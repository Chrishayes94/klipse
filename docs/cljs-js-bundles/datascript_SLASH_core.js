var me={tonsky:{}};me.tonsky.persistent_sorted_set={};me.tonsky.persistent_sorted_set.arrays={};me.tonsky.persistent_sorted_set.arrays.if_cljs=function(a,b,c){return cljs.core.truth_((new cljs.core.Keyword(null,"ns","ns",441598760)).cljs$core$IFn$_invoke$arity$1(a))?b:c};me.tonsky.persistent_sorted_set.arrays.make_array=function(a){return Array(a)};me.tonsky.persistent_sorted_set.arrays.into_array=function(a){return cljs.core.reduce.call(null,function(a,c){a.push(c);return a},[],a)};
me.tonsky.persistent_sorted_set.arrays.aclone=function(a){return a.slice(0)};me.tonsky.persistent_sorted_set.arrays.aconcat=function(a,b){return a.concat(b)};me.tonsky.persistent_sorted_set.arrays.amap=function(a,b){return b.map(a)};me.tonsky.persistent_sorted_set.arrays.asort=function(a,b){return a.sort(b)};me.tonsky.persistent_sorted_set.arrays.array_QMARK_=function(a){return"nodejs"===cljs.core._STAR_target_STAR_?Array.isArray(a):a instanceof Array};me.tonsky.persistent_sorted_set.min_len=16;me.tonsky.persistent_sorted_set.max_len=32;me.tonsky.persistent_sorted_set.avg_len=24;me.tonsky.persistent_sorted_set.level_shift=cljs.core.first.call(null,cljs.core.filter.call(null,function(a){return 0!=(32&1<<a)},cljs.core.range.call(null,31,-1,-1)))+1;me.tonsky.persistent_sorted_set.path_mask=(1<<me.tonsky.persistent_sorted_set.level_shift)-1;me.tonsky.persistent_sorted_set.empty_path=0;
me.tonsky.persistent_sorted_set.path_get=function(a,b){return me.tonsky.persistent_sorted_set.path_mask&a>>>b};me.tonsky.persistent_sorted_set.path_set=function(a,b,c){return a|c<<b};me.tonsky.persistent_sorted_set.binary_search_l=function(a,b,c,d){for(var e=0,f=cljs.core.long$.call(null,c);;)if(e<=f)c=e+f>>>1,0>a.call(null,b[c],d)?e=c+1:f=c-1;else return e};
me.tonsky.persistent_sorted_set.binary_search_r=function(a,b,c,d){for(var e=0,f=cljs.core.long$.call(null,c);;)if(e<=f)c=e+f>>>1,0<a.call(null,b[c],d)?f=c-1:e=c+1;else return e};me.tonsky.persistent_sorted_set.lookup_exact=function(a,b,c){var d=b.length,e=me.tonsky.persistent_sorted_set.binary_search_l.call(null,a,b,d-1,c);return e<d&&0===a.call(null,b[e],c)?e:-1};
me.tonsky.persistent_sorted_set.lookup_range=function(a,b,c){var d=b.length;a=me.tonsky.persistent_sorted_set.binary_search_l.call(null,a,b,d-1,c);return a===d?-1:a};me.tonsky.persistent_sorted_set.cut_n_splice=function(a,b,c,d,e,f){var g=f.length,h=d-b,k=h+g,l=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,h+g+(c-e));d-=b;for(var m=0;;)if(m<d)l[m+0]=a[m+b],m+=1;else break;b=g-0;for(g=0;;)if(g<b)l[g+h]=f[g+0],g+=1;else break;c-=e;for(f=0;;)if(f<c)l[f+k]=a[f+e],f+=1;else break;return l};
me.tonsky.persistent_sorted_set.splice=function(a,b,c,d){return me.tonsky.persistent_sorted_set.cut_n_splice.call(null,a,0,a.length,b,c,d)};me.tonsky.persistent_sorted_set.insert=function(a,b,c){return me.tonsky.persistent_sorted_set.cut_n_splice.call(null,a,0,a.length,b,b,c)};
me.tonsky.persistent_sorted_set.merge_n_split=function(a,b){var c=a.length,d=b.length,e=c+d,f=e>>>1,g=e-f;e=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,f);g=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,g);if(c<=f){for(var h=c-0,k=0;;)if(k<h)e[k+0]=a[k+0],k+=1;else break;a=f-c;for(h=0;;)if(h<a)e[h+c]=b[h+0],h+=1;else break;d-=f-c;for(a=0;;)if(a<d)g[a+0]=b[a+(f-c)],a+=1;else break}else{h=f-0;for(k=0;;)if(k<h)e[k+0]=a[k+0],k+=1;else break;h=c-f;for(k=0;;)if(k<h)g[k+0]=
a[k+f],k+=1;else break;d-=0;for(a=0;;)if(a<d)g[a+(c-f)]=b[a+0],a+=1;else break}return[e,g]};me.tonsky.persistent_sorted_set.eq_arr=function(a,b,c,d,e,f,g){d-=c;if(g=d===g-f)for(g=0;;){if(g===d)return!0;if(0!==a.call(null,b[g+c],e[g+f]))return!1;g+=1}else return g};me.tonsky.persistent_sorted_set.check_n_splice=function(a,b,c,d,e){return me.tonsky.persistent_sorted_set.eq_arr.call(null,a,b,c,d,e,0,e.length)?b:me.tonsky.persistent_sorted_set.splice.call(null,b,c,d,e)};
me.tonsky.persistent_sorted_set.return_array=function(a){switch(arguments.length){case 1:return me.tonsky.persistent_sorted_set.return_array.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 2:return me.tonsky.persistent_sorted_set.return_array.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return me.tonsky.persistent_sorted_set.return_array.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));
}};me.tonsky.persistent_sorted_set.return_array.cljs$core$IFn$_invoke$arity$1=function(a){return[a]};me.tonsky.persistent_sorted_set.return_array.cljs$core$IFn$_invoke$arity$2=function(a,b){return cljs.core.truth_(a)?cljs.core.truth_(b)?[a,b]:[a]:[b]};
me.tonsky.persistent_sorted_set.return_array.cljs$core$IFn$_invoke$arity$3=function(a,b,c){return cljs.core.truth_(a)?cljs.core.truth_(b)?cljs.core.truth_(c)?[a,b,c]:[a,b]:cljs.core.truth_(c)?[a,c]:[a]:cljs.core.truth_(b)?cljs.core.truth_(c)?[b,c]:[b]:[c]};me.tonsky.persistent_sorted_set.return_array.cljs$lang$maxFixedArity=3;me.tonsky.persistent_sorted_set.INode=function(){};
me.tonsky.persistent_sorted_set.node_lim_key=function(a){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_lim_key$arity$1)return a.me$tonsky$persistent_sorted_set$INode$node_lim_key$arity$1(a);var b=me.tonsky.persistent_sorted_set.node_lim_key[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=me.tonsky.persistent_sorted_set.node_lim_key._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"INode.node-lim-key",a);};
me.tonsky.persistent_sorted_set.node_len=function(a){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_len$arity$1)return a.me$tonsky$persistent_sorted_set$INode$node_len$arity$1(a);var b=me.tonsky.persistent_sorted_set.node_len[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=me.tonsky.persistent_sorted_set.node_len._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"INode.node-len",a);};
me.tonsky.persistent_sorted_set.node_merge=function(a,b){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_merge$arity$2)return a.me$tonsky$persistent_sorted_set$INode$node_merge$arity$2(a,b);var c=me.tonsky.persistent_sorted_set.node_merge[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=me.tonsky.persistent_sorted_set.node_merge._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"INode.node-merge",a);};
me.tonsky.persistent_sorted_set.node_merge_n_split=function(a,b){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_merge_n_split$arity$2)return a.me$tonsky$persistent_sorted_set$INode$node_merge_n_split$arity$2(a,b);var c=me.tonsky.persistent_sorted_set.node_merge_n_split[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=me.tonsky.persistent_sorted_set.node_merge_n_split._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"INode.node-merge-n-split",
a);};me.tonsky.persistent_sorted_set.node_lookup=function(a,b,c){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_lookup$arity$3)return a.me$tonsky$persistent_sorted_set$INode$node_lookup$arity$3(a,b,c);var d=me.tonsky.persistent_sorted_set.node_lookup[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=me.tonsky.persistent_sorted_set.node_lookup._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"INode.node-lookup",a);};
me.tonsky.persistent_sorted_set.node_conj=function(a,b,c){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_conj$arity$3)return a.me$tonsky$persistent_sorted_set$INode$node_conj$arity$3(a,b,c);var d=me.tonsky.persistent_sorted_set.node_conj[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=me.tonsky.persistent_sorted_set.node_conj._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"INode.node-conj",a);};
me.tonsky.persistent_sorted_set.node_disj=function(a,b,c,d,e,f){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$INode$node_disj$arity$6)return a.me$tonsky$persistent_sorted_set$INode$node_disj$arity$6(a,b,c,d,e,f);var g=me.tonsky.persistent_sorted_set.node_disj[goog.typeOf(null==a?null:a)];if(null!=g)return g.call(null,a,b,c,d,e,f);g=me.tonsky.persistent_sorted_set.node_disj._;if(null!=g)return g.call(null,a,b,c,d,e,f);throw cljs.core.missing_protocol.call(null,"INode.node-disj",a);};
me.tonsky.persistent_sorted_set.rotate=function(a,b,c,d){if(cljs.core.truth_(b))return me.tonsky.persistent_sorted_set.return_array.call(null,a);if(16<me.tonsky.persistent_sorted_set.node_len.call(null,a))return me.tonsky.persistent_sorted_set.return_array.call(null,c,a,d);if(cljs.core.truth_(cljs.core.truth_(c)?16>=me.tonsky.persistent_sorted_set.node_len.call(null,c):c))return me.tonsky.persistent_sorted_set.return_array.call(null,me.tonsky.persistent_sorted_set.node_merge.call(null,c,a),d);if(cljs.core.truth_(cljs.core.truth_(d)?
16>=me.tonsky.persistent_sorted_set.node_len.call(null,d):d))return me.tonsky.persistent_sorted_set.return_array.call(null,c,me.tonsky.persistent_sorted_set.node_merge.call(null,a,d));if(cljs.core.truth_(cljs.core.truth_(c)?null==d||me.tonsky.persistent_sorted_set.node_len.call(null,c)<me.tonsky.persistent_sorted_set.node_len.call(null,d):c))return a=me.tonsky.persistent_sorted_set.node_merge_n_split.call(null,c,a),me.tonsky.persistent_sorted_set.return_array.call(null,a[0],a[1],d);a=me.tonsky.persistent_sorted_set.node_merge_n_split.call(null,
a,d);return me.tonsky.persistent_sorted_set.return_array.call(null,c,a[0],a[1])};me.tonsky.persistent_sorted_set.Node=function(a,b){this.keys=a;this.pointers=b};me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$=cljs.core.PROTOCOL_SENTINEL;me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_lim_key$arity$1=function(a){a=this.keys;return a[a.length-1]};
me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_len$arity$1=function(a){return this.keys.length};me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_merge$arity$2=function(a,b){return new me.tonsky.persistent_sorted_set.Node(me.tonsky.persistent_sorted_set.arrays.aconcat.call(null,this.keys,b.keys),me.tonsky.persistent_sorted_set.arrays.aconcat.call(null,this.pointers,b.pointers))};
me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_merge_n_split$arity$2=function(a,b){a=me.tonsky.persistent_sorted_set.merge_n_split.call(null,this.keys,b.keys);b=me.tonsky.persistent_sorted_set.merge_n_split.call(null,this.pointers,b.pointers);return me.tonsky.persistent_sorted_set.return_array.call(null,new me.tonsky.persistent_sorted_set.Node(a[0],b[0]),new me.tonsky.persistent_sorted_set.Node(a[1],b[1]))};
me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_lookup$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set.lookup_range.call(null,b,this.keys,c);return-1===a?null:me.tonsky.persistent_sorted_set.node_lookup.call(null,this.pointers[a],b,c)};
me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_conj$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set.binary_search_l.call(null,b,this.keys,this.keys.length-2,c);c=me.tonsky.persistent_sorted_set.node_conj.call(null,this.pointers[a],b,c);if(cljs.core.truth_(c)){b=me.tonsky.persistent_sorted_set.check_n_splice.call(null,b,this.keys,a,a+1,me.tonsky.persistent_sorted_set.arrays.amap.call(null,me.tonsky.persistent_sorted_set.node_lim_key,c));a=me.tonsky.persistent_sorted_set.splice.call(null,
this.pointers,a,a+1,c);if(32>=a.length)return[new me.tonsky.persistent_sorted_set.Node(b,a)];c=a.length>>>1;return[new me.tonsky.persistent_sorted_set.Node(b.slice(0,c),a.slice(0,c)),new me.tonsky.persistent_sorted_set.Node(b.slice(c),a.slice(c))]}return null};
me.tonsky.persistent_sorted_set.Node.prototype.me$tonsky$persistent_sorted_set$INode$node_disj$arity$6=function(a,b,c,d,e,f){a=me.tonsky.persistent_sorted_set.lookup_range.call(null,b,this.keys,c);if(-1===a)return null;var g=0<=a-1?this.pointers[a-1]:null,h=a+1<this.pointers.length?this.pointers[a+1]:null;c=me.tonsky.persistent_sorted_set.node_disj.call(null,this.pointers[a],b,c,!1,g,h);return cljs.core.truth_(c)?(g=cljs.core.truth_(g)?a-1:a,a=cljs.core.truth_(h)?2+a:1+a,b=me.tonsky.persistent_sorted_set.check_n_splice.call(null,
b,this.keys,g,a,me.tonsky.persistent_sorted_set.arrays.amap.call(null,me.tonsky.persistent_sorted_set.node_lim_key,c)),c=me.tonsky.persistent_sorted_set.splice.call(null,this.pointers,g,a,c),me.tonsky.persistent_sorted_set.rotate.call(null,new me.tonsky.persistent_sorted_set.Node(b,c),d,e,f)):null};
me.tonsky.persistent_sorted_set.Node.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"keys","keys",-1586012071,null),new cljs.core.Symbol(null,"pointers","pointers",-1669058356,null)],null)};me.tonsky.persistent_sorted_set.Node.cljs$lang$type=!0;me.tonsky.persistent_sorted_set.Node.cljs$lang$ctorStr="me.tonsky.persistent-sorted-set/Node";
me.tonsky.persistent_sorted_set.Node.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"me.tonsky.persistent-sorted-set/Node")};me.tonsky.persistent_sorted_set.__GT_Node=function(a,b){return new me.tonsky.persistent_sorted_set.Node(a,b)};me.tonsky.persistent_sorted_set.Leaf=function(a){this.keys=a};me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$=cljs.core.PROTOCOL_SENTINEL;
me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_lim_key$arity$1=function(a){a=this.keys;return a[a.length-1]};me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_len$arity$1=function(a){return this.keys.length};
me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_merge$arity$2=function(a,b){return new me.tonsky.persistent_sorted_set.Leaf(me.tonsky.persistent_sorted_set.arrays.aconcat.call(null,this.keys,b.keys))};
me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_merge_n_split$arity$2=function(a,b){a=me.tonsky.persistent_sorted_set.merge_n_split.call(null,this.keys,b.keys);return me.tonsky.persistent_sorted_set.return_array.call(null,new me.tonsky.persistent_sorted_set.Leaf(a[0]),new me.tonsky.persistent_sorted_set.Leaf(a[1]))};
me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_lookup$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set.lookup_exact.call(null,b,this.keys,c);return-1===a?null:this.keys[a]};
me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_conj$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set.binary_search_l.call(null,b,this.keys,this.keys.length-1,c);var d=this.keys.length;return a<d&&0===b.call(null,c,this.keys[a])?null:32===d?(b=d+1>>>1,a>b?[new me.tonsky.persistent_sorted_set.Leaf(this.keys.slice(0,b)),new me.tonsky.persistent_sorted_set.Leaf(me.tonsky.persistent_sorted_set.cut_n_splice.call(null,this.keys,b,d,a,a,[c]))]:[new me.tonsky.persistent_sorted_set.Leaf(me.tonsky.persistent_sorted_set.cut_n_splice.call(null,
this.keys,0,b,a,a,[c])),new me.tonsky.persistent_sorted_set.Leaf(this.keys.slice(b,d))]):[new me.tonsky.persistent_sorted_set.Leaf(me.tonsky.persistent_sorted_set.splice.call(null,this.keys,a,a,[c]))]};
me.tonsky.persistent_sorted_set.Leaf.prototype.me$tonsky$persistent_sorted_set$INode$node_disj$arity$6=function(a,b,c,d,e,f){a=me.tonsky.persistent_sorted_set.lookup_exact.call(null,b,this.keys,c);if(-1===a)return null;a=me.tonsky.persistent_sorted_set.splice.call(null,this.keys,a,a+1,[]);return me.tonsky.persistent_sorted_set.rotate.call(null,new me.tonsky.persistent_sorted_set.Leaf(a),d,e,f)};
me.tonsky.persistent_sorted_set.Leaf.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"keys","keys",-1586012071,null)],null)};me.tonsky.persistent_sorted_set.Leaf.cljs$lang$type=!0;me.tonsky.persistent_sorted_set.Leaf.cljs$lang$ctorStr="me.tonsky.persistent-sorted-set/Leaf";me.tonsky.persistent_sorted_set.Leaf.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"me.tonsky.persistent-sorted-set/Leaf")};
me.tonsky.persistent_sorted_set.__GT_Leaf=function(a){return new me.tonsky.persistent_sorted_set.Leaf(a)};me.tonsky.persistent_sorted_set.uninitialized_hash=null;me.tonsky.persistent_sorted_set.BTSet=function(a,b,c,d,e,f){this.root=a;this.shift=b;this.cnt=c;this.comparator=d;this.meta=e;this._hash=f;this.cljs$lang$protocol_mask$partition0$=2297303311;this.cljs$lang$protocol_mask$partition1$=8332};
me.tonsky.persistent_sorted_set.BTSet.prototype.toString=function(){return cljs.core.pr_str_STAR_.call(null,this)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return me.tonsky.persistent_sorted_set.node_lookup.call(null,this.root,this.comparator,b)};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set.node_lookup.call(null,this.root,this.comparator,b);return cljs.core.truth_(a)?a:c};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,"#{"," ","}",c,cljs.core.seq.call(null,this))};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.meta};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new me.tonsky.persistent_sorted_set.BTSet(this.root,this.shift,this.cnt,this.comparator,this.meta,this._hash)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ICounted$_count$arity$1=function(a){return this.cnt};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IReversible$_rseq$arity$1=function(a){return cljs.core.rseq.call(null,me.tonsky.persistent_sorted_set.btset_iter.call(null,this))};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this._hash;return null!=a?a:this._hash=a=cljs.core.hash_unordered_coll.call(null,this)};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return cljs.core.set_QMARK_.call(null,b)&&this.cnt===cljs.core.count.call(null,b)&&cljs.core.every_QMARK_.call(null,function(a){return function(b){return cljs.core.contains_QMARK_.call(null,a,b)}}(this),b)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IEditableCollection$_as_transient$arity$1=function(a){return this};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IEmptyableCollection$_empty$arity$1=function(a){return new me.tonsky.persistent_sorted_set.BTSet(new me.tonsky.persistent_sorted_set.Leaf([]),0,0,this.comparator,this.meta,null)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ISet$_disjoin$arity$2=function(a,b){return me.tonsky.persistent_sorted_set.disj.call(null,this,b,this.comparator)};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IReduce$_reduce$arity$2=function(a,b){a=me.tonsky.persistent_sorted_set.btset_iter.call(null,this);return cljs.core.truth_(a)?cljs.core._reduce.call(null,a,b):b.call(null)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IReduce$_reduce$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set.btset_iter.call(null,this);return cljs.core.truth_(a)?cljs.core._reduce.call(null,a,b,c):c};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ITransientCollection$_conj_BANG_$arity$2=function(a,b){return me.tonsky.persistent_sorted_set.conj.call(null,this,b,this.comparator)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ITransientCollection$_persistent_BANG_$arity$1=function(a){return this};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return me.tonsky.persistent_sorted_set.btset_iter.call(null,this)};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ITransientSet$_disjoin_BANG_$arity$2=function(a,b){return me.tonsky.persistent_sorted_set.disj.call(null,this,b,this.comparator)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new me.tonsky.persistent_sorted_set.BTSet(this.root,this.shift,this.cnt,this.comparator,b,this._hash)};
me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return me.tonsky.persistent_sorted_set.conj.call(null,this,b,this.comparator)};
me.tonsky.persistent_sorted_set.BTSet.prototype.call=function(){var a=null,b=function(a,b){return cljs.core._lookup.call(null,this,b)},c=function(a,b,c){return cljs.core._lookup.call(null,this,b,c)};a=function(a,e,f){switch(arguments.length){case 2:return b.call(this,a,e);case 3:return c.call(this,a,e,f)}throw Error("Invalid arity: "+(arguments.length-1));};a.cljs$core$IFn$_invoke$arity$2=b;a.cljs$core$IFn$_invoke$arity$3=c;return a}();
me.tonsky.persistent_sorted_set.BTSet.prototype.apply=function(a,b){return this.call.apply(this,[this].concat(cljs.core.aclone.call(null,b)))};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IFn$_invoke$arity$1=function(a){return cljs.core._lookup.call(null,this,a)};me.tonsky.persistent_sorted_set.BTSet.prototype.cljs$core$IFn$_invoke$arity$2=function(a,b){return cljs.core._lookup.call(null,this,a,b)};
me.tonsky.persistent_sorted_set.BTSet.getBasis=function(){return new cljs.core.PersistentVector(null,6,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"root","root",1191874074,null),new cljs.core.Symbol(null,"shift","shift",-1657295705,null),new cljs.core.Symbol(null,"cnt","cnt",1924510325,null),new cljs.core.Symbol(null,"comparator","comparator",-509539107,null),new cljs.core.Symbol(null,"meta","meta",-1154898805,null),cljs.core.with_meta(new cljs.core.Symbol(null,"_hash","_hash",
-2130838312,null),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"mutable","mutable",875778266),!0],null))],null)};me.tonsky.persistent_sorted_set.BTSet.cljs$lang$type=!0;me.tonsky.persistent_sorted_set.BTSet.cljs$lang$ctorStr="me.tonsky.persistent-sorted-set/BTSet";me.tonsky.persistent_sorted_set.BTSet.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"me.tonsky.persistent-sorted-set/BTSet")};
me.tonsky.persistent_sorted_set.__GT_BTSet=function(a,b,c,d,e,f){return new me.tonsky.persistent_sorted_set.BTSet(a,b,c,d,e,f)};me.tonsky.persistent_sorted_set.keys_for=function(a,b){for(var c=a.shift,d=a.root;;)if(0<c)a=c-me.tonsky.persistent_sorted_set.level_shift,d=d.pointers[me.tonsky.persistent_sorted_set.path_get.call(null,b,c)],c=a;else return d.keys};me.tonsky.persistent_sorted_set.alter_btset=function(a,b,c,d){return new me.tonsky.persistent_sorted_set.BTSet(b,c,d,a.comparator,a.meta,null)};
me.tonsky.persistent_sorted_set._next_path=function(a,b,c){var d=me.tonsky.persistent_sorted_set.path_get.call(null,b,c);return 0<c?(b=me.tonsky.persistent_sorted_set._next_path.call(null,a.pointers[d],b,c-me.tonsky.persistent_sorted_set.level_shift),-1===b?d+1<a.pointers.length?me.tonsky.persistent_sorted_set.path_set.call(null,0,c,d+1):-1:me.tonsky.persistent_sorted_set.path_set.call(null,b,c,d)):d+1<a.keys.length?me.tonsky.persistent_sorted_set.path_set.call(null,0,0,d+1):-1};
me.tonsky.persistent_sorted_set.next_path=function(a,b){return me.tonsky.persistent_sorted_set._next_path.call(null,a.root,b,a.shift)};me.tonsky.persistent_sorted_set._rpath=function(a,b){for(var c=0;;)if(0<b){var d=a.pointers;d=d[d.length-1];c=me.tonsky.persistent_sorted_set.path_set.call(null,c,b,a.pointers.length-1);b-=me.tonsky.persistent_sorted_set.level_shift;a=d}else return me.tonsky.persistent_sorted_set.path_set.call(null,c,0,a.keys.length-1)};
me.tonsky.persistent_sorted_set._prev_path=function(a,b,c){var d=me.tonsky.persistent_sorted_set.path_get.call(null,b,c);if(0<c){var e=c-me.tonsky.persistent_sorted_set.level_shift;b=me.tonsky.persistent_sorted_set._prev_path.call(null,a.pointers[d],b,e);return-1===b?0<=d-1?(--d,a=me.tonsky.persistent_sorted_set._rpath.call(null,a.pointers[d],e),me.tonsky.persistent_sorted_set.path_set.call(null,a,c,d)):-1:me.tonsky.persistent_sorted_set.path_set.call(null,b,c,d)}return 0<=d-1?me.tonsky.persistent_sorted_set.path_set.call(null,
0,0,d-1):-1};me.tonsky.persistent_sorted_set.prev_path=function(a,b){return me.tonsky.persistent_sorted_set._prev_path.call(null,a.root,b,a.shift)};me.tonsky.persistent_sorted_set.btset_iter=function(a){if(0<me.tonsky.persistent_sorted_set.node_len.call(null,a.root)){var b=me.tonsky.persistent_sorted_set._rpath.call(null,a.root,a.shift)+1;return me.tonsky.persistent_sorted_set.iter.call(null,a,0,b)}return null};
me.tonsky.persistent_sorted_set.Chunk=function(a,b,c){this.arr=a;this.off=b;this.end=c;this.cljs$lang$protocol_mask$partition0$=524306;this.cljs$lang$protocol_mask$partition1$=0};me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$ICounted$_count$arity$1=function(a){return this.end-this.off};me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$IIndexed$_nth$arity$2=function(a,b){return this.arr[this.off+b]};
me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$IIndexed$_nth$arity$3=function(a,b,c){return 0<=b&&b<this.end-this.off?this.arr[this.off+b]:c};me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$IChunk$=cljs.core.PROTOCOL_SENTINEL;me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$IChunk$_drop_first$arity$1=function(a){if(this.off===this.end)throw Error("-drop-first of empty chunk");return new cljs.core.ArrayChunk(this.arr,this.off+1,this.end)};
me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$IReduce$_reduce$arity$2=function(a,b){return this.off===this.end?b.call(null):cljs.core._reduce.call(null,cljs.core._drop_first.call(null,this),b,this.arr[this.off])};me.tonsky.persistent_sorted_set.Chunk.prototype.cljs$core$IReduce$_reduce$arity$3=function(a,b,c){a=c;for(c=this.off;;)if(c<this.end){a=b.call(null,a,this.arr[c]);if(cljs.core.reduced_QMARK_.call(null,a))return cljs.core.deref.call(null,a);c+=1}else return a};
me.tonsky.persistent_sorted_set.Chunk.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"arr","arr",2115492975,null),new cljs.core.Symbol(null,"off","off",-2047994980,null),new cljs.core.Symbol(null,"end","end",1372345569,null)],null)};me.tonsky.persistent_sorted_set.Chunk.cljs$lang$type=!0;me.tonsky.persistent_sorted_set.Chunk.cljs$lang$ctorStr="me.tonsky.persistent-sorted-set/Chunk";
me.tonsky.persistent_sorted_set.Chunk.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"me.tonsky.persistent-sorted-set/Chunk")};me.tonsky.persistent_sorted_set.__GT_Chunk=function(a,b,c){return new me.tonsky.persistent_sorted_set.Chunk(a,b,c)};me.tonsky.persistent_sorted_set.IIter=function(){};
me.tonsky.persistent_sorted_set._copy=function(a,b,c){if(null!=a&&null!=a.me$tonsky$persistent_sorted_set$IIter$_copy$arity$3)return a.me$tonsky$persistent_sorted_set$IIter$_copy$arity$3(a,b,c);var d=me.tonsky.persistent_sorted_set._copy[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=me.tonsky.persistent_sorted_set._copy._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"IIter.-copy",a);};
me.tonsky.persistent_sorted_set.Iter=function(a,b,c,d,e){this.set=a;this.left=b;this.right=c;this.keys=d;this.idx=e;this.cljs$lang$protocol_mask$partition0$=2309488832;this.cljs$lang$protocol_mask$partition1$=1536};me.tonsky.persistent_sorted_set.Iter.prototype.toString=function(){return cljs.core.pr_str_STAR_.call(null,this)};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,"("," ",")",c,cljs.core.seq.call(null,this))};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$INext$_next$arity$1=function(a){if(cljs.core.truth_(this.keys)){if(this.idx+1<this.keys.length)return this.left+1<this.right?new me.tonsky.persistent_sorted_set.Iter(this.set,this.left+1,this.right,this.keys,this.idx+1):null;a=me.tonsky.persistent_sorted_set.next_path.call(null,this.set,this.left);return cljs.core.not_EQ_.call(null,-1,a)&&a<this.right?me.tonsky.persistent_sorted_set._copy.call(null,this,a,this.right):null}return null};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IReversible$_rseq$arity$1=function(a){return cljs.core.truth_(this.keys)?me.tonsky.persistent_sorted_set.riter.call(null,this.set,me.tonsky.persistent_sorted_set.prev_path.call(null,this.set,this.left),me.tonsky.persistent_sorted_set.prev_path.call(null,this.set,this.right)):null};me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return cljs.core.equiv_sequential.call(null,this,b)};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IReduce$_reduce$arity$2=function(a,b){if(null==this.keys)return b.call(null);a=cljs.core._first.call(null,this);var c=cljs.core._next.call(null,this);return null==c?a:cljs.core._reduce.call(null,c,b,a)};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IReduce$_reduce$arity$3=function(a,b,c){a=this.left;for(var d=this.keys,e=this.idx;;){if(null==d)return c;c=b.call(null,c,d[e]);if(cljs.core.reduced_QMARK_.call(null,c))return cljs.core.deref.call(null,c);if(e+1<d.length)if(a+1<this.right)e+=1,a+=1;else return c;else if(e=me.tonsky.persistent_sorted_set.next_path.call(null,this.set,a),-1!==e&&e<this.right)a=e,d=me.tonsky.persistent_sorted_set.keys_for.call(null,this.set,e),e=me.tonsky.persistent_sorted_set.path_get.call(null,
e,0);else return c}};me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$ISeq$_first$arity$1=function(a){return cljs.core.truth_(this.keys)?this.keys[this.idx]:null};me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$ISeq$_rest$arity$1=function(a){a=cljs.core._next.call(null,this);return cljs.core.truth_(a)?a:cljs.core.List.EMPTY};me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.truth_(this.keys)?this:null};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IChunkedSeq$_chunked_first$arity$1=function(a){a=cljs.core._EQ_.call(null,this.left|me.tonsky.persistent_sorted_set.path_mask,this.right|me.tonsky.persistent_sorted_set.path_mask)?this.right&me.tonsky.persistent_sorted_set.path_mask:this.keys.length;return new me.tonsky.persistent_sorted_set.Chunk(this.keys,this.idx,a)};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IChunkedSeq$_chunked_rest$arity$1=function(a){a=cljs.core._chunked_next.call(null,this);return cljs.core.truth_(a)?a:cljs.core.List.EMPTY};me.tonsky.persistent_sorted_set.Iter.prototype.me$tonsky$persistent_sorted_set$IIter$=cljs.core.PROTOCOL_SENTINEL;
me.tonsky.persistent_sorted_set.Iter.prototype.me$tonsky$persistent_sorted_set$IIter$_copy$arity$3=function(a,b,c){return new me.tonsky.persistent_sorted_set.Iter(this.set,b,c,me.tonsky.persistent_sorted_set.keys_for.call(null,this.set,b),me.tonsky.persistent_sorted_set.path_get.call(null,b,0))};
me.tonsky.persistent_sorted_set.Iter.prototype.cljs$core$IChunkedNext$_chunked_next$arity$1=function(a){a=me.tonsky.persistent_sorted_set.next_path.call(null,this.set,this.left+(this.keys.length-this.idx-1));return cljs.core.not_EQ_.call(null,-1,a)&&a<this.right?me.tonsky.persistent_sorted_set._copy.call(null,this,a,this.right):null};
me.tonsky.persistent_sorted_set.Iter.getBasis=function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"set","set",1945134081,null),new cljs.core.Symbol(null,"left","left",1241415590,null),new cljs.core.Symbol(null,"right","right",1187949694,null),new cljs.core.Symbol(null,"keys","keys",-1586012071,null),new cljs.core.Symbol(null,"idx","idx",-1600747296,null)],null)};me.tonsky.persistent_sorted_set.Iter.cljs$lang$type=!0;
me.tonsky.persistent_sorted_set.Iter.cljs$lang$ctorStr="me.tonsky.persistent-sorted-set/Iter";me.tonsky.persistent_sorted_set.Iter.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"me.tonsky.persistent-sorted-set/Iter")};me.tonsky.persistent_sorted_set.__GT_Iter=function(a,b,c,d,e){return new me.tonsky.persistent_sorted_set.Iter(a,b,c,d,e)};
me.tonsky.persistent_sorted_set.iter=function(a,b,c){return new me.tonsky.persistent_sorted_set.Iter(a,b,c,me.tonsky.persistent_sorted_set.keys_for.call(null,a,b),me.tonsky.persistent_sorted_set.path_get.call(null,b,0))};me.tonsky.persistent_sorted_set.ReverseIter=function(a,b,c,d,e){this.set=a;this.left=b;this.right=c;this.keys=d;this.idx=e;this.cljs$lang$protocol_mask$partition0$=2308964544;this.cljs$lang$protocol_mask$partition1$=0};
me.tonsky.persistent_sorted_set.ReverseIter.prototype.toString=function(){return cljs.core.pr_str_STAR_.call(null,this)};me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,"("," ",")",c,cljs.core.seq.call(null,this))};
me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$INext$_next$arity$1=function(a){if(cljs.core.truth_(this.keys)){if(0<=this.idx-1)return this.right-1>this.left?new me.tonsky.persistent_sorted_set.ReverseIter(this.set,this.left,this.right-1,this.keys,this.idx-1):null;a=me.tonsky.persistent_sorted_set.prev_path.call(null,this.set,this.right);return cljs.core.not_EQ_.call(null,-1,a)&&a>this.left?me.tonsky.persistent_sorted_set._copy.call(null,this,this.left,a):null}return null};
me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$IReversible$_rseq$arity$1=function(a){if(cljs.core.truth_(this.keys)){a=-1===this.left?0:me.tonsky.persistent_sorted_set.next_path.call(null,this.set,this.left);var b=me.tonsky.persistent_sorted_set.next_path.call(null,this.set,this.right);return me.tonsky.persistent_sorted_set.iter.call(null,this.set,a,-1===b?this.right+1:b)}return null};
me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return cljs.core.equiv_sequential.call(null,this,b)};me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$ISeq$_first$arity$1=function(a){return cljs.core.truth_(this.keys)?this.keys[this.idx]:null};me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$ISeq$_rest$arity$1=function(a){a=cljs.core._next.call(null,this);return cljs.core.truth_(a)?a:cljs.core.List.EMPTY};
me.tonsky.persistent_sorted_set.ReverseIter.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.truth_(this.keys)?this:null};me.tonsky.persistent_sorted_set.ReverseIter.prototype.me$tonsky$persistent_sorted_set$IIter$=cljs.core.PROTOCOL_SENTINEL;
me.tonsky.persistent_sorted_set.ReverseIter.prototype.me$tonsky$persistent_sorted_set$IIter$_copy$arity$3=function(a,b,c){return new me.tonsky.persistent_sorted_set.ReverseIter(this.set,b,c,me.tonsky.persistent_sorted_set.keys_for.call(null,this.set,c),me.tonsky.persistent_sorted_set.path_get.call(null,c,0))};
me.tonsky.persistent_sorted_set.ReverseIter.getBasis=function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"set","set",1945134081,null),new cljs.core.Symbol(null,"left","left",1241415590,null),new cljs.core.Symbol(null,"right","right",1187949694,null),new cljs.core.Symbol(null,"keys","keys",-1586012071,null),new cljs.core.Symbol(null,"idx","idx",-1600747296,null)],null)};
me.tonsky.persistent_sorted_set.ReverseIter.cljs$lang$type=!0;me.tonsky.persistent_sorted_set.ReverseIter.cljs$lang$ctorStr="me.tonsky.persistent-sorted-set/ReverseIter";me.tonsky.persistent_sorted_set.ReverseIter.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"me.tonsky.persistent-sorted-set/ReverseIter")};me.tonsky.persistent_sorted_set.__GT_ReverseIter=function(a,b,c,d,e){return new me.tonsky.persistent_sorted_set.ReverseIter(a,b,c,d,e)};
me.tonsky.persistent_sorted_set.riter=function(a,b,c){return new me.tonsky.persistent_sorted_set.ReverseIter(a,b,c,me.tonsky.persistent_sorted_set.keys_for.call(null,a,c),me.tonsky.persistent_sorted_set.path_get.call(null,c,0))};
me.tonsky.persistent_sorted_set._distance=function(a,b,c,d){var e=me.tonsky.persistent_sorted_set.path_get.call(null,b,d),f=me.tonsky.persistent_sorted_set.path_get.call(null,c,d);if(0<d){if(e===f)return me.tonsky.persistent_sorted_set._distance.call(null,a.pointers[e],b,c,d-me.tonsky.persistent_sorted_set.level_shift);a=d;for(e=f-e;;){if(0===a)return e;e*=me.tonsky.persistent_sorted_set.avg_len;a-=me.tonsky.persistent_sorted_set.level_shift}}else return f-e};
me.tonsky.persistent_sorted_set.distance=function(a,b,c){return b===c?0:b+1===c?1:me.tonsky.persistent_sorted_set.next_path.call(null,a,b)===c?1:me.tonsky.persistent_sorted_set._distance.call(null,a.root,b,c,a.shift)};me.tonsky.persistent_sorted_set.est_count=function(a){return me.tonsky.persistent_sorted_set.distance.call(null,a.set,a.left,a.right)};
me.tonsky.persistent_sorted_set._seek=function(a,b,c){var d=a.root,e=0;for(a=a.shift;;){var f=me.tonsky.persistent_sorted_set.node_len.call(null,d);if(0===a){var g=d.keys;g=me.tonsky.persistent_sorted_set.binary_search_l.call(null,c,g,f-1,b);return f===g?-1:me.tonsky.persistent_sorted_set.path_set.call(null,e,0,g)}g=d.keys;g=me.tonsky.persistent_sorted_set.binary_search_l.call(null,c,g,f-2,b);d=d.pointers[g];e=me.tonsky.persistent_sorted_set.path_set.call(null,e,a,g);a-=me.tonsky.persistent_sorted_set.level_shift}};
me.tonsky.persistent_sorted_set._rseek=function(a,b,c){var d=a.root,e=0;for(a=a.shift;;){var f=me.tonsky.persistent_sorted_set.node_len.call(null,d);if(0===a){var g=d.keys;f=me.tonsky.persistent_sorted_set.binary_search_r.call(null,c,g,f-1,b);return me.tonsky.persistent_sorted_set.path_set.call(null,e,0,f)}g=d.keys;f=me.tonsky.persistent_sorted_set.binary_search_r.call(null,c,g,f-2,b);d=d.pointers[f];e=me.tonsky.persistent_sorted_set.path_set.call(null,e,a,f);a-=me.tonsky.persistent_sorted_set.level_shift}};
me.tonsky.persistent_sorted_set._slice=function(a,b,c,d){b=me.tonsky.persistent_sorted_set._seek.call(null,a,b,d);if(0>b)return null;c=me.tonsky.persistent_sorted_set._rseek.call(null,a,c,d);return c>b?new me.tonsky.persistent_sorted_set.Iter(a,b,c,me.tonsky.persistent_sorted_set.keys_for.call(null,a,b),me.tonsky.persistent_sorted_set.path_get.call(null,b,0)):null};
me.tonsky.persistent_sorted_set.arr_map_inplace=function(a,b){for(var c=b.length,d=0;;)if(d<c)b[d]=a.call(null,b[d]),d+=1;else break;return b};
me.tonsky.persistent_sorted_set.arr_partition_approx=function(a,b,c){var d=me.tonsky.persistent_sorted_set.avg_len,e=c.length,f=cljs.core.transient$.call(null,cljs.core.PersistentVector.EMPTY);if(0<e)for(var g=0;;){var h=e-g;if(h<=b){cljs.core.conj_BANG_.call(null,f,c.slice(g));break}else h>=d+a?(cljs.core.conj_BANG_.call(null,f,c.slice(g,g+d)),g+=d):(h>>>=1,cljs.core.conj_BANG_.call(null,f,c.slice(g,g+h)),g+=h)}return cljs.core.to_array.call(null,cljs.core.persistent_BANG_.call(null,f))};
me.tonsky.persistent_sorted_set.sorted_arr_distinct_QMARK_=function(a,b){var c=a.length;if(1>=c)return!0;for(var d=1,e=a[0];;){if(d>=c)return!0;var f=a[d];if(0===b.call(null,f,e))return!1;e=f;d+=1}};
me.tonsky.persistent_sorted_set.sorted_arr_distinct=function(a,b){if(cljs.core.truth_(me.tonsky.persistent_sorted_set.sorted_arr_distinct_QMARK_.call(null,a,b)))return a;for(var c=a.length,d=cljs.core.transient$.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[a[0]],null)),e=1,f=a[0];;){if(e>=c)return cljs.core.into_array.call(null,cljs.core.persistent_BANG_.call(null,d));var g=a[e];0===b.call(null,g,f)?(e+=1,f=g):(d=cljs.core.conj_BANG_.call(null,d,g),e+=1,
f=g)}};me.tonsky.persistent_sorted_set.conj=function(a,b,c){b=me.tonsky.persistent_sorted_set.node_conj.call(null,a.root,c,b);return null==b?a:1===b.length?me.tonsky.persistent_sorted_set.alter_btset.call(null,a,b[0],a.shift,a.cnt+1):me.tonsky.persistent_sorted_set.alter_btset.call(null,a,new me.tonsky.persistent_sorted_set.Node(me.tonsky.persistent_sorted_set.arrays.amap.call(null,me.tonsky.persistent_sorted_set.node_lim_key,b),b),a.shift+me.tonsky.persistent_sorted_set.level_shift,a.cnt+1)};
me.tonsky.persistent_sorted_set.disj=function(a,b,c){b=me.tonsky.persistent_sorted_set.node_disj.call(null,a.root,c,b,!0,null,null);if(null==b)return a;b=b[0];return b instanceof me.tonsky.persistent_sorted_set.Node&&1===b.pointers.length?me.tonsky.persistent_sorted_set.alter_btset.call(null,a,b.pointers[0],a.shift-me.tonsky.persistent_sorted_set.level_shift,a.cnt-1):me.tonsky.persistent_sorted_set.alter_btset.call(null,a,b,a.shift,a.cnt-1)};
me.tonsky.persistent_sorted_set.slice=function(a){switch(arguments.length){case 3:return me.tonsky.persistent_sorted_set.slice.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return me.tonsky.persistent_sorted_set.slice.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
me.tonsky.persistent_sorted_set.slice.cljs$core$IFn$_invoke$arity$3=function(a,b,c){return me.tonsky.persistent_sorted_set._slice.call(null,a,b,c,a.comparator)};me.tonsky.persistent_sorted_set.slice.cljs$core$IFn$_invoke$arity$4=function(a,b,c,d){return me.tonsky.persistent_sorted_set._slice.call(null,a,b,c,d)};me.tonsky.persistent_sorted_set.slice.cljs$lang$maxFixedArity=4;
me.tonsky.persistent_sorted_set.rslice=function(a){switch(arguments.length){case 2:return me.tonsky.persistent_sorted_set.rslice.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return me.tonsky.persistent_sorted_set.rslice.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return me.tonsky.persistent_sorted_set.rslice.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));
}};me.tonsky.persistent_sorted_set.rslice.cljs$core$IFn$_invoke$arity$2=function(a,b){a=me.tonsky.persistent_sorted_set._slice.call(null,a,b,b,a.comparator);return null==a?null:cljs.core.rseq.call(null,a)};me.tonsky.persistent_sorted_set.rslice.cljs$core$IFn$_invoke$arity$3=function(a,b,c){a=me.tonsky.persistent_sorted_set._slice.call(null,a,c,b,a.comparator);return null==a?null:cljs.core.rseq.call(null,a)};
me.tonsky.persistent_sorted_set.rslice.cljs$core$IFn$_invoke$arity$4=function(a,b,c,d){a=me.tonsky.persistent_sorted_set._slice.call(null,a,c,b,d);return null==a?null:cljs.core.rseq.call(null,a)};me.tonsky.persistent_sorted_set.rslice.cljs$lang$maxFixedArity=4;
me.tonsky.persistent_sorted_set.from_sorted_array=function(a,b){for(var c=me.tonsky.persistent_sorted_set.arr_map_inplace.call(null,function(a){return new me.tonsky.persistent_sorted_set.Leaf(a)},me.tonsky.persistent_sorted_set.arr_partition_approx.call(null,16,32,b)),d=c,e=0;;){var f=cljs.core.count.call(null,d);switch(f){case 0:return new me.tonsky.persistent_sorted_set.BTSet(new me.tonsky.persistent_sorted_set.Leaf([]),0,0,a,null,null);case 1:return new me.tonsky.persistent_sorted_set.BTSet(cljs.core.first.call(null,
d),e,b.length,a,null,null);default:d=me.tonsky.persistent_sorted_set.arr_map_inplace.call(null,function(a,b,c,d){return function(a){return new me.tonsky.persistent_sorted_set.Node(me.tonsky.persistent_sorted_set.arrays.amap.call(null,me.tonsky.persistent_sorted_set.node_lim_key,a),a)}}(d,e,f,c),me.tonsky.persistent_sorted_set.arr_partition_approx.call(null,16,32,d)),e+=me.tonsky.persistent_sorted_set.level_shift}}};
me.tonsky.persistent_sorted_set.from_sequential=function(a,b){b=me.tonsky.persistent_sorted_set.sorted_arr_distinct.call(null,me.tonsky.persistent_sorted_set.arrays.asort.call(null,cljs.core.into_array.call(null,b),a),a);return me.tonsky.persistent_sorted_set.from_sorted_array.call(null,a,b)};
me.tonsky.persistent_sorted_set.sorted_set_by=function(a){switch(arguments.length){case 1:return me.tonsky.persistent_sorted_set.sorted_set_by.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=new cljs.core.IndexedSeq(b.slice(1),0,null);return me.tonsky.persistent_sorted_set.sorted_set_by.cljs$core$IFn$_invoke$arity$variadic(arguments[0],b)}};
me.tonsky.persistent_sorted_set.sorted_set_by.cljs$core$IFn$_invoke$arity$1=function(a){return new me.tonsky.persistent_sorted_set.BTSet(new me.tonsky.persistent_sorted_set.Leaf([]),0,0,a,null,null)};me.tonsky.persistent_sorted_set.sorted_set_by.cljs$core$IFn$_invoke$arity$variadic=function(a,b){return me.tonsky.persistent_sorted_set.from_sequential.call(null,a,b)};
me.tonsky.persistent_sorted_set.sorted_set_by.cljs$lang$applyTo=function(a){var b=cljs.core.first.call(null,a);a=cljs.core.next.call(null,a);return this.cljs$core$IFn$_invoke$arity$variadic(b,a)};me.tonsky.persistent_sorted_set.sorted_set_by.cljs$lang$maxFixedArity=1;
me.tonsky.persistent_sorted_set.sorted_set=function(a){switch(arguments.length){case 0:return me.tonsky.persistent_sorted_set.sorted_set.cljs$core$IFn$_invoke$arity$0();default:for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=new cljs.core.IndexedSeq(b.slice(0),0,null);return me.tonsky.persistent_sorted_set.sorted_set.cljs$core$IFn$_invoke$arity$variadic(b)}};
me.tonsky.persistent_sorted_set.sorted_set.cljs$core$IFn$_invoke$arity$0=function(){return me.tonsky.persistent_sorted_set.sorted_set_by.call(null,cljs.core.compare)};me.tonsky.persistent_sorted_set.sorted_set.cljs$core$IFn$_invoke$arity$variadic=function(a){return me.tonsky.persistent_sorted_set.from_sequential.call(null,cljs.core.compare,a)};me.tonsky.persistent_sorted_set.sorted_set.cljs$lang$applyTo=function(a){return this.cljs$core$IFn$_invoke$arity$variadic(cljs.core.seq.call(null,a))};
me.tonsky.persistent_sorted_set.sorted_set.cljs$lang$maxFixedArity=0;datascript.db={};datascript.db.Exception=Error;datascript.db.IllegalArgumentException=Error;datascript.db.UnsupportedOperationException=Error;datascript.db.e0=0;datascript.db.tx0=536870912;datascript.db.emax=2147483647;datascript.db.txmax=2147483647;
datascript.db.implicit_schema=new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","ident","db/ident",-737096),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","unique","db/unique",329396388),new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722)],null)],null);datascript.db.seqable_QMARK_=function(a){return"string"!==typeof a&&(cljs.core.seqable_QMARK_.call(null,a)||me.tonsky.persistent_sorted_set.arrays.array_QMARK_.call(null,a))};
datascript.db.conjv=cljs.core.fnil.call(null,cljs.core.conj,cljs.core.PersistentVector.EMPTY);datascript.db.conjs=cljs.core.fnil.call(null,cljs.core.conj,cljs.core.PersistentHashSet.EMPTY);
datascript.db.reduce_indexed=function(a,b,c){return cljs.core.first.call(null,cljs.core.reduce.call(null,function(b,c){var d=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);c=a.call(null,d,c,b);return cljs.core.reduced_QMARK_.call(null,c)?cljs.core.reduced.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,b],null)):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,b+1],null)},new cljs.core.PersistentVector(null,
2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,0],null),c))};datascript.db.cljs_env_QMARK_=function(a){return cljs.core.boolean$.call(null,(new cljs.core.Keyword(null,"ns","ns",441598760)).cljs$core$IFn$_invoke$arity$1(a))};datascript.db.combine_hashes=function(a,b){return cljs.core.hash_combine.call(null,a,b)};datascript.db.IDatom=function(){};
datascript.db.datom_tx=function(a){if(null!=a&&null!=a.datascript$db$IDatom$datom_tx$arity$1)return a.datascript$db$IDatom$datom_tx$arity$1(a);var b=datascript.db.datom_tx[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=datascript.db.datom_tx._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"IDatom.datom-tx",a);};
datascript.db.datom_added=function(a){if(null!=a&&null!=a.datascript$db$IDatom$datom_added$arity$1)return a.datascript$db$IDatom$datom_added$arity$1(a);var b=datascript.db.datom_added[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=datascript.db.datom_added._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"IDatom.datom-added",a);};
datascript.db.Datom=function(a,b,c,d,e){this.e=a;this.a=b;this.v=c;this.tx=d;this._hash=e;this.cljs$lang$protocol_mask$partition0$=2162164496;this.cljs$lang$protocol_mask$partition1$=0};datascript.db.Datom.prototype.datascript$db$IDatom$=cljs.core.PROTOCOL_SENTINEL;datascript.db.Datom.prototype.datascript$db$IDatom$datom_tx$arity$1=function(a){return 0<this.tx?this.tx:-this.tx};datascript.db.Datom.prototype.datascript$db$IDatom$datom_added$arity$1=function(a){return 0<this.tx};
datascript.db.Datom.prototype.cljs$core$IHash$_hash$arity$1=function(a){return 0===this._hash?this._hash=datascript.db.hash_datom.call(null,this):this._hash};datascript.db.Datom.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return(a=b instanceof datascript.db.Datom)?datascript.db.equiv_datom.call(null,this,b):a};datascript.db.Datom.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return datascript.db.seq_datom.call(null,this)};
datascript.db.Datom.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return datascript.db.val_at_datom.call(null,this,b,null)};datascript.db.Datom.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return datascript.db.val_at_datom.call(null,this,b,c)};datascript.db.Datom.prototype.cljs$core$IIndexed$_nth$arity$2=function(a,b){return datascript.db.nth_datom.call(null,this,b)};
datascript.db.Datom.prototype.cljs$core$IIndexed$_nth$arity$3=function(a,b,c){return datascript.db.nth_datom.call(null,this,b,c)};datascript.db.Datom.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return datascript.db.assoc_datom.call(null,this,b,c)};
datascript.db.Datom.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,"#datascript/Datom ["," ","]",c,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[this.e,this.a,this.v,datascript.db.datom_tx.call(null,this),datascript.db.datom_added.call(null,this)],null))};
datascript.db.Datom.getBasis=function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.with_meta(new cljs.core.Symbol(null,"e","e",-1273166571,null),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"tag","tag",-1290361223),new cljs.core.Symbol(null,"number","number",-1084057331,null)],null)),new cljs.core.Symbol(null,"a","a",-482876059,null),new cljs.core.Symbol(null,"v","v",1661996586,null),cljs.core.with_meta(new cljs.core.Symbol(null,
"tx","tx",2107161945,null),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"tag","tag",-1290361223),new cljs.core.Symbol(null,"number","number",-1084057331,null)],null)),cljs.core.with_meta(new cljs.core.Symbol(null,"_hash","_hash",-2130838312,null),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"tag","tag",-1290361223),new cljs.core.Symbol(null,"number","number",-1084057331,null),new cljs.core.Keyword(null,"mutable","mutable",875778266),!0],null))],null)};
datascript.db.Datom.cljs$lang$type=!0;datascript.db.Datom.cljs$lang$ctorStr="datascript.db/Datom";datascript.db.Datom.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"datascript.db/Datom")};datascript.db.__GT_Datom=function(a,b,c,d,e){return new datascript.db.Datom(a,b,c,d,e)};goog.exportSymbol("datascript.db.Datom",datascript.db.Datom);
datascript.db.datom=function(a){switch(arguments.length){case 3:return datascript.db.datom.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return datascript.db.datom.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return datascript.db.datom.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));
}};datascript.db.datom.cljs$core$IFn$_invoke$arity$3=function(a,b,c){return new datascript.db.Datom(a,b,c,536870912,0)};datascript.db.datom.cljs$core$IFn$_invoke$arity$4=function(a,b,c,d){return new datascript.db.Datom(a,b,c,d,0)};datascript.db.datom.cljs$core$IFn$_invoke$arity$5=function(a,b,c,d,e){return new datascript.db.Datom(a,b,c,cljs.core.truth_(e)?d:-d,0)};datascript.db.datom.cljs$lang$maxFixedArity=5;datascript.db.datom_QMARK_=function(a){return a instanceof datascript.db.Datom};
datascript.db.hash_datom=function(a){return datascript.db.combine_hashes.call(null,datascript.db.combine_hashes.call(null,cljs.core.hash.call(null,a.e),cljs.core.hash.call(null,a.a)),cljs.core.hash.call(null,a.v))};datascript.db.equiv_datom=function(a,b){return a.e===b.e&&cljs.core._EQ_.call(null,a.a,b.a)&&cljs.core._EQ_.call(null,a.v,b.v)};
datascript.db.seq_datom=function(a){return new cljs.core.List(null,a.e,new cljs.core.List(null,a.a,new cljs.core.List(null,a.v,new cljs.core.List(null,datascript.db.datom_tx.call(null,a),new cljs.core.List(null,datascript.db.datom_added.call(null,a),null,1,null),2,null),3,null),4,null),5,null)};
datascript.db.val_at_datom=function(a,b,c){return cljs.core._EQ_.call(null,new cljs.core.Keyword(null,"v","v",21465059),b)?a.v:cljs.core._EQ_.call(null,"e",b)?a.e:cljs.core._EQ_.call(null,new cljs.core.Keyword(null,"added","added",2057651688),b)?datascript.db.datom_added.call(null,a):cljs.core._EQ_.call(null,"v",b)?a.v:cljs.core._EQ_.call(null,new cljs.core.Keyword(null,"e","e",1381269198),b)?a.e:cljs.core._EQ_.call(null,"a",b)?a.a:cljs.core._EQ_.call(null,new cljs.core.Keyword(null,"tx","tx",466630418),
b)?datascript.db.datom_tx.call(null,a):cljs.core._EQ_.call(null,"added",b)?datascript.db.datom_added.call(null,a):cljs.core._EQ_.call(null,"tx",b)?datascript.db.datom_tx.call(null,a):cljs.core._EQ_.call(null,new cljs.core.Keyword(null,"a","a",-2123407586),b)?a.a:c};
datascript.db.nth_datom=function(a){switch(arguments.length){case 2:return datascript.db.nth_datom.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.db.nth_datom.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.db.nth_datom.cljs$core$IFn$_invoke$arity$2=function(a,b){switch(b){case 0:return a.e;case 1:return a.a;case 2:return a.v;case 3:return datascript.db.datom_tx.call(null,a);case 4:return datascript.db.datom_added.call(null,a);default:throw Error(["Datom/-nth: Index out of bounds: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(b)].join(""));}};
datascript.db.nth_datom.cljs$core$IFn$_invoke$arity$3=function(a,b,c){switch(b){case 0:return a.e;case 1:return a.a;case 2:return a.v;case 3:return datascript.db.datom_tx.call(null,a);case 4:return datascript.db.datom_added.call(null,a);default:return c}};datascript.db.nth_datom.cljs$lang$maxFixedArity=3;
datascript.db.assoc_datom=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "e":return datascript.db.datom.call(null,c,a.a,a.v,datascript.db.datom_tx.call(null,a),datascript.db.datom_added.call(null,a));case "a":return datascript.db.datom.call(null,a.e,c,a.v,datascript.db.datom_tx.call(null,a),datascript.db.datom_added.call(null,a));case "v":return datascript.db.datom.call(null,a.e,a.a,c,datascript.db.datom_tx.call(null,a),datascript.db.datom_added.call(null,a));case "tx":return datascript.db.datom.call(null,
a.e,a.a,a.v,c,datascript.db.datom_added.call(null,a));case "added":return datascript.db.datom.call(null,a.e,a.a,a.v,datascript.db.datom_tx.call(null,a),c);default:throw new datascript.db.IllegalArgumentException(["invalid key for #datascript/Datom: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(b)].join(""));}};datascript.db.datom_from_reader=function(a){return cljs.core.apply.call(null,datascript.db.datom,a)};
datascript.db.cmp=function(a,b){return null==a?0:null==b?0:cljs.core.compare.call(null,a,b)};
datascript.db.value_compare=function(a,b){return cljs.core._EQ_.call(null,a,b)?0:(null!=a?a.cljs$lang$protocol_mask$partition1$&2048||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$IComparable$||(a.cljs$lang$protocol_mask$partition1$?0:cljs.core.native_satisfies_QMARK_.call(null,cljs.core.IComparable,a)):cljs.core.native_satisfies_QMARK_.call(null,cljs.core.IComparable,a))?cljs.core._compare.call(null,a,b):"string"!==typeof a&&!cljs.core.array_QMARK_.call(null,a)&&!0!==a&&!1!==a||cljs.core.type.call(null,
a)!==cljs.core.type.call(null,b)?cljs.core.hash.call(null,a)-cljs.core.hash.call(null,b):goog.array.defaultCompare(a,b)};datascript.db.value_cmp=function(a,b){return null==a?0:null==b?0:datascript.db.value_compare.call(null,a,b)};datascript.db.cmp_datoms_eavt=function(a,b){var c=a.e-b.e;return 0===c&&(c=datascript.db.cmp.call(null,a.a,b.a),0===c&&(c=datascript.db.value_cmp.call(null,a.v,b.v),0===c))?(a=datascript.db.datom_tx.call(null,a)-datascript.db.datom_tx.call(null,b),0===a?0:a):c};
datascript.db.cmp_datoms_aevt=function(a,b){var c=datascript.db.cmp.call(null,a.a,b.a);return 0===c&&(c=a.e-b.e,0===c&&(c=datascript.db.value_cmp.call(null,a.v,b.v),0===c))?(a=datascript.db.datom_tx.call(null,a)-datascript.db.datom_tx.call(null,b),0===a?0:a):c};
datascript.db.cmp_datoms_avet=function(a,b){var c=datascript.db.cmp.call(null,a.a,b.a);return 0===c&&(c=datascript.db.value_cmp.call(null,a.v,b.v),0===c&&(c=a.e-b.e,0===c))?(a=datascript.db.datom_tx.call(null,a)-datascript.db.datom_tx.call(null,b),0===a?0:a):c};datascript.db.cmp_attr_quick=function(a,b){return a instanceof cljs.core.Keyword?cljs.core._compare.call(null,a,b):goog.array.defaultCompare(a,b)};
datascript.db.cmp_datoms_eav_quick=function(a,b){var c=a.e-b.e;return 0===c&&(c=datascript.db.cmp_attr_quick.call(null,a.a,b.a),0===c)?(a=datascript.db.value_compare.call(null,a.v,b.v),0===a?0:a):c};datascript.db.cmp_datoms_eavt_quick=function(a,b){var c=a.e-b.e;return 0===c&&(c=datascript.db.cmp_attr_quick.call(null,a.a,b.a),0===c&&(c=datascript.db.value_compare.call(null,a.v,b.v),0===c))?(a=datascript.db.datom_tx.call(null,a)-datascript.db.datom_tx.call(null,b),0===a?0:a):c};
datascript.db.cmp_datoms_aevt_quick=function(a,b){var c=datascript.db.cmp_attr_quick.call(null,a.a,b.a);return 0===c&&(c=a.e-b.e,0===c&&(c=datascript.db.value_compare.call(null,a.v,b.v),0===c))?(a=datascript.db.datom_tx.call(null,a)-datascript.db.datom_tx.call(null,b),0===a?0:a):c};
datascript.db.cmp_datoms_avet_quick=function(a,b){var c=datascript.db.cmp_attr_quick.call(null,a.a,b.a);return 0===c&&(c=datascript.db.value_compare.call(null,a.v,b.v),0===c&&(c=a.e-b.e,0===c))?(a=datascript.db.datom_tx.call(null,a)-datascript.db.datom_tx.call(null,b),0===a?0:a):c};
datascript.db.diff_sorted=function(a,b,c){for(var d=cljs.core.PersistentVector.EMPTY,e=cljs.core.PersistentVector.EMPTY,f=cljs.core.PersistentVector.EMPTY;;){if(cljs.core.empty_QMARK_.call(null,a))return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.not_empty.call(null,d),cljs.core.not_empty.call(null,cljs.core.into.call(null,e,b)),cljs.core.not_empty.call(null,f)],null);if(cljs.core.empty_QMARK_.call(null,b))return new cljs.core.PersistentVector(null,3,
5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.not_empty.call(null,cljs.core.into.call(null,d,a)),cljs.core.not_empty.call(null,e),cljs.core.not_empty.call(null,f)],null);var g=cljs.core.first.call(null,a),h=cljs.core.first.call(null,b),k=c.call(null,g,h);if(0===k)f=cljs.core.conj.call(null,f,g),a=cljs.core.next.call(null,a),b=cljs.core.next.call(null,b);else if(0>k)d=cljs.core.conj.call(null,d,g),a=cljs.core.next.call(null,a);else if(0<k)e=cljs.core.conj.call(null,e,h),b=cljs.core.next.call(null,
b);else return null}};datascript.db.ISearch=function(){};datascript.db._search=function(a,b){if(null!=a&&null!=a.datascript$db$ISearch$_search$arity$2)return a.datascript$db$ISearch$_search$arity$2(a,b);var c=datascript.db._search[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=datascript.db._search._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"ISearch.-search",a);};
datascript.db.fsearch=function(a,b){return cljs.core.first.call(null,datascript.db._search.call(null,a,b))};datascript.db.IIndexAccess=function(){};
datascript.db._datoms=function(a,b,c){if(null!=a&&null!=a.datascript$db$IIndexAccess$_datoms$arity$3)return a.datascript$db$IIndexAccess$_datoms$arity$3(a,b,c);var d=datascript.db._datoms[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=datascript.db._datoms._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"IIndexAccess.-datoms",a);};
datascript.db._seek_datoms=function(a,b,c){if(null!=a&&null!=a.datascript$db$IIndexAccess$_seek_datoms$arity$3)return a.datascript$db$IIndexAccess$_seek_datoms$arity$3(a,b,c);var d=datascript.db._seek_datoms[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=datascript.db._seek_datoms._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"IIndexAccess.-seek-datoms",a);};
datascript.db._rseek_datoms=function(a,b,c){if(null!=a&&null!=a.datascript$db$IIndexAccess$_rseek_datoms$arity$3)return a.datascript$db$IIndexAccess$_rseek_datoms$arity$3(a,b,c);var d=datascript.db._rseek_datoms[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=datascript.db._rseek_datoms._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"IIndexAccess.-rseek-datoms",a);};
datascript.db._index_range=function(a,b,c,d){if(null!=a&&null!=a.datascript$db$IIndexAccess$_index_range$arity$4)return a.datascript$db$IIndexAccess$_index_range$arity$4(a,b,c,d);var e=datascript.db._index_range[goog.typeOf(null==a?null:a)];if(null!=e)return e.call(null,a,b,c,d);e=datascript.db._index_range._;if(null!=e)return e.call(null,a,b,c,d);throw cljs.core.missing_protocol.call(null,"IIndexAccess.-index-range",a);};
datascript.db.validate_indexed=function(a,b,c){if(cljs.core._EQ_.call(null,b,new cljs.core.Keyword(null,"avet","avet",1383857032))){b=cljs.core.first.call(null,c);if(null==b||cljs.core.truth_(datascript.db.indexing_QMARK_.call(null,a,b)))return null;throw cljs.core.ex_info.call(null,["Attribute ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))," should be marked as :db/index true"].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",
-978969032),new cljs.core.Keyword(null,"index-access","index-access",-1548960265),new cljs.core.Keyword(null,"index","index",-1531685915),new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.Keyword(null,"components","components",-1073188942),c],null));}return null};datascript.db.IDB=function(){};
datascript.db._schema=function(a){if(null!=a&&null!=a.datascript$db$IDB$_schema$arity$1)return a.datascript$db$IDB$_schema$arity$1(a);var b=datascript.db._schema[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=datascript.db._schema._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"IDB.-schema",a);};
datascript.db._attrs_by=function(a,b){if(null!=a&&null!=a.datascript$db$IDB$_attrs_by$arity$2)return a.datascript$db$IDB$_attrs_by$arity$2(a,b);var c=datascript.db._attrs_by[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=datascript.db._attrs_by._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"IDB.-attrs-by",a);};
datascript.db.db_transient=function(a){return cljs.core.update.call(null,cljs.core.update.call(null,cljs.core.update.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.transient$),new cljs.core.Keyword(null,"aevt","aevt",-585148059),cljs.core.transient$),new cljs.core.Keyword(null,"avet","avet",1383857032),cljs.core.transient$)};
datascript.db.db_persistent_BANG_=function(a){return cljs.core.update.call(null,cljs.core.update.call(null,cljs.core.update.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.persistent_BANG_),new cljs.core.Keyword(null,"aevt","aevt",-585148059),cljs.core.persistent_BANG_),new cljs.core.Keyword(null,"avet","avet",1383857032),cljs.core.persistent_BANG_)};
datascript.db.DB=function(a,b,c,d,e,f,g,h,k,l,m){this.schema=a;this.eavt=b;this.aevt=c;this.avet=d;this.max_eid=e;this.max_tx=f;this.rschema=g;this.hash=h;this.__meta=k;this.__extmap=l;this.__hash=m;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.db.DB.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.db.DB.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "schema":return this.schema;case "eavt":return this.eavt;case "aevt":return this.aevt;case "avet":return this.avet;case "max-eid":return this.max_eid;case "max-tx":return this.max_tx;case "rschema":return this.rschema;case "hash":return this.hash;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.db.DB.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.db.DB{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,8,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"schema","schema",-1582001791),this.schema],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"eavt","eavt",-666437073),this.eavt],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"aevt","aevt",-585148059),this.aevt],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"avet","avet",1383857032),this.avet],null),new cljs.core.PersistentVector(null,
2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),this.max_eid],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),this.max_tx],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"rschema","rschema",-1196134054),this.rschema],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"hash","hash",-13781596),this.hash],null)],null),this.__extmap))};
datascript.db.DB.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,8,new cljs.core.PersistentVector(null,8,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"schema","schema",-1582001791),new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.Keyword(null,"aevt","aevt",-585148059),new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),new cljs.core.Keyword(null,"max-tx",
"max-tx",1119558339),new cljs.core.Keyword(null,"rschema","rschema",-1196134054),new cljs.core.Keyword(null,"hash","hash",-13781596)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.db.DB.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.db.DB.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,this.rschema,this.hash,this.__meta,this.__extmap,this.__hash)};datascript.db.DB.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 8+cljs.core.count.call(null,this.__extmap)};
datascript.db.DB.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1515640948^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.db.DB.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.schema,b.schema)&&cljs.core._EQ_.call(null,this.eavt,b.eavt)&&cljs.core._EQ_.call(null,this.aevt,b.aevt)&&cljs.core._EQ_.call(null,this.avet,b.avet)&&cljs.core._EQ_.call(null,this.max_eid,b.max_eid)&&cljs.core._EQ_.call(null,this.max_tx,b.max_tx)&&cljs.core._EQ_.call(null,this.rschema,b.rschema)&&cljs.core._EQ_.call(null,this.hash,b.hash)&&cljs.core._EQ_.call(null,
this.__extmap,b.__extmap)};
datascript.db.DB.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,8,[new cljs.core.Keyword(null,"schema","schema",-1582001791),null,new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),null,new cljs.core.Keyword(null,"hash","hash",-13781596),null,new cljs.core.Keyword(null,"aevt","aevt",-585148059),null,new cljs.core.Keyword(null,"avet","avet",1383857032),null,new cljs.core.Keyword(null,
"max-eid","max-eid",2134868075),null,new cljs.core.Keyword(null,"eavt","eavt",-666437073),null,new cljs.core.Keyword(null,"rschema","rschema",-1196134054),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,this.rschema,this.hash,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,
b)),null)};
datascript.db.DB.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"schema","schema",-1582001791),b))?new datascript.db.DB(c,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,this.rschema,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"eavt","eavt",-666437073),b))?new datascript.db.DB(this.schema,c,this.aevt,this.avet,this.max_eid,
this.max_tx,this.rschema,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"aevt","aevt",-585148059),b))?new datascript.db.DB(this.schema,this.eavt,c,this.avet,this.max_eid,this.max_tx,this.rschema,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"avet","avet",1383857032),b))?new datascript.db.DB(this.schema,this.eavt,this.aevt,c,this.max_eid,this.max_tx,this.rschema,this.hash,this.__meta,this.__extmap,
null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),b))?new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,c,this.max_tx,this.rschema,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),b))?new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,c,this.rschema,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,
"rschema","rschema",-1196134054),b))?new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,c,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"hash","hash",-13781596),b))?new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,this.rschema,c,this.__meta,this.__extmap,null):new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,this.rschema,this.hash,this.__meta,
cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.db.DB.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,8,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"schema","schema",-1582001791),this.schema,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"eavt","eavt",-666437073),this.eavt,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"aevt","aevt",-585148059),this.aevt,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,
"avet","avet",1383857032),this.avet,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),this.max_eid,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),this.max_tx,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"rschema","rschema",-1196134054),this.rschema,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"hash","hash",-13781596),this.hash,null)],null),this.__extmap))};
datascript.db.DB.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.db.DB(this.schema,this.eavt,this.aevt,this.avet,this.max_eid,this.max_tx,this.rschema,this.hash,b,this.__extmap,this.__hash)};
datascript.db.DB.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.db.DB.getBasis=function(){return new cljs.core.PersistentVector(null,8,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"schema","schema",58529736,null),new cljs.core.Symbol(null,"eavt","eavt",974094454,null),new cljs.core.Symbol(null,"aevt","aevt",1055383468,null),new cljs.core.Symbol(null,"avet","avet",-1270578737,null),new cljs.core.Symbol(null,"max-eid","max-eid",-519567694,null),new cljs.core.Symbol(null,"max-tx","max-tx",-1534877430,null),new cljs.core.Symbol(null,
"rschema","rschema",444397473,null),new cljs.core.Symbol(null,"hash","hash",1626749931,null)],null)};datascript.db.DB.cljs$lang$type=!0;datascript.db.DB.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.db/DB",null,1,null)};datascript.db.DB.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.db/DB")};datascript.db.__GT_DB=function(a,b,c,d,e,f,g,h){return new datascript.db.DB(a,b,c,d,e,f,g,h,null,null,null)};
datascript.db.map__GT_DB=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"schema","schema",-1582001791),new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.Keyword(null,"aevt","aevt",-585148059),new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),new cljs.core.Keyword(null,"rschema","rschema",-1196134054),new cljs.core.Keyword(null,"hash","hash",
-13781596));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.db.DB((new cljs.core.Keyword(null,"schema","schema",-1582001791)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"eavt","eavt",-666437073)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"aevt","aevt",-585148059)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"avet","avet",1383857032)).cljs$core$IFn$_invoke$arity$1(a),
(new cljs.core.Keyword(null,"max-eid","max-eid",2134868075)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"max-tx","max-tx",1119558339)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"rschema","rschema",-1196134054)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"hash","hash",-13781596)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.db.DB.prototype.clojure$data$Diff$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.clojure$data$Diff$diff_similar$arity$2=function(a,b){return datascript.db.diff_sorted.call(null,(new cljs.core.Keyword(null,"eavt","eavt",-666437073)).cljs$core$IFn$_invoke$arity$1(this),(new cljs.core.Keyword(null,"eavt","eavt",-666437073)).cljs$core$IFn$_invoke$arity$1(b),datascript.db.cmp_datoms_eav_quick)};datascript.db.DB.prototype.cljs$core$IPrintWithWriter$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return datascript.db.pr_db.call(null,this,b,c)};datascript.db.DB.prototype.cljs$core$ICounted$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.cljs$core$ICounted$_count$arity$1=function(a){return cljs.core.count.call(null,this.eavt)};datascript.db.DB.prototype.cljs$core$IReversible$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.cljs$core$IReversible$_rseq$arity$1=function(a){return cljs.core._rseq.call(null,this.eavt)};datascript.db.DB.prototype.cljs$core$IHash$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.cljs$core$IHash$_hash$arity$1=function(a){return datascript.db.hash_db.call(null,this)};datascript.db.DB.prototype.cljs$core$IEquiv$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return datascript.db.equiv_db.call(null,this,b)};
datascript.db.DB.prototype.cljs$core$IEditableCollection$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.cljs$core$IEditableCollection$_as_transient$arity$1=function(a){return datascript.db.db_transient.call(null,this)};datascript.db.DB.prototype.cljs$core$IEmptyableCollection$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.cljs$core$IEmptyableCollection$_empty$arity$1=function(a){return cljs.core.with_meta.call(null,datascript.db.empty_db.call(null,this.schema),cljs.core.meta.call(null,this))};datascript.db.DB.prototype.cljs$core$ITransientCollection$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.cljs$core$ITransientCollection$_conj_BANG_$arity$2=function(a,b){throw cljs.core.ex_info.call(null,"datascript.DB/conj! is not supported",cljs.core.PersistentArrayMap.EMPTY);};
datascript.db.DB.prototype.cljs$core$ITransientCollection$_persistent_BANG_$arity$1=function(a){return datascript.db.db_persistent_BANG_.call(null,this)};datascript.db.DB.prototype.cljs$core$ISeqable$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core._seq.call(null,this.eavt)};datascript.db.DB.prototype.clojure$data$EqualityPartition$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.clojure$data$EqualityPartition$equality_partition$arity$1=function(a){return new cljs.core.Keyword("datascript","db","datascript/db",-1190971692)};datascript.db.DB.prototype.datascript$db$IIndexAccess$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.datascript$db$IIndexAccess$_datoms$arity$3=function(a,b,c){datascript.db.validate_indexed.call(null,this,b,c);return me.tonsky.persistent_sorted_set.slice.call(null,cljs.core.get.call(null,this,b),datascript.db.components__GT_pattern.call(null,this,b,c,0,536870912),datascript.db.components__GT_pattern.call(null,this,b,c,2147483647,2147483647))};
datascript.db.DB.prototype.datascript$db$IIndexAccess$_seek_datoms$arity$3=function(a,b,c){datascript.db.validate_indexed.call(null,this,b,c);return me.tonsky.persistent_sorted_set.slice.call(null,cljs.core.get.call(null,this,b),datascript.db.components__GT_pattern.call(null,this,b,c,0,536870912),datascript.db.datom.call(null,2147483647,null,null,2147483647))};
datascript.db.DB.prototype.datascript$db$IIndexAccess$_rseek_datoms$arity$3=function(a,b,c){datascript.db.validate_indexed.call(null,this,b,c);return me.tonsky.persistent_sorted_set.rslice.call(null,cljs.core.get.call(null,this,b),datascript.db.components__GT_pattern.call(null,this,b,c,2147483647,2147483647),datascript.db.datom.call(null,0,null,null,536870912))};
datascript.db.DB.prototype.datascript$db$IIndexAccess$_index_range$arity$4=function(a,b,c,d){datascript.db.validate_indexed.call(null,this,new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null));datascript.db.validate_attr.call(null,b,new cljs.core.List(null,new cljs.core.Symbol(null,"-index-range","-index-range",898114142,null),new cljs.core.List(null,new cljs.core.Symbol(null,"db","db",-1661185010,null),new cljs.core.List(null,
b,new cljs.core.List(null,c,new cljs.core.List(null,d,null,1,null),2,null),3,null),4,null),5,null));return me.tonsky.persistent_sorted_set.slice.call(null,this.avet,datascript.db.resolve_datom.call(null,this,null,b,c,null,0,536870912),datascript.db.resolve_datom.call(null,this,null,b,d,null,2147483647,2147483647))};datascript.db.DB.prototype.datascript$db$IDB$=cljs.core.PROTOCOL_SENTINEL;datascript.db.DB.prototype.datascript$db$IDB$_schema$arity$1=function(a){return this.schema};
datascript.db.DB.prototype.datascript$db$IDB$_attrs_by$arity$2=function(a,b){return this.rschema.call(null,b)};datascript.db.DB.prototype.datascript$db$ISearch$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.DB.prototype.datascript$db$ISearch$_search$arity$2=function(a,b){a=cljs.core.nth.call(null,b,0,null);var c=cljs.core.nth.call(null,b,1,null),d=cljs.core.nth.call(null,b,2,null),e=cljs.core.nth.call(null,b,3,null),f=this.eavt,g=this.aevt,h=this.avet,k=cljs.core.contains_QMARK_.call(null,datascript.db._attrs_by.call(null,this,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234)),c);return cljs.core.truth_(a)?cljs.core.truth_(c)?null!=d?cljs.core.truth_(e)?me.tonsky.persistent_sorted_set.slice.call(null,
f,datascript.db.datom.call(null,a,c,d,e),datascript.db.datom.call(null,a,c,d,e)):me.tonsky.persistent_sorted_set.slice.call(null,f,datascript.db.datom.call(null,a,c,d,536870912),datascript.db.datom.call(null,a,c,d,2147483647)):cljs.core.truth_(e)?cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,f,datascript.db.datom.call(null,a,
c,null,536870912),datascript.db.datom.call(null,a,c,null,2147483647))):me.tonsky.persistent_sorted_set.slice.call(null,f,datascript.db.datom.call(null,a,c,null,536870912),datascript.db.datom.call(null,a,c,null,2147483647)):null!=d?cljs.core.truth_(e)?cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,d,a.v)&&cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,
f,datascript.db.datom.call(null,a,null,null,536870912),datascript.db.datom.call(null,a,null,null,2147483647))):cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,d,a.v)}}(b,a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,f,datascript.db.datom.call(null,a,null,null,536870912),datascript.db.datom.call(null,a,null,null,2147483647))):cljs.core.truth_(e)?cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,
e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,f,datascript.db.datom.call(null,a,null,null,536870912),datascript.db.datom.call(null,a,null,null,2147483647))):me.tonsky.persistent_sorted_set.slice.call(null,f,datascript.db.datom.call(null,a,null,null,536870912),datascript.db.datom.call(null,a,null,null,2147483647)):cljs.core.truth_(c)?null!=d?cljs.core.truth_(e)?cljs.core.truth_(datascript.db.indexing_QMARK_.call(null,this,c))?cljs.core.filter.call(null,
function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,h,datascript.db.datom.call(null,0,c,d,536870912),datascript.db.datom.call(null,2147483647,c,d,2147483647))):cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,d,a.v)&&cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,
this),me.tonsky.persistent_sorted_set.slice.call(null,g,datascript.db.datom.call(null,0,c,null,536870912),datascript.db.datom.call(null,2147483647,c,null,2147483647))):cljs.core.truth_(datascript.db.indexing_QMARK_.call(null,this,c))?me.tonsky.persistent_sorted_set.slice.call(null,h,datascript.db.datom.call(null,0,c,d,536870912),datascript.db.datom.call(null,2147483647,c,d,2147483647)):cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,d,a.v)}}(b,
a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,g,datascript.db.datom.call(null,0,c,null,536870912),datascript.db.datom.call(null,2147483647,c,null,2147483647))):cljs.core.truth_(e)?cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),me.tonsky.persistent_sorted_set.slice.call(null,g,datascript.db.datom.call(null,0,c,null,536870912),datascript.db.datom.call(null,
2147483647,c,null,2147483647))):me.tonsky.persistent_sorted_set.slice.call(null,g,datascript.db.datom.call(null,0,c,null,536870912),datascript.db.datom.call(null,2147483647,c,null,2147483647)):null!=d?cljs.core.truth_(e)?cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,d,a.v)&&cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),f):cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,
d,a.v)}}(b,a,c,d,e,f,g,h,k,this),f):cljs.core.truth_(e)?cljs.core.filter.call(null,function(a,b,c,d,e,f,g,h,k,w){return function(a){return cljs.core._EQ_.call(null,e,datascript.db.datom_tx.call(null,a))}}(b,a,c,d,e,f,g,h,k,this),f):f};
datascript.db.db_QMARK_=function(a){var b=null!=a?cljs.core.PROTOCOL_SENTINEL===a.datascript$db$ISearch$?!0:a.cljs$lang$protocol_mask$partition$?!1:cljs.core.native_satisfies_QMARK_.call(null,datascript.db.ISearch,a):cljs.core.native_satisfies_QMARK_.call(null,datascript.db.ISearch,a);return b?(b=null!=a?cljs.core.PROTOCOL_SENTINEL===a.datascript$db$IIndexAccess$?!0:a.cljs$lang$protocol_mask$partition$?!1:cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IIndexAccess,a):cljs.core.native_satisfies_QMARK_.call(null,
datascript.db.IIndexAccess,a))?null!=a?cljs.core.PROTOCOL_SENTINEL===a.datascript$db$IDB$?!0:a.cljs$lang$protocol_mask$partition$?!1:cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IDB,a):cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IDB,a):b:b};datascript.db.FilteredDB=function(a,b,c,d,e,f){this.unfiltered_db=a;this.pred=b;this.hash=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.db.FilteredDB.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.db.FilteredDB.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "unfiltered-db":return this.unfiltered_db;case "pred":return this.pred;case "hash":return this.hash;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.db.FilteredDB.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.db.FilteredDB{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"unfiltered-db","unfiltered-db",-1363720391),this.unfiltered_db],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"pred","pred",1927423397),this.pred],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"hash","hash",-13781596),this.hash],null)],null),this.__extmap))};
datascript.db.FilteredDB.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"unfiltered-db","unfiltered-db",-1363720391),new cljs.core.Keyword(null,"pred","pred",1927423397),new cljs.core.Keyword(null,"hash","hash",-13781596)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.db.FilteredDB.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.db.FilteredDB.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.db.FilteredDB(this.unfiltered_db,this.pred,this.hash,this.__meta,this.__extmap,this.__hash)};datascript.db.FilteredDB.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.db.FilteredDB.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-351969977^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.db.FilteredDB.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.unfiltered_db,b.unfiltered_db)&&cljs.core._EQ_.call(null,this.pred,b.pred)&&cljs.core._EQ_.call(null,this.hash,b.hash)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.db.FilteredDB.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"hash","hash",-13781596),null,new cljs.core.Keyword(null,"pred","pred",1927423397),null,new cljs.core.Keyword(null,"unfiltered-db","unfiltered-db",-1363720391),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.db.FilteredDB(this.unfiltered_db,this.pred,this.hash,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.db.FilteredDB.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"unfiltered-db","unfiltered-db",-1363720391),b))?new datascript.db.FilteredDB(c,this.pred,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"pred","pred",1927423397),b))?new datascript.db.FilteredDB(this.unfiltered_db,c,this.hash,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"hash","hash",-13781596),b))?new datascript.db.FilteredDB(this.unfiltered_db,this.pred,c,this.__meta,this.__extmap,null):new datascript.db.FilteredDB(this.unfiltered_db,this.pred,this.hash,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.db.FilteredDB.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"unfiltered-db","unfiltered-db",-1363720391),this.unfiltered_db,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"pred","pred",1927423397),this.pred,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"hash","hash",-13781596),
this.hash,null)],null),this.__extmap))};datascript.db.FilteredDB.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.db.FilteredDB(this.unfiltered_db,this.pred,this.hash,b,this.__extmap,this.__hash)};
datascript.db.FilteredDB.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.db.FilteredDB.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"unfiltered-db","unfiltered-db",276811136,null),new cljs.core.Symbol(null,"pred","pred",-727012372,null),new cljs.core.Symbol(null,"hash","hash",1626749931,null)],null)};datascript.db.FilteredDB.cljs$lang$type=!0;datascript.db.FilteredDB.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.db/FilteredDB",null,1,null)};
datascript.db.FilteredDB.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.db/FilteredDB")};datascript.db.__GT_FilteredDB=function(a,b,c){return new datascript.db.FilteredDB(a,b,c,null,null,null)};
datascript.db.map__GT_FilteredDB=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"unfiltered-db","unfiltered-db",-1363720391),new cljs.core.Keyword(null,"pred","pred",1927423397),new cljs.core.Keyword(null,"hash","hash",-13781596));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.db.FilteredDB((new cljs.core.Keyword(null,"unfiltered-db","unfiltered-db",-1363720391)).cljs$core$IFn$_invoke$arity$1(a),
(new cljs.core.Keyword(null,"pred","pred",1927423397)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"hash","hash",-13781596)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.db.FilteredDB.prototype.cljs$core$ILookup$=cljs.core.PROTOCOL_SENTINEL;datascript.db.FilteredDB.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){throw Error("-lookup is not supported on FilteredDB");};
datascript.db.FilteredDB.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){throw Error("-lookup is not supported on FilteredDB");};datascript.db.FilteredDB.prototype.cljs$core$IPrintWithWriter$=cljs.core.PROTOCOL_SENTINEL;datascript.db.FilteredDB.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return datascript.db.pr_db.call(null,this,b,c)};datascript.db.FilteredDB.prototype.cljs$core$ICounted$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.cljs$core$ICounted$_count$arity$1=function(a){return cljs.core.count.call(null,datascript.db._datoms.call(null,this,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY))};datascript.db.FilteredDB.prototype.cljs$core$IHash$=cljs.core.PROTOCOL_SENTINEL;datascript.db.FilteredDB.prototype.cljs$core$IHash$_hash$arity$1=function(a){return datascript.db.hash_fdb.call(null,this)};datascript.db.FilteredDB.prototype.cljs$core$IEquiv$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return datascript.db.equiv_db.call(null,this,b)};datascript.db.FilteredDB.prototype.cljs$core$IEmptyableCollection$=cljs.core.PROTOCOL_SENTINEL;datascript.db.FilteredDB.prototype.cljs$core$IEmptyableCollection$_empty$arity$1=function(a){throw Error("-empty is not supported on FilteredDB");};datascript.db.FilteredDB.prototype.cljs$core$IAssociative$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.cljs$core$IAssociative$_contains_key_QMARK_$arity$2=function(a,b){throw Error("-contains-key? is not supported on FilteredDB");};datascript.db.FilteredDB.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){throw Error("-assoc is not supported on FilteredDB");};datascript.db.FilteredDB.prototype.cljs$core$ISeqable$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,datascript.db._datoms.call(null,this,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY))};datascript.db.FilteredDB.prototype.datascript$db$IIndexAccess$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.datascript$db$IIndexAccess$_datoms$arity$3=function(a,b,c){return cljs.core.filter.call(null,this.pred,datascript.db._datoms.call(null,this.unfiltered_db,b,c))};datascript.db.FilteredDB.prototype.datascript$db$IIndexAccess$_seek_datoms$arity$3=function(a,b,c){return cljs.core.filter.call(null,this.pred,datascript.db._seek_datoms.call(null,this.unfiltered_db,b,c))};
datascript.db.FilteredDB.prototype.datascript$db$IIndexAccess$_rseek_datoms$arity$3=function(a,b,c){return cljs.core.filter.call(null,this.pred,datascript.db._rseek_datoms.call(null,this.unfiltered_db,b,c))};datascript.db.FilteredDB.prototype.datascript$db$IIndexAccess$_index_range$arity$4=function(a,b,c,d){return cljs.core.filter.call(null,this.pred,datascript.db._index_range.call(null,this.unfiltered_db,b,c,d))};datascript.db.FilteredDB.prototype.datascript$db$IDB$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.datascript$db$IDB$_schema$arity$1=function(a){return datascript.db._schema.call(null,this.unfiltered_db)};datascript.db.FilteredDB.prototype.datascript$db$IDB$_attrs_by$arity$2=function(a,b){return datascript.db._attrs_by.call(null,this.unfiltered_db,b)};datascript.db.FilteredDB.prototype.datascript$db$ISearch$=cljs.core.PROTOCOL_SENTINEL;
datascript.db.FilteredDB.prototype.datascript$db$ISearch$_search$arity$2=function(a,b){return cljs.core.filter.call(null,this.pred,datascript.db._search.call(null,this.unfiltered_db,b))};
datascript.db.attr__GT_properties=function(a,b){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "db.unique/identity":return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","unique","db/unique",329396388),new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722),new cljs.core.Keyword("db","index","db/index",-1531680669)],null);case "db.unique/value":return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword("db","unique","db/unique",329396388),new cljs.core.Keyword("db.unique","value","db.unique/value",276903088),new cljs.core.Keyword("db","index","db/index",-1531680669)],null);case "db.cardinality/many":return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234)],null);case "db.type/ref":return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db.type",
"ref","db.type/ref",-1728373079),new cljs.core.Keyword("db","index","db/index",-1531680669)],null);default:return cljs.core._EQ_.call(null,new cljs.core.Keyword("db","isComponent","db/isComponent",423352398),a)&&!0===b?new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)],null):cljs.core._EQ_.call(null,new cljs.core.Keyword("db","index","db/index",-1531680669),a)&&!0===b?new cljs.core.PersistentVector(null,
1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","index","db/index",-1531680669)],null):cljs.core._EQ_.call(null,new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092),a)?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db.type","tuple","db.type/tuple",938234914),new cljs.core.Keyword("db","index","db/index",-1531680669)],null):cljs.core.PersistentVector.EMPTY}};
datascript.db.attr_tuples=function(a,b){return cljs.core.reduce.call(null,function(b,d){return datascript.db.reduce_indexed.call(null,function(a,b,c){return cljs.core.update.call(null,a,b,cljs.core.assoc,d,c)},b,(new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092)).cljs$core$IFn$_invoke$arity$1(d.call(null,a)))},cljs.core.PersistentArrayMap.EMPTY,(new cljs.core.Keyword("db.type","tuple","db.type/tuple",938234914)).cljs$core$IFn$_invoke$arity$1(b))};
datascript.db.rschema=function(a){var b=cljs.core.reduce_kv.call(null,function(a,b,e){return cljs.core.reduce_kv.call(null,function(a,c,d){return cljs.core.reduce.call(null,function(a,c){return cljs.core.update.call(null,a,c,datascript.db.conjs,b)},a,datascript.db.attr__GT_properties.call(null,c,d))},a,e)},cljs.core.PersistentArrayMap.EMPTY,a);return cljs.core.assoc.call(null,b,new cljs.core.Keyword("db","attrTuples","db/attrTuples",860541631),datascript.db.attr_tuples.call(null,a,b))};
datascript.db.validate_schema_key=function(a,b,c,d){if(null==c||cljs.core.contains_QMARK_.call(null,d,c))return null;throw cljs.core.ex_info.call(null,["Bad attribute specification for ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.PersistentArrayMap.createAsIfByAssoc([a,cljs.core.PersistentArrayMap.createAsIfByAssoc([b,c])]))),", expected one of ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(d)].join(""),new cljs.core.PersistentArrayMap(null,4,[new cljs.core.Keyword(null,
"error","error",-978969032),new cljs.core.Keyword("schema","validation","schema/validation",1178447161),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),a,new cljs.core.Keyword(null,"key","key",-1516042587),b,new cljs.core.Keyword(null,"value","value",305978217),c],null));};
datascript.db.validate_schema=function(a){for(var b=cljs.core.seq.call(null,a),c=null,d=0,e=0;;)if(e<d){var f=cljs.core._nth.call(null,c,e),g=cljs.core.nth.call(null,f,0,null),h=cljs.core.nth.call(null,f,1,null),k=(new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)).cljs$core$IFn$_invoke$arity$2(h,!1);datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","isComponent","db/isComponent",423352398),(new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)).cljs$core$IFn$_invoke$arity$1(h),
new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[!0,null,!1,null],null),null));if(cljs.core.truth_(function(){var a=k;return cljs.core.truth_(a)?cljs.core.not_EQ_.call(null,(new cljs.core.Keyword("db","valueType","db/valueType",1827971944)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079)):a}()))throw cljs.core.ex_info.call(null,["Bad attribute specification for ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
g)),": {:db/isComponent true} should also have {:db/valueType :db.type/ref}"].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("schema","validation","schema/validation",1178447161),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),g,new cljs.core.Keyword(null,"key","key",-1516042587),new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)],null));datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db",
"unique","db/unique",329396388),(new cljs.core.Keyword("db","unique","db/unique",329396388)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722),null,new cljs.core.Keyword("db.unique","value","db.unique/value",276903088),null],null),null));datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","valueType","db/valueType",1827971944),(new cljs.core.Keyword("db",
"valueType","db/valueType",1827971944)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079),null],null),null));datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),null,new cljs.core.Keyword("db.cardinality","one","db.cardinality/one",1428352190),null],null),null));if(cljs.core.contains_QMARK_.call(null,h,new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092))){f=new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("schema","validation","schema/validation",1178447161),new cljs.core.Keyword(null,"attribute",
"attribute",-2074029119),g,new cljs.core.Keyword(null,"key","key",-1516042587),new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092)],null);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(h)))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," has :db/tupleAttrs, must be :db.cardinality/one"].join(""),
f);var l=(new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092)).cljs$core$IFn$_invoke$arity$1(h);if(!cljs.core.sequential_QMARK_.call(null,l))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs must be a sequential collection, got: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,l))].join(""),f);if(cljs.core.empty_QMARK_.call(null,l))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
g))," :db/tupleAttrs can’t be empty"].join(""),f);l=cljs.core.seq.call(null,l);for(var m=null,n=0,p=0;;)if(p<n){var q=cljs.core._nth.call(null,m,p),r=cljs.core.assoc.call(null,f,new cljs.core.Keyword(null,"value","value",305978217),q);if(cljs.core.contains_QMARK_.call(null,cljs.core.get.call(null,a,q),new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092)))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on another tuple attribute: ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,q))].join(""),r);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,a,q))))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on :db.cardinality/many attribute: ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,q))].join(""),r);p+=1}else if(l=cljs.core.seq.call(null,l)){if(cljs.core.chunked_seq_QMARK_.call(null,l))n=cljs.core.chunk_first.call(null,l),l=cljs.core.chunk_rest.call(null,l),m=n,n=cljs.core.count.call(null,n);else{m=cljs.core.first.call(null,l);n=cljs.core.assoc.call(null,f,new cljs.core.Keyword(null,"value","value",305978217),m);if(cljs.core.contains_QMARK_.call(null,cljs.core.get.call(null,a,m),new cljs.core.Keyword("db",
"tupleAttrs","db/tupleAttrs",250080092)))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on another tuple attribute: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,m))].join(""),n);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,
a,m))))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on :db.cardinality/many attribute: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,m))].join(""),n);l=cljs.core.next.call(null,l);m=null;n=0}p=0}else break}e+=1}else if(g=cljs.core.seq.call(null,b)){b=g;if(cljs.core.chunked_seq_QMARK_.call(null,b))c=cljs.core.chunk_first.call(null,b),b=cljs.core.chunk_rest.call(null,b),g=c,d=cljs.core.count.call(null,
c),c=g;else{c=cljs.core.first.call(null,b);g=cljs.core.nth.call(null,c,0,null);h=cljs.core.nth.call(null,c,1,null);var t=(new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)).cljs$core$IFn$_invoke$arity$2(h,!1);datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","isComponent","db/isComponent",423352398),(new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,
2,[!0,null,!1,null],null),null));if(cljs.core.truth_(function(){var a=t;return cljs.core.truth_(a)?cljs.core.not_EQ_.call(null,(new cljs.core.Keyword("db","valueType","db/valueType",1827971944)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079)):a}()))throw cljs.core.ex_info.call(null,["Bad attribute specification for ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g)),": {:db/isComponent true} should also have {:db/valueType :db.type/ref}"].join(""),
new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("schema","validation","schema/validation",1178447161),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),g,new cljs.core.Keyword(null,"key","key",-1516042587),new cljs.core.Keyword("db","isComponent","db/isComponent",423352398)],null));datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","unique","db/unique",329396388),(new cljs.core.Keyword("db","unique",
"db/unique",329396388)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722),null,new cljs.core.Keyword("db.unique","value","db.unique/value",276903088),null],null),null));datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","valueType","db/valueType",1827971944),(new cljs.core.Keyword("db","valueType","db/valueType",1827971944)).cljs$core$IFn$_invoke$arity$1(h),
new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079),null],null),null));datascript.db.validate_schema_key.call(null,g,new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(h),new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword("db.cardinality","many",
"db.cardinality/many",772806234),null,new cljs.core.Keyword("db.cardinality","one","db.cardinality/one",1428352190),null],null),null));if(cljs.core.contains_QMARK_.call(null,h,new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092))){c=new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("schema","validation","schema/validation",1178447161),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),g,new cljs.core.Keyword(null,
"key","key",-1516042587),new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092)],null);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(h)))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," has :db/tupleAttrs, must be :db.cardinality/one"].join(""),c);d=(new cljs.core.Keyword("db",
"tupleAttrs","db/tupleAttrs",250080092)).cljs$core$IFn$_invoke$arity$1(h);if(!cljs.core.sequential_QMARK_.call(null,d))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs must be a sequential collection, got: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,d))].join(""),c);if(cljs.core.empty_QMARK_.call(null,d))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
g))," :db/tupleAttrs can’t be empty"].join(""),c);d=cljs.core.seq.call(null,d);e=null;for(l=f=0;;)if(l<f){m=cljs.core._nth.call(null,e,l);n=cljs.core.assoc.call(null,c,new cljs.core.Keyword(null,"value","value",305978217),m);if(cljs.core.contains_QMARK_.call(null,cljs.core.get.call(null,a,m),new cljs.core.Keyword("db","tupleAttrs","db/tupleAttrs",250080092)))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on another tuple attribute: ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,m))].join(""),n);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,a,m))))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on :db.cardinality/many attribute: ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,m))].join(""),n);l+=1}else if(d=cljs.core.seq.call(null,d)){if(cljs.core.chunked_seq_QMARK_.call(null,d))f=cljs.core.chunk_first.call(null,d),d=cljs.core.chunk_rest.call(null,d),e=f,f=cljs.core.count.call(null,f);else{e=cljs.core.first.call(null,d);f=cljs.core.assoc.call(null,c,new cljs.core.Keyword(null,"value","value",305978217),e);if(cljs.core.contains_QMARK_.call(null,cljs.core.get.call(null,a,e),new cljs.core.Keyword("db",
"tupleAttrs","db/tupleAttrs",250080092)))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on another tuple attribute: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))].join(""),f);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),(new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659)).cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,
a,e))))throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," :db/tupleAttrs can’t depend on :db.cardinality/many attribute: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))].join(""),f);d=cljs.core.next.call(null,d);e=null;f=0}l=0}else break}b=cljs.core.next.call(null,b);c=null;d=0}e=0}else return null};
datascript.db.empty_db=function(a){switch(arguments.length){case 0:return datascript.db.empty_db.cljs$core$IFn$_invoke$arity$0();case 1:return datascript.db.empty_db.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};datascript.db.empty_db.cljs$core$IFn$_invoke$arity$0=function(){return datascript.db.empty_db.call(null,null)};
datascript.db.empty_db.cljs$core$IFn$_invoke$arity$1=function(a){if(null!=a&&!cljs.core.map_QMARK_.call(null,a))throw Error("Assert failed: (or (nil? schema) (map? schema))");datascript.db.validate_schema.call(null,a);return datascript.db.map__GT_DB.call(null,new cljs.core.PersistentArrayMap(null,8,[new cljs.core.Keyword(null,"schema","schema",-1582001791),a,new cljs.core.Keyword(null,"rschema","rschema",-1196134054),datascript.db.rschema.call(null,cljs.core.merge.call(null,new cljs.core.PersistentArrayMap(null,
1,[new cljs.core.Keyword("db","ident","db/ident",-737096),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","unique","db/unique",329396388),new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722)],null)],null),a)),new cljs.core.Keyword(null,"eavt","eavt",-666437073),me.tonsky.persistent_sorted_set.sorted_set_by.call(null,datascript.db.cmp_datoms_eavt),new cljs.core.Keyword(null,"aevt","aevt",-585148059),me.tonsky.persistent_sorted_set.sorted_set_by.call(null,
datascript.db.cmp_datoms_aevt),new cljs.core.Keyword(null,"avet","avet",1383857032),me.tonsky.persistent_sorted_set.sorted_set_by.call(null,datascript.db.cmp_datoms_avet),new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),0,new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),536870912,new cljs.core.Keyword(null,"hash","hash",-13781596),cljs.core.atom.call(null,0)],null))};datascript.db.empty_db.cljs$lang$maxFixedArity=1;
datascript.db.init_max_eid=function(a){a=(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,me.tonsky.persistent_sorted_set.rslice.call(null,a,datascript.db.datom.call(null,536870911,null,null,2147483647),datascript.db.datom.call(null,0,null,null,536870912))));return cljs.core.truth_(a)?a:0};
datascript.db.init_db=function(a){switch(arguments.length){case 1:return datascript.db.init_db.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 2:return datascript.db.init_db.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};datascript.db.init_db.cljs$core$IFn$_invoke$arity$1=function(a){return datascript.db.init_db.call(null,a,null)};
datascript.db.init_db.cljs$core$IFn$_invoke$arity$2=function(a,b){var c=cljs.core.first.call(null,cljs.core.drop_while.call(null,datascript.db.datom_QMARK_,a));if(null!=c)throw cljs.core.ex_info.call(null,["init-db expects list of Datoms, got ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.type.call(null,c)))].join(""),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword(null,"init-db","init-db",1595181278)],
null));datascript.db.validate_schema.call(null,b);c=datascript.db.rschema.call(null,cljs.core.merge.call(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","ident","db/ident",-737096),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","unique","db/unique",329396388),new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722)],null)],null),b));var d=(new cljs.core.Keyword("db","index","db/index",-1531680669)).cljs$core$IFn$_invoke$arity$1(c),
e=me.tonsky.persistent_sorted_set.arrays.array_QMARK_.call(null,a)?a:me.tonsky.persistent_sorted_set.arrays.into_array.call(null,a),f=me.tonsky.persistent_sorted_set.arrays.asort.call(null,e,datascript.db.cmp_datoms_eavt_quick),g=me.tonsky.persistent_sorted_set.from_sorted_array.call(null,datascript.db.cmp_datoms_eavt,e),h=me.tonsky.persistent_sorted_set.arrays.asort.call(null,e,datascript.db.cmp_datoms_aevt_quick),k=me.tonsky.persistent_sorted_set.from_sorted_array.call(null,datascript.db.cmp_datoms_aevt,
e),l=cljs.core.filter.call(null,function(a,b,c,d,e,f,g){return function(a){return cljs.core.contains_QMARK_.call(null,b,a.a)}}(c,d,e,f,g,h,k),a),m=cljs.core.to_array.call(null,l),n=me.tonsky.persistent_sorted_set.arrays.asort.call(null,m,datascript.db.cmp_datoms_avet_quick);a=me.tonsky.persistent_sorted_set.from_sorted_array.call(null,datascript.db.cmp_datoms_avet,m);var p=datascript.db.init_max_eid.call(null,g);d=cljs.core.transduce.call(null,cljs.core.map.call(null,function(a,b,c,d,e,f,g,h,k,l,
m,n){return function(a){return datascript.db.datom_tx.call(null,a)}}(c,d,e,f,g,h,k,l,m,n,a,p)),cljs.core.max,536870912,g);return datascript.db.map__GT_DB.call(null,new cljs.core.PersistentArrayMap(null,8,[new cljs.core.Keyword(null,"schema","schema",-1582001791),b,new cljs.core.Keyword(null,"rschema","rschema",-1196134054),c,new cljs.core.Keyword(null,"eavt","eavt",-666437073),g,new cljs.core.Keyword(null,"aevt","aevt",-585148059),k,new cljs.core.Keyword(null,"avet","avet",1383857032),a,new cljs.core.Keyword(null,
"max-eid","max-eid",2134868075),p,new cljs.core.Keyword(null,"max-tx","max-tx",1119558339),d,new cljs.core.Keyword(null,"hash","hash",-13781596),cljs.core.atom.call(null,0)],null))};datascript.db.init_db.cljs$lang$maxFixedArity=2;
datascript.db.equiv_db_index=function(a,b){a=cljs.core.seq.call(null,a);for(b=cljs.core.seq.call(null,b);;){if(null==a)return null==b;if(cljs.core._EQ_.call(null,cljs.core.first.call(null,a),cljs.core.first.call(null,b)))a=cljs.core.next.call(null,a),b=cljs.core.next.call(null,b);else return!1}};
datascript.db.hash_db=function(a){var b=cljs.core.deref.call(null,a.hash);return 0===b?cljs.core.reset_BANG_.call(null,a.hash,datascript.db.combine_hashes.call(null,cljs.core.hash.call(null,a.schema),cljs.core.hash.call(null,a.eavt))):b};
datascript.db.hash_fdb=function(a){var b=cljs.core.deref.call(null,a.hash);(function(){var b=datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY);return cljs.core.truth_(b)?b:cljs.core.PersistentHashSet.EMPTY})();return 0===b?(b=function(){var b=datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY);return cljs.core.truth_(b)?b:cljs.core.PersistentHashSet.EMPTY}(),
cljs.core.reset_BANG_.call(null,a.hash,datascript.db.combine_hashes.call(null,cljs.core.hash.call(null,datascript.db._schema.call(null,a)),cljs.core.hash_unordered_coll.call(null,b)))):b};
datascript.db.equiv_db=function(a,b){var c=b instanceof datascript.db.DB||b instanceof datascript.db.FilteredDB;return c?(c=cljs.core._EQ_.call(null,datascript.db._schema.call(null,a),datascript.db._schema.call(null,b)))?datascript.db.equiv_db_index.call(null,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY),datascript.db._datoms.call(null,b,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY)):
c:c};
datascript.db.pr_db=function(a,b,c){cljs.core._write.call(null,b,"#datascript/DB {");cljs.core._write.call(null,b,":schema ");cljs.core.pr_writer.call(null,datascript.db._schema.call(null,a),b,c);cljs.core._write.call(null,b,", :datoms ");cljs.core.pr_sequential_writer.call(null,b,function(a,b,c){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,"["," ","]",c,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[a.e,a.a,a.v,datascript.db.datom_tx.call(null,a)],
null))},"["," ","]",c,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),cljs.core.PersistentVector.EMPTY));return cljs.core._write.call(null,b,"}")};
datascript.db.db_from_reader=function(a){var b=null!=a&&(a.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,a):a,c=cljs.core.get.call(null,b,new cljs.core.Keyword(null,"schema","schema",-1582001791)),d=cljs.core.get.call(null,b,new cljs.core.Keyword(null,"datoms","datoms",-290874434));return datascript.db.init_db.call(null,cljs.core.map.call(null,function(a,b,c,d){return function(a){var b=cljs.core.nth.call(null,
a,0,null),c=cljs.core.nth.call(null,a,1,null),d=cljs.core.nth.call(null,a,2,null);a=cljs.core.nth.call(null,a,3,null);return datascript.db.datom.call(null,b,c,d,a)}}(a,b,c,d),d),c)};
datascript.db.resolve_datom=function(a,b,c,d,e,f,g){cljs.core.truth_(c)&&datascript.db.validate_attr.call(null,c,new cljs.core.List(null,new cljs.core.Symbol(null,"resolve-datom","resolve-datom",-294110827,null),new cljs.core.List(null,new cljs.core.Symbol(null,"db","db",-1661185010,null),new cljs.core.List(null,b,new cljs.core.List(null,c,new cljs.core.List(null,d,new cljs.core.List(null,e,null,1,null),2,null),3,null),4,null),5,null),6,null));return datascript.db.datom.call(null,function(){var c=
datascript.db.entid_some.call(null,a,b);return cljs.core.truth_(c)?c:f}(),c,cljs.core.truth_(function(){var b=null!=d;return b?datascript.db.ref_QMARK_.call(null,a,c):b}())?datascript.db.entid_strict.call(null,a,d):d,function(){var b=datascript.db.entid_some.call(null,a,e);return cljs.core.truth_(b)?b:g}())};
datascript.db.components__GT_pattern=function(a,b,c,d,e){var f=cljs.core.nth.call(null,c,0,null),g=cljs.core.nth.call(null,c,1,null),h=cljs.core.nth.call(null,c,2,null);c=cljs.core.nth.call(null,c,3,null);b=b instanceof cljs.core.Keyword?b.fqn:null;switch(b){case "eavt":return datascript.db.resolve_datom.call(null,a,f,g,h,c,d,e);case "aevt":return datascript.db.resolve_datom.call(null,a,g,f,h,c,d,e);case "avet":return datascript.db.resolve_datom.call(null,a,h,f,g,c,d,e);default:throw Error(["No matching clause: ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(b)].join(""));}};datascript.db.TxReport=function(a,b,c,d,e,f,g,h){this.db_before=a;this.db_after=b;this.tx_data=c;this.tempids=d;this.tx_meta=e;this.__meta=f;this.__extmap=g;this.__hash=h;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.db.TxReport.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.db.TxReport.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "db-before":return this.db_before;case "db-after":return this.db_after;case "tx-data":return this.tx_data;case "tempids":return this.tempids;case "tx-meta":return this.tx_meta;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.db.TxReport.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.db.TxReport{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"db-before","db-before",-553691536),this.db_before],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"db-after","db-after",-571884666),this.db_after],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"tx-data","tx-data",934159761),this.tx_data],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"tempids","tempids",
1767509089),this.tempids],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194),this.tx_meta],null)],null),this.__extmap))};
datascript.db.TxReport.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,5,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"db-before","db-before",-553691536),new cljs.core.Keyword(null,"db-after","db-after",-571884666),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),new cljs.core.Keyword(null,"tempids","tempids",1767509089),new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194)],
null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.db.TxReport.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.db.TxReport.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.db.TxReport(this.db_before,this.db_after,this.tx_data,this.tempids,this.tx_meta,this.__meta,this.__extmap,this.__hash)};
datascript.db.TxReport.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 5+cljs.core.count.call(null,this.__extmap)};datascript.db.TxReport.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-2022644885^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.db.TxReport.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.db_before,b.db_before)&&cljs.core._EQ_.call(null,this.db_after,b.db_after)&&cljs.core._EQ_.call(null,this.tx_data,b.tx_data)&&cljs.core._EQ_.call(null,this.tempids,b.tempids)&&cljs.core._EQ_.call(null,this.tx_meta,b.tx_meta)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.db.TxReport.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,5,[new cljs.core.Keyword(null,"tempids","tempids",1767509089),null,new cljs.core.Keyword(null,"db-after","db-after",-571884666),null,new cljs.core.Keyword(null,"db-before","db-before",-553691536),null,new cljs.core.Keyword(null,"tx-data","tx-data",934159761),null,new cljs.core.Keyword(null,"tx-meta","tx-meta",
1159283194),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.db.TxReport(this.db_before,this.db_after,this.tx_data,this.tempids,this.tx_meta,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.db.TxReport.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"db-before","db-before",-553691536),b))?new datascript.db.TxReport(c,this.db_after,this.tx_data,this.tempids,this.tx_meta,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"db-after","db-after",-571884666),b))?new datascript.db.TxReport(this.db_before,c,this.tx_data,this.tempids,
this.tx_meta,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"tx-data","tx-data",934159761),b))?new datascript.db.TxReport(this.db_before,this.db_after,c,this.tempids,this.tx_meta,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"tempids","tempids",1767509089),b))?new datascript.db.TxReport(this.db_before,this.db_after,this.tx_data,c,this.tx_meta,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,
"tx-meta","tx-meta",1159283194),b))?new datascript.db.TxReport(this.db_before,this.db_after,this.tx_data,this.tempids,c,this.__meta,this.__extmap,null):new datascript.db.TxReport(this.db_before,this.db_after,this.tx_data,this.tempids,this.tx_meta,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.db.TxReport.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"db-before","db-before",-553691536),this.db_before,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"db-after","db-after",-571884666),this.db_after,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"tx-data","tx-data",934159761),
this.tx_data,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"tempids","tempids",1767509089),this.tempids,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194),this.tx_meta,null)],null),this.__extmap))};datascript.db.TxReport.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.db.TxReport(this.db_before,this.db_after,this.tx_data,this.tempids,this.tx_meta,b,this.__extmap,this.__hash)};
datascript.db.TxReport.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.db.TxReport.getBasis=function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"db-before","db-before",1086839991,null),new cljs.core.Symbol(null,"db-after","db-after",1068646861,null),new cljs.core.Symbol(null,"tx-data","tx-data",-1720276008,null),new cljs.core.Symbol(null,"tempids","tempids",-886926680,null),new cljs.core.Symbol(null,"tx-meta","tx-meta",-1495152575,null)],null)};datascript.db.TxReport.cljs$lang$type=!0;
datascript.db.TxReport.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.db/TxReport",null,1,null)};datascript.db.TxReport.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.db/TxReport")};datascript.db.__GT_TxReport=function(a,b,c,d,e){return new datascript.db.TxReport(a,b,c,d,e,null,null,null)};
datascript.db.map__GT_TxReport=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"db-before","db-before",-553691536),new cljs.core.Keyword(null,"db-after","db-after",-571884666),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),new cljs.core.Keyword(null,"tempids","tempids",1767509089),new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.db.TxReport((new cljs.core.Keyword(null,
"db-before","db-before",-553691536)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"tx-data","tx-data",934159761)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"tempids","tempids",1767509089)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.db.is_attr_QMARK_=function(a,b,c){return cljs.core.contains_QMARK_.call(null,datascript.db._attrs_by.call(null,a,c),b)};datascript.db.multival_QMARK_=function(a,b){return datascript.db.is_attr_QMARK_.call(null,a,b,new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234))};datascript.db.ref_QMARK_=function(a,b){return datascript.db.is_attr_QMARK_.call(null,a,b,new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079))};
datascript.db.component_QMARK_=function(a,b){return datascript.db.is_attr_QMARK_.call(null,a,b,new cljs.core.Keyword("db","isComponent","db/isComponent",423352398))};datascript.db.indexing_QMARK_=function(a,b){return datascript.db.is_attr_QMARK_.call(null,a,b,new cljs.core.Keyword("db","index","db/index",-1531680669))};datascript.db.tuple_QMARK_=function(a,b){return datascript.db.is_attr_QMARK_.call(null,a,b,new cljs.core.Keyword("db.type","tuple","db.type/tuple",938234914))};
datascript.db.tuple_source_QMARK_=function(a,b){return datascript.db.is_attr_QMARK_.call(null,a,b,new cljs.core.Keyword("db","attrTuples","db/attrTuples",860541631))};
datascript.db.entid=function(a,b){for(;;){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db? db)");if("number"===typeof b&&0<b){if(2147483647<b)throw cljs.core.ex_info.call(null,["Highest supported entity id is ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,2147483647)),", got ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error",
"error",-978969032),new cljs.core.Keyword(null,"entity-id","entity-id",1485898093),new cljs.core.Keyword(null,"value","value",305978217),b],null));return b}if(cljs.core.sequential_QMARK_.call(null,b)){var c=b,d=cljs.core.nth.call(null,c,0,null);c=cljs.core.nth.call(null,c,1,null);if(cljs.core.not_EQ_.call(null,cljs.core.count.call(null,b),2))throw cljs.core.ex_info.call(null,["Lookup ref should contain 2 elements: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),
new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("lookup-ref","syntax","lookup-ref/syntax",-317304012),new cljs.core.Keyword(null,"entity-id","entity-id",1485898093),b],null));if(datascript.db.is_attr_QMARK_.call(null,a,d,new cljs.core.Keyword("db","unique","db/unique",329396388)))return null==c?null:(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,datascript.db._datoms.call(null,
a,new cljs.core.Keyword(null,"avet","avet",1383857032),b)));throw cljs.core.ex_info.call(null,["Lookup ref attribute should be marked as :db/unique: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("lookup-ref","unique","lookup-ref/unique",-960647710),new cljs.core.Keyword(null,"entity-id","entity-id",1485898093),b],null));}if(cljs.core.array_QMARK_.call(null,
b))b=cljs.core.array_seq.call(null,b);else{if(b instanceof cljs.core.Keyword)return(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","ident","db/ident",-737096),b],null))));throw cljs.core.ex_info.call(null,["Expected number or lookup ref for entity id, got ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("entity-id","syntax","entity-id/syntax",1921317045),new cljs.core.Keyword(null,"entity-id","entity-id",1485898093),b],null));}}};
datascript.db.entid_strict=function(a,b){a=datascript.db.entid.call(null,a,b);if(cljs.core.truth_(a))return a;throw cljs.core.ex_info.call(null,["Nothing found for entity id ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("entity-id","missing","entity-id/missing",1234588374),new cljs.core.Keyword(null,"entity-id","entity-id",1485898093),b],null));
};datascript.db.entid_some=function(a,b){return cljs.core.truth_(b)?datascript.db.entid_strict.call(null,a,b):null};
datascript.db.validate_datom=function(a,b){if(cljs.core.truth_(function(){var c=datascript.db.datom_added.call(null,b);return cljs.core.truth_(c)?datascript.db.is_attr_QMARK_.call(null,a,b.a,new cljs.core.Keyword("db","unique","db/unique",329396388)):c}())){var c=cljs.core.not_empty.call(null,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b.a,b.v],null)));if(null==c)return null;throw cljs.core.ex_info.call(null,
["Cannot add ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))," because of unique constraint: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,c))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","unique","transact/unique",-940992320),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),b.a,new cljs.core.Keyword(null,"datom","datom",-371556090),b],
null));}return null};
datascript.db.validate_attr=function(a,b){if(a instanceof cljs.core.Keyword||"string"===typeof a)return null;throw cljs.core.ex_info.call(null,["Bad entity attribute ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,a))," at ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b)),", expected keyword or string"].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax",
"transact/syntax",-299207078),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),a,new cljs.core.Keyword(null,"context","context",-830191113),b],null));};
datascript.db.validate_val=function(a,b){if(null==a)throw cljs.core.ex_info.call(null,["Cannot store nil as a value at ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"value","value",305978217),a,new cljs.core.Keyword(null,"context","context",-830191113),b],null));return null};
datascript.db.current_tx=function(a){return cljs.core.get_in.call(null,a,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"db-before","db-before",-553691536),new cljs.core.Keyword(null,"max-tx","max-tx",1119558339)],null))+1};datascript.db.next_eid=function(a){return(new cljs.core.Keyword(null,"max-eid","max-eid",2134868075)).cljs$core$IFn$_invoke$arity$1(a)+1};
datascript.db.tx_id_QMARK_=function(a){return cljs.core._EQ_.call(null,a,new cljs.core.Keyword("db","current-tx","db/current-tx",1600722132))||cljs.core._EQ_.call(null,a,":db/current-tx")||cljs.core._EQ_.call(null,a,"datomic.tx")||cljs.core._EQ_.call(null,a,"datascript.tx")};datascript.db.tempid_QMARK_=function(a){return"number"===typeof a&&0>a||"string"===typeof a};
datascript.db.new_eid_QMARK_=function(a,b){return b>(new cljs.core.Keyword(null,"max-eid","max-eid",2134868075)).cljs$core$IFn$_invoke$arity$1(a)&&536870912>b};datascript.db.advance_max_eid=function(a,b){return cljs.core.truth_(datascript.db.new_eid_QMARK_.call(null,a,b))?cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"max-eid","max-eid",2134868075),b):a};
datascript.db.allocate_eid=function(a){switch(arguments.length){case 2:return datascript.db.allocate_eid.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.db.allocate_eid.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.db.allocate_eid.cljs$core$IFn$_invoke$arity$2=function(a,b){return cljs.core.update.call(null,a,new cljs.core.Keyword(null,"db-after","db-after",-571884666),datascript.db.advance_max_eid,b)};
datascript.db.allocate_eid.cljs$core$IFn$_invoke$arity$3=function(a,b,c){var d=datascript.db.tx_id_QMARK_.call(null,b)?cljs.core.update.call(null,a,new cljs.core.Keyword(null,"tempids","tempids",1767509089),cljs.core.assoc,b,c):a;d=datascript.db.tempid_QMARK_.call(null,b)?cljs.core.update.call(null,d,new cljs.core.Keyword(null,"tempids","tempids",1767509089),cljs.core.assoc,b,c):d;d=cljs.core.truth_(function(){var d=!datascript.db.tempid_QMARK_.call(null,b);return d?datascript.db.new_eid_QMARK_.call(null,
(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(a),c):d}())?cljs.core.update.call(null,d,new cljs.core.Keyword(null,"tempids","tempids",1767509089),cljs.core.assoc,c,c):d;return cljs.core.update.call(null,d,new cljs.core.Keyword(null,"db-after","db-after",-571884666),datascript.db.advance_max_eid,c)};datascript.db.allocate_eid.cljs$lang$maxFixedArity=3;
datascript.db.with_datom=function(a,b){datascript.db.validate_datom.call(null,a,b);var c=datascript.db.indexing_QMARK_.call(null,a,b.a);if(cljs.core.truth_(datascript.db.datom_added.call(null,b)))return a=cljs.core.update.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),me.tonsky.persistent_sorted_set.conj,b,datascript.db.cmp_datoms_eavt_quick),a=cljs.core.update.call(null,a,new cljs.core.Keyword(null,"aevt","aevt",-585148059),me.tonsky.persistent_sorted_set.conj,b,datascript.db.cmp_datoms_aevt_quick),
c=c?cljs.core.update.call(null,a,new cljs.core.Keyword(null,"avet","avet",1383857032),me.tonsky.persistent_sorted_set.conj,b,datascript.db.cmp_datoms_avet_quick):a,c=datascript.db.advance_max_eid.call(null,c,b.e),cljs.core.assoc.call(null,c,new cljs.core.Keyword(null,"hash","hash",-13781596),cljs.core.atom.call(null,0));b=datascript.db.fsearch.call(null,a,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[b.e,b.a,b.v],null));if(null==b)return a;a=cljs.core.update.call(null,
a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),me.tonsky.persistent_sorted_set.disj,b,datascript.db.cmp_datoms_eavt_quick);a=cljs.core.update.call(null,a,new cljs.core.Keyword(null,"aevt","aevt",-585148059),me.tonsky.persistent_sorted_set.disj,b,datascript.db.cmp_datoms_aevt_quick);c=c?cljs.core.update.call(null,a,new cljs.core.Keyword(null,"avet","avet",1383857032),me.tonsky.persistent_sorted_set.disj,b,datascript.db.cmp_datoms_avet_quick):a;return cljs.core.assoc.call(null,c,new cljs.core.Keyword(null,
"hash","hash",-13781596),cljs.core.atom.call(null,0))};
datascript.db.queue_tuple=function(a,b,c,d,e,f,g){f=cljs.core.get.call(null,a,b);cljs.core.truth_(f)?d=f:(e=(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,datascript.db._datoms.call(null,d,new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,b],null)))),d=cljs.core.truth_(e)?e:cljs.core.vec.call(null,cljs.core.repeat.call(null,cljs.core.count.call(null,(new cljs.core.Keyword("db",
"tupleAttrs","db/tupleAttrs",250080092)).cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,datascript.db._schema.call(null,d),b))),null)));c=cljs.core.assoc.call(null,d,c,g);return cljs.core.assoc.call(null,a,b,c)};datascript.db.queue_tuples=function(a,b,c,d,e,f){return cljs.core.reduce_kv.call(null,function(a,b,k){return datascript.db.queue_tuple.call(null,a,b,k,c,d,e,f)},a,b)};
datascript.db.transact_report=function(a,b){var c=(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(a),d=(new cljs.core.Keyword(null,"a","a",-2123407586)).cljs$core$IFn$_invoke$arity$1(b);a=cljs.core.update.call(null,cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"db-after","db-after",-571884666),datascript.db.with_datom.call(null,c,b)),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),cljs.core.conj,b);if(datascript.db.tuple_source_QMARK_.call(null,
c,d)){var e=(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(b);b=cljs.core.truth_(datascript.db.datom_added.call(null,b))?(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(b):null;var f=cljs.core.get.call(null,(new cljs.core.Keyword("datascript.db","queued-tuples","datascript.db/queued-tuples",-762852029)).cljs$core$IFn$_invoke$arity$1(a),e);f=cljs.core.truth_(f)?f:cljs.core.PersistentArrayMap.EMPTY;var g=cljs.core.get.call(null,datascript.db._attrs_by.call(null,
c,new cljs.core.Keyword("db","attrTuples","db/attrTuples",860541631)),d);c=datascript.db.queue_tuples.call(null,f,g,c,e,d,b);return cljs.core.update.call(null,a,new cljs.core.Keyword("datascript.db","queued-tuples","datascript.db/queued-tuples",-762852029),cljs.core.assoc,e,c)}return a};
datascript.db.reverse_ref_QMARK_=function(a){if(a instanceof cljs.core.Keyword)return cljs.core._EQ_.call(null,"_",cljs.core.nth.call(null,cljs.core.name.call(null,a),0));if("string"===typeof a)return cljs.core.boolean$.call(null,cljs.core.re_matches.call(null,/(?:([^\/]+)\/)?_([^\/]+)/,a));throw cljs.core.ex_info.call(null,["Bad attribute type: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,a)),", expected keyword or string"].join(""),new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),a],null));};
datascript.db.reverse_ref=function(a){if(a instanceof cljs.core.Keyword)return datascript.db.reverse_ref_QMARK_.call(null,a)?cljs.core.keyword.call(null,cljs.core.namespace.call(null,a),cljs.core.subs.call(null,cljs.core.name.call(null,a),1)):cljs.core.keyword.call(null,cljs.core.namespace.call(null,a),["_",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.name.call(null,a))].join(""));if("string"===typeof a){var b=cljs.core.re_matches.call(null,/(?:([^\/]+)\/)?([^\/]+)/,a);cljs.core.nth.call(null,
b,0,null);a=cljs.core.nth.call(null,b,1,null);b=cljs.core.nth.call(null,b,2,null);return cljs.core._EQ_.call(null,"_",cljs.core.nth.call(null,b,0))?cljs.core.truth_(a)?[cljs.core.str.cljs$core$IFn$_invoke$arity$1(a),"/",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.subs.call(null,b,1))].join(""):cljs.core.subs.call(null,b,1):cljs.core.truth_(a)?[cljs.core.str.cljs$core$IFn$_invoke$arity$1(a),"/_",cljs.core.str.cljs$core$IFn$_invoke$arity$1(b)].join(""):["_",cljs.core.str.cljs$core$IFn$_invoke$arity$1(b)].join("")}throw cljs.core.ex_info.call(null,
["Bad attribute type: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,a)),", expected keyword or string"].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),a],null));};
datascript.db.resolve_upserts=function(a,b){var c=cljs.core.not_empty.call(null,datascript.db._attrs_by.call(null,a,new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722)));if(null==c)return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,null],null);var d=function(b,c){return function(b,c){return(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,
"avet","avet",1383857032),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,c],null))))}}(c,c),e=function(a,b,c){return function(d,e){return cljs.core.reduce.call(null,function(a,b,c){return function(b,c){var e=a.call(null,d,c);return null==e?cljs.core.update.call(null,b,0,cljs.core.conj,c):cljs.core.update.call(null,b,1,cljs.core.assoc,c,e)}}(a,b,c),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.PersistentVector.EMPTY,cljs.core.PersistentArrayMap.EMPTY],
null),e)}}(d,c,c);return cljs.core.reduce_kv.call(null,function(b,c,d,e){return function(e,f,g){var h=cljs.core.nth.call(null,e,0,null);e=cljs.core.nth.call(null,e,1,null);if(cljs.core.contains_QMARK_.call(null,d,f)){if(datascript.db.multival_QMARK_.call(null,a,f)&&(me.tonsky.persistent_sorted_set.arrays.array_QMARK_.call(null,g)||cljs.core.coll_QMARK_.call(null,g)&&!cljs.core.map_QMARK_.call(null,g))){var k=c.call(null,f,g);g=cljs.core.nth.call(null,k,0,null);k=cljs.core.nth.call(null,k,1,null);
return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.empty_QMARK_.call(null,g)?h:cljs.core.assoc.call(null,h,f,g),cljs.core.empty_QMARK_.call(null,k)?e:cljs.core.assoc.call(null,e,f,k)],null)}k=b.call(null,f,g);return null==k?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.assoc.call(null,h,f,g),e],null):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[h,cljs.core.assoc.call(null,e,f,
cljs.core.PersistentArrayMap.createAsIfByAssoc([g,k]))],null)}return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.assoc.call(null,h,f,g),e],null)}}(d,e,c,c),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.PersistentArrayMap.EMPTY,cljs.core.PersistentArrayMap.EMPTY],null),b)};
datascript.db.validate_upserts=function(a,b){var c=cljs.core.reduce_kv.call(null,function(a,b,c){return cljs.core.reduce_kv.call(null,function(a,c,d){return cljs.core.assoc.call(null,a,d,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,c],null))},a,c)},cljs.core.PersistentArrayMap.EMPTY,b);if(2<=cljs.core.count.call(null,c)){b=cljs.core.first.call(null,c);a=cljs.core.nth.call(null,b,0,null);var d=cljs.core.nth.call(null,b,1,null);b=cljs.core.nth.call(null,d,0,null);
d=cljs.core.nth.call(null,d,1,null);var e=cljs.core.second.call(null,c);c=cljs.core.nth.call(null,e,0,null);var f=cljs.core.nth.call(null,e,1,null);e=cljs.core.nth.call(null,f,0,null);f=cljs.core.nth.call(null,f,1,null);throw cljs.core.ex_info.call(null,["Conflicting upserts: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,d],null)))," resolves to ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
a)),", but ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,f],null)))," resolves to ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,c))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","upsert","transact/upsert",412688078),new cljs.core.Keyword(null,"assertion","assertion",-1645134882),
new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[a,b,d],null),new cljs.core.Keyword(null,"conflict","conflict",1978796605),new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[c,e,f],null)],null));}d=cljs.core.first.call(null,c);b=cljs.core.nth.call(null,d,0,null);c=cljs.core.nth.call(null,d,1,null);d=cljs.core.nth.call(null,c,0,null);c=cljs.core.nth.call(null,c,1,null);a=(new cljs.core.Keyword("db","id","db/id",-1388397098)).cljs$core$IFn$_invoke$arity$1(a);
if(null!=b&&null!=a&&!datascript.db.tempid_QMARK_.call(null,a)&&cljs.core.not_EQ_.call(null,b,a))throw cljs.core.ex_info.call(null,["Conflicting upsert: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[d,c],null)))," resolves to ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b)),", but entity already has :db/id ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
a))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","upsert","transact/upsert",412688078),new cljs.core.Keyword(null,"assertion","assertion",-1645134882),new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[b,d,c],null),new cljs.core.Keyword(null,"conflict","conflict",1978796605),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","id","db/id",-1388397098),a],null)],
null));return b};
datascript.db.maybe_wrap_multival=function(a,b,c){return datascript.db.reverse_ref_QMARK_.call(null,b)||datascript.db.multival_QMARK_.call(null,a,b)?me.tonsky.persistent_sorted_set.arrays.array_QMARK_.call(null,c)||cljs.core.coll_QMARK_.call(null,c)&&!cljs.core.map_QMARK_.call(null,c)?cljs.core._EQ_.call(null,cljs.core.count.call(null,c),2)&&datascript.db.is_attr_QMARK_.call(null,a,cljs.core.first.call(null,c),new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722))?new cljs.core.PersistentVector(null,
1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null):c:new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null):new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null)};
datascript.db.explode=function(a,b){return function(b){return function f(c){return new cljs.core.LazySeq(null,function(b){return function(){for(var e=c;;){var g=cljs.core.seq.call(null,e);if(g){var l=g,m=cljs.core.first.call(null,l),n=cljs.core.nth.call(null,m,0,null),p=cljs.core.nth.call(null,m,1,null);if(cljs.core.not_EQ_.call(null,n,new cljs.core.Keyword("db","id","db/id",-1388397098))){var q=datascript.db.validate_attr.call(null,n,cljs.core.PersistentArrayMap.createAsIfByAssoc([new cljs.core.Keyword("db",
"id","db/id",-1388397098),b,n,p])),r=datascript.db.reverse_ref_QMARK_.call(null,n),t=r?datascript.db.reverse_ref.call(null,n):n;if(r&&!datascript.db.ref_QMARK_.call(null,a,t))throw cljs.core.ex_info.call(null,["Bad attribute ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,n)),": reverse attribute name requires {:db/valueType :db.type/ref} in schema"].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact",
"syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"attribute","attribute",-2074029119),n,new cljs.core.Keyword(null,"context","context",-830191113),cljs.core.PersistentArrayMap.createAsIfByAssoc([new cljs.core.Keyword("db","id","db/id",-1388397098),b,n,p])],null));g=function(b,c,e,f,g,h,k,l,m,n,p){return function G(q){return new cljs.core.LazySeq(null,function(b,c,e,f,g,h,k,l,m,n,p){return function(){for(;;){var b=cljs.core.seq.call(null,q);if(b){if(cljs.core.chunked_seq_QMARK_.call(null,
b)){var c=cljs.core.chunk_first.call(null,b),g=cljs.core.count.call(null,c),h=cljs.core.chunk_buffer.call(null,g);a:for(var l=0;;)if(l<g){var m=cljs.core._nth.call(null,c,l);cljs.core.chunk_append.call(null,h,datascript.db.ref_QMARK_.call(null,a,f)&&cljs.core.map_QMARK_.call(null,m)?cljs.core.assoc.call(null,m,datascript.db.reverse_ref.call(null,k),p):e?new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),m,f,p],null):
new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),p,f,m],null));l+=1}else{c=!0;break a}return c?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,h),G.call(null,cljs.core.chunk_rest.call(null,b))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,h),null)}h=cljs.core.first.call(null,b);return cljs.core.cons.call(null,datascript.db.ref_QMARK_.call(null,a,f)&&cljs.core.map_QMARK_.call(null,h)?cljs.core.assoc.call(null,
h,datascript.db.reverse_ref.call(null,k),p):e?new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),h,f,p],null):new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),p,f,h],null),G.call(null,cljs.core.rest.call(null,b)))}return null}}}(b,c,e,f,g,h,k,l,m,n,p),null,null)}}(e,q,r,t,null,m,n,p,l,g,b);if(n=cljs.core.seq.call(null,g.call(null,datascript.db.maybe_wrap_multival.call(null,
a,n,p))))return cljs.core.concat.call(null,n,f.call(null,cljs.core.rest.call(null,e)))}e=cljs.core.rest.call(null,e)}else return null}}}(b),null,null)}}((new cljs.core.Keyword("db","id","db/id",-1388397098)).cljs$core$IFn$_invoke$arity$1(b)).call(null,b)};
datascript.db.transact_add=function(a,b){cljs.core.nth.call(null,b,0,null);var c=cljs.core.nth.call(null,b,1,null),d=cljs.core.nth.call(null,b,2,null),e=cljs.core.nth.call(null,b,3,null),f=cljs.core.nth.call(null,b,4,null);datascript.db.validate_attr.call(null,d,b);datascript.db.validate_val.call(null,e,b);b=cljs.core.truth_(f)?f:datascript.db.current_tx.call(null,a);f=(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(a);c=datascript.db.entid_strict.call(null,
f,c);e=datascript.db.ref_QMARK_.call(null,f,d)?datascript.db.entid_strict.call(null,f,e):e;var g=datascript.db.datom.call(null,c,d,e,b);f=datascript.db.multival_QMARK_.call(null,f,d)?datascript.db.fsearch.call(null,f,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e],null)):datascript.db.fsearch.call(null,f,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d],null));return null==f?datascript.db.transact_report.call(null,a,g):cljs.core._EQ_.call(null,
f.v,e)?cljs.core.update.call(null,a,new cljs.core.Keyword("datascript.db","tx-redundant","datascript.db/tx-redundant",-1117921977),datascript.db.conjv,g):datascript.db.transact_report.call(null,datascript.db.transact_report.call(null,a,datascript.db.datom.call(null,c,d,f.v,b,!1)),g)};datascript.db.transact_retract_datom=function(a,b){var c=datascript.db.current_tx.call(null,a);return datascript.db.transact_report.call(null,a,datascript.db.datom.call(null,b.e,b.a,b.v,c,!1))};
datascript.db.retract_components=function(a,b){return cljs.core.into.call(null,cljs.core.PersistentHashSet.EMPTY,cljs.core.comp.call(null,cljs.core.filter.call(null,function(b){return datascript.db.component_QMARK_.call(null,a,b.a)}),cljs.core.map.call(null,function(a){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db.fn","retractEntity","db.fn/retractEntity",-1423535441),a.v],null)})),b)};
datascript.db.retry_with_tempid=function(a,b,c,d,e){if(cljs.core.contains_QMARK_.call(null,(new cljs.core.Keyword(null,"tempids","tempids",1767509089)).cljs$core$IFn$_invoke$arity$1(a),d))throw cljs.core.ex_info.call(null,["Conflicting upsert: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,d))," resolves both to ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))," and ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.get_in.call(null,
a,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"tempids","tempids",1767509089),d],null))))].join(""),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","upsert","transact/upsert",412688078)],null));b=cljs.core.assoc.call(null,(new cljs.core.Keyword(null,"tempids","tempids",1767509089)).cljs$core$IFn$_invoke$arity$1(b),d,e);a=cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,
"tempids","tempids",1767509089),b);return datascript.db.transact_tx_data.call(null,a,c)};
datascript.db.builtin_fn_QMARK_=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,8,[new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418),null,new cljs.core.Keyword("db","cas","db/cas",-451542322),null,new cljs.core.Keyword("db.fn","retractEntity","db.fn/retractEntity",-1423535441),null,new cljs.core.Keyword("db","retractEntity","db/retractEntity",-1452737935),null,new cljs.core.Keyword("db","retract","db/retract",-1549825231),null,new cljs.core.Keyword("db.fn","retractAttribute",
"db.fn/retractAttribute",937402164),null,new cljs.core.Keyword("db.fn","cas","db.fn/cas",-379352172),null,new cljs.core.Keyword("db","add","db/add",235286841),null],null),null);
datascript.db.flush_tuples=function(a){var b=(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(a),c=datascript.db._schema.call(null,b),d=datascript.db._attrs_by.call(null,b,new cljs.core.Keyword("db","attrTuples","db/attrTuples",860541631));return cljs.core.reduce_kv.call(null,function(a,b,c){return function(d,e,f){return cljs.core.reduce_kv.call(null,function(a,b,c){return function(b,c,d){d=cljs.core.every_QMARK_.call(null,cljs.core.nil_QMARK_,d)?null:d;
var f=(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,c],null))));return cljs.core._EQ_.call(null,d,f)?b:null==d?cljs.core.conj.call(null,b,cljs.core.with_meta(new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","retract","db/retract",
-1549825231),e,c,f],null),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("datascript.db","internal","datascript.db/internal",-249301114),!0],null))):cljs.core.conj.call(null,b,cljs.core.with_meta(new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),e,c,d],null),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("datascript.db","internal","datascript.db/internal",-249301114),!0],null)))}}(a,b,
c),d,f)}}(b,c,d),cljs.core.PersistentVector.EMPTY,(new cljs.core.Keyword("datascript.db","queued-tuples","datascript.db/queued-tuples",-762852029)).cljs$core$IFn$_invoke$arity$1(a))};
datascript.db.check_value_tempids=function(a){var b=(new cljs.core.Keyword("datascript.db","value-tempids","datascript.db/value-tempids",244806162)).cljs$core$IFn$_invoke$arity$1(a),c=function(a){return function(a,b){return cljs.core.truth_(datascript.db.datom_added.call(null,b))?cljs.core.dissoc.call(null,a,(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(b)):a}}(b);b=cljs.core.reduce.call(null,c,b,cljs.core.concat.call(null,(new cljs.core.Keyword(null,"tx-data","tx-data",
934159761)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword("datascript.db","tx-redundant","datascript.db/tx-redundant",-1117921977)).cljs$core$IFn$_invoke$arity$1(a)));if(cljs.core.empty_QMARK_.call(null,b))return cljs.core.dissoc.call(null,a,new cljs.core.Keyword("datascript.db","value-tempids","datascript.db/value-tempids",244806162),new cljs.core.Keyword("datascript.db","tx-redundant","datascript.db/tx-redundant",-1117921977));throw cljs.core.ex_info.call(null,["Tempids used only as value in transaction: ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.sort.call(null,cljs.core.vals.call(null,b))))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"tempids","tempids",1767509089),b],null));};
datascript.db.transact_tx_data=function(a,b){if(null!=b&&!cljs.core.sequential_QMARK_.call(null,b))throw cljs.core.ex_info.call(null,["Bad transaction data ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b)),", expected sequential collection"].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),
b],null));for(var c=cljs.core.update.call(null,a,new cljs.core.Keyword(null,"db-after","db-after",-571884666),cljs.core.transient$),d=!cljs.core.empty_QMARK_.call(null,datascript.db._attrs_by.call(null,(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(a),new cljs.core.Keyword("db.type","tuple","db.type/tuple",938234914))),e=d?cljs.core.interleave.call(null,b,cljs.core.repeat.call(null,new cljs.core.Keyword("datascript.db","flush-tuples","datascript.db/flush-tuples",
-797350002))):b,f=c,g=e;;){if(cljs.core.empty_QMARK_.call(null,g))return cljs.core.update.call(null,cljs.core.update.call(null,cljs.core.update.call(null,datascript.db.check_value_tempids.call(null,f),new cljs.core.Keyword(null,"tempids","tempids",1767509089),cljs.core.assoc,new cljs.core.Keyword("db","current-tx","db/current-tx",1600722132),datascript.db.current_tx.call(null,f)),new cljs.core.Keyword(null,"db-after","db-after",-571884666),cljs.core.update,new cljs.core.Keyword(null,"max-tx","max-tx",
1119558339),cljs.core.inc),new cljs.core.Keyword(null,"db-after","db-after",-571884666),cljs.core.persistent_BANG_);var h=g,k=cljs.core.seq.call(null,h),l=cljs.core.first.call(null,k),m=cljs.core.next.call(null,k),n=l,p=m;if(null==n)g=p;else if(cljs.core._EQ_.call(null,new cljs.core.Keyword("datascript.db","flush-tuples","datascript.db/flush-tuples",-797350002),n))if(cljs.core.contains_QMARK_.call(null,f,new cljs.core.Keyword("datascript.db","queued-tuples","datascript.db/queued-tuples",-762852029))){var q=
cljs.core.dissoc.call(null,f,new cljs.core.Keyword("datascript.db","queued-tuples","datascript.db/queued-tuples",-762852029));p=cljs.core.concat.call(null,datascript.db.flush_tuples.call(null,f),p);f=q;g=p}else g=p;else{var r=(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(f),t=(new cljs.core.Keyword(null,"tempids","tempids",1767509089)).cljs$core$IFn$_invoke$arity$1(f);if(cljs.core.map_QMARK_.call(null,n)){var u=(new cljs.core.Keyword("db","id","db/id",
-1388397098)).cljs$core$IFn$_invoke$arity$1(n);if(datascript.db.tx_id_QMARK_.call(null,u))q=datascript.db.current_tx.call(null,f),f=datascript.db.allocate_eid.call(null,f,u,q),g=p=cljs.core.cons.call(null,cljs.core.assoc.call(null,n,new cljs.core.Keyword("db","id","db/id",-1388397098),q),p);else if(cljs.core.sequential_QMARK_.call(null,u))q=datascript.db.entid_strict.call(null,r,u),g=p=cljs.core.cons.call(null,cljs.core.assoc.call(null,n,new cljs.core.Keyword("db","id","db/id",-1388397098),q),p);
else{var v=datascript.db.resolve_upserts.call(null,r,n);q=cljs.core.nth.call(null,v,0,null);v=cljs.core.nth.call(null,v,1,null);var w=datascript.db.validate_upserts.call(null,q,v);if(null!=w){if(datascript.db.tempid_QMARK_.call(null,u)&&cljs.core.contains_QMARK_.call(null,t,u)&&cljs.core.not_EQ_.call(null,w,cljs.core.get.call(null,t,u)))return datascript.db.retry_with_tempid.call(null,a,f,b,u,w);f=datascript.db.allocate_eid.call(null,f,u,w);g=p=cljs.core.concat.call(null,datascript.db.explode.call(null,
r,cljs.core.assoc.call(null,q,new cljs.core.Keyword("db","id","db/id",-1388397098),w)),p)}else if("number"===typeof u||null==u||"string"===typeof u)q=null==u?datascript.db.next_eid.call(null,r):datascript.db.tempid_QMARK_.call(null,u)?function(){var a=cljs.core.get.call(null,t,u);return cljs.core.truth_(a)?a:datascript.db.next_eid.call(null,r)}():u,n=cljs.core.assoc.call(null,n,new cljs.core.Keyword("db","id","db/id",-1388397098),q),f=datascript.db.allocate_eid.call(null,f,u,q),g=p=cljs.core.concat.call(null,
datascript.db.explode.call(null,r,n),p);else throw cljs.core.ex_info.call(null,["Expected number, string or lookup ref for :db/id, got ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,u))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("entity-id","syntax","entity-id/syntax",1921317045),new cljs.core.Keyword(null,"entity","entity",-450970276),n],null));}}else if(cljs.core.sequential_QMARK_.call(null,
n)){var x=n;v=cljs.core.nth.call(null,x,0,null);var y=cljs.core.nth.call(null,x,1,null);q=cljs.core.nth.call(null,x,2,null);var B=cljs.core.nth.call(null,x,3,null);if(cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418))){q=cljs.core.seq.call(null,n);n=cljs.core.first.call(null,q);q=cljs.core.next.call(null,q);var I=n;n=cljs.core.first.call(null,q);q=cljs.core.next.call(null,q);g=p=cljs.core.concat.call(null,cljs.core.apply.call(null,n,r,q),p)}else if(v instanceof
cljs.core.Keyword&&cljs.core.not.call(null,datascript.db.builtin_fn_QMARK_.call(null,v))){I=datascript.db.entid.call(null,r,v);if(null==I)throw cljs.core.ex_info.call(null,["Can’t find entity for transaction fn ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,v))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"operation",
"operation",-1267664310),new cljs.core.Keyword("db.fn","call","db.fn/call",-151594418),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),n],null));q=I;y=(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(datascript.db.fsearch.call(null,r,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[q,new cljs.core.Keyword("db","fn","db/fn",-1175261470)],null)));q=cljs.core.next.call(null,n);if(cljs.core.fn_QMARK_.call(null,y))g=p=cljs.core.concat.call(null,
cljs.core.apply.call(null,y,r,q),p);else throw cljs.core.ex_info.call(null,["Entity ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,v))," expected to have :db/fn attribute with fn? value"].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"operation","operation",-1267664310),new cljs.core.Keyword("db.fn","call","db.fn/call",
-151594418),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),n],null));}else{if(datascript.db.tempid_QMARK_.call(null,y)&&cljs.core.not_EQ_.call(null,v,new cljs.core.Keyword("db","add","db/add",235286841)))throw cljs.core.ex_info.call(null,["Can't use tempid in '",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,n)),"'. Tempids are allowed in :db/add only"].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact",
"syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"op","op",-1882987955),n],null));if(cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db.fn","cas","db.fn/cas",-379352172))||cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db","cas","db/cas",-451542322))){var T=n;I=cljs.core.nth.call(null,T,0,null);var z=cljs.core.nth.call(null,T,1,null),A=cljs.core.nth.call(null,T,2,null),C=cljs.core.nth.call(null,T,3,null),D=cljs.core.nth.call(null,T,4,null),E=datascript.db.entid_strict.call(null,
r,z),G=datascript.db.validate_attr.call(null,A,n),F=datascript.db.ref_QMARK_.call(null,r,A)?datascript.db.entid_strict.call(null,r,C):C,H=datascript.db.ref_QMARK_.call(null,r,A)?datascript.db.entid_strict.call(null,r,D):D,K=datascript.db.validate_val.call(null,H,n),J=cljs.core.vec.call(null,datascript.db._search.call(null,r,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[E,A],null)));if(datascript.db.multival_QMARK_.call(null,r,A))if(cljs.core.truth_(cljs.core.some.call(null,
function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v,w,x,y,B,A,z,C,I,E,D,G,F){return function(a){return cljs.core._EQ_.call(null,a.v,m)}}(f,g,T,I,z,A,C,D,E,G,F,H,K,J,x,v,y,q,B,r,t,h,k,l,m,n,p,c,d,e),J)))f=datascript.db.transact_add.call(null,f,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),E,A,H],null)),g=p;else throw cljs.core.ex_info.call(null,[":db.fn/cas failed on datom [",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
E))," ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,A))," ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.map.call(null,new cljs.core.Keyword(null,"v","v",21465059),J))),"], expected ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,F))].join(""),new cljs.core.PersistentArrayMap(null,4,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","cas","transact/cas",816687170),new cljs.core.Keyword(null,
"old","old",-1825222690),J,new cljs.core.Keyword(null,"expected","expected",1583670997),F,new cljs.core.Keyword(null,"new","new",-2085437848),H],null));else if(v=(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,J)),cljs.core._EQ_.call(null,v,F))f=datascript.db.transact_add.call(null,f,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),E,A,H],null)),g=p;else throw cljs.core.ex_info.call(null,
[":db.fn/cas failed on datom [",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,E))," ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,A))," ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,v)),"], expected ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,F))].join(""),new cljs.core.PersistentArrayMap(null,4,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","cas","transact/cas",
816687170),new cljs.core.Keyword(null,"old","old",-1825222690),cljs.core.first.call(null,J),new cljs.core.Keyword(null,"expected","expected",1583670997),F,new cljs.core.Keyword(null,"new","new",-2085437848),H],null));}else if(datascript.db.tx_id_QMARK_.call(null,y))n=datascript.db.allocate_eid.call(null,f,y,datascript.db.current_tx.call(null,f)),p=cljs.core.cons.call(null,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[v,datascript.db.current_tx.call(null,f),q,B],null),
p),f=n,g=p;else if(datascript.db.ref_QMARK_.call(null,r,q)&&datascript.db.tx_id_QMARK_.call(null,B))n=datascript.db.allocate_eid.call(null,f,B,datascript.db.current_tx.call(null,f)),p=cljs.core.cons.call(null,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[v,y,q,datascript.db.current_tx.call(null,f)],null),p),f=n,g=p;else if(datascript.db.ref_QMARK_.call(null,r,q)&&datascript.db.tempid_QMARK_.call(null,B))I=cljs.core.get.call(null,t,B),null==I?(n=datascript.db.next_eid.call(null,
r),f=cljs.core.update.call(null,datascript.db.allocate_eid.call(null,f,B,n),new cljs.core.Keyword("datascript.db","value-tempids","datascript.db/value-tempids",244806162),cljs.core.assoc,n,B),g=p=g):(n=I,f=cljs.core.update.call(null,f,new cljs.core.Keyword("datascript.db","value-tempids","datascript.db/value-tempids",244806162),cljs.core.assoc,n,B),g=p=cljs.core.cons.call(null,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[v,y,q,n],null),p));else if(datascript.db.tempid_QMARK_.call(null,
y)){w=datascript.db.is_attr_QMARK_.call(null,r,q,new cljs.core.Keyword("db.unique","identity","db.unique/identity",1675950722))?(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,datascript.db._datoms.call(null,r,new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[q,B],null)))):null;var L=cljs.core.get.call(null,t,y);if(cljs.core.truth_(function(){var a=w;return cljs.core.truth_(a)?
(a=L,cljs.core.truth_(a)?cljs.core.not_EQ_.call(null,w,L):a):a}()))return datascript.db.retry_with_tempid.call(null,a,f,b,y,w);n=function(){var a=w;if(cljs.core.truth_(a))return a;a=L;return cljs.core.truth_(a)?a:datascript.db.next_eid.call(null,r)}();f=datascript.db.allocate_eid.call(null,f,y,n);g=p=cljs.core.cons.call(null,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[v,n,q,B],null),p)}else{if(cljs.core.not.call(null,(new cljs.core.Keyword("datascript.db","internal",
"datascript.db/internal",-249301114)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,n)))&&datascript.db.tuple_QMARK_.call(null,r,q))throw cljs.core.ex_info.call(null,["Can’t modify tuple attrs directly: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,n))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"tx-data",
"tx-data",934159761),n],null));if(cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db","add","db/add",235286841)))f=datascript.db.transact_add.call(null,f,n),g=p;else if(cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db","retract","db/retract",-1549825231))&&null!=B)I=datascript.db.entid.call(null,r,y),null==I?g=p:(z=I,v=datascript.db.ref_QMARK_.call(null,r,q)?datascript.db.entid_strict.call(null,r,B):B,datascript.db.validate_attr.call(null,q,n),datascript.db.validate_val.call(null,v,n),q=datascript.db.fsearch.call(null,
r,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[z,q,v],null)),null==q?g=p:(f=datascript.db.transact_retract_datom.call(null,f,q),g=p));else if(cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db.fn","retractAttribute","db.fn/retractAttribute",937402164))||cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db","retract","db/retract",-1549825231)))I=datascript.db.entid.call(null,r,y),null==I?g=p:(z=I,I=datascript.db.validate_attr.call(null,q,n),J=cljs.core.vec.call(null,
datascript.db._search.call(null,r,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[z,q],null))),f=cljs.core.reduce.call(null,datascript.db.transact_retract_datom,f,J),g=p=cljs.core.concat.call(null,datascript.db.retract_components.call(null,r,J),p));else if(cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db.fn","retractEntity","db.fn/retractEntity",-1423535441))||cljs.core._EQ_.call(null,v,new cljs.core.Keyword("db","retractEntity","db/retractEntity",-1452737935)))I=
datascript.db.entid.call(null,r,y),null==I?g=p:(z=I,J=cljs.core.vec.call(null,datascript.db._search.call(null,r,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[z],null))),q=cljs.core.vec.call(null,cljs.core.mapcat.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v,w,x,y){return function(a){return datascript.db._search.call(null,m,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[null,a,d],null))}}(f,g,J,z,I,x,v,y,q,B,r,t,h,k,l,m,n,p,
c,d,e),datascript.db._attrs_by.call(null,r,new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079)))),f=cljs.core.reduce.call(null,datascript.db.transact_retract_datom,f,cljs.core.concat.call(null,J,q)),g=p=cljs.core.concat.call(null,datascript.db.retract_components.call(null,r,J),p));else throw cljs.core.ex_info.call(null,["Unknown operation at ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,n)),", expected :db/add, :db/retract, :db.fn/call, :db.fn/retractAttribute, :db.fn/retractEntity or an ident corresponding to an installed transaction function (e.g. {:db/ident \x3ckeyword\x3e :db/fn \x3cIfn\x3e}, usage of :db/ident requires {:db/unique :db.unique/identity} in schema)"].join(""),
new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"operation","operation",-1267664310),v,new cljs.core.Keyword(null,"tx-data","tx-data",934159761),n],null));}}}else if(cljs.core.truth_(datascript.db.datom_QMARK_.call(null,n)))v=n,y=cljs.core.nth.call(null,v,0,null),q=cljs.core.nth.call(null,v,1,null),B=cljs.core.nth.call(null,v,2,null),n=cljs.core.nth.call(null,
v,3,null),v=cljs.core.nth.call(null,v,4,null),cljs.core.truth_(v)?(f=datascript.db.transact_add.call(null,f,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","add","db/add",235286841),y,q,B,n],null)),g=p):g=p=cljs.core.cons.call(null,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword("db","retract","db/retract",-1549825231),y,q,B],null),p);else throw cljs.core.ex_info.call(null,["Bad entity type at ",
cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,n)),", expected map or vector"].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transact","syntax","transact/syntax",-299207078),new cljs.core.Keyword(null,"tx-data","tx-data",934159761),n],null));}}};datascript.pull_parser={};datascript.pull_parser.PullSpec=function(a,b,c,d,e){this.wildcard_QMARK_=a;this.attrs=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullSpec.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullSpec.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "wildcard?":return this.wildcard_QMARK_;case "attrs":return this.attrs;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullSpec.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullSpec{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),this.wildcard_QMARK_],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attrs","attrs",-2090668713),this.attrs],null)],null),this.__extmap))};
datascript.pull_parser.PullSpec.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),new cljs.core.Keyword(null,"attrs","attrs",-2090668713)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullSpec.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullSpec.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullSpec(this.wildcard_QMARK_,this.attrs,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullSpec.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullSpec.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 90253489^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.pull_parser.PullSpec.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.wildcard_QMARK_,b.wildcard_QMARK_)&&cljs.core._EQ_.call(null,this.attrs,b.attrs)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.pull_parser.PullSpec.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"attrs","attrs",-2090668713),null,new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullSpec(this.wildcard_QMARK_,
this.attrs,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullSpec.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),b))?new datascript.pull_parser.PullSpec(c,this.attrs,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attrs","attrs",-2090668713),b))?new datascript.pull_parser.PullSpec(this.wildcard_QMARK_,c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullSpec(this.wildcard_QMARK_,
this.attrs,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.pull_parser.PullSpec.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),this.wildcard_QMARK_,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"attrs","attrs",-2090668713),this.attrs,null)],null),this.__extmap))};
datascript.pull_parser.PullSpec.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullSpec(this.wildcard_QMARK_,this.attrs,b,this.__extmap,this.__hash)};datascript.pull_parser.PullSpec.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullSpec.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"wildcard?","wildcard?",954487426,null),new cljs.core.Symbol(null,"attrs","attrs",-450137186,null)],null)};datascript.pull_parser.PullSpec.cljs$lang$type=!0;datascript.pull_parser.PullSpec.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullSpec",null,1,null)};
datascript.pull_parser.PullSpec.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullSpec")};datascript.pull_parser.__GT_PullSpec=function(a,b){return new datascript.pull_parser.PullSpec(a,b,null,null,null)};
datascript.pull_parser.map__GT_PullSpec=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),new cljs.core.Keyword(null,"attrs","attrs",-2090668713));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullSpec((new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.pull_parser.IPullSpecComponent=function(){};
datascript.pull_parser._as_spec=function(a){if(null!=a&&null!=a.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1)return a.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1(a);var b=datascript.pull_parser._as_spec[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=datascript.pull_parser._as_spec._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"IPullSpecComponent.-as-spec",a);};
datascript.pull_parser.PullAttrName=function(a,b,c,d){this.attr=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullAttrName.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullAttrName.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attr":return this.attr;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullAttrName.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullAttrName{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null)],null),this.__extmap))};datascript.pull_parser.PullAttrName.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attr","attr",-604132353)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullAttrName.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullAttrName.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullAttrName(this.attr,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullAttrName.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullAttrName.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-838771693^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.pull_parser.PullAttrName.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attr,b.attr)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.pull_parser.PullAttrName.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;datascript.pull_parser.PullAttrName.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[this.attr,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null)],null)};
datascript.pull_parser.PullAttrName.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"attr","attr",-604132353),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullAttrName(this.attr,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.pull_parser.PullAttrName.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),b))?new datascript.pull_parser.PullAttrName(c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullAttrName(this.attr,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.pull_parser.PullAttrName.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr,null)],null),this.__extmap))};
datascript.pull_parser.PullAttrName.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullAttrName(this.attr,b,this.__extmap,this.__hash)};datascript.pull_parser.PullAttrName.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullAttrName.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attr","attr",1036399174,null)],null)};datascript.pull_parser.PullAttrName.cljs$lang$type=!0;datascript.pull_parser.PullAttrName.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullAttrName",null,1,null)};
datascript.pull_parser.PullAttrName.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullAttrName")};datascript.pull_parser.__GT_PullAttrName=function(a){return new datascript.pull_parser.PullAttrName(a,null,null,null)};
datascript.pull_parser.map__GT_PullAttrName=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attr","attr",-604132353));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullAttrName((new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.pull_parser.PullReverseAttrName=function(a,b,c,d,e){this.attr=a;this.rattr=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attr":return this.attr;case "rattr":return this.rattr;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullReverseAttrName{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"rattr","rattr",-1122345563),this.rattr],null)],null),this.__extmap))};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"rattr","rattr",-1122345563)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullReverseAttrName(this.attr,this.rattr,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 158820207^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attr,b.attr)&&cljs.core._EQ_.call(null,this.rattr,b.rattr)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};datascript.pull_parser.PullReverseAttrName.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;
datascript.pull_parser.PullReverseAttrName.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[this.rattr,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null)],null)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"rattr","rattr",-1122345563),null,new cljs.core.Keyword(null,"attr","attr",-604132353),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullReverseAttrName(this.attr,
this.rattr,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),b))?new datascript.pull_parser.PullReverseAttrName(c,this.rattr,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"rattr","rattr",-1122345563),b))?new datascript.pull_parser.PullReverseAttrName(this.attr,c,this.__meta,this.__extmap,
null):new datascript.pull_parser.PullReverseAttrName(this.attr,this.rattr,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"rattr","rattr",-1122345563),this.rattr,null)],null),this.__extmap))};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullReverseAttrName(this.attr,this.rattr,b,this.__extmap,this.__hash)};
datascript.pull_parser.PullReverseAttrName.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullReverseAttrName.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attr","attr",1036399174,null),new cljs.core.Symbol(null,"rattr","rattr",518185964,null)],null)};datascript.pull_parser.PullReverseAttrName.cljs$lang$type=!0;datascript.pull_parser.PullReverseAttrName.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullReverseAttrName",null,1,null)};
datascript.pull_parser.PullReverseAttrName.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullReverseAttrName")};datascript.pull_parser.__GT_PullReverseAttrName=function(a,b){return new datascript.pull_parser.PullReverseAttrName(a,b,null,null,null)};
datascript.pull_parser.map__GT_PullReverseAttrName=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"rattr","rattr",-1122345563));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullReverseAttrName((new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"rattr","rattr",-1122345563)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.pull_parser.PullLimitExpr=function(a,b,c,d,e){this.attr=a;this.limit=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullLimitExpr.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attr":return this.attr;case "limit":return this.limit;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullLimitExpr{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"limit","limit",-1355822363),this.limit],null)],null),this.__extmap))};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"limit","limit",-1355822363)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullLimitExpr.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullLimitExpr(this.attr,this.limit,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullLimitExpr.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 2109320956^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attr,b.attr)&&cljs.core._EQ_.call(null,this.limit,b.limit)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};datascript.pull_parser.PullLimitExpr.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;
datascript.pull_parser.PullLimitExpr.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return cljs.core.assoc_in.call(null,datascript.pull_parser._as_spec.call(null,this.attr),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[1,new cljs.core.Keyword(null,"limit","limit",-1355822363)],null),this.limit)};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"limit","limit",-1355822363),null,new cljs.core.Keyword(null,"attr","attr",-604132353),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullLimitExpr(this.attr,
this.limit,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),b))?new datascript.pull_parser.PullLimitExpr(c,this.limit,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"limit","limit",-1355822363),b))?new datascript.pull_parser.PullLimitExpr(this.attr,c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullLimitExpr(this.attr,
this.limit,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.pull_parser.PullLimitExpr.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"limit","limit",-1355822363),this.limit,null)],null),this.__extmap))};
datascript.pull_parser.PullLimitExpr.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullLimitExpr(this.attr,this.limit,b,this.__extmap,this.__hash)};datascript.pull_parser.PullLimitExpr.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullLimitExpr.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attr","attr",1036399174,null),new cljs.core.Symbol(null,"limit","limit",284709164,null)],null)};datascript.pull_parser.PullLimitExpr.cljs$lang$type=!0;datascript.pull_parser.PullLimitExpr.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullLimitExpr",null,1,null)};
datascript.pull_parser.PullLimitExpr.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullLimitExpr")};datascript.pull_parser.__GT_PullLimitExpr=function(a,b){return new datascript.pull_parser.PullLimitExpr(a,b,null,null,null)};
datascript.pull_parser.map__GT_PullLimitExpr=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"limit","limit",-1355822363));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullLimitExpr((new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"limit","limit",-1355822363)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.pull_parser.PullDefaultExpr=function(a,b,c,d,e){this.attr=a;this.value=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attr":return this.attr;case "value":return this.value;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullDefaultExpr{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"value","value",305978217),this.value],null)],null),this.__extmap))};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"value","value",305978217)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullDefaultExpr(this.attr,this.value,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1499761615^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attr,b.attr)&&cljs.core._EQ_.call(null,this.value,b.value)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};datascript.pull_parser.PullDefaultExpr.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;
datascript.pull_parser.PullDefaultExpr.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return cljs.core.assoc_in.call(null,datascript.pull_parser._as_spec.call(null,this.attr),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[1,new cljs.core.Keyword(null,"default","default",-1987822328)],null),this.value)};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"value","value",305978217),null,new cljs.core.Keyword(null,"attr","attr",-604132353),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullDefaultExpr(this.attr,
this.value,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),b))?new datascript.pull_parser.PullDefaultExpr(c,this.value,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"value","value",305978217),b))?new datascript.pull_parser.PullDefaultExpr(this.attr,c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullDefaultExpr(this.attr,
this.value,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"value","value",305978217),this.value,null)],null),this.__extmap))};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullDefaultExpr(this.attr,this.value,b,this.__extmap,this.__hash)};
datascript.pull_parser.PullDefaultExpr.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullDefaultExpr.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attr","attr",1036399174,null),new cljs.core.Symbol(null,"value","value",1946509744,null)],null)};datascript.pull_parser.PullDefaultExpr.cljs$lang$type=!0;datascript.pull_parser.PullDefaultExpr.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullDefaultExpr",null,1,null)};
datascript.pull_parser.PullDefaultExpr.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullDefaultExpr")};datascript.pull_parser.__GT_PullDefaultExpr=function(a,b){return new datascript.pull_parser.PullDefaultExpr(a,b,null,null,null)};
datascript.pull_parser.map__GT_PullDefaultExpr=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"value","value",305978217));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullDefaultExpr((new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"value","value",305978217)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.pull_parser.PullWildcard=function(a,b,c){this.__meta=a;this.__extmap=b;this.__hash=c;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullWildcard.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullWildcard.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return cljs.core.get.call(null,this.__extmap,b,c)};
datascript.pull_parser.PullWildcard.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullWildcard{",", ","}",c,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.pull_parser.PullWildcard.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,0,cljs.core.PersistentVector.EMPTY,cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.pull_parser.PullWildcard.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.pull_parser.PullWildcard.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullWildcard(this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullWildcard.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 0+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullWildcard.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-163917799^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.pull_parser.PullWildcard.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.pull_parser.PullWildcard.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,cljs.core.PersistentHashSet.EMPTY,b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullWildcard(this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullWildcard.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return new datascript.pull_parser.PullWildcard(this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.pull_parser.PullWildcard.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.pull_parser.PullWildcard.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullWildcard(b,this.__extmap,this.__hash)};datascript.pull_parser.PullWildcard.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullWildcard.getBasis=function(){return cljs.core.PersistentVector.EMPTY};datascript.pull_parser.PullWildcard.cljs$lang$type=!0;datascript.pull_parser.PullWildcard.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullWildcard",null,1,null)};datascript.pull_parser.PullWildcard.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullWildcard")};
datascript.pull_parser.__GT_PullWildcard=function(){return new datascript.pull_parser.PullWildcard(null,null,null)};datascript.pull_parser.map__GT_PullWildcard=function(a){var b=cljs.core.dissoc.call(null,a);a=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullWildcard(null,cljs.core.not_empty.call(null,a),null)};
datascript.pull_parser.PullRecursionLimit=function(a,b,c,d){this.limit=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "limit":return this.limit;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullRecursionLimit{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"limit","limit",-1355822363),this.limit],null)],null),this.__extmap))};datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"limit","limit",-1355822363)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullRecursionLimit(this.limit,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1552688154^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.limit,b.limit)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.pull_parser.PullRecursionLimit.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;datascript.pull_parser.PullRecursionLimit.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"recursion","recursion",-749738765),this.limit],null)};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"limit","limit",-1355822363),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullRecursionLimit(this.limit,this.__meta,
cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"limit","limit",-1355822363),b))?new datascript.pull_parser.PullRecursionLimit(c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullRecursionLimit(this.limit,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"limit","limit",-1355822363),this.limit,null)],null),this.__extmap))};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullRecursionLimit(this.limit,b,this.__extmap,this.__hash)};
datascript.pull_parser.PullRecursionLimit.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullRecursionLimit.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"limit","limit",284709164,null)],null)};datascript.pull_parser.PullRecursionLimit.cljs$lang$type=!0;datascript.pull_parser.PullRecursionLimit.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullRecursionLimit",null,1,null)};
datascript.pull_parser.PullRecursionLimit.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullRecursionLimit")};datascript.pull_parser.__GT_PullRecursionLimit=function(a){return new datascript.pull_parser.PullRecursionLimit(a,null,null,null)};
datascript.pull_parser.map__GT_PullRecursionLimit=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"limit","limit",-1355822363));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullRecursionLimit((new cljs.core.Keyword(null,"limit","limit",-1355822363)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.pull_parser.PullMapSpecEntry=function(a,b,c,d,e){this.attr=a;this.porrl=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attr":return this.attr;case "porrl":return this.porrl;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullMapSpecEntry{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"porrl","porrl",-1693905102),this.porrl],null)],null),this.__extmap))};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"porrl","porrl",-1693905102)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullMapSpecEntry(this.attr,this.porrl,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 152088668^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attr,b.attr)&&cljs.core._EQ_.call(null,this.porrl,b.porrl)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};datascript.pull_parser.PullMapSpecEntry.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;
datascript.pull_parser.PullMapSpecEntry.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return cljs.core.update.call(null,datascript.pull_parser._as_spec.call(null,this.attr),1,cljs.core.conj,datascript.pull_parser._as_spec.call(null,this.porrl))};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"porrl","porrl",-1693905102),null,new cljs.core.Keyword(null,"attr","attr",-604132353),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullMapSpecEntry(this.attr,
this.porrl,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),b))?new datascript.pull_parser.PullMapSpecEntry(c,this.porrl,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"porrl","porrl",-1693905102),b))?new datascript.pull_parser.PullMapSpecEntry(this.attr,c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullMapSpecEntry(this.attr,
this.porrl,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"porrl","porrl",-1693905102),this.porrl,null)],null),this.__extmap))};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullMapSpecEntry(this.attr,this.porrl,b,this.__extmap,this.__hash)};
datascript.pull_parser.PullMapSpecEntry.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullMapSpecEntry.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attr","attr",1036399174,null),new cljs.core.Symbol(null,"porrl","porrl",-53373575,null)],null)};datascript.pull_parser.PullMapSpecEntry.cljs$lang$type=!0;datascript.pull_parser.PullMapSpecEntry.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullMapSpecEntry",null,1,null)};
datascript.pull_parser.PullMapSpecEntry.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullMapSpecEntry")};datascript.pull_parser.__GT_PullMapSpecEntry=function(a,b){return new datascript.pull_parser.PullMapSpecEntry(a,b,null,null,null)};
datascript.pull_parser.map__GT_PullMapSpecEntry=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"porrl","porrl",-1693905102));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullMapSpecEntry((new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"porrl","porrl",-1693905102)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.pull_parser.PullAttrWithOpts=function(a,b,c,d,e){this.attr=a;this.opts=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attr":return this.attr;case "opts":return this.opts;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullAttrWithOpts{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"opts","opts",155075701),this.opts],null)],null),this.__extmap))};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"opts","opts",155075701)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullAttrWithOpts(this.attr,this.opts,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-429987476^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attr,b.attr)&&cljs.core._EQ_.call(null,this.opts,b.opts)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};datascript.pull_parser.PullAttrWithOpts.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;
datascript.pull_parser.PullAttrWithOpts.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){return cljs.core.update.call(null,datascript.pull_parser._as_spec.call(null,this.attr),1,cljs.core.merge,this.opts)};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"opts","opts",155075701),null,new cljs.core.Keyword(null,"attr","attr",-604132353),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullAttrWithOpts(this.attr,
this.opts,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),b))?new datascript.pull_parser.PullAttrWithOpts(c,this.opts,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"opts","opts",155075701),b))?new datascript.pull_parser.PullAttrWithOpts(this.attr,c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullAttrWithOpts(this.attr,
this.opts,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attr","attr",-604132353),this.attr,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"opts","opts",155075701),this.opts,null)],null),this.__extmap))};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullAttrWithOpts(this.attr,this.opts,b,this.__extmap,this.__hash)};
datascript.pull_parser.PullAttrWithOpts.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullAttrWithOpts.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attr","attr",1036399174,null),new cljs.core.Symbol(null,"opts","opts",1795607228,null)],null)};datascript.pull_parser.PullAttrWithOpts.cljs$lang$type=!0;datascript.pull_parser.PullAttrWithOpts.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullAttrWithOpts",null,1,null)};
datascript.pull_parser.PullAttrWithOpts.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullAttrWithOpts")};datascript.pull_parser.__GT_PullAttrWithOpts=function(a,b){return new datascript.pull_parser.PullAttrWithOpts(a,b,null,null,null)};
datascript.pull_parser.map__GT_PullAttrWithOpts=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.Keyword(null,"opts","opts",155075701));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullAttrWithOpts((new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"opts","opts",155075701)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.pull_parser.aggregate_specs=function(a,b){return b instanceof datascript.pull_parser.PullWildcard?cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),!0):cljs.core.update.call(null,a,new cljs.core.Keyword(null,"attrs","attrs",-2090668713),cljs.core.conj_BANG_,datascript.pull_parser._as_spec.call(null,b))};
datascript.pull_parser.PullPattern=function(a,b,c,d){this.specs=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.pull_parser.PullPattern.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.pull_parser.PullPattern.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "specs":return this.specs;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.pull_parser.PullPattern.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.pull-parser.PullPattern{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"specs","specs",1426570741),this.specs],null)],null),this.__extmap))};datascript.pull_parser.PullPattern.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"specs","specs",1426570741)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.pull_parser.PullPattern.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.pull_parser.PullPattern.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.pull_parser.PullPattern(this.specs,this.__meta,this.__extmap,this.__hash)};datascript.pull_parser.PullPattern.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.pull_parser.PullPattern.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-795554044^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.pull_parser.PullPattern.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.specs,b.specs)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.pull_parser.PullPattern.prototype.datascript$pull_parser$IPullSpecComponent$=cljs.core.PROTOCOL_SENTINEL;
datascript.pull_parser.PullPattern.prototype.datascript$pull_parser$IPullSpecComponent$_as_spec$arity$1=function(a){a=new datascript.pull_parser.PullSpec(!1,cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY),null,null,null);a=cljs.core.reduce.call(null,datascript.pull_parser.aggregate_specs,a,this.specs);return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"subpattern","subpattern",45002743),cljs.core.update.call(null,a,new cljs.core.Keyword(null,
"attrs","attrs",-2090668713),cljs.core.persistent_BANG_)],null)};
datascript.pull_parser.PullPattern.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"specs","specs",1426570741),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.pull_parser.PullPattern(this.specs,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.pull_parser.PullPattern.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"specs","specs",1426570741),b))?new datascript.pull_parser.PullPattern(c,this.__meta,this.__extmap,null):new datascript.pull_parser.PullPattern(this.specs,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.pull_parser.PullPattern.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"specs","specs",1426570741),this.specs,null)],null),this.__extmap))};
datascript.pull_parser.PullPattern.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.pull_parser.PullPattern(this.specs,b,this.__extmap,this.__hash)};datascript.pull_parser.PullPattern.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.pull_parser.PullPattern.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"specs","specs",-1227865028,null)],null)};datascript.pull_parser.PullPattern.cljs$lang$type=!0;datascript.pull_parser.PullPattern.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.pull-parser/PullPattern",null,1,null)};
datascript.pull_parser.PullPattern.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.pull-parser/PullPattern")};datascript.pull_parser.__GT_PullPattern=function(a){return new datascript.pull_parser.PullPattern(a,null,null,null)};
datascript.pull_parser.map__GT_PullPattern=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"specs","specs",1426570741));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.pull_parser.PullPattern((new cljs.core.Keyword(null,"specs","specs",1426570741)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.pull_parser.wildcard_QMARK_=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"*","*",-1294732318),null,"*",null,new cljs.core.Symbol(null,"*","*",345799209,null),null],null),null);datascript.pull_parser.parse_wildcard=function(a){return cljs.core.truth_(datascript.pull_parser.wildcard_QMARK_.call(null,a))?new datascript.pull_parser.PullWildcard(null,null,null):null};
datascript.pull_parser.parse_attr_name=function(a){return a instanceof cljs.core.Keyword||"string"===typeof a?datascript.db.reverse_ref_QMARK_.call(null,a)?new datascript.pull_parser.PullReverseAttrName(datascript.db.reverse_ref.call(null,a),a,null,null,null):new datascript.pull_parser.PullAttrName(a,null,null,null):null};
datascript.pull_parser.unlimited_recursion_QMARK_=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,["...",null,new cljs.core.Symbol(null,"...","...",-1926939749,null),null],null),null);
datascript.pull_parser.parse_recursion_limit=function(a){return cljs.core.truth_(datascript.pull_parser.unlimited_recursion_QMARK_.call(null,a))?new datascript.pull_parser.PullRecursionLimit(null,null,null,null):"number"===typeof a&&0<a?new datascript.pull_parser.PullRecursionLimit(a,null,null,null):null};datascript.pull_parser.maybe_attr_expr_QMARK_=function(a){return cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,3,cljs.core.count.call(null,a))};
datascript.pull_parser.limit_QMARK_=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Symbol(null,"limit","limit",284709164,null),null,new cljs.core.Keyword(null,"limit","limit",-1355822363),null,"limit",null],null),null);
datascript.pull_parser.parse_limit_expr=function(a){var b=cljs.core.nth.call(null,a,0,null),c=cljs.core.nth.call(null,a,1,null),d=cljs.core.nth.call(null,a,2,null);if(cljs.core.truth_(datascript.pull_parser.limit_QMARK_.call(null,b))){c=(b=null==d||"number"===typeof d&&0<d)?datascript.pull_parser.parse_attr_name.call(null,c):b;if(cljs.core.truth_(c))return new datascript.pull_parser.PullLimitExpr(c,d,null,null,null);throw cljs.core.ex_info.call(null,'Expected ["limit" attr-name (positive-number | nil)]',
new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","pull","parser/pull",-2147427204),new cljs.core.Keyword(null,"fragment","fragment",826775688),a],null));}return null};
datascript.pull_parser.default_QMARK_=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Symbol(null,"default","default",-347290801,null),null,new cljs.core.Keyword(null,"default","default",-1987822328),null,"default",null],null),null);
datascript.pull_parser.parse_default_expr=function(a){var b=cljs.core.nth.call(null,a,0,null),c=cljs.core.nth.call(null,a,1,null),d=cljs.core.nth.call(null,a,2,null);if(cljs.core.truth_(datascript.pull_parser.default_QMARK_.call(null,b))){b=datascript.pull_parser.parse_attr_name.call(null,c);if(cljs.core.truth_(b))return new datascript.pull_parser.PullDefaultExpr(b,d,null,null,null);throw cljs.core.ex_info.call(null,'Expected ["default" attr-name any-value]',new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","pull","parser/pull",-2147427204),new cljs.core.Keyword(null,"fragment","fragment",826775688),a],null));}return null};
datascript.pull_parser.parse_attr_with_opts=function(a){if(cljs.core.sequential_QMARK_.call(null,a)){var b=cljs.core.seq.call(null,a);a=cljs.core.first.call(null,b);b=cljs.core.next.call(null,b);a=datascript.pull_parser.parse_attr_name.call(null,a);return null==a?null:cljs.core.even_QMARK_.call(null,cljs.core.count.call(null,b))&&cljs.core.every_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"limit","limit",-1355822363),null,
new cljs.core.Keyword(null,"default","default",-1987822328),null,new cljs.core.Keyword(null,"as","as",1148689641),null],null),null),cljs.core.map.call(null,cljs.core.first,cljs.core.partition.call(null,2,b)))?new datascript.pull_parser.PullAttrWithOpts(a,cljs.core.apply.call(null,cljs.core.array_map,b),null,null,null):null}return null};
datascript.pull_parser.parse_map_spec_entry=function(a){var b=cljs.core.nth.call(null,a,0,null),c=cljs.core.nth.call(null,a,1,null);a=function(){var a=datascript.pull_parser.parse_attr_name.call(null,b);if(cljs.core.truth_(a))return a;a=datascript.pull_parser.parse_attr_with_opts.call(null,b);return cljs.core.truth_(a)?a:cljs.core.truth_(datascript.pull_parser.maybe_attr_expr_QMARK_.call(null,b))?datascript.pull_parser.parse_limit_expr.call(null,b):null}();if(cljs.core.truth_(a)){var d=function(){var a=
datascript.pull_parser.parse_recursion_limit.call(null,c);return cljs.core.truth_(a)?a:datascript.pull_parser.parse_pattern.call(null,c)}();if(cljs.core.truth_(d))return new datascript.pull_parser.PullMapSpecEntry(a,d,null,null,null);throw cljs.core.ex_info.call(null,"Expected (pattern | recursion-limit)",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","pull","parser/pull",-2147427204),new cljs.core.Keyword(null,"fragment",
"fragment",826775688),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,c],null)],null));}throw cljs.core.ex_info.call(null,"Expected (attr-name | limit-expr)",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","pull","parser/pull",-2147427204),new cljs.core.Keyword(null,"fragment","fragment",826775688),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,c],null)],
null));};datascript.pull_parser.parse_map_spec=function(a){if(cljs.core.map_QMARK_.call(null,a)){if(!cljs.core._EQ_.call(null,1,cljs.core.count.call(null,a)))throw Error("Assert failed: Maps should contain exactly 1 entry\n(\x3d 1 (count spec))");return datascript.pull_parser.parse_map_spec_entry.call(null,cljs.core.first.call(null,a))}return null};
datascript.pull_parser.parse_attr_expr=function(a){if(cljs.core.truth_(datascript.pull_parser.maybe_attr_expr_QMARK_.call(null,a))){var b=datascript.pull_parser.parse_limit_expr.call(null,a);return cljs.core.truth_(b)?b:datascript.pull_parser.parse_default_expr.call(null,a)}return null};
datascript.pull_parser.parse_attr_spec=function(a){var b=datascript.pull_parser.parse_attr_name.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.pull_parser.parse_wildcard.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.pull_parser.parse_map_spec.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.pull_parser.parse_attr_with_opts.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.pull_parser.parse_attr_expr.call(null,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,
"Cannot parse attr-spec, expected: (attr-name | wildcard | map-spec | attr-expr)",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","pull","parser/pull",-2147427204),new cljs.core.Keyword(null,"fragment","fragment",826775688),a],null));};
datascript.pull_parser.pattern_clause_type=function(a){return cljs.core.map_QMARK_.call(null,a)?new cljs.core.Keyword(null,"map","map",1371690461):cljs.core.truth_(datascript.pull_parser.wildcard_QMARK_.call(null,a))?new cljs.core.Keyword(null,"wildcard","wildcard",-622473020):new cljs.core.Keyword(null,"other","other",995793544)};
datascript.pull_parser.expand_map_clause=function(a){return cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.map.call(null,function(a){return cljs.core.conj.call(null,cljs.core.PersistentArrayMap.EMPTY,a)}),a)};
datascript.pull_parser.simplify_pattern_clauses=function(a){a=cljs.core.group_by.call(null,datascript.pull_parser.pattern_clause_type,a);var b=cljs.core.truth_(cljs.core.not_empty.call(null,cljs.core.get.call(null,a,new cljs.core.Keyword(null,"wildcard","wildcard",-622473020))))?new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"*","*",345799209,null)],null):cljs.core.PersistentVector.EMPTY;return cljs.core.into.call(null,cljs.core.into.call(null,
b,cljs.core.get.call(null,a,new cljs.core.Keyword(null,"other","other",995793544))),cljs.core.mapcat.call(null,datascript.pull_parser.expand_map_clause),cljs.core.get.call(null,a,new cljs.core.Keyword(null,"map","map",1371690461)))};
datascript.pull_parser.parse_pattern=function(a){return cljs.core.sequential_QMARK_.call(null,a)?new datascript.pull_parser.PullPattern(cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.map.call(null,datascript.pull_parser.parse_attr_spec),datascript.pull_parser.simplify_pattern_clauses.call(null,a)),null,null,null):null};datascript.pull_parser.pattern__GT_spec=function(a){return cljs.core.second.call(null,datascript.pull_parser._as_spec.call(null,a))};
datascript.pull_parser.parse_pull=function(a){var b=null==a?null:datascript.pull_parser.parse_pattern.call(null,a);b=null==b?null:datascript.pull_parser.pattern__GT_spec.call(null,b);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse pull pattern, expected: [attr-spec+]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","pull","parser/pull",-2147427204),new cljs.core.Keyword(null,"fragment","fragment",
826775688),a],null));};datascript.impl={};datascript.impl.entity={};datascript.impl.entity.entid=function(a,b){return"number"===typeof b||cljs.core.sequential_QMARK_.call(null,b)||b instanceof cljs.core.Keyword?datascript.db.entid.call(null,a,b):null};
datascript.impl.entity.entity=function(a,b){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");b=datascript.impl.entity.entid.call(null,a,b);return cljs.core.truth_(b)?datascript.impl.entity.__GT_Entity.call(null,a,b,cljs.core.volatile_BANG_.call(null,!1),cljs.core.volatile_BANG_.call(null,cljs.core.PersistentArrayMap.EMPTY)):null};
datascript.impl.entity.entity_attr=function(a,b,c){return datascript.db.multival_QMARK_.call(null,a,b)?datascript.db.ref_QMARK_.call(null,a,b)?cljs.core.reduce.call(null,function(b,c){return cljs.core.conj.call(null,b,datascript.impl.entity.entity.call(null,a,(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(c)))},cljs.core.PersistentHashSet.EMPTY,c):cljs.core.reduce.call(null,function(a,b){return cljs.core.conj.call(null,a,(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(b))},
cljs.core.PersistentHashSet.EMPTY,c):datascript.db.ref_QMARK_.call(null,a,b)?datascript.impl.entity.entity.call(null,a,(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,c))):(new cljs.core.Keyword(null,"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,c))};
datascript.impl.entity._lookup_backwards=function(a,b,c,d){b=cljs.core.not_empty.call(null,datascript.db._search.call(null,a,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[null,c,b],null)));return cljs.core.truth_(b)?datascript.db.component_QMARK_.call(null,a,c)?datascript.impl.entity.entity.call(null,a,(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,b))):cljs.core.reduce.call(null,function(b,c){return function(b,
c){return cljs.core.conj.call(null,b,datascript.impl.entity.entity.call(null,a,(new cljs.core.Keyword(null,"e","e",1381269198)).cljs$core$IFn$_invoke$arity$1(c)))}}(b,b),cljs.core.PersistentHashSet.EMPTY,b):d};datascript.impl.entity.multival__GT_js=function(a){return cljs.core.truth_(a)?cljs.core.to_array.call(null,a):null};
datascript.impl.entity.js_seq=function(a){datascript.impl.entity.touch.call(null,a);return function d(c){return new cljs.core.LazySeq(null,function(){for(;;){var e=cljs.core.seq.call(null,c);if(e){if(cljs.core.chunked_seq_QMARK_.call(null,e)){var f=cljs.core.chunk_first.call(null,e),g=cljs.core.count.call(null,f),h=cljs.core.chunk_buffer.call(null,g);a:for(var k=0;;)if(k<g){var l=cljs.core._nth.call(null,f,k),m=cljs.core.nth.call(null,l,0,null);l=cljs.core.nth.call(null,l,1,null);cljs.core.chunk_append.call(null,
h,datascript.db.multival_QMARK_.call(null,a.db,m)?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[m,datascript.impl.entity.multival__GT_js.call(null,l)],null):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[m,l],null));k+=1}else{f=!0;break a}return f?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,h),d.call(null,cljs.core.chunk_rest.call(null,e))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,h),null)}f=cljs.core.first.call(null,
e);h=cljs.core.nth.call(null,f,0,null);f=cljs.core.nth.call(null,f,1,null);return cljs.core.cons.call(null,datascript.db.multival_QMARK_.call(null,a.db,h)?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[h,datascript.impl.entity.multival__GT_js.call(null,f)],null):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[h,f],null),d.call(null,cljs.core.rest.call(null,e)))}return null}},null,null)}.call(null,cljs.core.deref.call(null,a.cache))};
datascript.impl.entity.Entity=function(a,b,c,d){this.db=a;this.eid=b;this.touched=c;this.cache=d;this.cljs$lang$protocol_mask$partition0$=2162164483;this.cljs$lang$protocol_mask$partition1$=0};datascript.impl.entity.Entity.prototype.entry_set=function(){return cljs.core.to_array.call(null,cljs.core.map.call(null,cljs.core.to_array,datascript.impl.entity.js_seq.call(null,this)))};
datascript.impl.entity.Entity.prototype.forEach=function(){var a=null,b=function(a){for(var b=cljs.core.seq.call(null,datascript.impl.entity.js_seq.call(null,this)),c=null,d=0,h=0;;)if(h<d){var k=cljs.core._nth.call(null,c,h),l=cljs.core.nth.call(null,k,0,null);k=cljs.core.nth.call(null,k,1,null);a.call(null,k,l,this);h+=1}else if(b=cljs.core.seq.call(null,b))cljs.core.chunked_seq_QMARK_.call(null,b)?(c=cljs.core.chunk_first.call(null,b),b=cljs.core.chunk_rest.call(null,b),l=c,d=cljs.core.count.call(null,
c),c=l):(c=cljs.core.first.call(null,b),l=cljs.core.nth.call(null,c,0,null),k=cljs.core.nth.call(null,c,1,null),a.call(null,k,l,this),b=cljs.core.next.call(null,b),c=null,d=0),h=0;else return null},c=function(a,b){for(var c=cljs.core.seq.call(null,datascript.impl.entity.js_seq.call(null,this)),d=null,e=0,k=0;;)if(k<e){var l=cljs.core._nth.call(null,d,k),m=cljs.core.nth.call(null,l,0,null);l=cljs.core.nth.call(null,l,1,null);a.call(b,l,m,this);k+=1}else if(c=cljs.core.seq.call(null,c))cljs.core.chunked_seq_QMARK_.call(null,
c)?(d=cljs.core.chunk_first.call(null,c),c=cljs.core.chunk_rest.call(null,c),m=d,e=cljs.core.count.call(null,d),d=m):(d=cljs.core.first.call(null,c),m=cljs.core.nth.call(null,d,0,null),l=cljs.core.nth.call(null,d,1,null),a.call(b,l,m,this),c=cljs.core.next.call(null,c),d=null,e=0),k=0;else return null};a=function(a,e){switch(arguments.length){case 1:return b.call(this,a);case 2:return c.call(this,a,e)}throw Error("Invalid arity: "+arguments.length);};a.cljs$core$IFn$_invoke$arity$1=b;a.cljs$core$IFn$_invoke$arity$2=
c;return a}();
datascript.impl.entity.Entity.prototype.get=function(a){if(cljs.core._EQ_.call(null,a,":db/id"))return this.eid;if(datascript.db.reverse_ref_QMARK_.call(null,a))return datascript.impl.entity.multival__GT_js.call(null,datascript.impl.entity._lookup_backwards.call(null,this.db,this.eid,datascript.db.reverse_ref.call(null,a),null));var b=datascript.impl.entity.lookup_entity.call(null,this,a);return datascript.db.multival_QMARK_.call(null,this.db,a)?datascript.impl.entity.multival__GT_js.call(null,b):
b};datascript.impl.entity.Entity.prototype.key_set=function(){return cljs.core.to_array.call(null,cljs.core.keys.call(null,this))};datascript.impl.entity.Entity.prototype.entries=function(){return cljs.core.es6_entries_iterator.call(null,datascript.impl.entity.js_seq.call(null,this))};datascript.impl.entity.Entity.prototype.value_set=function(){return cljs.core.to_array.call(null,cljs.core.map.call(null,cljs.core.second,datascript.impl.entity.js_seq.call(null,this)))};
datascript.impl.entity.Entity.prototype.toString=function(){return cljs.core.pr_str_STAR_.call(null,this)};datascript.impl.entity.Entity.prototype.keys=function(){return cljs.core.es6_iterator.call(null,cljs.core.keys.call(null,this))};datascript.impl.entity.Entity.prototype.values=function(){return cljs.core.es6_iterator.call(null,cljs.core.map.call(null,cljs.core.second,datascript.impl.entity.js_seq.call(null,this)))};
datascript.impl.entity.Entity.prototype.equiv=function(a){return datascript.impl.entity.equiv_entity.call(null,this,a)};datascript.impl.entity.Entity.prototype.has=function(a){return null!=this.get(a)};datascript.impl.entity.Entity.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return datascript.impl.entity.lookup_entity.call(null,this,b,null)};
datascript.impl.entity.Entity.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return datascript.impl.entity.lookup_entity.call(null,this,b,c)};datascript.impl.entity.Entity.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return cljs.core._pr_writer.call(null,cljs.core.assoc.call(null,cljs.core.deref.call(null,this.cache),new cljs.core.Keyword("db","id","db/id",-1388397098),this.eid),b,c)};
datascript.impl.entity.Entity.prototype.cljs$core$ICounted$_count$arity$1=function(a){datascript.impl.entity.touch.call(null,this);return cljs.core.count.call(null,cljs.core.deref.call(null,this.cache))};datascript.impl.entity.Entity.prototype.cljs$core$IHash$_hash$arity$1=function(a){return cljs.core.hash.call(null,this.eid)};datascript.impl.entity.Entity.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return datascript.impl.entity.equiv_entity.call(null,this,b)};
datascript.impl.entity.Entity.prototype.cljs$core$IAssociative$_contains_key_QMARK_$arity$2=function(a,b){return cljs.core.not_EQ_.call(null,new cljs.core.Keyword("datascript.impl.entity","nf","datascript.impl.entity/nf",-953741353),datascript.impl.entity.lookup_entity.call(null,this,b,new cljs.core.Keyword("datascript.impl.entity","nf","datascript.impl.entity/nf",-953741353)))};
datascript.impl.entity.Entity.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){datascript.impl.entity.touch.call(null,this);return cljs.core.seq.call(null,cljs.core.deref.call(null,this.cache))};
datascript.impl.entity.Entity.prototype.call=function(){var a=null,b=function(a,b){return datascript.impl.entity.lookup_entity.call(null,this,b)},c=function(a,b,c){return datascript.impl.entity.lookup_entity.call(null,this,b,c)};a=function(a,e,f){switch(arguments.length){case 2:return b.call(this,a,e);case 3:return c.call(this,a,e,f)}throw Error("Invalid arity: "+(arguments.length-1));};a.cljs$core$IFn$_invoke$arity$2=b;a.cljs$core$IFn$_invoke$arity$3=c;return a}();
datascript.impl.entity.Entity.prototype.apply=function(a,b){return this.call.apply(this,[this].concat(cljs.core.aclone.call(null,b)))};datascript.impl.entity.Entity.prototype.cljs$core$IFn$_invoke$arity$1=function(a){return datascript.impl.entity.lookup_entity.call(null,this,a)};datascript.impl.entity.Entity.prototype.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.impl.entity.lookup_entity.call(null,this,a,b)};
datascript.impl.entity.Entity.getBasis=function(){return new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"db","db",-1661185010,null),new cljs.core.Symbol(null,"eid","eid",-2094915839,null),new cljs.core.Symbol(null,"touched","touched",1031397108,null),new cljs.core.Symbol(null,"cache","cache",403508473,null)],null)};datascript.impl.entity.Entity.cljs$lang$type=!0;datascript.impl.entity.Entity.cljs$lang$ctorStr="datascript.impl.entity/Entity";
datascript.impl.entity.Entity.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"datascript.impl.entity/Entity")};datascript.impl.entity.__GT_Entity=function(a,b,c,d){return new datascript.impl.entity.Entity(a,b,c,d)};datascript.impl.entity.entity_QMARK_=function(a){return a instanceof datascript.impl.entity.Entity};datascript.impl.entity.equiv_entity=function(a,b){return b instanceof datascript.impl.entity.Entity&&cljs.core._EQ_.call(null,a.eid,b.eid)};
datascript.impl.entity.lookup_entity=function(a){switch(arguments.length){case 2:return datascript.impl.entity.lookup_entity.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.impl.entity.lookup_entity.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.impl.entity.lookup_entity.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.impl.entity.lookup_entity.call(null,a,b,null)};
datascript.impl.entity.lookup_entity.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(cljs.core._EQ_.call(null,b,new cljs.core.Keyword("db","id","db/id",-1388397098)))return a.eid;if(datascript.db.reverse_ref_QMARK_.call(null,b))return datascript.impl.entity._lookup_backwards.call(null,a.db,a.eid,datascript.db.reverse_ref.call(null,b),c);var d=cljs.core.deref.call(null,a.cache).call(null,b);if(null==d){if(cljs.core.truth_(cljs.core.deref.call(null,a.touched)))return c;d=cljs.core.not_empty.call(null,
datascript.db._search.call(null,a.db,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[a.eid,b],null)));if(null==d)return c;c=datascript.impl.entity.entity_attr.call(null,a.db,b,d);cljs.core.vreset_BANG_.call(null,a.cache,cljs.core.assoc.call(null,cljs.core.deref.call(null,a.cache),b,c));return c}return d};datascript.impl.entity.lookup_entity.cljs$lang$maxFixedArity=3;
datascript.impl.entity.touch_components=function(a,b){return cljs.core.reduce_kv.call(null,function(b,d,e){return cljs.core.assoc.call(null,b,d,datascript.db.component_QMARK_.call(null,a,d)?datascript.db.multival_QMARK_.call(null,a,d)?cljs.core.set.call(null,cljs.core.map.call(null,datascript.impl.entity.touch,e)):datascript.impl.entity.touch.call(null,e):e)},cljs.core.PersistentArrayMap.EMPTY,b)};
datascript.impl.entity.datoms__GT_cache=function(a,b){return cljs.core.reduce.call(null,function(b,d){var c=(new cljs.core.Keyword(null,"a","a",-2123407586)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,d));return cljs.core.assoc.call(null,b,c,datascript.impl.entity.entity_attr.call(null,a,c,d))},cljs.core.PersistentArrayMap.EMPTY,cljs.core.partition_by.call(null,new cljs.core.Keyword(null,"a","a",-2123407586),b))};
datascript.impl.entity.touch=function(a){if(!cljs.core.truth_(datascript.impl.entity.entity_QMARK_.call(null,a)))throw Error("Assert failed: (entity? e)");if(!cljs.core.truth_(cljs.core.deref.call(null,a.touched))){var b=cljs.core.not_empty.call(null,datascript.db._search.call(null,a.db,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[a.eid],null)));cljs.core.truth_(b)&&(cljs.core.vreset_BANG_.call(null,a.cache,datascript.impl.entity.touch_components.call(null,a.db,datascript.impl.entity.datoms__GT_cache.call(null,
a.db,b))),cljs.core.vreset_BANG_.call(null,a.touched,!0))}return a};goog.exportSymbol("datascript.impl.entity.Entity",datascript.impl.entity.Entity);datascript.pull_api={};datascript.pull_api.into_BANG_=function(a,b){return cljs.core.reduce.call(null,cljs.core.conj_BANG_,a,b)};datascript.pull_api._PLUS_default_limit_PLUS_=1E3;
datascript.pull_api.initial_frame=function(a,b,c){return cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"multi?","multi?",-749311069),new cljs.core.Keyword(null,"eids","eids",1546550700),new cljs.core.Keyword(null,"state","state",-1988618099),new cljs.core.Keyword(null,"recursion","recursion",-749738765),new cljs.core.Keyword(null,"specs","specs",1426570741),new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),new cljs.core.Keyword(null,"kvps","kvps",65308317),new cljs.core.Keyword(null,
"pattern","pattern",242135423),new cljs.core.Keyword(null,"results","results",-1134170113)],[c,b,new cljs.core.Keyword(null,"pattern","pattern",242135423),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"depth","depth",1768663640),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword(null,"seen","seen",-518999789),cljs.core.PersistentHashSet.EMPTY],null),cljs.core.seq.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a)),(new cljs.core.Keyword(null,
"wildcard?","wildcard?",-686044101)).cljs$core$IFn$_invoke$arity$1(a),cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY),a,cljs.core.transient$.call(null,cljs.core.PersistentVector.EMPTY)])};datascript.pull_api.subpattern_frame=function(a,b,c,d){return cljs.core.assoc.call(null,datascript.pull_api.initial_frame.call(null,a,b,c),new cljs.core.Keyword(null,"attr","attr",-604132353),d)};
datascript.pull_api.reset_frame=function(a,b,c){var d=(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(a);return cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"eids","eids",1546550700),b,new cljs.core.Keyword(null,"specs","specs",1426570741),cljs.core.seq.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(d)),new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),(new cljs.core.Keyword(null,"wildcard?",
"wildcard?",-686044101)).cljs$core$IFn$_invoke$arity$1(d),new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY),new cljs.core.Keyword(null,"results","results",-1134170113),function(){var b=(new cljs.core.Keyword(null,"results","results",-1134170113)).cljs$core$IFn$_invoke$arity$1(a);return cljs.core.seq.call(null,c)?cljs.core.conj_BANG_.call(null,b,c):b}())};
datascript.pull_api.push_recursion=function(a,b,c){var d=null!=a&&(a.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,a):a,e=cljs.core.get.call(null,d,new cljs.core.Keyword(null,"depth","depth",1768663640));d=cljs.core.get.call(null,d,new cljs.core.Keyword(null,"seen","seen",-518999789));return cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"depth","depth",1768663640),cljs.core.update.call(null,e,b,cljs.core.fnil.call(null,
cljs.core.inc,0)),new cljs.core.Keyword(null,"seen","seen",-518999789),cljs.core.conj.call(null,d,c))};datascript.pull_api.seen_eid_QMARK_=function(a,b){return cljs.core.contains_QMARK_.call(null,cljs.core.get_in.call(null,a,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"recursion","recursion",-749738765),new cljs.core.Keyword(null,"seen","seen",-518999789)],null),cljs.core.PersistentHashSet.EMPTY),b)};
datascript.pull_api.pull_seen_eid=function(a,b,c){return cljs.core.truth_(datascript.pull_api.seen_eid_QMARK_.call(null,a,c))?cljs.core.conj.call(null,b,cljs.core.update.call(null,a,new cljs.core.Keyword(null,"results","results",-1134170113),cljs.core.conj_BANG_,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","id","db/id",-1388397098),c],null))):null};
datascript.pull_api.single_frame_result=function(a,b){b=(new cljs.core.Keyword(null,"kvps","kvps",65308317)).cljs$core$IFn$_invoke$arity$1(b);b=null==b?null:cljs.core.persistent_BANG_.call(null,b);return null==b?null:cljs.core.get.call(null,b,a)};datascript.pull_api.recursion_result=function(a){return datascript.pull_api.single_frame_result.call(null,new cljs.core.Keyword("datascript.pull-api","recursion","datascript.pull-api/recursion",-1897884534),a)};
datascript.pull_api.recursion_frame=function(a,b){var c=(new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a);c=datascript.pull_api.push_recursion.call(null,(new cljs.core.Keyword(null,"recursion","recursion",-749738765)).cljs$core$IFn$_invoke$arity$1(a),c,b);return cljs.core.assoc.call(null,datascript.pull_api.subpattern_frame.call(null,(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(a),new cljs.core.PersistentVector(null,
1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null),!1,new cljs.core.Keyword("datascript.pull-api","recursion","datascript.pull-api/recursion",-1897884534)),new cljs.core.Keyword(null,"recursion","recursion",-749738765),c)};
datascript.pull_api.pull_recursion_frame=function(a,b){a=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,a);a=cljs.core.next.call(null,a);var c=cljs.core.seq.call(null,(new cljs.core.Keyword(null,"eids","eids",1546550700)).cljs$core$IFn$_invoke$arity$1(b));if(c){b=datascript.pull_api.reset_frame.call(null,b,cljs.core.rest.call(null,c),datascript.pull_api.recursion_result.call(null,b));c=cljs.core.first.call(null,c);var d=datascript.pull_api.pull_seen_eid.call(null,b,a,c);return cljs.core.truth_(d)?
d:cljs.core.conj.call(null,a,b,datascript.pull_api.recursion_frame.call(null,b,c))}c=datascript.pull_api.recursion_result.call(null,b);d=(new cljs.core.Keyword(null,"results","results",-1134170113)).cljs$core$IFn$_invoke$arity$1(b);c=cljs.core.seq.call(null,c)?cljs.core.conj_BANG_.call(null,d,c):d;return cljs.core.conj.call(null,a,cljs.core.assoc.call(null,b,new cljs.core.Keyword(null,"state","state",-1988618099),new cljs.core.Keyword(null,"done","done",-889844188),new cljs.core.Keyword(null,"results",
"results",-1134170113),c))};
datascript.pull_api.recurse_attr=function(a,b,c,d,e,f,g){var h=null!=f&&(f.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===f.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,f):f;e=cljs.core.get.call(null,h,new cljs.core.Keyword(null,"recursion","recursion",-749738765));h=cljs.core.get.call(null,h,new cljs.core.Keyword(null,"pattern","pattern",242135423));var k=cljs.core.get.call(null,cljs.core.get.call(null,e,new cljs.core.Keyword(null,"depth","depth",1768663640)),
b,0);return cljs.core._EQ_.call(null,(new cljs.core.Keyword(null,"recursion","recursion",-749738765)).cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(h),b)),k)?cljs.core.conj.call(null,g,f):datascript.pull_api.pull_recursion_frame.call(null,a,cljs.core.conj.call(null,g,f,new cljs.core.PersistentArrayMap(null,7,[new cljs.core.Keyword(null,"state","state",-1988618099),new cljs.core.Keyword(null,"recursion",
"recursion",-749738765),new cljs.core.Keyword(null,"pattern","pattern",242135423),h,new cljs.core.Keyword(null,"attr","attr",-604132353),b,new cljs.core.Keyword(null,"multi?","multi?",-749311069),c,new cljs.core.Keyword(null,"eids","eids",1546550700),d,new cljs.core.Keyword(null,"recursion","recursion",-749738765),e,new cljs.core.Keyword(null,"results","results",-1134170113),cljs.core.transient$.call(null,cljs.core.PersistentVector.EMPTY)],null)))};
var pattern_3834=new datascript.pull_parser.PullSpec(!0,cljs.core.PersistentArrayMap.EMPTY,null,null,null);datascript.pull_api.expand_frame=function(a){return function(b,c,d,e,f){b=datascript.pull_api.push_recursion.call(null,(new cljs.core.Keyword(null,"recursion","recursion",-749738765)).cljs$core$IFn$_invoke$arity$1(b),d,c);return cljs.core.assoc.call(null,datascript.pull_api.subpattern_frame.call(null,a,f,e,d),new cljs.core.Keyword(null,"recursion","recursion",-749738765),b)}}(pattern_3834);
datascript.pull_api.pull_attr_datoms=function(a,b,c,d,e,f,g,h){var k=cljs.core.seq.call(null,h),l=cljs.core.first.call(null,k),m=cljs.core.next.call(null,k),n=cljs.core.get.call(null,g,new cljs.core.Keyword(null,"limit","limit",-1355822363),1E3),p=function(){var a=(new cljs.core.Keyword(null,"as","as",1148689641)).cljs$core$IFn$_invoke$arity$1(g);return cljs.core.truth_(a)?a:b}(),q=cljs.core.not_empty.call(null,cljs.core.truth_(n)?cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.take.call(null,
n),f):f);if(cljs.core.truth_(q)){var r=datascript.db.ref_QMARK_.call(null,a,c),t=r&&datascript.db.component_QMARK_.call(null,a,c),u=cljs.core.truth_(e)?datascript.db.multival_QMARK_.call(null,a,c):!t,v=cljs.core.truth_(e)?function(a,b,c,d,e,f,g,h,k,l,m,n){return function(a){return a.v}}(r,t,u,n,p,q,h,k,l,m,l,m):function(a,b,c,d,e,f,g,h,k,l,m,n){return function(a){return a.e}}(r,t,u,n,p,q,h,k,l,m,l,m);if(cljs.core.contains_QMARK_.call(null,g,new cljs.core.Keyword(null,"subpattern","subpattern",45002743)))return cljs.core.conj.call(null,
m,l,datascript.pull_api.subpattern_frame.call(null,(new cljs.core.Keyword(null,"subpattern","subpattern",45002743)).cljs$core$IFn$_invoke$arity$1(g),cljs.core.mapv.call(null,v,q),u,p));if(cljs.core.contains_QMARK_.call(null,g,new cljs.core.Keyword(null,"recursion","recursion",-749738765)))return datascript.pull_api.recurse_attr.call(null,a,p,u,cljs.core.mapv.call(null,v,q),d,l,m);if(cljs.core.truth_(t?e:t))return cljs.core.conj.call(null,m,l,datascript.pull_api.expand_frame.call(null,l,d,p,u,cljs.core.mapv.call(null,
v,q)));var w=function(){return r?cljs.core.comp.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q){return function(a){return cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword("db","id","db/id",-1388397098)],[a])}}(v,r,t,u,v,n,p,q,h,k,l,m,l,m),v):v}(),x=!u;return cljs.core.conj.call(null,m,cljs.core.update.call(null,l,new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.assoc_BANG_,p,function(){var a=cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.map.call(null,
w),q);return x?cljs.core.first.call(null,a):a}()))}return cljs.core.conj.call(null,m,cljs.core.contains_QMARK_.call(null,g,new cljs.core.Keyword(null,"default","default",-1987822328))?cljs.core.update.call(null,l,new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.assoc_BANG_,p,(new cljs.core.Keyword(null,"default","default",-1987822328)).cljs$core$IFn$_invoke$arity$1(g)):l)};
datascript.pull_api.pull_attr=function(a,b,c,d){var e=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);if(cljs.core._EQ_.call(null,new cljs.core.Keyword("db","id","db/id",-1388397098),e))return cljs.core.truth_(cljs.core.not_empty.call(null,datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null))))?cljs.core.conj.call(null,cljs.core.rest.call(null,d),cljs.core.update.call(null,
cljs.core.first.call(null,d),new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.assoc_BANG_,new cljs.core.Keyword("db","id","db/id",-1388397098),c)):d;var f=(new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(b),g=cljs.core._EQ_.call(null,e,f),h=g?datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,f],null)):datascript.db._datoms.call(null,
a,new cljs.core.Keyword(null,"avet","avet",1383857032),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[f,c],null));return datascript.pull_api.pull_attr_datoms.call(null,a,e,f,c,g,h,b,d)};datascript.pull_api.filter_reverse_attrs=cljs.core.filter.call(null,function(a){var b=cljs.core.nth.call(null,a,0,null);a=cljs.core.nth.call(null,a,1,null);return cljs.core.not_EQ_.call(null,b,(new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(a))});
datascript.pull_api.expand_reverse_subpattern_frame=function(a,b,c){return datascript.pull_api.subpattern_frame.call(null,cljs.core.assoc.call(null,(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(a),new cljs.core.Keyword(null,"attrs","attrs",-2090668713),c,new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),!1),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null),!1,new cljs.core.Keyword("datascript.pull-api",
"expand-rev","datascript.pull-api/expand-rev",2143627459))};datascript.pull_api.expand_result=function(a,b){return cljs.core.conj.call(null,cljs.core.rest.call(null,a),cljs.core.update.call(null,cljs.core.first.call(null,a),new cljs.core.Keyword(null,"kvps","kvps",65308317),datascript.pull_api.into_BANG_,cljs.core.persistent_BANG_.call(null,b)))};
datascript.pull_api.pull_expand_reverse_frame=function(a,b){a=cljs.core.seq.call(null,b);var c=cljs.core.first.call(null,a);a=cljs.core.next.call(null,a);return datascript.pull_api.expand_result.call(null,a,datascript.pull_api.into_BANG_.call(null,(new cljs.core.Keyword(null,"expand-kvps","expand-kvps",44141154)).cljs$core$IFn$_invoke$arity$1(c),function(){var a=datascript.pull_api.single_frame_result.call(null,new cljs.core.Keyword("datascript.pull-api","expand-rev","datascript.pull-api/expand-rev",
2143627459),c);return cljs.core.truth_(a)?a:cljs.core.PersistentArrayMap.EMPTY}()))};
datascript.pull_api.pull_expand_frame=function(a,b){var c=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,c);c=cljs.core.next.call(null,c);var d=cljs.core.seq.call(null,(new cljs.core.Keyword(null,"datoms","datoms",-290874434)).cljs$core$IFn$_invoke$arity$1(b));if(d){var e=cljs.core.first.call(null,d);d=cljs.core.nth.call(null,e,0,null);e=cljs.core.nth.call(null,e,1,null);var f=cljs.core.get.call(null,cljs.core.get_in.call(null,b,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"pattern","pattern",242135423),new cljs.core.Keyword(null,"attrs","attrs",-2090668713)],null)),d,cljs.core.PersistentArrayMap.EMPTY);return datascript.pull_api.pull_attr_datoms.call(null,a,d,d,(new cljs.core.Keyword(null,"eid","eid",559519930)).cljs$core$IFn$_invoke$arity$1(b),!0,e,f,cljs.core.conj.call(null,c,cljs.core.update.call(null,b,new cljs.core.Keyword(null,"datoms","datoms",-290874434),cljs.core.rest)))}a=cljs.core.not_empty.call(null,cljs.core.into.call(null,
cljs.core.PersistentArrayMap.EMPTY,datascript.pull_api.filter_reverse_attrs,cljs.core.get_in.call(null,b,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"pattern","pattern",242135423),new cljs.core.Keyword(null,"attrs","attrs",-2090668713)],null))));return cljs.core.truth_(a)?(b=cljs.core.assoc.call(null,b,new cljs.core.Keyword(null,"state","state",-1988618099),new cljs.core.Keyword(null,"expand-rev","expand-rev",1249112650),new cljs.core.Keyword(null,
"expand-kvps","expand-kvps",44141154),(new cljs.core.Keyword(null,"kvps","kvps",65308317)).cljs$core$IFn$_invoke$arity$1(b),new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY)),cljs.core.conj.call(null,c,b,datascript.pull_api.expand_reverse_subpattern_frame.call(null,b,(new cljs.core.Keyword(null,"eid","eid",559519930)).cljs$core$IFn$_invoke$arity$1(b),a))):datascript.pull_api.expand_result.call(null,c,(new cljs.core.Keyword(null,"kvps",
"kvps",65308317)).cljs$core$IFn$_invoke$arity$1(b))};
datascript.pull_api.pull_wildcard_expand=function(a,b,c,d,e){var f=cljs.core.group_by.call(null,function(a){return a.a},datascript.db._datoms.call(null,a,new cljs.core.Keyword(null,"eavt","eavt",-666437073),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[d],null))),g=null!=b&&(b.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===b.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,b):b,h=cljs.core.get.call(null,g,new cljs.core.Keyword(null,
"attr","attr",-604132353));g=cljs.core.get.call(null,g,new cljs.core.Keyword(null,"recursion","recursion",-749738765));h=null!=h?datascript.pull_api.push_recursion.call(null,g,h,d):g;return datascript.pull_api.pull_expand_frame.call(null,a,cljs.core.conj.call(null,c,b,new cljs.core.PersistentArrayMap(null,6,[new cljs.core.Keyword(null,"state","state",-1988618099),new cljs.core.Keyword(null,"expand","expand",595248157),new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.transient$.call(null,
new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword("db","id","db/id",-1388397098),d],null)),new cljs.core.Keyword(null,"eid","eid",559519930),d,new cljs.core.Keyword(null,"pattern","pattern",242135423),e,new cljs.core.Keyword(null,"datoms","datoms",-290874434),cljs.core.seq.call(null,f),new cljs.core.Keyword(null,"recursion","recursion",-749738765),h],null)))};
datascript.pull_api.pull_wildcard=function(a,b,c){var d=null!=b&&(b.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===b.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,b):b,e=cljs.core.get.call(null,d,new cljs.core.Keyword(null,"eid","eid",559519930));d=cljs.core.get.call(null,d,new cljs.core.Keyword(null,"pattern","pattern",242135423));var f=datascript.pull_api.pull_seen_eid.call(null,b,c,e);return cljs.core.truth_(f)?f:datascript.pull_api.pull_wildcard_expand.call(null,
a,b,c,e,d)};
datascript.pull_api.pull_pattern_frame=function(a,b){for(;;){var c=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,c);c=cljs.core.next.call(null,c);var d=cljs.core.seq.call(null,(new cljs.core.Keyword(null,"eids","eids",1546550700)).cljs$core$IFn$_invoke$arity$1(b));if(d){if(cljs.core.truth_((new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101)).cljs$core$IFn$_invoke$arity$1(b)))return datascript.pull_api.pull_wildcard.call(null,a,cljs.core.assoc.call(null,b,new cljs.core.Keyword(null,"specs",
"specs",1426570741),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"eid","eid",559519930),cljs.core.first.call(null,d),new cljs.core.Keyword(null,"wildcard?","wildcard?",-686044101),!1),c);var e=cljs.core.seq.call(null,(new cljs.core.Keyword(null,"specs","specs",1426570741)).cljs$core$IFn$_invoke$arity$1(b));if(e){var f=e;e=cljs.core.first.call(null,f);(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(b);b=cljs.core.conj.call(null,c,cljs.core.assoc.call(null,
b,new cljs.core.Keyword(null,"specs","specs",1426570741),cljs.core.rest.call(null,f)));return datascript.pull_api.pull_attr.call(null,a,e,cljs.core.first.call(null,d),b)}b=cljs.core.conj.call(null,c,datascript.pull_api.reset_frame.call(null,b,cljs.core.rest.call(null,d),cljs.core.not_empty.call(null,cljs.core.persistent_BANG_.call(null,(new cljs.core.Keyword(null,"kvps","kvps",65308317)).cljs$core$IFn$_invoke$arity$1(b)))))}else return cljs.core.conj.call(null,c,cljs.core.assoc.call(null,b,new cljs.core.Keyword(null,
"state","state",-1988618099),new cljs.core.Keyword(null,"done","done",-889844188)))}};
datascript.pull_api.pull_pattern=function(a,b){for(;;){var c=(new cljs.core.Keyword(null,"state","state",-1988618099)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,b));c=c instanceof cljs.core.Keyword?c.fqn:null;switch(c){case "expand":c=a;b=datascript.pull_api.pull_expand_frame.call(null,a,b);a=c;continue;case "expand-rev":c=a;b=datascript.pull_api.pull_expand_reverse_frame.call(null,a,b);a=c;continue;case "pattern":c=a;b=datascript.pull_api.pull_pattern_frame.call(null,a,b);a=c;continue;
case "recursion":c=a;b=datascript.pull_api.pull_recursion_frame.call(null,a,b);a=c;continue;case "done":c=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,c);c=cljs.core.next.call(null,c);var d=b,e=c,f=function(){var a=cljs.core.persistent_BANG_.call(null,(new cljs.core.Keyword(null,"results","results",-1134170113)).cljs$core$IFn$_invoke$arity$1(d));return cljs.core.not.call(null,(new cljs.core.Keyword(null,"multi?","multi?",-749311069)).cljs$core$IFn$_invoke$arity$1(d))?cljs.core.first.call(null,
a):a}();if(cljs.core.seq.call(null,e)){b=cljs.core.conj.call(null,cljs.core.rest.call(null,e),function(){var a=cljs.core.first.call(null,e);return cljs.core.truth_(f)?cljs.core.update.call(null,a,new cljs.core.Keyword(null,"kvps","kvps",65308317),cljs.core.assoc_BANG_,(new cljs.core.Keyword(null,"attr","attr",-604132353)).cljs$core$IFn$_invoke$arity$1(d),f):a}());continue}else return f;default:throw Error(["No matching clause: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(c)].join(""));}}};
datascript.pull_api.pull_spec=function(a,b,c,d){c=cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.map.call(null,function(b){return datascript.db.entid_strict.call(null,a,b)}),c);return datascript.pull_api.pull_pattern.call(null,a,new cljs.core.List(null,datascript.pull_api.initial_frame.call(null,b,c,d),null,1,null))};
datascript.pull_api.pull=function(a,b,c){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.pull_api.pull_spec.call(null,a,datascript.pull_parser.parse_pull.call(null,b),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null),!1)};
datascript.pull_api.pull_many=function(a,b,c){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.pull_api.pull_spec.call(null,a,datascript.pull_parser.parse_pull.call(null,b),c,!0)};datascript.lru={};datascript.lru.LRU=function(a,b,c,d,e){this.key_value=a;this.gen_key=b;this.key_gen=c;this.gen=d;this.limit=e;this.cljs$lang$protocol_mask$partition0$=2147484416;this.cljs$lang$protocol_mask$partition1$=0};datascript.lru.LRU.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return datascript.lru.assoc_lru.call(null,this,b,c)};
datascript.lru.LRU.prototype.cljs$core$IAssociative$_contains_key_QMARK_$arity$2=function(a,b){return cljs.core._contains_key_QMARK_.call(null,this.key_value,b)};datascript.lru.LRU.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return cljs.core._lookup.call(null,this.key_value,b,null)};datascript.lru.LRU.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return cljs.core._lookup.call(null,this.key_value,b,c)};
datascript.lru.LRU.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){return cljs.core._pr_writer.call(null,this.key_value,b,c)};
datascript.lru.LRU.getBasis=function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"key-value","key-value",1605624688,null),new cljs.core.Symbol(null,"gen-key","gen-key",392707442,null),new cljs.core.Symbol(null,"key-gen","key-gen",415199034,null),new cljs.core.Symbol(null,"gen","gen",1783106829,null),new cljs.core.Symbol(null,"limit","limit",284709164,null)],null)};datascript.lru.LRU.cljs$lang$type=!0;
datascript.lru.LRU.cljs$lang$ctorStr="datascript.lru/LRU";datascript.lru.LRU.cljs$lang$ctorPrWriter=function(a,b,c){return cljs.core._write.call(null,b,"datascript.lru/LRU")};datascript.lru.__GT_LRU=function(a,b,c,d,e){return new datascript.lru.LRU(a,b,c,d,e)};
datascript.lru.assoc_lru=function(a,b,c){var d=a.key_value,e=a.gen_key,f=a.key_gen,g=a.gen;a=a.limit;var h=f.call(null,b,null);return cljs.core.truth_(h)?datascript.lru.__GT_LRU.call(null,d,cljs.core.assoc.call(null,cljs.core.dissoc.call(null,e,h),g,b),cljs.core.assoc.call(null,f,b,g),g+1,a):datascript.lru.cleanup_lru.call(null,datascript.lru.__GT_LRU.call(null,cljs.core.assoc.call(null,d,b,c),cljs.core.assoc.call(null,e,g,b),cljs.core.assoc.call(null,f,b,g),g+1,a))};
datascript.lru.cleanup_lru=function(a){if(cljs.core.count.call(null,a.key_value)>a.limit){var b=a.key_value,c=a.gen_key,d=a.key_gen,e=a.gen;a=a.limit;var f=cljs.core.first.call(null,c),g=cljs.core.nth.call(null,f,0,null);f=cljs.core.nth.call(null,f,1,null);return datascript.lru.__GT_LRU.call(null,cljs.core.dissoc.call(null,b,f),cljs.core.dissoc.call(null,c,g),cljs.core.dissoc.call(null,d,f),e,a)}return a};
datascript.lru.lru=function(a){return datascript.lru.__GT_LRU.call(null,cljs.core.PersistentArrayMap.EMPTY,cljs.core.sorted_map.call(null),cljs.core.PersistentArrayMap.EMPTY,0,a)};datascript.parser={};datascript.parser.ITraversable=function(){};datascript.parser._collect=function(a,b,c){if(null!=a&&null!=a.datascript$parser$ITraversable$_collect$arity$3)return a.datascript$parser$ITraversable$_collect$arity$3(a,b,c);var d=datascript.parser._collect[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=datascript.parser._collect._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"ITraversable.-collect",a);};
datascript.parser._collect_vars=function(a,b){if(null!=a&&null!=a.datascript$parser$ITraversable$_collect_vars$arity$2)return a.datascript$parser$ITraversable$_collect_vars$arity$2(a,b);var c=datascript.parser._collect_vars[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=datascript.parser._collect_vars._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"ITraversable.-collect-vars",a);};
datascript.parser._postwalk=function(a,b){if(null!=a&&null!=a.datascript$parser$ITraversable$_postwalk$arity$2)return a.datascript$parser$ITraversable$_postwalk$arity$2(a,b);var c=datascript.parser._postwalk[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=datascript.parser._postwalk._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"ITraversable.-postwalk",a);};
datascript.parser.of_size_QMARK_=function(a,b){return cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.count.call(null,a),b)};datascript.parser.parse_seq=function(a,b){return cljs.core.sequential_QMARK_.call(null,b)?cljs.core.reduce.call(null,function(b,d){d=a.call(null,d);return cljs.core.truth_(d)?cljs.core.conj.call(null,b,d):cljs.core.reduced.call(null,null)},cljs.core.PersistentVector.EMPTY,b):null};
datascript.parser.collect=function(a){switch(arguments.length){case 2:return datascript.parser.collect.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.parser.collect.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.parser.collect.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.parser.collect.call(null,a,b,cljs.core.PersistentVector.EMPTY)};
datascript.parser.collect.cljs$core$IFn$_invoke$arity$3=function(a,b,c){return cljs.core.truth_(a.call(null,b))?cljs.core.conj.call(null,c,b):(null!=b?cljs.core.PROTOCOL_SENTINEL===b.datascript$parser$ITraversable$||(b.cljs$lang$protocol_mask$partition$?0:cljs.core.native_satisfies_QMARK_.call(null,datascript.parser.ITraversable,b)):cljs.core.native_satisfies_QMARK_.call(null,datascript.parser.ITraversable,b))?datascript.parser._collect.call(null,b,a,c):datascript.db.seqable_QMARK_.call(null,b)?cljs.core.reduce.call(null,
function(b,c){return datascript.parser.collect.call(null,a,c,b)},c,b):c};datascript.parser.collect.cljs$lang$maxFixedArity=3;datascript.parser.distinct_QMARK_=function(a){var b=cljs.core.empty_QMARK_.call(null,a);return b?b:cljs.core.apply.call(null,cljs.core.distinct_QMARK_,a)};
datascript.parser.postwalk=function(a,b){return(null!=a?cljs.core.PROTOCOL_SENTINEL===a.datascript$parser$ITraversable$||(a.cljs$lang$protocol_mask$partition$?0:cljs.core.native_satisfies_QMARK_.call(null,datascript.parser.ITraversable,a)):cljs.core.native_satisfies_QMARK_.call(null,datascript.parser.ITraversable,a))?b.call(null,datascript.parser._postwalk.call(null,a,b)):cljs.core.map_QMARK_.call(null,a)?b.call(null,cljs.core.reduce.call(null,function(a,d){var c=cljs.core.nth.call(null,d,0,null);
d=cljs.core.nth.call(null,d,1,null);return cljs.core.assoc.call(null,a,c,datascript.parser.postwalk.call(null,d,b))},a,a)):cljs.core.seq_QMARK_.call(null,a)?b.call(null,cljs.core.map.call(null,function(a){return datascript.parser.postwalk.call(null,a,b)},a)):cljs.core.coll_QMARK_.call(null,a)?b.call(null,cljs.core.into.call(null,cljs.core.empty.call(null,a),cljs.core.map.call(null,function(a){return datascript.parser.postwalk.call(null,a,b)},a))):b.call(null,a)};
datascript.parser.with_source=function(a,b){return cljs.core.with_meta.call(null,a,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"source","source",-433931539),b],null))};datascript.parser.source=function(a){var b=(new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a));return cljs.core.truth_(b)?b:a};
datascript.parser.Placeholder=function(a,b,c){this.__meta=a;this.__extmap=b;this.__hash=c;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Placeholder.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.Placeholder.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return cljs.core.get.call(null,this.__extmap,b,c)};
datascript.parser.Placeholder.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Placeholder{",", ","}",c,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.Placeholder.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,0,cljs.core.PersistentVector.EMPTY,cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.Placeholder.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.Placeholder.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Placeholder(this.__meta,this.__extmap,this.__hash)};datascript.parser.Placeholder.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 0+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Placeholder.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-528488587^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.Placeholder.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Placeholder.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,cljs.core.PersistentHashSet.EMPTY,b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Placeholder(this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Placeholder.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return new datascript.parser.Placeholder(this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.Placeholder.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.Placeholder.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Placeholder(b,this.__extmap,this.__hash)};datascript.parser.Placeholder.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Placeholder.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Placeholder.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Placeholder(null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.Placeholder.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return c};
datascript.parser.Placeholder.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return b};datascript.parser.Placeholder.getBasis=function(){return cljs.core.PersistentVector.EMPTY};datascript.parser.Placeholder.cljs$lang$type=!0;datascript.parser.Placeholder.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Placeholder",null,1,null)};datascript.parser.Placeholder.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Placeholder")};
datascript.parser.__GT_Placeholder=function(){return new datascript.parser.Placeholder(null,null,null)};datascript.parser.map__GT_Placeholder=function(a){var b=cljs.core.dissoc.call(null,a);a=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Placeholder(null,cljs.core.not_empty.call(null,a),null)};
datascript.parser.Variable=function(a,b,c,d){this.symbol=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Variable.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Variable.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "symbol":return this.symbol;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Variable.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Variable{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"symbol","symbol",-1038572696),this.symbol],null)],null),this.__extmap))};datascript.parser.Variable.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"symbol","symbol",-1038572696)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Variable.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Variable.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Variable(this.symbol,this.__meta,this.__extmap,this.__hash)};datascript.parser.Variable.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Variable.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 736891289^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.Variable.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.symbol,b.symbol)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Variable.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"symbol","symbol",-1038572696),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Variable(this.symbol,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.Variable.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),b))?new datascript.parser.Variable(c,this.__meta,this.__extmap,null):new datascript.parser.Variable(this.symbol,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Variable.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"symbol","symbol",-1038572696),this.symbol,null)],null),this.__extmap))};datascript.parser.Variable.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Variable(this.symbol,b,this.__extmap,this.__hash)};
datascript.parser.Variable.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.Variable.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Variable.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Variable(datascript.parser.postwalk.call(null,this.symbol,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.Variable.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.symbol,c)};
datascript.parser.Variable.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.symbol)};datascript.parser.Variable.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"symbol","symbol",601958831,null)],null)};datascript.parser.Variable.cljs$lang$type=!0;
datascript.parser.Variable.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Variable",null,1,null)};datascript.parser.Variable.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Variable")};datascript.parser.__GT_Variable=function(a){return new datascript.parser.Variable(a,null,null,null)};
datascript.parser.map__GT_Variable=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"symbol","symbol",-1038572696));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Variable((new cljs.core.Keyword(null,"symbol","symbol",-1038572696)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.SrcVar=function(a,b,c,d){this.symbol=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.SrcVar.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.SrcVar.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "symbol":return this.symbol;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.SrcVar.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.SrcVar{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"symbol","symbol",-1038572696),this.symbol],null)],null),this.__extmap))};datascript.parser.SrcVar.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"symbol","symbol",-1038572696)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.SrcVar.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.SrcVar.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.SrcVar(this.symbol,this.__meta,this.__extmap,this.__hash)};datascript.parser.SrcVar.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.SrcVar.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1648766309^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.SrcVar.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.symbol,b.symbol)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.SrcVar.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"symbol","symbol",-1038572696),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.SrcVar(this.symbol,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.SrcVar.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),b))?new datascript.parser.SrcVar(c,this.__meta,this.__extmap,null):new datascript.parser.SrcVar(this.symbol,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.SrcVar.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"symbol","symbol",-1038572696),this.symbol,null)],null),this.__extmap))};datascript.parser.SrcVar.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.SrcVar(this.symbol,b,this.__extmap,this.__hash)};
datascript.parser.SrcVar.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.SrcVar.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.SrcVar.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.SrcVar(datascript.parser.postwalk.call(null,this.symbol,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.SrcVar.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.symbol,c)};
datascript.parser.SrcVar.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.symbol)};datascript.parser.SrcVar.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"symbol","symbol",601958831,null)],null)};datascript.parser.SrcVar.cljs$lang$type=!0;
datascript.parser.SrcVar.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/SrcVar",null,1,null)};datascript.parser.SrcVar.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/SrcVar")};datascript.parser.__GT_SrcVar=function(a){return new datascript.parser.SrcVar(a,null,null,null)};
datascript.parser.map__GT_SrcVar=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"symbol","symbol",-1038572696));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.SrcVar((new cljs.core.Keyword(null,"symbol","symbol",-1038572696)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.DefaultSrc=function(a,b,c){this.__meta=a;this.__extmap=b;this.__hash=c;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.DefaultSrc.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.DefaultSrc.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return cljs.core.get.call(null,this.__extmap,b,c)};
datascript.parser.DefaultSrc.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.DefaultSrc{",", ","}",c,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.DefaultSrc.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,0,cljs.core.PersistentVector.EMPTY,cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.DefaultSrc.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.DefaultSrc.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.DefaultSrc(this.__meta,this.__extmap,this.__hash)};datascript.parser.DefaultSrc.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 0+cljs.core.count.call(null,this.__extmap)};
datascript.parser.DefaultSrc.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-350962559^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.DefaultSrc.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.DefaultSrc.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,cljs.core.PersistentHashSet.EMPTY,b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.DefaultSrc(this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.DefaultSrc.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return new datascript.parser.DefaultSrc(this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.DefaultSrc.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.DefaultSrc.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.DefaultSrc(b,this.__extmap,this.__hash)};datascript.parser.DefaultSrc.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.DefaultSrc.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.DefaultSrc.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.DefaultSrc(null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.DefaultSrc.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return c};
datascript.parser.DefaultSrc.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return b};datascript.parser.DefaultSrc.getBasis=function(){return cljs.core.PersistentVector.EMPTY};datascript.parser.DefaultSrc.cljs$lang$type=!0;datascript.parser.DefaultSrc.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/DefaultSrc",null,1,null)};datascript.parser.DefaultSrc.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/DefaultSrc")};
datascript.parser.__GT_DefaultSrc=function(){return new datascript.parser.DefaultSrc(null,null,null)};datascript.parser.map__GT_DefaultSrc=function(a){var b=cljs.core.dissoc.call(null,a);a=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.DefaultSrc(null,cljs.core.not_empty.call(null,a),null)};
datascript.parser.RulesVar=function(a,b,c){this.__meta=a;this.__extmap=b;this.__hash=c;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.RulesVar.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.RulesVar.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return cljs.core.get.call(null,this.__extmap,b,c)};
datascript.parser.RulesVar.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.RulesVar{",", ","}",c,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.RulesVar.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,0,cljs.core.PersistentVector.EMPTY,cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.RulesVar.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.RulesVar.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.RulesVar(this.__meta,this.__extmap,this.__hash)};datascript.parser.RulesVar.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 0+cljs.core.count.call(null,this.__extmap)};
datascript.parser.RulesVar.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1504050517^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.RulesVar.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.RulesVar.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,cljs.core.PersistentHashSet.EMPTY,b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.RulesVar(this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.RulesVar.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return new datascript.parser.RulesVar(this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.RulesVar.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.RulesVar.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.RulesVar(b,this.__extmap,this.__hash)};datascript.parser.RulesVar.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.RulesVar.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.RulesVar.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.RulesVar(null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.RulesVar.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return c};
datascript.parser.RulesVar.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return b};datascript.parser.RulesVar.getBasis=function(){return cljs.core.PersistentVector.EMPTY};datascript.parser.RulesVar.cljs$lang$type=!0;datascript.parser.RulesVar.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/RulesVar",null,1,null)};datascript.parser.RulesVar.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/RulesVar")};
datascript.parser.__GT_RulesVar=function(){return new datascript.parser.RulesVar(null,null,null)};datascript.parser.map__GT_RulesVar=function(a){var b=cljs.core.dissoc.call(null,a);a=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.RulesVar(null,cljs.core.not_empty.call(null,a),null)};
datascript.parser.Constant=function(a,b,c,d){this.value=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Constant.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Constant.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "value":return this.value;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Constant.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Constant{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"value","value",305978217),this.value],null)],null),this.__extmap))};datascript.parser.Constant.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"value","value",305978217)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Constant.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Constant.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Constant(this.value,this.__meta,this.__extmap,this.__hash)};datascript.parser.Constant.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Constant.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-812884714^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.Constant.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.value,b.value)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Constant.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"value","value",305978217),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Constant(this.value,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.Constant.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"value","value",305978217),b))?new datascript.parser.Constant(c,this.__meta,this.__extmap,null):new datascript.parser.Constant(this.value,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Constant.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"value","value",305978217),this.value,null)],null),this.__extmap))};datascript.parser.Constant.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Constant(this.value,b,this.__extmap,this.__hash)};
datascript.parser.Constant.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.Constant.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Constant.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Constant(datascript.parser.postwalk.call(null,this.value,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.Constant.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.value,c)};
datascript.parser.Constant.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.value)};datascript.parser.Constant.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"value","value",1946509744,null)],null)};datascript.parser.Constant.cljs$lang$type=!0;
datascript.parser.Constant.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Constant",null,1,null)};datascript.parser.Constant.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Constant")};datascript.parser.__GT_Constant=function(a){return new datascript.parser.Constant(a,null,null,null)};
datascript.parser.map__GT_Constant=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"value","value",305978217));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Constant((new cljs.core.Keyword(null,"value","value",305978217)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.PlainSymbol=function(a,b,c,d){this.symbol=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.PlainSymbol.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.PlainSymbol.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "symbol":return this.symbol;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.PlainSymbol.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.PlainSymbol{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"symbol","symbol",-1038572696),this.symbol],null)],null),this.__extmap))};datascript.parser.PlainSymbol.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"symbol","symbol",-1038572696)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.PlainSymbol.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.PlainSymbol.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.PlainSymbol(this.symbol,this.__meta,this.__extmap,this.__hash)};datascript.parser.PlainSymbol.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.PlainSymbol.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1509921913^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.PlainSymbol.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.symbol,b.symbol)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.PlainSymbol.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"symbol","symbol",-1038572696),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.PlainSymbol(this.symbol,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.PlainSymbol.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),b))?new datascript.parser.PlainSymbol(c,this.__meta,this.__extmap,null):new datascript.parser.PlainSymbol(this.symbol,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.PlainSymbol.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"symbol","symbol",-1038572696),this.symbol,null)],null),this.__extmap))};
datascript.parser.PlainSymbol.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.PlainSymbol(this.symbol,b,this.__extmap,this.__hash)};datascript.parser.PlainSymbol.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.PlainSymbol.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.PlainSymbol.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.PlainSymbol(datascript.parser.postwalk.call(null,this.symbol,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.PlainSymbol.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.symbol,c)};datascript.parser.PlainSymbol.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.symbol)};
datascript.parser.PlainSymbol.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"symbol","symbol",601958831,null)],null)};datascript.parser.PlainSymbol.cljs$lang$type=!0;datascript.parser.PlainSymbol.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/PlainSymbol",null,1,null)};datascript.parser.PlainSymbol.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/PlainSymbol")};
datascript.parser.__GT_PlainSymbol=function(a){return new datascript.parser.PlainSymbol(a,null,null,null)};
datascript.parser.map__GT_PlainSymbol=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"symbol","symbol",-1038572696));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.PlainSymbol((new cljs.core.Keyword(null,"symbol","symbol",-1038572696)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.parse_placeholder=function(a){return cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"_","_",-1201019570,null),a)?new datascript.parser.Placeholder(null,null,null):null};datascript.parser.parse_variable=function(a){return a instanceof cljs.core.Symbol&&cljs.core._EQ_.call(null,cljs.core.first.call(null,cljs.core.name.call(null,a)),"?")?new datascript.parser.Variable(a,null,null,null):null};
datascript.parser.parse_var_required=function(a){var b=datascript.parser.parse_variable.call(null,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,["Cannot parse var, expected symbol starting with ?, got: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,a))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule-var","parser/rule-var",-1584354459),new cljs.core.Keyword(null,
"form","form",-1624062471),a],null));};datascript.parser.parse_src_var=function(a){return a instanceof cljs.core.Symbol&&cljs.core._EQ_.call(null,cljs.core.first.call(null,cljs.core.name.call(null,a)),"$")?new datascript.parser.SrcVar(a,null,null,null):null};datascript.parser.parse_rules_var=function(a){return cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"%","%",-950237169,null),a)?new datascript.parser.RulesVar(null,null,null):null};
datascript.parser.parse_constant=function(a){return a instanceof cljs.core.Symbol?null:new datascript.parser.Constant(a,null,null,null)};
datascript.parser.parse_plain_symbol=function(a){return a instanceof cljs.core.Symbol&&cljs.core.not.call(null,datascript.parser.parse_variable.call(null,a))&&cljs.core.not.call(null,datascript.parser.parse_src_var.call(null,a))&&cljs.core.not.call(null,datascript.parser.parse_rules_var.call(null,a))&&cljs.core.not.call(null,datascript.parser.parse_placeholder.call(null,a))?new datascript.parser.PlainSymbol(a,null,null,null):null};
datascript.parser.parse_plain_variable=function(a){return cljs.core.truth_(datascript.parser.parse_plain_symbol.call(null,a))?new datascript.parser.Variable(a,null,null,null):null};datascript.parser.parse_fn_arg=function(a){var b=datascript.parser.parse_variable.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_constant.call(null,a);return cljs.core.truth_(b)?b:datascript.parser.parse_src_var.call(null,a)};
datascript.parser.RuleVars=function(a,b,c,d,e){this.required=a;this.free=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.RuleVars.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.RuleVars.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "required":return this.required;case "free":return this.free;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.RuleVars.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.RuleVars{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"required","required",1807647006),this.required],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"free","free",801364328),this.free],null)],null),this.__extmap))};
datascript.parser.RuleVars.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"required","required",1807647006),new cljs.core.Keyword(null,"free","free",801364328)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.RuleVars.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.RuleVars.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.RuleVars(this.required,this.free,this.__meta,this.__extmap,this.__hash)};datascript.parser.RuleVars.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.RuleVars.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 892963297^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.RuleVars.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.required,b.required)&&cljs.core._EQ_.call(null,this.free,b.free)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.RuleVars.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"free","free",801364328),null,new cljs.core.Keyword(null,"required","required",1807647006),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.RuleVars(this.required,
this.free,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.RuleVars.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"required","required",1807647006),b))?new datascript.parser.RuleVars(c,this.free,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"free","free",801364328),b))?new datascript.parser.RuleVars(this.required,c,this.__meta,this.__extmap,null):new datascript.parser.RuleVars(this.required,
this.free,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.RuleVars.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"required","required",1807647006),this.required,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"free","free",801364328),this.free,null)],null),this.__extmap))};
datascript.parser.RuleVars.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.RuleVars(this.required,this.free,b,this.__extmap,this.__hash)};datascript.parser.RuleVars.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.RuleVars.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.RuleVars.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.RuleVars(datascript.parser.postwalk.call(null,this.required,b),datascript.parser.postwalk.call(null,this.free,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.RuleVars.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.free,datascript.parser.collect.call(null,b,this.required,c))};datascript.parser.RuleVars.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.required),this.free)};
datascript.parser.RuleVars.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"required","required",-846788763,null),new cljs.core.Symbol(null,"free","free",-1853071441,null)],null)};datascript.parser.RuleVars.cljs$lang$type=!0;datascript.parser.RuleVars.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/RuleVars",null,1,null)};
datascript.parser.RuleVars.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/RuleVars")};datascript.parser.__GT_RuleVars=function(a,b){return new datascript.parser.RuleVars(a,b,null,null,null)};
datascript.parser.map__GT_RuleVars=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"required","required",1807647006),new cljs.core.Keyword(null,"free","free",801364328));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.RuleVars((new cljs.core.Keyword(null,"required","required",1807647006)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"free","free",801364328)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.parse_rule_vars=function(a){if(cljs.core.sequential_QMARK_.call(null,a)){var b=cljs.core.sequential_QMARK_.call(null,cljs.core.first.call(null,a))?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.first.call(null,a),cljs.core.next.call(null,a)],null):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[null,a],null),c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);c=datascript.parser.parse_seq.call(null,
datascript.parser.parse_var_required,c);b=datascript.parser.parse_seq.call(null,datascript.parser.parse_var_required,b);if(cljs.core.empty_QMARK_.call(null,c)&&cljs.core.empty_QMARK_.call(null,b))throw cljs.core.ex_info.call(null,"Cannot parse rule-vars, expected [ variable+ | ([ variable+ ] variable*) ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule-vars","parser/rule-vars",-1493174969),new cljs.core.Keyword(null,
"form","form",-1624062471),a],null));if(!cljs.core.truth_(datascript.parser.distinct_QMARK_.call(null,cljs.core.concat.call(null,c,b))))throw cljs.core.ex_info.call(null,"Rule variables should be distinct",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule-vars","parser/rule-vars",-1493174969),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));return new datascript.parser.RuleVars(c,b,null,null,null)}throw cljs.core.ex_info.call(null,
"Cannot parse rule-vars, expected [ variable+ | ([ variable+ ] variable*) ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule-vars","parser/rule-vars",-1493174969),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));};
datascript.parser.flatten_rule_vars=function(a){return cljs.core.concat.call(null,cljs.core.truth_((new cljs.core.Keyword(null,"required","required",1807647006)).cljs$core$IFn$_invoke$arity$1(a))?function(){new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.mapv.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),(new cljs.core.Keyword(null,"required","required",1807647006)).cljs$core$IFn$_invoke$arity$1(a))],null);return cljs.core.mapv.call(null,
new cljs.core.Keyword(null,"symbol","symbol",-1038572696),(new cljs.core.Keyword(null,"free","free",801364328)).cljs$core$IFn$_invoke$arity$1(a))}():null)};
datascript.parser.rule_vars_arity=function(a){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.count.call(null,(new cljs.core.Keyword(null,"required","required",1807647006)).cljs$core$IFn$_invoke$arity$1(a)),cljs.core.count.call(null,(new cljs.core.Keyword(null,"free","free",801364328)).cljs$core$IFn$_invoke$arity$1(a))],null)};
datascript.parser.BindIgnore=function(a,b,c){this.__meta=a;this.__extmap=b;this.__hash=c;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.BindIgnore.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.BindIgnore.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){return cljs.core.get.call(null,this.__extmap,b,c)};
datascript.parser.BindIgnore.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.BindIgnore{",", ","}",c,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.BindIgnore.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,0,cljs.core.PersistentVector.EMPTY,cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.BindIgnore.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.BindIgnore.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.BindIgnore(this.__meta,this.__extmap,this.__hash)};datascript.parser.BindIgnore.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 0+cljs.core.count.call(null,this.__extmap)};
datascript.parser.BindIgnore.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-890522983^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.BindIgnore.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.BindIgnore.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,cljs.core.PersistentHashSet.EMPTY,b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.BindIgnore(this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.BindIgnore.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return new datascript.parser.BindIgnore(this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.BindIgnore.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,cljs.core.PersistentVector.EMPTY,this.__extmap))};
datascript.parser.BindIgnore.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.BindIgnore(b,this.__extmap,this.__hash)};datascript.parser.BindIgnore.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.BindIgnore.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.BindIgnore.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.BindIgnore(null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.BindIgnore.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return c};
datascript.parser.BindIgnore.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return b};datascript.parser.BindIgnore.getBasis=function(){return cljs.core.PersistentVector.EMPTY};datascript.parser.BindIgnore.cljs$lang$type=!0;datascript.parser.BindIgnore.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/BindIgnore",null,1,null)};datascript.parser.BindIgnore.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/BindIgnore")};
datascript.parser.__GT_BindIgnore=function(){return new datascript.parser.BindIgnore(null,null,null)};datascript.parser.map__GT_BindIgnore=function(a){var b=cljs.core.dissoc.call(null,a);a=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.BindIgnore(null,cljs.core.not_empty.call(null,a),null)};
datascript.parser.BindScalar=function(a,b,c,d){this.variable=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.BindScalar.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.BindScalar.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "variable":return this.variable;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.BindScalar.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.BindScalar{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"variable","variable",-281346492),this.variable],null)],null),this.__extmap))};datascript.parser.BindScalar.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"variable","variable",-281346492)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.BindScalar.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.BindScalar.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.BindScalar(this.variable,this.__meta,this.__extmap,this.__hash)};datascript.parser.BindScalar.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.BindScalar.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1522792445^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.BindScalar.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.variable,b.variable)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.BindScalar.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"variable","variable",-281346492),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.BindScalar(this.variable,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.BindScalar.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"variable","variable",-281346492),b))?new datascript.parser.BindScalar(c,this.__meta,this.__extmap,null):new datascript.parser.BindScalar(this.variable,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.BindScalar.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"variable","variable",-281346492),this.variable,null)],null),this.__extmap))};
datascript.parser.BindScalar.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.BindScalar(this.variable,b,this.__extmap,this.__hash)};datascript.parser.BindScalar.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.BindScalar.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.BindScalar.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.BindScalar(datascript.parser.postwalk.call(null,this.variable,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.BindScalar.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.variable,c)};datascript.parser.BindScalar.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.variable)};
datascript.parser.BindScalar.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"variable","variable",1359185035,null)],null)};datascript.parser.BindScalar.cljs$lang$type=!0;datascript.parser.BindScalar.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/BindScalar",null,1,null)};datascript.parser.BindScalar.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/BindScalar")};
datascript.parser.__GT_BindScalar=function(a){return new datascript.parser.BindScalar(a,null,null,null)};
datascript.parser.map__GT_BindScalar=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"variable","variable",-281346492));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.BindScalar((new cljs.core.Keyword(null,"variable","variable",-281346492)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.BindTuple=function(a,b,c,d){this.bindings=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.BindTuple.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.BindTuple.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "bindings":return this.bindings;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.BindTuple.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.BindTuple{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"bindings","bindings",1271397192),this.bindings],null)],null),this.__extmap))};datascript.parser.BindTuple.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"bindings","bindings",1271397192)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.BindTuple.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.BindTuple.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.BindTuple(this.bindings,this.__meta,this.__extmap,this.__hash)};datascript.parser.BindTuple.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.BindTuple.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1637239347^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.BindTuple.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.bindings,b.bindings)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.BindTuple.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"bindings","bindings",1271397192),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.BindTuple(this.bindings,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.BindTuple.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"bindings","bindings",1271397192),b))?new datascript.parser.BindTuple(c,this.__meta,this.__extmap,null):new datascript.parser.BindTuple(this.bindings,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.BindTuple.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"bindings","bindings",1271397192),this.bindings,null)],null),this.__extmap))};
datascript.parser.BindTuple.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.BindTuple(this.bindings,b,this.__extmap,this.__hash)};datascript.parser.BindTuple.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.BindTuple.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.BindTuple.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.BindTuple(datascript.parser.postwalk.call(null,this.bindings,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.BindTuple.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.bindings,c)};datascript.parser.BindTuple.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.bindings)};
datascript.parser.BindTuple.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"bindings","bindings",-1383038577,null)],null)};datascript.parser.BindTuple.cljs$lang$type=!0;datascript.parser.BindTuple.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/BindTuple",null,1,null)};datascript.parser.BindTuple.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/BindTuple")};
datascript.parser.__GT_BindTuple=function(a){return new datascript.parser.BindTuple(a,null,null,null)};
datascript.parser.map__GT_BindTuple=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"bindings","bindings",1271397192));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.BindTuple((new cljs.core.Keyword(null,"bindings","bindings",1271397192)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.BindColl=function(a,b,c,d){this.binding=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.BindColl.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.BindColl.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "binding":return this.binding;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.BindColl.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.BindColl{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"binding","binding",539932593),this.binding],null)],null),this.__extmap))};datascript.parser.BindColl.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"binding","binding",539932593)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.BindColl.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.BindColl.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.BindColl(this.binding,this.__meta,this.__extmap,this.__hash)};datascript.parser.BindColl.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.BindColl.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1930368089^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.BindColl.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.binding,b.binding)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.BindColl.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"binding","binding",539932593),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.BindColl(this.binding,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.BindColl.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"binding","binding",539932593),b))?new datascript.parser.BindColl(c,this.__meta,this.__extmap,null):new datascript.parser.BindColl(this.binding,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.BindColl.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"binding","binding",539932593),this.binding,null)],null),this.__extmap))};datascript.parser.BindColl.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.BindColl(this.binding,b,this.__extmap,this.__hash)};
datascript.parser.BindColl.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.BindColl.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.BindColl.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.BindColl(datascript.parser.postwalk.call(null,this.binding,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.BindColl.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.binding,c)};
datascript.parser.BindColl.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.binding)};datascript.parser.BindColl.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"binding","binding",-2114503176,null)],null)};datascript.parser.BindColl.cljs$lang$type=!0;
datascript.parser.BindColl.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/BindColl",null,1,null)};datascript.parser.BindColl.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/BindColl")};datascript.parser.__GT_BindColl=function(a){return new datascript.parser.BindColl(a,null,null,null)};
datascript.parser.map__GT_BindColl=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"binding","binding",539932593));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.BindColl((new cljs.core.Keyword(null,"binding","binding",539932593)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.parse_bind_ignore=function(a){return cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"_","_",-1201019570,null),a)?datascript.parser.with_source.call(null,new datascript.parser.BindIgnore(null,null,null),a):null};datascript.parser.parse_bind_scalar=function(a){var b=datascript.parser.parse_variable.call(null,a);return cljs.core.truth_(b)?datascript.parser.with_source.call(null,new datascript.parser.BindScalar(b,null,null,null),a):null};
datascript.parser.parse_bind_coll=function(a){if(cljs.core.truth_(function(){var b=datascript.parser.of_size_QMARK_.call(null,a,2);return cljs.core.truth_(b)?cljs.core._EQ_.call(null,cljs.core.second.call(null,a),new cljs.core.Symbol(null,"...","...",-1926939749,null)):b}())){var b=datascript.parser.parse_binding.call(null,cljs.core.first.call(null,a));if(cljs.core.truth_(b))return datascript.parser.with_source.call(null,new datascript.parser.BindColl(b,null,null,null),a);throw cljs.core.ex_info.call(null,
"Cannot parse collection binding",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","binding","parser/binding",-346395752),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}return null};datascript.parser.parse_tuple_el=function(a){var b=datascript.parser.parse_bind_ignore.call(null,a);return cljs.core.truth_(b)?b:datascript.parser.parse_binding.call(null,a)};
datascript.parser.parse_bind_tuple=function(a){var b=datascript.parser.parse_seq.call(null,datascript.parser.parse_tuple_el,a);if(cljs.core.truth_(b)){if(cljs.core.empty_QMARK_.call(null,b))throw cljs.core.ex_info.call(null,"Tuple binding cannot be empty",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","binding","parser/binding",-346395752),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));return datascript.parser.with_source.call(null,
new datascript.parser.BindTuple(b,null,null,null),a)}return null};datascript.parser.parse_bind_rel=function(a){return cljs.core.truth_(function(){var b=datascript.parser.of_size_QMARK_.call(null,a,1);return cljs.core.truth_(b)?cljs.core.sequential_QMARK_.call(null,cljs.core.first.call(null,a)):b}())?datascript.parser.with_source.call(null,new datascript.parser.BindColl(datascript.parser.parse_bind_tuple.call(null,cljs.core.first.call(null,a)),null,null,null),a):null};
datascript.parser.parse_binding=function(a){var b=datascript.parser.parse_bind_coll.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_bind_rel.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_bind_tuple.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_bind_ignore.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_bind_scalar.call(null,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse binding, expected (bind-scalar | bind-tuple | bind-coll | bind-rel)",
new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","binding","parser/binding",-346395752),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));};datascript.parser.IFindVars=function(){};
datascript.parser._find_vars=function(a){if(null!=a&&null!=a.datascript$parser$IFindVars$_find_vars$arity$1)return a.datascript$parser$IFindVars$_find_vars$arity$1(a);var b=datascript.parser._find_vars[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=datascript.parser._find_vars._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"IFindVars.-find-vars",a);};datascript.parser.Variable.prototype.datascript$parser$IFindVars$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Variable.prototype.datascript$parser$IFindVars$_find_vars$arity$1=function(a){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[this.symbol],null)};datascript.parser.Aggregate=function(a,b,c,d,e){this.fn=a;this.args=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Aggregate.prototype.datascript$parser$IFindVars$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Aggregate.prototype.datascript$parser$IFindVars$_find_vars$arity$1=function(a){return datascript.parser._find_vars.call(null,cljs.core.last.call(null,this.args))};datascript.parser.Aggregate.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Aggregate.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "fn":return this.fn;case "args":return this.args;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Aggregate.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Aggregate{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"fn","fn",-1175266204),this.fn],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"args","args",1315556576),this.args],null)],null),this.__extmap))};
datascript.parser.Aggregate.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"fn","fn",-1175266204),new cljs.core.Keyword(null,"args","args",1315556576)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.Aggregate.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.Aggregate.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Aggregate(this.fn,this.args,this.__meta,this.__extmap,this.__hash)};datascript.parser.Aggregate.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Aggregate.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-91097383^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Aggregate.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.fn,b.fn)&&cljs.core._EQ_.call(null,this.args,b.args)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Aggregate.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"args","args",1315556576),null,new cljs.core.Keyword(null,"fn","fn",-1175266204),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Aggregate(this.fn,
this.args,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Aggregate.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"fn","fn",-1175266204),b))?new datascript.parser.Aggregate(c,this.args,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"args","args",1315556576),b))?new datascript.parser.Aggregate(this.fn,c,this.__meta,this.__extmap,null):new datascript.parser.Aggregate(this.fn,this.args,
this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.Aggregate.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"fn","fn",-1175266204),this.fn,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"args","args",1315556576),this.args,null)],null),this.__extmap))};
datascript.parser.Aggregate.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Aggregate(this.fn,this.args,b,this.__extmap,this.__hash)};datascript.parser.Aggregate.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Aggregate.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Aggregate.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Aggregate(datascript.parser.postwalk.call(null,this.fn,b),datascript.parser.postwalk.call(null,this.args,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Aggregate.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.args,datascript.parser.collect.call(null,b,this.fn,c))};datascript.parser.Aggregate.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.fn),this.args)};
datascript.parser.Aggregate.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"fn","fn",465265323,null),new cljs.core.Symbol(null,"args","args",-1338879193,null)],null)};datascript.parser.Aggregate.cljs$lang$type=!0;datascript.parser.Aggregate.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Aggregate",null,1,null)};
datascript.parser.Aggregate.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Aggregate")};datascript.parser.__GT_Aggregate=function(a,b){return new datascript.parser.Aggregate(a,b,null,null,null)};
datascript.parser.map__GT_Aggregate=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"fn","fn",-1175266204),new cljs.core.Keyword(null,"args","args",1315556576));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Aggregate((new cljs.core.Keyword(null,"fn","fn",-1175266204)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"args","args",1315556576)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.parser.Pull=function(a,b,c,d,e,f){this.source=a;this.variable=b;this.pattern=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Pull.prototype.datascript$parser$IFindVars$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Pull.prototype.datascript$parser$IFindVars$_find_vars$arity$1=function(a){return datascript.parser._find_vars.call(null,this.variable)};datascript.parser.Pull.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Pull.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "source":return this.source;case "variable":return this.variable;case "pattern":return this.pattern;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Pull.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Pull{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"source","source",-433931539),this.source],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"variable","variable",-281346492),this.variable],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"pattern","pattern",242135423),this.pattern],null)],null),this.__extmap))};
datascript.parser.Pull.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"variable","variable",-281346492),new cljs.core.Keyword(null,"pattern","pattern",242135423)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Pull.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Pull.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Pull(this.source,this.variable,this.pattern,this.__meta,this.__extmap,this.__hash)};datascript.parser.Pull.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Pull.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-2108867663^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Pull.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.source,b.source)&&cljs.core._EQ_.call(null,this.variable,b.variable)&&cljs.core._EQ_.call(null,this.pattern,b.pattern)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Pull.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"variable","variable",-281346492),null,new cljs.core.Keyword(null,"source","source",-433931539),null,new cljs.core.Keyword(null,"pattern","pattern",242135423),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.parser.Pull(this.source,this.variable,this.pattern,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Pull.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"source","source",-433931539),b))?new datascript.parser.Pull(c,this.variable,this.pattern,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"variable","variable",-281346492),b))?new datascript.parser.Pull(this.source,c,this.pattern,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"pattern","pattern",242135423),b))?new datascript.parser.Pull(this.source,this.variable,c,this.__meta,this.__extmap,null):new datascript.parser.Pull(this.source,this.variable,this.pattern,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Pull.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"source","source",-433931539),this.source,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"variable","variable",-281346492),this.variable,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"pattern","pattern",242135423),this.pattern,
null)],null),this.__extmap))};datascript.parser.Pull.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Pull(this.source,this.variable,this.pattern,b,this.__extmap,this.__hash)};
datascript.parser.Pull.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.Pull.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Pull.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Pull(datascript.parser.postwalk.call(null,this.source,b),datascript.parser.postwalk.call(null,this.variable,b),datascript.parser.postwalk.call(null,this.pattern,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Pull.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.pattern,datascript.parser.collect.call(null,b,this.variable,datascript.parser.collect.call(null,b,this.source,c)))};
datascript.parser.Pull.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.source),this.variable),this.pattern)};
datascript.parser.Pull.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"source","source",1206599988,null),new cljs.core.Symbol(null,"variable","variable",1359185035,null),new cljs.core.Symbol(null,"pattern","pattern",1882666950,null)],null)};datascript.parser.Pull.cljs$lang$type=!0;datascript.parser.Pull.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Pull",null,1,null)};
datascript.parser.Pull.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Pull")};datascript.parser.__GT_Pull=function(a,b,c){return new datascript.parser.Pull(a,b,c,null,null,null)};
datascript.parser.map__GT_Pull=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"variable","variable",-281346492),new cljs.core.Keyword(null,"pattern","pattern",242135423));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Pull((new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,
"variable","variable",-281346492)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.parser.IFindElements=function(){};
datascript.parser.find_elements=function(a){if(null!=a&&null!=a.datascript$parser$IFindElements$find_elements$arity$1)return a.datascript$parser$IFindElements$find_elements$arity$1(a);var b=datascript.parser.find_elements[goog.typeOf(null==a?null:a)];if(null!=b)return b.call(null,a);b=datascript.parser.find_elements._;if(null!=b)return b.call(null,a);throw cljs.core.missing_protocol.call(null,"IFindElements.find-elements",a);};
datascript.parser.FindRel=function(a,b,c,d){this.elements=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.FindRel.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.FindRel.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "elements":return this.elements;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.FindRel.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.FindRel{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"elements","elements",657646735),this.elements],null)],null),this.__extmap))};datascript.parser.FindRel.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"elements","elements",657646735)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.FindRel.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.FindRel.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.FindRel(this.elements,this.__meta,this.__extmap,this.__hash)};datascript.parser.FindRel.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.FindRel.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 744809563^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.FindRel.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.elements,b.elements)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.FindRel.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"elements","elements",657646735),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.FindRel(this.elements,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.FindRel.prototype.datascript$parser$IFindElements$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindRel.prototype.datascript$parser$IFindElements$find_elements$arity$1=function(a){return this.elements};
datascript.parser.FindRel.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"elements","elements",657646735),b))?new datascript.parser.FindRel(c,this.__meta,this.__extmap,null):new datascript.parser.FindRel(this.elements,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.FindRel.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"elements","elements",657646735),this.elements,null)],null),this.__extmap))};datascript.parser.FindRel.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.FindRel(this.elements,b,this.__extmap,this.__hash)};
datascript.parser.FindRel.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.FindRel.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.FindRel.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.FindRel(datascript.parser.postwalk.call(null,this.elements,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.FindRel.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.elements,c)};
datascript.parser.FindRel.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.elements)};datascript.parser.FindRel.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"elements","elements",-1996789034,null)],null)};datascript.parser.FindRel.cljs$lang$type=!0;
datascript.parser.FindRel.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/FindRel",null,1,null)};datascript.parser.FindRel.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/FindRel")};datascript.parser.__GT_FindRel=function(a){return new datascript.parser.FindRel(a,null,null,null)};
datascript.parser.map__GT_FindRel=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"elements","elements",657646735));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.FindRel((new cljs.core.Keyword(null,"elements","elements",657646735)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.FindColl=function(a,b,c,d){this.element=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.FindColl.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.FindColl.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "element":return this.element;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.FindColl.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.FindColl{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"element","element",1974019749),this.element],null)],null),this.__extmap))};datascript.parser.FindColl.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"element","element",1974019749)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.FindColl.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.FindColl.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.FindColl(this.element,this.__meta,this.__extmap,this.__hash)};datascript.parser.FindColl.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.FindColl.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 124241361^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.FindColl.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.element,b.element)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.FindColl.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"element","element",1974019749),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.FindColl(this.element,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.FindColl.prototype.datascript$parser$IFindElements$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindColl.prototype.datascript$parser$IFindElements$find_elements$arity$1=function(a){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[this.element],null)};
datascript.parser.FindColl.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"element","element",1974019749),b))?new datascript.parser.FindColl(c,this.__meta,this.__extmap,null):new datascript.parser.FindColl(this.element,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.FindColl.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"element","element",1974019749),this.element,null)],null),this.__extmap))};datascript.parser.FindColl.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.FindColl(this.element,b,this.__extmap,this.__hash)};
datascript.parser.FindColl.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.FindColl.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.FindColl.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.FindColl(datascript.parser.postwalk.call(null,this.element,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.FindColl.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.element,c)};
datascript.parser.FindColl.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.element)};datascript.parser.FindColl.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"element","element",-680416020,null)],null)};datascript.parser.FindColl.cljs$lang$type=!0;
datascript.parser.FindColl.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/FindColl",null,1,null)};datascript.parser.FindColl.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/FindColl")};datascript.parser.__GT_FindColl=function(a){return new datascript.parser.FindColl(a,null,null,null)};
datascript.parser.map__GT_FindColl=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"element","element",1974019749));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.FindColl((new cljs.core.Keyword(null,"element","element",1974019749)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.FindScalar=function(a,b,c,d){this.element=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.FindScalar.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.FindScalar.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "element":return this.element;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.FindScalar.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.FindScalar{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"element","element",1974019749),this.element],null)],null),this.__extmap))};datascript.parser.FindScalar.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"element","element",1974019749)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.FindScalar.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.FindScalar.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.FindScalar(this.element,this.__meta,this.__extmap,this.__hash)};datascript.parser.FindScalar.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.FindScalar.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-661542332^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.FindScalar.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.element,b.element)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.FindScalar.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"element","element",1974019749),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.FindScalar(this.element,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.FindScalar.prototype.datascript$parser$IFindElements$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindScalar.prototype.datascript$parser$IFindElements$find_elements$arity$1=function(a){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[this.element],null)};
datascript.parser.FindScalar.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"element","element",1974019749),b))?new datascript.parser.FindScalar(c,this.__meta,this.__extmap,null):new datascript.parser.FindScalar(this.element,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.FindScalar.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"element","element",1974019749),this.element,null)],null),this.__extmap))};
datascript.parser.FindScalar.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.FindScalar(this.element,b,this.__extmap,this.__hash)};datascript.parser.FindScalar.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.FindScalar.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindScalar.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.FindScalar(datascript.parser.postwalk.call(null,this.element,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.FindScalar.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.element,c)};datascript.parser.FindScalar.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.element)};
datascript.parser.FindScalar.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"element","element",-680416020,null)],null)};datascript.parser.FindScalar.cljs$lang$type=!0;datascript.parser.FindScalar.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/FindScalar",null,1,null)};datascript.parser.FindScalar.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/FindScalar")};
datascript.parser.__GT_FindScalar=function(a){return new datascript.parser.FindScalar(a,null,null,null)};
datascript.parser.map__GT_FindScalar=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"element","element",1974019749));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.FindScalar((new cljs.core.Keyword(null,"element","element",1974019749)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.FindTuple=function(a,b,c,d){this.elements=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.FindTuple.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.FindTuple.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "elements":return this.elements;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.FindTuple.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.FindTuple{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"elements","elements",657646735),this.elements],null)],null),this.__extmap))};datascript.parser.FindTuple.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"elements","elements",657646735)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.FindTuple.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.FindTuple.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.FindTuple(this.elements,this.__meta,this.__extmap,this.__hash)};datascript.parser.FindTuple.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.FindTuple.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 681530371^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.FindTuple.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.elements,b.elements)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.FindTuple.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"elements","elements",657646735),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.FindTuple(this.elements,this.__meta,cljs.core.not_empty.call(null,
cljs.core.dissoc.call(null,this.__extmap,b)),null)};datascript.parser.FindTuple.prototype.datascript$parser$IFindElements$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindTuple.prototype.datascript$parser$IFindElements$find_elements$arity$1=function(a){return this.elements};
datascript.parser.FindTuple.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"elements","elements",657646735),b))?new datascript.parser.FindTuple(c,this.__meta,this.__extmap,null):new datascript.parser.FindTuple(this.elements,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.FindTuple.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"elements","elements",657646735),this.elements,null)],null),this.__extmap))};
datascript.parser.FindTuple.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.FindTuple(this.elements,b,this.__extmap,this.__hash)};datascript.parser.FindTuple.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.FindTuple.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindTuple.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.FindTuple(datascript.parser.postwalk.call(null,this.elements,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.FindTuple.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.elements,c)};datascript.parser.FindTuple.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.elements)};
datascript.parser.FindTuple.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"elements","elements",-1996789034,null)],null)};datascript.parser.FindTuple.cljs$lang$type=!0;datascript.parser.FindTuple.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/FindTuple",null,1,null)};datascript.parser.FindTuple.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/FindTuple")};
datascript.parser.__GT_FindTuple=function(a){return new datascript.parser.FindTuple(a,null,null,null)};
datascript.parser.map__GT_FindTuple=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"elements","elements",657646735));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.FindTuple((new cljs.core.Keyword(null,"elements","elements",657646735)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.find_vars=function(a){return cljs.core.mapcat.call(null,datascript.parser._find_vars,datascript.parser.find_elements.call(null,a))};datascript.parser.aggregate_QMARK_=function(a){return a instanceof datascript.parser.Aggregate};datascript.parser.pull_QMARK_=function(a){return a instanceof datascript.parser.Pull};
datascript.parser.parse_aggregate=function(a){if(cljs.core.sequential_QMARK_.call(null,a)&&2<=cljs.core.count.call(null,a)){var b=cljs.core.seq.call(null,a);a=cljs.core.first.call(null,b);b=cljs.core.next.call(null,b);a=datascript.parser.parse_plain_symbol.call(null,a);b=datascript.parser.parse_seq.call(null,datascript.parser.parse_fn_arg,b);return cljs.core.truth_(cljs.core.truth_(a)?b:a)?new datascript.parser.Aggregate(a,b,null,null,null):null}return null};
datascript.parser.parse_aggregate_custom=function(a){if(cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.first.call(null,a),new cljs.core.Symbol(null,"aggregate","aggregate",-1142967327,null))){if(3<=cljs.core.count.call(null,a)){var b=cljs.core.seq.call(null,a);cljs.core.first.call(null,b);var c=cljs.core.next.call(null,b);b=cljs.core.first.call(null,c);c=cljs.core.next.call(null,c);b=datascript.parser.parse_variable.call(null,b);c=datascript.parser.parse_seq.call(null,
datascript.parser.parse_fn_arg,c);if(cljs.core.truth_(cljs.core.truth_(b)?c:b))return new datascript.parser.Aggregate(b,c,null,null,null)}throw cljs.core.ex_info.call(null,"Cannot parse custom aggregate call, expect ['aggregate' variable fn-arg+]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","find","parser/find",-801023103),new cljs.core.Keyword(null,"fragment","fragment",826775688),a],null));}return null};
datascript.parser.parse_pull_expr=function(a){if(cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.first.call(null,a),new cljs.core.Symbol(null,"pull","pull",779986722,null))){if(3<=cljs.core.count.call(null,a)&&4>=cljs.core.count.call(null,a)){var b=cljs.core._EQ_.call(null,cljs.core.count.call(null,a),4),c=b?cljs.core.nth.call(null,a,1):new cljs.core.Symbol(null,"$","$",-1580747756,null);b=b?cljs.core.nnext.call(null,a):cljs.core.next.call(null,a);var d=cljs.core.nth.call(null,
b,0,null);b=cljs.core.nth.call(null,b,1,null);c=datascript.parser.parse_src_var.call(null,c);d=datascript.parser.parse_variable.call(null,d);var e=datascript.parser.parse_variable.call(null,b);cljs.core.truth_(e)?b=e:(e=datascript.parser.parse_plain_variable.call(null,b),b=cljs.core.truth_(e)?e:datascript.parser.parse_constant.call(null,b));if(cljs.core.truth_(cljs.core.truth_(c)?cljs.core.truth_(d)?b:d:c))return new datascript.parser.Pull(c,d,b,null,null,null)}throw cljs.core.ex_info.call(null,"Cannot parse pull expression, expect ['pull' src-var? variable (constant | variable | plain-symbol)]",
new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","find","parser/find",-801023103),new cljs.core.Keyword(null,"fragment","fragment",826775688),a],null));}return null};
datascript.parser.parse_find_elem=function(a){var b=datascript.parser.parse_variable.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_pull_expr.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_aggregate_custom.call(null,a);return cljs.core.truth_(b)?b:datascript.parser.parse_aggregate.call(null,a)};
datascript.parser.parse_find_rel=function(a){a=datascript.parser.parse_seq.call(null,datascript.parser.parse_find_elem,a);return null==a?null:new datascript.parser.FindRel(a,null,null,null)};
datascript.parser.parse_find_coll=function(a){return cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.count.call(null,a),1)&&(a=cljs.core.first.call(null,a),cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.count.call(null,a),2)&&cljs.core._EQ_.call(null,cljs.core.second.call(null,a),new cljs.core.Symbol(null,"...","...",-1926939749,null)))?(a=datascript.parser.parse_find_elem.call(null,cljs.core.first.call(null,a)),null==a?null:new datascript.parser.FindColl(a,
null,null,null)):null};datascript.parser.parse_find_scalar=function(a){return cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.count.call(null,a),2)&&cljs.core._EQ_.call(null,cljs.core.second.call(null,a),new cljs.core.Symbol(null,".",".",1975675962,null))?(a=datascript.parser.parse_find_elem.call(null,cljs.core.first.call(null,a)),null==a?null:new datascript.parser.FindScalar(a,null,null,null)):null};
datascript.parser.parse_find_tuple=function(a){return cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,cljs.core.count.call(null,a),1)?(a=cljs.core.first.call(null,a),a=datascript.parser.parse_seq.call(null,datascript.parser.parse_find_elem,a),null==a?null:new datascript.parser.FindTuple(a,null,null,null)):null};
datascript.parser.parse_find=function(a){var b=datascript.parser.parse_find_rel.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_find_coll.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_find_scalar.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_find_tuple.call(null,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse :find, expected: (find-rel | find-coll | find-tuple | find-scalar)",new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","find","parser/find",-801023103),new cljs.core.Keyword(null,"fragment","fragment",826775688),a],null));};datascript.parser.ReturnMap=function(a,b,c,d,e){this.type=a;this.symbols=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.parser.ReturnMap.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.ReturnMap.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "type":return this.type;case "symbols":return this.symbols;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.ReturnMap.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.ReturnMap{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"type","type",1174270348),this.type],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"symbols","symbols",1211743),this.symbols],null)],null),this.__extmap))};
datascript.parser.ReturnMap.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"symbols","symbols",1211743)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.ReturnMap.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.ReturnMap.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.ReturnMap(this.type,this.symbols,this.__meta,this.__extmap,this.__hash)};datascript.parser.ReturnMap.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.ReturnMap.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-2025547471^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.ReturnMap.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.type,b.type)&&cljs.core._EQ_.call(null,this.symbols,b.symbols)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.ReturnMap.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"type","type",1174270348),null,new cljs.core.Keyword(null,"symbols","symbols",1211743),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.ReturnMap(this.type,
this.symbols,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.ReturnMap.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"type","type",1174270348),b))?new datascript.parser.ReturnMap(c,this.symbols,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"symbols","symbols",1211743),b))?new datascript.parser.ReturnMap(this.type,c,this.__meta,this.__extmap,null):new datascript.parser.ReturnMap(this.type,
this.symbols,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.ReturnMap.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"type","type",1174270348),this.type,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"symbols","symbols",1211743),this.symbols,null)],null),this.__extmap))};
datascript.parser.ReturnMap.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.ReturnMap(this.type,this.symbols,b,this.__extmap,this.__hash)};datascript.parser.ReturnMap.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.ReturnMap.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.ReturnMap.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.ReturnMap(datascript.parser.postwalk.call(null,this.type,b),datascript.parser.postwalk.call(null,this.symbols,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.ReturnMap.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.symbols,datascript.parser.collect.call(null,b,this.type,c))};datascript.parser.ReturnMap.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.type),this.symbols)};
datascript.parser.ReturnMap.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"type","type",-1480165421,null),new cljs.core.Symbol(null,"symbols","symbols",1641743270,null)],null)};datascript.parser.ReturnMap.cljs$lang$type=!0;datascript.parser.ReturnMap.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/ReturnMap",null,1,null)};
datascript.parser.ReturnMap.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/ReturnMap")};datascript.parser.__GT_ReturnMap=function(a,b){return new datascript.parser.ReturnMap(a,b,null,null,null)};
datascript.parser.map__GT_ReturnMap=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"symbols","symbols",1211743));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.ReturnMap((new cljs.core.Keyword(null,"type","type",1174270348)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"symbols","symbols",1211743)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.parse_return_map=function(a,b){if(!cljs.core.empty_QMARK_.call(null,b)&&cljs.core.every_QMARK_.call(null,cljs.core.symbol_QMARK_,b))switch(a instanceof cljs.core.Keyword?a.fqn:null){case "keys":return new datascript.parser.ReturnMap(a,cljs.core.mapv.call(null,cljs.core.keyword,b),null,null,null);case "syms":return new datascript.parser.ReturnMap(a,cljs.core.vec.call(null,b),null,null,null);case "strs":return new datascript.parser.ReturnMap(a,cljs.core.mapv.call(null,cljs.core.str,
b),null,null,null);default:return null}else return null};
datascript.parser.parse_with=function(a){var b=datascript.parser.parse_seq.call(null,datascript.parser.parse_variable,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse :with clause, expected [ variable+ ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","with","parser/with",-386255821),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));};
datascript.parser.parse_in_binding=function(a){var b=datascript.parser.parse_src_var.call(null,a);cljs.core.truth_(b)||(b=datascript.parser.parse_rules_var.call(null,a),b=cljs.core.truth_(b)?b:datascript.parser.parse_plain_variable.call(null,a));return cljs.core.truth_(b)?datascript.parser.with_source.call(null,new datascript.parser.BindScalar(b,null,null,null),a):datascript.parser.parse_binding.call(null,a)};
datascript.parser.parse_in=function(a){var b=datascript.parser.parse_seq.call(null,datascript.parser.parse_in_binding,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse :in clause, expected (src-var | % | plain-symbol | bind-scalar | bind-tuple | bind-coll | bind-rel)",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","in","parser/in",1617442048),new cljs.core.Keyword(null,"form","form",-1624062471),
a],null));};datascript.parser.Pattern=function(a,b,c,d,e){this.source=a;this.pattern=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Pattern.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Pattern.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "source":return this.source;case "pattern":return this.pattern;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Pattern.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Pattern{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"source","source",-433931539),this.source],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"pattern","pattern",242135423),this.pattern],null)],null),this.__extmap))};
datascript.parser.Pattern.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"pattern","pattern",242135423)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Pattern.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Pattern.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Pattern(this.source,this.pattern,this.__meta,this.__extmap,this.__hash)};datascript.parser.Pattern.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Pattern.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 575220587^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Pattern.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.source,b.source)&&cljs.core._EQ_.call(null,this.pattern,b.pattern)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Pattern.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"source","source",-433931539),null,new cljs.core.Keyword(null,"pattern","pattern",242135423),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Pattern(this.source,
this.pattern,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Pattern.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"source","source",-433931539),b))?new datascript.parser.Pattern(c,this.pattern,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"pattern","pattern",242135423),b))?new datascript.parser.Pattern(this.source,c,this.__meta,this.__extmap,null):new datascript.parser.Pattern(this.source,
this.pattern,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.Pattern.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"source","source",-433931539),this.source,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"pattern","pattern",242135423),this.pattern,null)],null),this.__extmap))};
datascript.parser.Pattern.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Pattern(this.source,this.pattern,b,this.__extmap,this.__hash)};datascript.parser.Pattern.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Pattern.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Pattern.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Pattern(datascript.parser.postwalk.call(null,this.source,b),datascript.parser.postwalk.call(null,this.pattern,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Pattern.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.pattern,datascript.parser.collect.call(null,b,this.source,c))};datascript.parser.Pattern.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.source),this.pattern)};
datascript.parser.Pattern.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"source","source",1206599988,null),new cljs.core.Symbol(null,"pattern","pattern",1882666950,null)],null)};datascript.parser.Pattern.cljs$lang$type=!0;datascript.parser.Pattern.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Pattern",null,1,null)};
datascript.parser.Pattern.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Pattern")};datascript.parser.__GT_Pattern=function(a,b){return new datascript.parser.Pattern(a,b,null,null,null)};
datascript.parser.map__GT_Pattern=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"pattern","pattern",242135423));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Pattern((new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.parser.Predicate=function(a,b,c,d,e){this.fn=a;this.args=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Predicate.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Predicate.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "fn":return this.fn;case "args":return this.args;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Predicate.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Predicate{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"fn","fn",-1175266204),this.fn],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"args","args",1315556576),this.args],null)],null),this.__extmap))};
datascript.parser.Predicate.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"fn","fn",-1175266204),new cljs.core.Keyword(null,"args","args",1315556576)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.Predicate.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.Predicate.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Predicate(this.fn,this.args,this.__meta,this.__extmap,this.__hash)};datascript.parser.Predicate.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Predicate.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-1523376880^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Predicate.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.fn,b.fn)&&cljs.core._EQ_.call(null,this.args,b.args)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Predicate.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"args","args",1315556576),null,new cljs.core.Keyword(null,"fn","fn",-1175266204),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Predicate(this.fn,
this.args,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Predicate.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"fn","fn",-1175266204),b))?new datascript.parser.Predicate(c,this.args,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"args","args",1315556576),b))?new datascript.parser.Predicate(this.fn,c,this.__meta,this.__extmap,null):new datascript.parser.Predicate(this.fn,this.args,
this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.Predicate.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"fn","fn",-1175266204),this.fn,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"args","args",1315556576),this.args,null)],null),this.__extmap))};
datascript.parser.Predicate.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Predicate(this.fn,this.args,b,this.__extmap,this.__hash)};datascript.parser.Predicate.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Predicate.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Predicate.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Predicate(datascript.parser.postwalk.call(null,this.fn,b),datascript.parser.postwalk.call(null,this.args,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Predicate.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.args,datascript.parser.collect.call(null,b,this.fn,c))};datascript.parser.Predicate.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.fn),this.args)};
datascript.parser.Predicate.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"fn","fn",465265323,null),new cljs.core.Symbol(null,"args","args",-1338879193,null)],null)};datascript.parser.Predicate.cljs$lang$type=!0;datascript.parser.Predicate.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Predicate",null,1,null)};
datascript.parser.Predicate.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Predicate")};datascript.parser.__GT_Predicate=function(a,b){return new datascript.parser.Predicate(a,b,null,null,null)};
datascript.parser.map__GT_Predicate=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"fn","fn",-1175266204),new cljs.core.Keyword(null,"args","args",1315556576));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Predicate((new cljs.core.Keyword(null,"fn","fn",-1175266204)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"args","args",1315556576)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.parser.Function=function(a,b,c,d,e,f){this.fn=a;this.args=b;this.binding=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Function.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Function.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "fn":return this.fn;case "args":return this.args;case "binding":return this.binding;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Function.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Function{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"fn","fn",-1175266204),this.fn],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"args","args",1315556576),this.args],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"binding","binding",539932593),this.binding],null)],null),this.__extmap))};
datascript.parser.Function.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"fn","fn",-1175266204),new cljs.core.Keyword(null,"args","args",1315556576),new cljs.core.Keyword(null,"binding","binding",539932593)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Function.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Function.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Function(this.fn,this.args,this.binding,this.__meta,this.__extmap,this.__hash)};datascript.parser.Function.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Function.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 589494199^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Function.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.fn,b.fn)&&cljs.core._EQ_.call(null,this.args,b.args)&&cljs.core._EQ_.call(null,this.binding,b.binding)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Function.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"args","args",1315556576),null,new cljs.core.Keyword(null,"fn","fn",-1175266204),null,new cljs.core.Keyword(null,"binding","binding",539932593),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.parser.Function(this.fn,this.args,this.binding,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Function.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"fn","fn",-1175266204),b))?new datascript.parser.Function(c,this.args,this.binding,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"args","args",1315556576),b))?new datascript.parser.Function(this.fn,c,this.binding,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"binding","binding",539932593),b))?new datascript.parser.Function(this.fn,this.args,c,this.__meta,this.__extmap,null):new datascript.parser.Function(this.fn,this.args,this.binding,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Function.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"fn","fn",-1175266204),this.fn,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"args","args",1315556576),this.args,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"binding","binding",539932593),this.binding,null)],null),
this.__extmap))};datascript.parser.Function.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Function(this.fn,this.args,this.binding,b,this.__extmap,this.__hash)};datascript.parser.Function.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Function.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Function.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Function(datascript.parser.postwalk.call(null,this.fn,b),datascript.parser.postwalk.call(null,this.args,b),datascript.parser.postwalk.call(null,this.binding,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Function.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.binding,datascript.parser.collect.call(null,b,this.args,datascript.parser.collect.call(null,b,this.fn,c)))};
datascript.parser.Function.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.fn),this.args),this.binding)};
datascript.parser.Function.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"fn","fn",465265323,null),new cljs.core.Symbol(null,"args","args",-1338879193,null),new cljs.core.Symbol(null,"binding","binding",-2114503176,null)],null)};datascript.parser.Function.cljs$lang$type=!0;datascript.parser.Function.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Function",null,1,null)};
datascript.parser.Function.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Function")};datascript.parser.__GT_Function=function(a,b,c){return new datascript.parser.Function(a,b,c,null,null,null)};
datascript.parser.map__GT_Function=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"fn","fn",-1175266204),new cljs.core.Keyword(null,"args","args",1315556576),new cljs.core.Keyword(null,"binding","binding",539932593));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Function((new cljs.core.Keyword(null,"fn","fn",-1175266204)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"args",
"args",1315556576)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"binding","binding",539932593)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.parser.RuleExpr=function(a,b,c,d,e,f){this.source=a;this.name=b;this.args=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.parser.RuleExpr.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.RuleExpr.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "source":return this.source;case "name":return this.name;case "args":return this.args;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.RuleExpr.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.RuleExpr{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"source","source",-433931539),this.source],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"name","name",1843675177),this.name],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"args","args",1315556576),this.args],null)],null),this.__extmap))};
datascript.parser.RuleExpr.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"name","name",1843675177),new cljs.core.Keyword(null,"args","args",1315556576)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.RuleExpr.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.RuleExpr.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.RuleExpr(this.source,this.name,this.args,this.__meta,this.__extmap,this.__hash)};datascript.parser.RuleExpr.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.parser.RuleExpr.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-444662011^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.RuleExpr.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.source,b.source)&&cljs.core._EQ_.call(null,this.name,b.name)&&cljs.core._EQ_.call(null,this.args,b.args)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.RuleExpr.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"args","args",1315556576),null,new cljs.core.Keyword(null,"name","name",1843675177),null,new cljs.core.Keyword(null,"source","source",-433931539),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.parser.RuleExpr(this.source,this.name,this.args,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.RuleExpr.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"source","source",-433931539),b))?new datascript.parser.RuleExpr(c,this.name,this.args,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"name","name",1843675177),b))?new datascript.parser.RuleExpr(this.source,c,this.args,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"args","args",1315556576),b))?new datascript.parser.RuleExpr(this.source,this.name,c,this.__meta,this.__extmap,null):new datascript.parser.RuleExpr(this.source,this.name,this.args,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.RuleExpr.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"source","source",-433931539),this.source,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"name","name",1843675177),this.name,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"args","args",1315556576),this.args,null)],
null),this.__extmap))};datascript.parser.RuleExpr.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.RuleExpr(this.source,this.name,this.args,b,this.__extmap,this.__hash)};
datascript.parser.RuleExpr.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.RuleExpr.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.RuleExpr.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.RuleExpr(datascript.parser.postwalk.call(null,this.source,b),datascript.parser.postwalk.call(null,this.name,b),datascript.parser.postwalk.call(null,this.args,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.RuleExpr.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.args,datascript.parser.collect.call(null,b,this.name,datascript.parser.collect.call(null,b,this.source,c)))};
datascript.parser.RuleExpr.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.source),this.name),this.args)};
datascript.parser.RuleExpr.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"source","source",1206599988,null),new cljs.core.Symbol(null,"name","name",-810760592,null),new cljs.core.Symbol(null,"args","args",-1338879193,null)],null)};datascript.parser.RuleExpr.cljs$lang$type=!0;datascript.parser.RuleExpr.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/RuleExpr",null,1,null)};
datascript.parser.RuleExpr.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/RuleExpr")};datascript.parser.__GT_RuleExpr=function(a,b,c){return new datascript.parser.RuleExpr(a,b,c,null,null,null)};
datascript.parser.map__GT_RuleExpr=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"name","name",1843675177),new cljs.core.Keyword(null,"args","args",1315556576));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.RuleExpr((new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,
"name","name",1843675177)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"args","args",1315556576)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.parser.Not=function(a,b,c,d,e,f){this.source=a;this.vars=b;this.clauses=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.parser.Not.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.Not.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "source":return this.source;case "vars":return this.vars;case "clauses":return this.clauses;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Not.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Not{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"source","source",-433931539),this.source],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"vars","vars",-2046957217),this.vars],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses],null)],null),this.__extmap))};
datascript.parser.Not.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"vars","vars",-2046957217),new cljs.core.Keyword(null,"clauses","clauses",1454841241)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Not.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Not.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Not(this.source,this.vars,this.clauses,this.__meta,this.__extmap,this.__hash)};datascript.parser.Not.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Not.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1394671061^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Not.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.source,b.source)&&cljs.core._EQ_.call(null,this.vars,b.vars)&&cljs.core._EQ_.call(null,this.clauses,b.clauses)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Not.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"source","source",-433931539),null,new cljs.core.Keyword(null,"clauses","clauses",1454841241),null,new cljs.core.Keyword(null,"vars","vars",-2046957217),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.parser.Not(this.source,this.vars,this.clauses,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Not.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"source","source",-433931539),b))?new datascript.parser.Not(c,this.vars,this.clauses,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"vars","vars",-2046957217),b))?new datascript.parser.Not(this.source,c,this.clauses,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"clauses","clauses",1454841241),b))?new datascript.parser.Not(this.source,this.vars,c,this.__meta,this.__extmap,null):new datascript.parser.Not(this.source,this.vars,this.clauses,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Not.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"source","source",-433931539),this.source,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"vars","vars",-2046957217),this.vars,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses,null)],
null),this.__extmap))};datascript.parser.Not.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Not(this.source,this.vars,this.clauses,b,this.__extmap,this.__hash)};datascript.parser.Not.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Not.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Not.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Not(datascript.parser.postwalk.call(null,this.source,b),datascript.parser.postwalk.call(null,this.vars,b),datascript.parser.postwalk.call(null,this.clauses,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Not.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.clauses,datascript.parser.collect.call(null,b,this.vars,datascript.parser.collect.call(null,b,this.source,c)))};
datascript.parser.Not.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.source),this.vars),this.clauses)};
datascript.parser.Not.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"source","source",1206599988,null),new cljs.core.Symbol(null,"vars","vars",-406425690,null),new cljs.core.Symbol(null,"clauses","clauses",-1199594528,null)],null)};datascript.parser.Not.cljs$lang$type=!0;datascript.parser.Not.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Not",null,1,null)};
datascript.parser.Not.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Not")};datascript.parser.__GT_Not=function(a,b,c){return new datascript.parser.Not(a,b,c,null,null,null)};
datascript.parser.map__GT_Not=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"vars","vars",-2046957217),new cljs.core.Keyword(null,"clauses","clauses",1454841241));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Not((new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,
"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.parser.Or=function(a,b,c,d,e,f){this.source=a;this.rule_vars=b;this.clauses=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.parser.Or.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.Or.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "source":return this.source;case "rule-vars":return this.rule_vars;case "clauses":return this.clauses;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Or.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Or{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"source","source",-433931539),this.source],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520),this.rule_vars],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses],null)],null),this.__extmap))};
datascript.parser.Or.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520),new cljs.core.Keyword(null,"clauses","clauses",1454841241)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.Or.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Or.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Or(this.source,this.rule_vars,this.clauses,this.__meta,this.__extmap,this.__hash)};datascript.parser.Or.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Or.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1461934571^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Or.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.source,b.source)&&cljs.core._EQ_.call(null,this.rule_vars,b.rule_vars)&&cljs.core._EQ_.call(null,this.clauses,b.clauses)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Or.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520),null,new cljs.core.Keyword(null,"source","source",-433931539),null,new cljs.core.Keyword(null,"clauses","clauses",1454841241),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.parser.Or(this.source,this.rule_vars,this.clauses,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Or.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"source","source",-433931539),b))?new datascript.parser.Or(c,this.rule_vars,this.clauses,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520),b))?new datascript.parser.Or(this.source,c,this.clauses,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"clauses","clauses",1454841241),b))?new datascript.parser.Or(this.source,this.rule_vars,c,this.__meta,this.__extmap,null):new datascript.parser.Or(this.source,this.rule_vars,this.clauses,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Or.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"source","source",-433931539),this.source,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520),this.rule_vars,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses,
null)],null),this.__extmap))};datascript.parser.Or.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Or(this.source,this.rule_vars,this.clauses,b,this.__extmap,this.__hash)};datascript.parser.Or.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Or.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Or.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Or(datascript.parser.postwalk.call(null,this.source,b),datascript.parser.postwalk.call(null,this.rule_vars,b),datascript.parser.postwalk.call(null,this.clauses,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Or.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.clauses,datascript.parser.collect.call(null,b,this.rule_vars,datascript.parser.collect.call(null,b,this.source,c)))};
datascript.parser.Or.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.source),this.rule_vars),this.clauses)};
datascript.parser.Or.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"source","source",1206599988,null),new cljs.core.Symbol(null,"rule-vars","rule-vars",-988463249,null),new cljs.core.Symbol(null,"clauses","clauses",-1199594528,null)],null)};datascript.parser.Or.cljs$lang$type=!0;datascript.parser.Or.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Or",null,1,null)};
datascript.parser.Or.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Or")};datascript.parser.__GT_Or=function(a,b,c){return new datascript.parser.Or(a,b,c,null,null,null)};
datascript.parser.map__GT_Or=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"source","source",-433931539),new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520),new cljs.core.Keyword(null,"clauses","clauses",1454841241));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Or((new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,
"rule-vars","rule-vars",1665972520)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.parser.And=function(a,b,c,d){this.clauses=a;this.__meta=b;this.__extmap=c;this.__hash=d;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.parser.And.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.parser.And.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "clauses":return this.clauses;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.And.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.And{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"clauses","clauses",1454841241),this.clauses],null)],null),this.__extmap))};datascript.parser.And.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,1,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"clauses","clauses",1454841241)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.And.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.And.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.And(this.clauses,this.__meta,this.__extmap,this.__hash)};datascript.parser.And.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 1+cljs.core.count.call(null,this.__extmap)};
datascript.parser.And.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-131856804^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};datascript.parser.And.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.clauses,b.clauses)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.And.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"clauses","clauses",1454841241),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.And(this.clauses,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,
this.__extmap,b)),null)};datascript.parser.And.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){return cljs.core.truth_(cljs.core.keyword_identical_QMARK_.call(null,new cljs.core.Keyword(null,"clauses","clauses",1454841241),b))?new datascript.parser.And(c,this.__meta,this.__extmap,null):new datascript.parser.And(this.clauses,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.And.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses,null)],null),this.__extmap))};datascript.parser.And.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.And(this.clauses,b,this.__extmap,this.__hash)};
datascript.parser.And.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.And.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.And.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.And(datascript.parser.postwalk.call(null,this.clauses,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};datascript.parser.And.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.clauses,c)};
datascript.parser.And.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,b,this.clauses)};datascript.parser.And.getBasis=function(){return new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"clauses","clauses",-1199594528,null)],null)};datascript.parser.And.cljs$lang$type=!0;
datascript.parser.And.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/And",null,1,null)};datascript.parser.And.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/And")};datascript.parser.__GT_And=function(a){return new datascript.parser.And(a,null,null,null)};
datascript.parser.map__GT_And=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"clauses","clauses",1454841241));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.And((new cljs.core.Keyword(null,"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.parse_pattern_el=function(a){var b=datascript.parser.parse_placeholder.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_variable.call(null,a);return cljs.core.truth_(b)?b:datascript.parser.parse_constant.call(null,a)};
datascript.parser.take_source=function(a){if(cljs.core.sequential_QMARK_.call(null,a)){var b=datascript.parser.parse_src_var.call(null,cljs.core.first.call(null,a));return cljs.core.truth_(b)?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,cljs.core.next.call(null,a)],null):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new datascript.parser.DefaultSrc(null,null,null),a],null)}return null};
datascript.parser.parse_pattern=function(a){var b=datascript.parser.take_source.call(null,a);if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);b=datascript.parser.parse_seq.call(null,datascript.parser.parse_pattern_el,b);if(cljs.core.truth_(b)){if(cljs.core.empty_QMARK_.call(null,b))throw cljs.core.ex_info.call(null,"Pattern could not be empty",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser",
"where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));return datascript.parser.with_source.call(null,new datascript.parser.Pattern(c,b,null,null,null),a)}}return null};
datascript.parser.parse_call=function(a){if(cljs.core.sequential_QMARK_.call(null,a)){var b=cljs.core.seq.call(null,a);a=cljs.core.first.call(null,b);b=cljs.core.next.call(null,b);b=null==b?cljs.core.PersistentVector.EMPTY:b;var c=datascript.parser.parse_plain_symbol.call(null,a);a=cljs.core.truth_(c)?c:datascript.parser.parse_variable.call(null,a);b=datascript.parser.parse_seq.call(null,datascript.parser.parse_fn_arg,b);return cljs.core.truth_(cljs.core.truth_(a)?b:a)?new cljs.core.PersistentVector(null,
2,5,cljs.core.PersistentVector.EMPTY_NODE,[a,b],null):null}return null};datascript.parser.parse_pred=function(a){if(cljs.core.truth_(datascript.parser.of_size_QMARK_.call(null,a,1))){var b=datascript.parser.parse_call.call(null,cljs.core.first.call(null,a));if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);return datascript.parser.with_source.call(null,new datascript.parser.Predicate(c,b,null,null,null),a)}}return null};
datascript.parser.parse_fn=function(a){if(cljs.core.truth_(datascript.parser.of_size_QMARK_.call(null,a,2))){var b=cljs.core.nth.call(null,a,0,null),c=cljs.core.nth.call(null,a,1,null),d=datascript.parser.parse_call.call(null,b);if(cljs.core.truth_(d))return b=cljs.core.nth.call(null,d,0,null),d=cljs.core.nth.call(null,d,1,null),c=datascript.parser.parse_binding.call(null,c),cljs.core.truth_(c)?datascript.parser.with_source.call(null,new datascript.parser.Function(b,d,c,null,null,null),a):null}return null};
datascript.parser.parse_rule_expr=function(a){var b=datascript.parser.take_source.call(null,a);if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);b=cljs.core.seq.call(null,b);var d=cljs.core.first.call(null,b);b=cljs.core.next.call(null,b);d=datascript.parser.parse_plain_symbol.call(null,d);var e=datascript.parser.parse_seq.call(null,datascript.parser.parse_pattern_el,b);if(cljs.core.truth_(d)){if(cljs.core.empty_QMARK_.call(null,b))throw cljs.core.ex_info.call(null,
"rule-expr requires at least one argument",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));if(null==e)throw cljs.core.ex_info.call(null,"Cannot parse rule-expr arguments, expected [ (variable | constant | '_')+ ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser",
"where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));return new datascript.parser.RuleExpr(c,d,e,null,null,null)}}return null};
datascript.parser.collect_vars_acc=function(a,b){return b instanceof datascript.parser.Variable?cljs.core.conj.call(null,a,b):b instanceof datascript.parser.Not?cljs.core.into.call(null,a,(new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(b)):b instanceof datascript.parser.Or?datascript.parser.collect_vars_acc.call(null,a,(new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520)).cljs$core$IFn$_invoke$arity$1(b)):(null!=b?cljs.core.PROTOCOL_SENTINEL===b.datascript$parser$ITraversable$||
(b.cljs$lang$protocol_mask$partition$?0:cljs.core.native_satisfies_QMARK_.call(null,datascript.parser.ITraversable,b)):cljs.core.native_satisfies_QMARK_.call(null,datascript.parser.ITraversable,b))?datascript.parser._collect_vars.call(null,b,a):cljs.core.sequential_QMARK_.call(null,b)?cljs.core.reduce.call(null,datascript.parser.collect_vars_acc,a,b):a};datascript.parser.collect_vars=function(a){return datascript.parser.collect_vars_acc.call(null,cljs.core.PersistentVector.EMPTY,a)};
datascript.parser.collect_vars_distinct=function(a){return cljs.core.vec.call(null,cljs.core.distinct.call(null,datascript.parser.collect_vars.call(null,a)))};
datascript.parser.validate_join_vars=function(a,b,c){if(cljs.core.empty_QMARK_.call(null,a)&&cljs.core.empty_QMARK_.call(null,b))throw cljs.core.ex_info.call(null,"Join variables should not be empty",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),c],null));return null};
datascript.parser.validate_not=function(a,b){datascript.parser.validate_join_vars.call(null,null,(new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(a),b);return a};
datascript.parser.parse_not=function(a){var b=datascript.parser.take_source.call(null,a);if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);var d=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,d);d=cljs.core.next.call(null,d);if(cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"not","not",1044554643,null),b)){b=datascript.parser.parse_clauses.call(null,d);if(cljs.core.truth_(b))return datascript.parser.validate_not.call(null,datascript.parser.with_source.call(null,
new datascript.parser.Not(c,datascript.parser.collect_vars_distinct.call(null,b),b,null,null,null),a),a);throw cljs.core.ex_info.call(null,"Cannot parse 'not' clause, expected [ src-var? 'not' clause+ ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}}return null};
datascript.parser.parse_not_join=function(a){var b=datascript.parser.take_source.call(null,a);if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);var d=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,d);var e=cljs.core.next.call(null,d);d=cljs.core.first.call(null,e);e=cljs.core.next.call(null,e);if(cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"not-join","not-join",-645515756,null),b)){b=datascript.parser.parse_seq.call(null,datascript.parser.parse_variable,
d);d=datascript.parser.parse_clauses.call(null,e);if(cljs.core.truth_(cljs.core.truth_(b)?d:b))return datascript.parser.validate_not.call(null,datascript.parser.with_source.call(null,new datascript.parser.Not(c,b,d,null,null,null),a),a);throw cljs.core.ex_info.call(null,"Cannot parse 'not-join' clause, expected [ src-var? 'not-join' [variable+] clause+ ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",
-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}}return null};
datascript.parser.validate_or=function(a,b){var c=null!=a&&(a.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,a):a;c=cljs.core.get.call(null,c,new cljs.core.Keyword(null,"rule-vars","rule-vars",1665972520));var d=null!=c&&(c.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===c.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,c):c;c=cljs.core.get.call(null,d,new cljs.core.Keyword(null,
"required","required",1807647006));d=cljs.core.get.call(null,d,new cljs.core.Keyword(null,"free","free",801364328));datascript.parser.validate_join_vars.call(null,c,d,b);return a};
datascript.parser.parse_and=function(a){if(cljs.core.sequential_QMARK_.call(null,a)&&cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"and","and",668631710,null),cljs.core.first.call(null,a))){var b=datascript.parser.parse_clauses.call(null,cljs.core.next.call(null,a));if(cljs.core.truth_(cljs.core.not_empty.call(null,b)))return new datascript.parser.And(b,null,null,null);throw cljs.core.ex_info.call(null,"Cannot parse 'and' clause, expected [ 'and' clause+ ]",new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}return null};
datascript.parser.parse_or=function(a){var b=datascript.parser.take_source.call(null,a);if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);var d=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,d);d=cljs.core.next.call(null,d);if(cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"or","or",1876275696,null),b)){b=datascript.parser.parse_seq.call(null,cljs.core.some_fn.call(null,datascript.parser.parse_and,datascript.parser.parse_clause),d);if(cljs.core.truth_(b))return datascript.parser.validate_or.call(null,
datascript.parser.with_source.call(null,new datascript.parser.Or(c,new datascript.parser.RuleVars(null,datascript.parser.collect_vars_distinct.call(null,b),null,null,null),b,null,null,null),a),a);throw cljs.core.ex_info.call(null,"Cannot parse 'or' clause, expected [ src-var? 'or' clause+ ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),
a],null));}}return null};
datascript.parser.parse_or_join=function(a){var b=datascript.parser.take_source.call(null,a);if(cljs.core.truth_(b)){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);var d=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,d);var e=cljs.core.next.call(null,d);d=cljs.core.first.call(null,e);e=cljs.core.next.call(null,e);if(cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"or-join","or-join",591375469,null),b)){b=datascript.parser.parse_rule_vars.call(null,d);d=datascript.parser.parse_seq.call(null,
cljs.core.some_fn.call(null,datascript.parser.parse_and,datascript.parser.parse_clause),e);if(cljs.core.truth_(cljs.core.truth_(b)?d:b))return datascript.parser.validate_or.call(null,datascript.parser.with_source.call(null,new datascript.parser.Or(c,b,d,null,null,null),a),a);throw cljs.core.ex_info.call(null,"Cannot parse 'or-join' clause, expected [ src-var? 'or-join' [variable+] clause+ ]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser",
"where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}}return null};
datascript.parser.parse_clause=function(a){var b=datascript.parser.parse_not.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_not_join.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_or.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_or_join.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_pred.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_fn.call(null,a);if(cljs.core.truth_(b))return b;
b=datascript.parser.parse_rule_expr.call(null,a);if(cljs.core.truth_(b))return b;b=datascript.parser.parse_pattern.call(null,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse clause, expected (data-pattern | pred-expr | fn-expr | rule-expr | not-clause | not-join-clause | or-clause | or-join-clause)",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,
"form","form",-1624062471),a],null));};datascript.parser.parse_clauses=function(a){return datascript.parser.parse_seq.call(null,datascript.parser.parse_clause,a)};
datascript.parser.parse_where=function(a){var b=datascript.parser.parse_clauses.call(null,a);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse :where clause, expected [clause+]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","where","parser/where",-966053850),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));};
datascript.parser.RuleBranch=function(a,b,c,d,e){this.vars=a;this.clauses=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.RuleBranch.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.RuleBranch.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "vars":return this.vars;case "clauses":return this.clauses;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.RuleBranch.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.RuleBranch{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"vars","vars",-2046957217),this.vars],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses],null)],null),this.__extmap))};
datascript.parser.RuleBranch.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"vars","vars",-2046957217),new cljs.core.Keyword(null,"clauses","clauses",1454841241)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.parser.RuleBranch.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.RuleBranch.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.RuleBranch(this.vars,this.clauses,this.__meta,this.__extmap,this.__hash)};datascript.parser.RuleBranch.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.RuleBranch.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1024755006^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.RuleBranch.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.vars,b.vars)&&cljs.core._EQ_.call(null,this.clauses,b.clauses)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.RuleBranch.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"clauses","clauses",1454841241),null,new cljs.core.Keyword(null,"vars","vars",-2046957217),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.RuleBranch(this.vars,
this.clauses,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.RuleBranch.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"vars","vars",-2046957217),b))?new datascript.parser.RuleBranch(c,this.clauses,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"clauses","clauses",1454841241),b))?new datascript.parser.RuleBranch(this.vars,c,this.__meta,this.__extmap,null):new datascript.parser.RuleBranch(this.vars,
this.clauses,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.RuleBranch.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"vars","vars",-2046957217),this.vars,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"clauses","clauses",1454841241),this.clauses,null)],null),this.__extmap))};
datascript.parser.RuleBranch.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.RuleBranch(this.vars,this.clauses,b,this.__extmap,this.__hash)};datascript.parser.RuleBranch.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.RuleBranch.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.RuleBranch.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.RuleBranch(datascript.parser.postwalk.call(null,this.vars,b),datascript.parser.postwalk.call(null,this.clauses,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.RuleBranch.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.clauses,datascript.parser.collect.call(null,b,this.vars,c))};datascript.parser.RuleBranch.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.vars),this.clauses)};
datascript.parser.RuleBranch.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"vars","vars",-406425690,null),new cljs.core.Symbol(null,"clauses","clauses",-1199594528,null)],null)};datascript.parser.RuleBranch.cljs$lang$type=!0;datascript.parser.RuleBranch.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/RuleBranch",null,1,null)};
datascript.parser.RuleBranch.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/RuleBranch")};datascript.parser.__GT_RuleBranch=function(a,b){return new datascript.parser.RuleBranch(a,b,null,null,null)};
datascript.parser.map__GT_RuleBranch=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"vars","vars",-2046957217),new cljs.core.Keyword(null,"clauses","clauses",1454841241));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.RuleBranch((new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.parser.Rule=function(a,b,c,d,e){this.name=a;this.branches=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Rule.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Rule.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "name":return this.name;case "branches":return this.branches;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Rule.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Rule{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"name","name",1843675177),this.name],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"branches","branches",-1240337268),this.branches],null)],null),this.__extmap))};
datascript.parser.Rule.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"name","name",1843675177),new cljs.core.Keyword(null,"branches","branches",-1240337268)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.Rule.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};
datascript.parser.Rule.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Rule(this.name,this.branches,this.__meta,this.__extmap,this.__hash)};datascript.parser.Rule.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.parser.Rule.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return-900273052^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Rule.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.name,b.name)&&cljs.core._EQ_.call(null,this.branches,b.branches)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Rule.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"name","name",1843675177),null,new cljs.core.Keyword(null,"branches","branches",-1240337268),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Rule(this.name,
this.branches,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Rule.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"name","name",1843675177),b))?new datascript.parser.Rule(c,this.branches,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"branches","branches",-1240337268),b))?new datascript.parser.Rule(this.name,c,this.__meta,this.__extmap,null):new datascript.parser.Rule(this.name,this.branches,
this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.parser.Rule.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"name","name",1843675177),this.name,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"branches","branches",-1240337268),this.branches,null)],null),this.__extmap))};
datascript.parser.Rule.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Rule(this.name,this.branches,b,this.__extmap,this.__hash)};datascript.parser.Rule.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.parser.Rule.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Rule.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Rule(datascript.parser.postwalk.call(null,this.name,b),datascript.parser.postwalk.call(null,this.branches,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Rule.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.branches,datascript.parser.collect.call(null,b,this.name,c))};datascript.parser.Rule.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.name),this.branches)};
datascript.parser.Rule.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"name","name",-810760592,null),new cljs.core.Symbol(null,"branches","branches",400194259,null)],null)};datascript.parser.Rule.cljs$lang$type=!0;datascript.parser.Rule.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Rule",null,1,null)};
datascript.parser.Rule.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Rule")};datascript.parser.__GT_Rule=function(a,b){return new datascript.parser.Rule(a,b,null,null,null)};
datascript.parser.map__GT_Rule=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"name","name",1843675177),new cljs.core.Keyword(null,"branches","branches",-1240337268));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Rule((new cljs.core.Keyword(null,"name","name",1843675177)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"branches","branches",-1240337268)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.parse_rule=function(a){if(cljs.core.sequential_QMARK_.call(null,a)){var b=cljs.core.seq.call(null,a),c=cljs.core.first.call(null,b),d=cljs.core.next.call(null,b);if(cljs.core.sequential_QMARK_.call(null,c)){b=cljs.core.seq.call(null,c);var e=cljs.core.first.call(null,b);c=cljs.core.next.call(null,b);b=function(){var b=datascript.parser.parse_plain_symbol.call(null,e);if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Cannot parse rule name, expected plain-symbol",new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule","parser/rule",-464044566),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}();c=datascript.parser.parse_rule_vars.call(null,c);var f=function(){var b=cljs.core.not_empty.call(null,datascript.parser.parse_clauses.call(null,d));if(cljs.core.truth_(b))return b;throw cljs.core.ex_info.call(null,"Rule branch should have clauses",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,
"error","error",-978969032),new cljs.core.Keyword("parser","rule","parser/rule",-464044566),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}();return new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"name","name",1843675177),b,new cljs.core.Keyword(null,"vars","vars",-2046957217),c,new cljs.core.Keyword(null,"clauses","clauses",1454841241),f],null)}throw cljs.core.ex_info.call(null,["Cannot parse rule head, expected [rule-name rule-vars], got: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
c))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule","parser/rule",-464044566),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));}throw cljs.core.ex_info.call(null,"Cannot parse rule, expected [rule-head clause+]",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule","parser/rule",-464044566),new cljs.core.Keyword(null,
"form","form",-1624062471),a],null));};
datascript.parser.validate_arity=function(a,b){var c=(new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(cljs.core.first.call(null,b)),d=datascript.parser.rule_vars_arity.call(null,c);b=cljs.core.seq.call(null,cljs.core.next.call(null,b));for(var e=null,f=0,g=0;;)if(g<f){var h=cljs.core._nth.call(null,e,g);h=(new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(h);if(cljs.core.not_EQ_.call(null,d,datascript.parser.rule_vars_arity.call(null,
h)))throw cljs.core.ex_info.call(null,["Arity mismatch for rule '",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,(new cljs.core.Keyword(null,"symbol","symbol",-1038572696)).cljs$core$IFn$_invoke$arity$1(a))),"': ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,datascript.parser.flatten_rule_vars.call(null,c)))," vs. ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,datascript.parser.flatten_rule_vars.call(null,h)))].join(""),
new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule","parser/rule",-464044566),new cljs.core.Keyword(null,"rule","rule",729973257),a],null));g+=1}else if(b=cljs.core.seq.call(null,b)){if(cljs.core.chunked_seq_QMARK_.call(null,b))f=cljs.core.chunk_first.call(null,b),b=cljs.core.chunk_rest.call(null,b),e=f,f=cljs.core.count.call(null,f);else{h=cljs.core.first.call(null,b);e=(new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(h);
if(cljs.core.not_EQ_.call(null,d,datascript.parser.rule_vars_arity.call(null,e)))throw cljs.core.ex_info.call(null,["Arity mismatch for rule '",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,(new cljs.core.Keyword(null,"symbol","symbol",-1038572696)).cljs$core$IFn$_invoke$arity$1(a))),"': ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,datascript.parser.flatten_rule_vars.call(null,c)))," vs. ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
datascript.parser.flatten_rule_vars.call(null,e)))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","rule","parser/rule",-464044566),new cljs.core.Keyword(null,"rule","rule",729973257),a],null));b=cljs.core.next.call(null,b);e=null;f=0}g=0}else return null};
datascript.parser.parse_rules=function(a){return cljs.core.vec.call(null,function(){return function d(a){return new cljs.core.LazySeq(null,function(){for(;;){var c=cljs.core.seq.call(null,a);if(c){var f=c;if(cljs.core.chunked_seq_QMARK_.call(null,f)){var g=cljs.core.chunk_first.call(null,f),h=cljs.core.count.call(null,g),k=cljs.core.chunk_buffer.call(null,h);return function(){for(var a=0;;)if(a<h){var d=cljs.core._nth.call(null,g,a),e=cljs.core.nth.call(null,d,0,null),l=cljs.core.nth.call(null,d,
1,null),m=cljs.core.mapv.call(null,function(a,c,d,e,f,g,h,k,l){return function(a){return new datascript.parser.RuleBranch((new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(a),null,null,null)}}(a,d,e,l,g,h,k,f,c),l);cljs.core.chunk_append.call(null,k,function(){datascript.parser.validate_arity.call(null,e,m);return new datascript.parser.Rule(e,m,null,null,null)}());a+=1}else return!0}()?
cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,k),d.call(null,cljs.core.chunk_rest.call(null,f))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,k),null)}var l=cljs.core.first.call(null,f),m=cljs.core.nth.call(null,l,0,null),n=cljs.core.nth.call(null,l,1,null),p=cljs.core.mapv.call(null,function(a,c,d,e,f){return function(a){return new datascript.parser.RuleBranch((new cljs.core.Keyword(null,"vars","vars",-2046957217)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,
"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(a),null,null,null)}}(l,m,n,f,c),n);return cljs.core.cons.call(null,function(){datascript.parser.validate_arity.call(null,m,p);return new datascript.parser.Rule(m,p,null,null,null)}(),d.call(null,cljs.core.rest.call(null,f)))}return null}},null,null)}.call(null,cljs.core.group_by.call(null,new cljs.core.Keyword(null,"name","name",1843675177),datascript.parser.parse_seq.call(null,datascript.parser.parse_rule,a)))}())};
datascript.parser.Query=function(a,b,c,d,e,f,g,h){this.qfind=a;this.qwith=b;this.qreturn_map=c;this.qin=d;this.qwhere=e;this.__meta=f;this.__extmap=g;this.__hash=h;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.parser.Query.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.parser.Query.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "qfind":return this.qfind;case "qwith":return this.qwith;case "qreturn-map":return this.qreturn_map;case "qin":return this.qin;case "qwhere":return this.qwhere;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.parser.Query.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.parser.Query{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"qfind","qfind",1529332972),this.qfind],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"qwith","qwith",-45809392),this.qwith],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),this.qreturn_map],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"qin","qin",1372651151),this.qin],
null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378),this.qwhere],null)],null),this.__extmap))};
datascript.parser.Query.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,5,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"qfind","qfind",1529332972),new cljs.core.Keyword(null,"qwith","qwith",-45809392),new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),new cljs.core.Keyword(null,"qin","qin",1372651151),new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378)],null),cljs.core.truth_(this.__extmap)?
cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};datascript.parser.Query.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.parser.Query.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.parser.Query(this.qfind,this.qwith,this.qreturn_map,this.qin,this.qwhere,this.__meta,this.__extmap,this.__hash)};
datascript.parser.Query.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 5+cljs.core.count.call(null,this.__extmap)};datascript.parser.Query.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 181307977^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.parser.Query.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.qfind,b.qfind)&&cljs.core._EQ_.call(null,this.qwith,b.qwith)&&cljs.core._EQ_.call(null,this.qreturn_map,b.qreturn_map)&&cljs.core._EQ_.call(null,this.qin,b.qin)&&cljs.core._EQ_.call(null,this.qwhere,b.qwhere)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.parser.Query.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,5,[new cljs.core.Keyword(null,"qfind","qfind",1529332972),null,new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378),null,new cljs.core.Keyword(null,"qin","qin",1372651151),null,new cljs.core.Keyword(null,"qwith","qwith",-45809392),null,new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),
null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.parser.Query(this.qfind,this.qwith,this.qreturn_map,this.qin,this.qwhere,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.parser.Query.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"qfind","qfind",1529332972),b))?new datascript.parser.Query(c,this.qwith,this.qreturn_map,this.qin,this.qwhere,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"qwith","qwith",-45809392),b))?new datascript.parser.Query(this.qfind,c,this.qreturn_map,this.qin,this.qwhere,this.__meta,
this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),b))?new datascript.parser.Query(this.qfind,this.qwith,c,this.qin,this.qwhere,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"qin","qin",1372651151),b))?new datascript.parser.Query(this.qfind,this.qwith,this.qreturn_map,c,this.qwhere,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378),
b))?new datascript.parser.Query(this.qfind,this.qwith,this.qreturn_map,this.qin,c,this.__meta,this.__extmap,null):new datascript.parser.Query(this.qfind,this.qwith,this.qreturn_map,this.qin,this.qwhere,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.parser.Query.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"qfind","qfind",1529332972),this.qfind,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"qwith","qwith",-45809392),this.qwith,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),this.qreturn_map,
null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"qin","qin",1372651151),this.qin,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378),this.qwhere,null)],null),this.__extmap))};datascript.parser.Query.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.parser.Query(this.qfind,this.qwith,this.qreturn_map,this.qin,this.qwhere,b,this.__extmap,this.__hash)};
datascript.parser.Query.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};datascript.parser.Query.prototype.datascript$parser$ITraversable$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.Query.prototype.datascript$parser$ITraversable$_postwalk$arity$2=function(a,b){a=new datascript.parser.Query(datascript.parser.postwalk.call(null,this.qfind,b),datascript.parser.postwalk.call(null,this.qwith,b),datascript.parser.postwalk.call(null,this.qreturn_map,b),datascript.parser.postwalk.call(null,this.qin,b),datascript.parser.postwalk.call(null,this.qwhere,b),null,null,null);b=cljs.core.meta.call(null,this);return cljs.core.truth_(b)?cljs.core.with_meta.call(null,a,b):a};
datascript.parser.Query.prototype.datascript$parser$ITraversable$_collect$arity$3=function(a,b,c){return datascript.parser.collect.call(null,b,this.qwhere,datascript.parser.collect.call(null,b,this.qin,datascript.parser.collect.call(null,b,this.qreturn_map,datascript.parser.collect.call(null,b,this.qwith,datascript.parser.collect.call(null,b,this.qfind,c)))))};
datascript.parser.Query.prototype.datascript$parser$ITraversable$_collect_vars$arity$2=function(a,b){return datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,datascript.parser.collect_vars_acc.call(null,b,this.qfind),this.qwith),this.qreturn_map),this.qin),this.qwhere)};
datascript.parser.Query.getBasis=function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"qfind","qfind",-1125102797,null),new cljs.core.Symbol(null,"qwith","qwith",1594722135,null),new cljs.core.Symbol(null,"qreturn-map","qreturn-map",-813219775,null),new cljs.core.Symbol(null,"qin","qin",-1281784618,null),new cljs.core.Symbol(null,"qwhere","qwhere",-4535851,null)],null)};datascript.parser.Query.cljs$lang$type=!0;
datascript.parser.Query.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.parser/Query",null,1,null)};datascript.parser.Query.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.parser/Query")};datascript.parser.__GT_Query=function(a,b,c,d,e){return new datascript.parser.Query(a,b,c,d,e,null,null,null)};
datascript.parser.map__GT_Query=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"qfind","qfind",1529332972),new cljs.core.Keyword(null,"qwith","qwith",-45809392),new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),new cljs.core.Keyword(null,"qin","qin",1372651151),new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.parser.Query((new cljs.core.Keyword(null,
"qfind","qfind",1529332972)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"qwith","qwith",-45809392)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};
datascript.parser.query__GT_map=function(a){for(var b=cljs.core.PersistentArrayMap.EMPTY,c=null;;){var d=cljs.core.first.call(null,a);if(cljs.core.truth_(d))d instanceof cljs.core.Keyword?(c=d,a=cljs.core.next.call(null,a)):(b=cljs.core.update_in.call(null,b,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null),cljs.core.fnil.call(null,cljs.core.conj,cljs.core.PersistentVector.EMPTY),d),a=cljs.core.next.call(null,a));else return b}};
datascript.parser.explicit_input=function(a){var b=(new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(a);return a instanceof datascript.parser.Pattern?b:null!=b?b instanceof datascript.parser.DefaultSrc?null:b:null};
datascript.parser.default_in=function(a){return cljs.core.empty_QMARK_.call(null,datascript.parser.collect.call(null,datascript.parser.explicit_input,a))?cljs.core.PersistentVector.EMPTY:new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"$","$",-1580747756,null)],null)};
datascript.parser.validate_query=function(a,b,c){var d=cljs.core.set.call(null,datascript.parser.collect_vars.call(null,(new cljs.core.Keyword(null,"qfind","qfind",1529332972)).cljs$core$IFn$_invoke$arity$1(a))),e=cljs.core.set.call(null,(new cljs.core.Keyword(null,"qwith","qwith",-45809392)).cljs$core$IFn$_invoke$arity$1(a)),f=cljs.core.set.call(null,datascript.parser.collect_vars.call(null,(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a))),g=cljs.core.set.call(null,
datascript.parser.collect_vars.call(null,(new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378)).cljs$core$IFn$_invoke$arity$1(a)));f=clojure.set.difference.call(null,clojure.set.union.call(null,d,e),clojure.set.union.call(null,g,f));d=clojure.set.intersection.call(null,d,e);if(!cljs.core.empty_QMARK_.call(null,f))throw cljs.core.ex_info.call(null,["Query for unknown vars: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.mapv.call(null,new cljs.core.Keyword(null,
"symbol","symbol",-1038572696),f)))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"vars","vars",-2046957217),f,new cljs.core.Keyword(null,"form","form",-1624062471),b],null));if(!cljs.core.empty_QMARK_.call(null,d))throw cljs.core.ex_info.call(null,[":find and :with should not use same variables: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
cljs.core.mapv.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),d)))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"vars","vars",-2046957217),d,new cljs.core.Keyword(null,"form","form",-1624062471),b],null));d=(new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994)).cljs$core$IFn$_invoke$arity$1(a);if(null!=d){if((new cljs.core.Keyword(null,
"qfind","qfind",1529332972)).cljs$core$IFn$_invoke$arity$1(a)instanceof datascript.parser.FindScalar)throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,(new cljs.core.Keyword(null,"type","type",1174270348)).cljs$core$IFn$_invoke$arity$1(d)))," does not work with single-scalar :find"].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),
new cljs.core.Keyword(null,"form","form",-1624062471),b],null));if((new cljs.core.Keyword(null,"qfind","qfind",1529332972)).cljs$core$IFn$_invoke$arity$1(a)instanceof datascript.parser.FindColl)throw cljs.core.ex_info.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,(new cljs.core.Keyword(null,"type","type",1174270348)).cljs$core$IFn$_invoke$arity$1(d)))," does not work with collection :find"].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,
"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"form","form",-1624062471),b],null));}d=(new cljs.core.Keyword(null,"symbols","symbols",1211743)).cljs$core$IFn$_invoke$arity$1((new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994)).cljs$core$IFn$_invoke$arity$1(a));if(null!=d&&(e=datascript.parser.find_elements.call(null,(new cljs.core.Keyword(null,"qfind","qfind",1529332972)).cljs$core$IFn$_invoke$arity$1(a)),!cljs.core._EQ_.call(null,
cljs.core.count.call(null,d),cljs.core.count.call(null,e))))throw cljs.core.ex_info.call(null,["Count of ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,(new cljs.core.Keyword(null,"type","type",1174270348)).cljs$core$IFn$_invoke$arity$1((new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994)).cljs$core$IFn$_invoke$arity$1(a))))," must match count of :find"].join(""),new cljs.core.PersistentArrayMap(null,4,[new cljs.core.Keyword(null,"error","error",-978969032),
new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"return-map","return-map",1620104901),cljs.core.cons.call(null,(new cljs.core.Keyword(null,"type","type",1174270348)).cljs$core$IFn$_invoke$arity$1((new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994)).cljs$core$IFn$_invoke$arity$1(a)),d),new cljs.core.Keyword(null,"find","find",496279456),e,new cljs.core.Keyword(null,"form","form",-1624062471),b],null));if(1<cljs.core.count.call(null,cljs.core.filter.call(null,
cljs.core.some_QMARK_,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[(new cljs.core.Keyword(null,"keys","keys",1068423698)).cljs$core$IFn$_invoke$arity$1(c),(new cljs.core.Keyword(null,"syms","syms",-1575891762)).cljs$core$IFn$_invoke$arity$1(c),(new cljs.core.Keyword(null,"strs","strs",1175537277)).cljs$core$IFn$_invoke$arity$1(c)],null))))throw cljs.core.ex_info.call(null,"Only one of :keys/:syms/:strs must be present",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,
"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"form","form",-1624062471),b],null));var h=datascript.parser.collect_vars.call(null,(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a)),k=datascript.parser.collect.call(null,function(a){return function(a){return a instanceof datascript.parser.SrcVar}}(h),(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a)),l=datascript.parser.collect.call(null,
function(a,b){return function(a){return a instanceof datascript.parser.RulesVar}}(h,k),(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a));if(!cljs.core.truth_(function(){var a=datascript.parser.distinct_QMARK_.call(null,h);return cljs.core.truth_(a)?(a=datascript.parser.distinct_QMARK_.call(null,k),cljs.core.truth_(a)?datascript.parser.distinct_QMARK_.call(null,l):a):a}()))throw cljs.core.ex_info.call(null,"Vars used in :in should be distinct",new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"form","form",-1624062471),b],null));c=datascript.parser.collect_vars.call(null,(new cljs.core.Keyword(null,"qwith","qwith",-45809392)).cljs$core$IFn$_invoke$arity$1(a));if(!cljs.core.truth_(datascript.parser.distinct_QMARK_.call(null,c)))throw cljs.core.ex_info.call(null,"Vars used in :with should be distinct",new cljs.core.PersistentArrayMap(null,
2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"form","form",-1624062471),b],null));c=datascript.parser.collect.call(null,function(a){return a instanceof datascript.parser.SrcVar},(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a),cljs.core.PersistentHashSet.EMPTY);d=datascript.parser.collect.call(null,function(a){return function(a){return a instanceof datascript.parser.SrcVar}}(c),
(new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378)).cljs$core$IFn$_invoke$arity$1(a),cljs.core.PersistentHashSet.EMPTY);c=clojure.set.difference.call(null,d,c);if(!cljs.core.empty_QMARK_.call(null,c))throw cljs.core.ex_info.call(null,["Where uses unknown source vars: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.mapv.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),c)))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,
"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"vars","vars",-2046957217),c,new cljs.core.Keyword(null,"form","form",-1624062471),b],null));c=datascript.parser.collect.call(null,function(a){return a instanceof datascript.parser.RuleExpr},(new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378)).cljs$core$IFn$_invoke$arity$1(a));a=datascript.parser.collect.call(null,function(a){return function(a){return a instanceof datascript.parser.RulesVar}}(c),
(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(a));if(!cljs.core.empty_QMARK_.call(null,c)&&cljs.core.empty_QMARK_.call(null,a))throw cljs.core.ex_info.call(null,"Missing rules var '%' in :in",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"form","form",-1624062471),b],null));return null};
datascript.parser.parse_query=function(a){if(cljs.core.map_QMARK_.call(null,a))var b=a;else if(cljs.core.sequential_QMARK_.call(null,a))b=datascript.parser.query__GT_map.call(null,a);else throw cljs.core.ex_info.call(null,"Query should be a vector or a map",new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("parser","query","parser/query",1877320671),new cljs.core.Keyword(null,"form","form",-1624062471),a],null));var c=b,d=datascript.parser.parse_where.call(null,
(new cljs.core.Keyword(null,"where","where",-2044795965)).cljs$core$IFn$_invoke$arity$2(c,cljs.core.PersistentVector.EMPTY));b=datascript.parser.map__GT_Query.call(null,new cljs.core.PersistentArrayMap(null,5,[new cljs.core.Keyword(null,"qfind","qfind",1529332972),datascript.parser.parse_find.call(null,(new cljs.core.Keyword(null,"find","find",496279456)).cljs$core$IFn$_invoke$arity$1(c)),new cljs.core.Keyword(null,"qwith","qwith",-45809392),function(){var a=(new cljs.core.Keyword(null,"with","with",
-1536296876)).cljs$core$IFn$_invoke$arity$1(c);return cljs.core.truth_(a)?datascript.parser.parse_with.call(null,a):null}(),new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994),function(){var a=datascript.parser.parse_return_map.call(null,new cljs.core.Keyword(null,"keys","keys",1068423698),(new cljs.core.Keyword(null,"keys","keys",1068423698)).cljs$core$IFn$_invoke$arity$1(c));if(cljs.core.truth_(a))return a;a=datascript.parser.parse_return_map.call(null,new cljs.core.Keyword(null,
"syms","syms",-1575891762),(new cljs.core.Keyword(null,"syms","syms",-1575891762)).cljs$core$IFn$_invoke$arity$1(c));return cljs.core.truth_(a)?a:datascript.parser.parse_return_map.call(null,new cljs.core.Keyword(null,"strs","strs",1175537277),(new cljs.core.Keyword(null,"strs","strs",1175537277)).cljs$core$IFn$_invoke$arity$1(c))}(),new cljs.core.Keyword(null,"qin","qin",1372651151),datascript.parser.parse_in.call(null,function(){var a=(new cljs.core.Keyword(null,"in","in",-1531184865)).cljs$core$IFn$_invoke$arity$1(c);
return cljs.core.truth_(a)?a:datascript.parser.default_in.call(null,d)}()),new cljs.core.Keyword(null,"qwhere","qwhere",-1645067378),d],null));datascript.parser.validate_query.call(null,b,a,c);return b};datascript.query={};datascript.query.lru_cache_size=100;datascript.query.Context=function(a,b,c,d,e,f){this.rels=a;this.sources=b;this.rules=c;this.__meta=d;this.__extmap=e;this.__hash=f;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};datascript.query.Context.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};
datascript.query.Context.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "rels":return this.rels;case "sources":return this.sources;case "rules":return this.rules;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.query.Context.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.query.Context{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,
"rels","rels",1770187185),this.rels],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"sources","sources",-321166424),this.sources],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"rules","rules",1198912366),this.rules],null)],null),this.__extmap))};
datascript.query.Context.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,3,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.Keyword(null,"sources","sources",-321166424),new cljs.core.Keyword(null,"rules","rules",1198912366)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.query.Context.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.query.Context.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.query.Context(this.rels,this.sources,this.rules,this.__meta,this.__extmap,this.__hash)};datascript.query.Context.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 3+cljs.core.count.call(null,this.__extmap)};
datascript.query.Context.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1014232958^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.query.Context.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.rels,b.rels)&&cljs.core._EQ_.call(null,this.sources,b.sources)&&cljs.core._EQ_.call(null,this.rules,b.rules)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.query.Context.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"sources","sources",-321166424),null,new cljs.core.Keyword(null,"rules","rules",1198912366),null,new cljs.core.Keyword(null,"rels","rels",1770187185),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,
this),this.__meta),b):new datascript.query.Context(this.rels,this.sources,this.rules,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.query.Context.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"rels","rels",1770187185),b))?new datascript.query.Context(c,this.sources,this.rules,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"sources","sources",-321166424),b))?new datascript.query.Context(this.rels,c,this.rules,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,
new cljs.core.Keyword(null,"rules","rules",1198912366),b))?new datascript.query.Context(this.rels,this.sources,c,this.__meta,this.__extmap,null):new datascript.query.Context(this.rels,this.sources,this.rules,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};
datascript.query.Context.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"rels","rels",1770187185),this.rels,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"sources","sources",-321166424),this.sources,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"rules","rules",1198912366),this.rules,null)],
null),this.__extmap))};datascript.query.Context.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.query.Context(this.rels,this.sources,this.rules,b,this.__extmap,this.__hash)};datascript.query.Context.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.query.Context.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"rels","rels",-884248584,null),new cljs.core.Symbol(null,"sources","sources",1319365103,null),new cljs.core.Symbol(null,"rules","rules",-1455523403,null)],null)};datascript.query.Context.cljs$lang$type=!0;datascript.query.Context.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.query/Context",null,1,null)};
datascript.query.Context.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.query/Context")};datascript.query.__GT_Context=function(a,b,c){return new datascript.query.Context(a,b,c,null,null,null)};
datascript.query.map__GT_Context=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.Keyword(null,"sources","sources",-321166424),new cljs.core.Keyword(null,"rules","rules",1198912366));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.query.Context((new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,
"sources","sources",-321166424)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"rules","rules",1198912366)).cljs$core$IFn$_invoke$arity$1(a),null,cljs.core.not_empty.call(null,b),null)};datascript.query.Relation=function(a,b,c,d,e){this.attrs=a;this.tuples=b;this.__meta=c;this.__extmap=d;this.__hash=e;this.cljs$lang$protocol_mask$partition0$=2229667594;this.cljs$lang$protocol_mask$partition1$=139264};
datascript.query.Relation.prototype.cljs$core$ILookup$_lookup$arity$2=function(a,b){return this.cljs$core$ILookup$_lookup$arity$3(null,b,null)};datascript.query.Relation.prototype.cljs$core$ILookup$_lookup$arity$3=function(a,b,c){switch(b instanceof cljs.core.Keyword?b.fqn:null){case "attrs":return this.attrs;case "tuples":return this.tuples;default:return cljs.core.get.call(null,this.__extmap,b,c)}};
datascript.query.Relation.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(a,b,c){a=function(a){return function(a){return cljs.core.pr_sequential_writer.call(null,b,cljs.core.pr_writer,""," ","",c,a)}}(this);return cljs.core.pr_sequential_writer.call(null,b,a,"#datascript.query.Relation{",", ","}",c,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"attrs","attrs",-2090668713),this.attrs],null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"tuples","tuples",-676032639),this.tuples],null)],null),this.__extmap))};
datascript.query.Relation.prototype.cljs$core$IIterable$_iterator$arity$1=function(a){return new cljs.core.RecordIter(0,this,2,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"attrs","attrs",-2090668713),new cljs.core.Keyword(null,"tuples","tuples",-676032639)],null),cljs.core.truth_(this.__extmap)?cljs.core._iterator.call(null,this.__extmap):cljs.core.nil_iter.call(null))};
datascript.query.Relation.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return this.__meta};datascript.query.Relation.prototype.cljs$core$ICloneable$_clone$arity$1=function(a){return new datascript.query.Relation(this.attrs,this.tuples,this.__meta,this.__extmap,this.__hash)};datascript.query.Relation.prototype.cljs$core$ICounted$_count$arity$1=function(a){return 2+cljs.core.count.call(null,this.__extmap)};
datascript.query.Relation.prototype.cljs$core$IHash$_hash$arity$1=function(a){a=this.__hash;return null!=a?a:this.__hash=a=function(a,c){return function(a){return 1107093117^cljs.core.hash_unordered_coll.call(null,a)}}(a,this).call(null,this)};
datascript.query.Relation.prototype.cljs$core$IEquiv$_equiv$arity$2=function(a,b){return null!=b&&this.constructor===b.constructor&&cljs.core._EQ_.call(null,this.attrs,b.attrs)&&cljs.core._EQ_.call(null,this.tuples,b.tuples)&&cljs.core._EQ_.call(null,this.__extmap,b.__extmap)};
datascript.query.Relation.prototype.cljs$core$IMap$_dissoc$arity$2=function(a,b){return cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"tuples","tuples",-676032639),null,new cljs.core.Keyword(null,"attrs","attrs",-2090668713),null],null),null),b)?cljs.core.dissoc.call(null,cljs.core._with_meta.call(null,cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,this),this.__meta),b):new datascript.query.Relation(this.attrs,
this.tuples,this.__meta,cljs.core.not_empty.call(null,cljs.core.dissoc.call(null,this.__extmap,b)),null)};
datascript.query.Relation.prototype.cljs$core$IAssociative$_assoc$arity$3=function(a,b,c){a=cljs.core.keyword_identical_QMARK_;return cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"attrs","attrs",-2090668713),b))?new datascript.query.Relation(c,this.tuples,this.__meta,this.__extmap,null):cljs.core.truth_(a.call(null,new cljs.core.Keyword(null,"tuples","tuples",-676032639),b))?new datascript.query.Relation(this.attrs,c,this.__meta,this.__extmap,null):new datascript.query.Relation(this.attrs,
this.tuples,this.__meta,cljs.core.assoc.call(null,this.__extmap,b,c),null)};datascript.query.Relation.prototype.cljs$core$ISeqable$_seq$arity$1=function(a){return cljs.core.seq.call(null,cljs.core.concat.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.MapEntry(new cljs.core.Keyword(null,"attrs","attrs",-2090668713),this.attrs,null),new cljs.core.MapEntry(new cljs.core.Keyword(null,"tuples","tuples",-676032639),this.tuples,null)],null),this.__extmap))};
datascript.query.Relation.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return new datascript.query.Relation(this.attrs,this.tuples,b,this.__extmap,this.__hash)};datascript.query.Relation.prototype.cljs$core$ICollection$_conj$arity$2=function(a,b){return cljs.core.vector_QMARK_.call(null,b)?this.cljs$core$IAssociative$_assoc$arity$3(null,cljs.core._nth.call(null,b,0),cljs.core._nth.call(null,b,1)):cljs.core.reduce.call(null,cljs.core._conj,this,b)};
datascript.query.Relation.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"attrs","attrs",-450137186,null),new cljs.core.Symbol(null,"tuples","tuples",964498888,null)],null)};datascript.query.Relation.cljs$lang$type=!0;datascript.query.Relation.cljs$lang$ctorPrSeq=function(a){return new cljs.core.List(null,"datascript.query/Relation",null,1,null)};
datascript.query.Relation.cljs$lang$ctorPrWriter=function(a,b){return cljs.core._write.call(null,b,"datascript.query/Relation")};datascript.query.__GT_Relation=function(a,b){return new datascript.query.Relation(a,b,null,null,null)};
datascript.query.map__GT_Relation=function(a){var b=cljs.core.dissoc.call(null,a,new cljs.core.Keyword(null,"attrs","attrs",-2090668713),new cljs.core.Keyword(null,"tuples","tuples",-676032639));b=cljs.core.record_QMARK_.call(null,a)?cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,b):b;return new datascript.query.Relation((new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(a),
null,cljs.core.not_empty.call(null,b),null)};datascript.query.single=function(a){if(null!=cljs.core.next.call(null,a))throw Error("Assert failed: Expected single element\n(nil? (next coll))");return cljs.core.first.call(null,a)};datascript.query.intersect_keys=function(a,b){return clojure.set.intersection.call(null,cljs.core.set.call(null,cljs.core.keys.call(null,a)),cljs.core.set.call(null,cljs.core.keys.call(null,b)))};
datascript.query.concatv=function(a){for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=0<b.length?new cljs.core.IndexedSeq(b.slice(0),0,null):null;return datascript.query.concatv.cljs$core$IFn$_invoke$arity$variadic(b)};datascript.query.concatv.cljs$core$IFn$_invoke$arity$variadic=function(a){return cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.cat,a)};datascript.query.concatv.cljs$lang$maxFixedArity=0;
datascript.query.concatv.cljs$lang$applyTo=function(a){return this.cljs$core$IFn$_invoke$arity$variadic(cljs.core.seq.call(null,a))};
datascript.query.zip=function(a){switch(arguments.length){case 2:return datascript.query.zip.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=new cljs.core.IndexedSeq(b.slice(2),0,null);return datascript.query.zip.cljs$core$IFn$_invoke$arity$variadic(arguments[0],arguments[1],b)}};datascript.query.zip.cljs$core$IFn$_invoke$arity$2=function(a,b){return cljs.core.mapv.call(null,cljs.core.vector,a,b)};
datascript.query.zip.cljs$core$IFn$_invoke$arity$variadic=function(a,b,c){return cljs.core.apply.call(null,cljs.core.mapv,cljs.core.vector,a,b,c)};datascript.query.zip.cljs$lang$applyTo=function(a){var b=cljs.core.first.call(null,a),c=cljs.core.next.call(null,a);a=cljs.core.first.call(null,c);c=cljs.core.next.call(null,c);return this.cljs$core$IFn$_invoke$arity$variadic(b,a,c)};datascript.query.zip.cljs$lang$maxFixedArity=2;
datascript.query.same_keys_QMARK_=function(a,b){return cljs.core._EQ_.call(null,cljs.core.count.call(null,a),cljs.core.count.call(null,b))&&cljs.core.every_QMARK_.call(null,function(a){return cljs.core.contains_QMARK_.call(null,b,a)},cljs.core.keys.call(null,a))&&cljs.core.every_QMARK_.call(null,function(a){return cljs.core.contains_QMARK_.call(null,b,a)},cljs.core.keys.call(null,a))};
datascript.query.looks_like_QMARK_=function(a,b){return cljs.core._EQ_.call(null,new cljs.core.Symbol(null,"_","_",-1201019570,null),a)?!0:cljs.core._EQ_.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"*","*",345799209,null)],null),a)?cljs.core.sequential_QMARK_.call(null,b):a instanceof cljs.core.Symbol?cljs.core._EQ_.call(null,b,a):cljs.core.sequential_QMARK_.call(null,a)?cljs.core._EQ_.call(null,cljs.core.last.call(null,a),new cljs.core.Symbol(null,
"*","*",345799209,null))?cljs.core.sequential_QMARK_.call(null,b)&&cljs.core.every_QMARK_.call(null,function(a){var b=cljs.core.nth.call(null,a,0,null);a=cljs.core.nth.call(null,a,1,null);return datascript.query.looks_like_QMARK_.call(null,b,a)},cljs.core.map.call(null,cljs.core.vector,cljs.core.butlast.call(null,a),b)):cljs.core.sequential_QMARK_.call(null,b)&&cljs.core._EQ_.call(null,cljs.core.count.call(null,b),cljs.core.count.call(null,a))&&cljs.core.every_QMARK_.call(null,function(a){var b=cljs.core.nth.call(null,
a,0,null);a=cljs.core.nth.call(null,a,1,null);return datascript.query.looks_like_QMARK_.call(null,b,a)},cljs.core.map.call(null,cljs.core.vector,a,b)):a.call(null,b)};datascript.query.source_QMARK_=function(a){return a instanceof cljs.core.Symbol&&cljs.core._EQ_.call(null,"$",cljs.core.first.call(null,cljs.core.name.call(null,a)))};datascript.query.free_var_QMARK_=function(a){return a instanceof cljs.core.Symbol&&cljs.core._EQ_.call(null,"?",cljs.core.first.call(null,cljs.core.name.call(null,a)))};
datascript.query.attr_QMARK_=function(a){return a instanceof cljs.core.Keyword||"string"===typeof a};datascript.query.lookup_ref_QMARK_=function(a){return datascript.query.looks_like_QMARK_.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[datascript.query.attr_QMARK_,new cljs.core.Symbol(null,"_","_",-1201019570,null)],null),a)};
datascript.query.join_tuples=function(a,b,c,d){for(var e=b.length,f=d.length,g=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,e+f),h=0;;)if(h<e)g[h]=a[b[h]],h+=1;else break;for(a=0;;)if(a<f)g[e+a]=c[d[a]],a+=1;else break;return g};
datascript.query.sum_rel=function(a,b){var c=null!=a&&(a.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,a):a,d=cljs.core.get.call(null,c,new cljs.core.Keyword(null,"attrs","attrs",-2090668713)),e=cljs.core.get.call(null,c,new cljs.core.Keyword(null,"tuples","tuples",-676032639)),f=null!=b&&(b.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===b.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,
b):b,g=cljs.core.get.call(null,f,new cljs.core.Keyword(null,"attrs","attrs",-2090668713)),h=cljs.core.get.call(null,f,new cljs.core.Keyword(null,"tuples","tuples",-676032639));if(cljs.core._EQ_.call(null,d,g))return new datascript.query.Relation(d,cljs.core.into.call(null,cljs.core.vec.call(null,e),h),null,null,null);if(cljs.core.not.call(null,datascript.query.same_keys_QMARK_.call(null,d,g)))throw cljs.core.ex_info.call(null,["Can’t sum relations with different attrs: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
d))," and ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))].join(""),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429)],null));if(cljs.core.every_QMARK_.call(null,cljs.core.number_QMARK_,cljs.core.vals.call(null,d))){var k=cljs.core.vec.call(null,function(){return function(a,b,c,d,e,f,g,h){return function y(k){return new cljs.core.LazySeq(null,function(a,b,c,d,
e,f,g,h){return function(){for(;;){var a=cljs.core.seq.call(null,k);if(a){if(cljs.core.chunked_seq_QMARK_.call(null,a)){var b=cljs.core.chunk_first.call(null,a),d=cljs.core.count.call(null,b),e=cljs.core.chunk_buffer.call(null,d);a:for(var f=0;;)if(f<d){var g=cljs.core._nth.call(null,b,f),h=cljs.core.nth.call(null,g,0,null);g=cljs.core.nth.call(null,g,1,null);cljs.core.chunk_append.call(null,e,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[g,c.call(null,h)],null));
f+=1}else{b=!0;break a}return b?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,e),y.call(null,cljs.core.chunk_rest.call(null,a))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,e),null)}b=cljs.core.first.call(null,a);e=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);return cljs.core.cons.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,c.call(null,e)],null),y.call(null,cljs.core.rest.call(null,a)))}return null}}}(a,
b,c,d,e,f,g,h),null,null)}}(a,c,d,e,b,f,g,h).call(null,g)}()),l=cljs.core.reduce.call(null,cljs.core.max,cljs.core.vals.call(null,d))+1;k=cljs.core.persistent_BANG_.call(null,cljs.core.reduce.call(null,function(a,b,c,d,e,f,g,h,k,l){return function(c,d){for(var e=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,b),f=cljs.core.seq.call(null,a),g=null,h=0,k=0;;)if(k<h){var l=cljs.core._nth.call(null,g,k),m=cljs.core.nth.call(null,l,0,null);l=cljs.core.nth.call(null,l,1,null);e[l]=d[m];k+=
1}else if(f=cljs.core.seq.call(null,f))cljs.core.chunked_seq_QMARK_.call(null,f)?(h=cljs.core.chunk_first.call(null,f),f=cljs.core.chunk_rest.call(null,f),g=h,h=cljs.core.count.call(null,h)):(h=cljs.core.first.call(null,f),g=cljs.core.nth.call(null,h,0,null),h=cljs.core.nth.call(null,h,1,null),e[h]=d[g],f=cljs.core.next.call(null,f),g=null,h=0),k=0;else break;return cljs.core.conj_BANG_.call(null,c,e)}}(k,l,a,c,d,e,b,f,g,h),cljs.core.transient$.call(null,cljs.core.vec.call(null,e)),h));return new datascript.query.Relation(d,
k,null,null,null)}k=cljs.core.zipmap.call(null,cljs.core.keys.call(null,cljs.core.merge.call(null,d,g)),cljs.core.range.call(null));return datascript.query.sum_rel.call(null,datascript.query.sum_rel.call(null,new datascript.query.Relation(k,cljs.core.PersistentVector.EMPTY,null,null,null),a),b)};
datascript.query.prod_rel=function(a){switch(arguments.length){case 0:return datascript.query.prod_rel.cljs$core$IFn$_invoke$arity$0();case 2:return datascript.query.prod_rel.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.query.prod_rel.cljs$core$IFn$_invoke$arity$0=function(){return new datascript.query.Relation(cljs.core.PersistentArrayMap.EMPTY,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[me.tonsky.persistent_sorted_set.arrays.make_array.call(null,0)],null),null,null,null)};
datascript.query.prod_rel.cljs$core$IFn$_invoke$arity$2=function(a,b){var c=cljs.core.keys.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a)),d=cljs.core.keys.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(b)),e=cljs.core.to_array.call(null,cljs.core.map.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),c)),f=cljs.core.to_array.call(null,cljs.core.map.call(null,
(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(b),d));return new datascript.query.Relation(cljs.core.zipmap.call(null,cljs.core.concat.call(null,c,d),cljs.core.range.call(null)),cljs.core.persistent_BANG_.call(null,cljs.core.reduce.call(null,function(a,c,d,e){return function(f,g){return cljs.core.reduce.call(null,function(a,b,c,d){return function(a,b){return cljs.core.conj_BANG_.call(null,a,datascript.query.join_tuples.call(null,g,c,b,d))}}(a,c,d,e),f,(new cljs.core.Keyword(null,
"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(b))}}(c,d,e,f),cljs.core.transient$.call(null,cljs.core.PersistentVector.EMPTY),(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(a))),null,null,null)};datascript.query.prod_rel.cljs$lang$maxFixedArity=2;datascript.query._differ_QMARK_=function(a){for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=0<b.length?new cljs.core.IndexedSeq(b.slice(0),0,null):null;return datascript.query._differ_QMARK_.cljs$core$IFn$_invoke$arity$variadic(b)};
datascript.query._differ_QMARK_.cljs$core$IFn$_invoke$arity$variadic=function(a){var b=cljs.core.count.call(null,a);return cljs.core.not_EQ_.call(null,cljs.core.take.call(null,b/2,a),cljs.core.drop.call(null,b/2,a))};datascript.query._differ_QMARK_.cljs$lang$maxFixedArity=0;datascript.query._differ_QMARK_.cljs$lang$applyTo=function(a){return this.cljs$core$IFn$_invoke$arity$variadic(cljs.core.seq.call(null,a))};
datascript.query._get_else=function(a,b,c,d){if(null==d)throw cljs.core.ex_info.call(null,"get-else: nil default value is not supported",new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429)],null));a=cljs.core.first.call(null,datascript.db._search.call(null,a,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,c],null)));return null==a?d:(new cljs.core.Keyword(null,
"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(a)};datascript.query._get_some=function(a){for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=2<b.length?new cljs.core.IndexedSeq(b.slice(2),0,null):null;return datascript.query._get_some.cljs$core$IFn$_invoke$arity$variadic(arguments[0],arguments[1],b)};
datascript.query._get_some.cljs$core$IFn$_invoke$arity$variadic=function(a,b,c){return cljs.core.reduce.call(null,function(c,e){c=cljs.core.first.call(null,datascript.db._search.call(null,a,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[b,e],null)));return null==c?null:cljs.core.reduced.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[(new cljs.core.Keyword(null,"a","a",-2123407586)).cljs$core$IFn$_invoke$arity$1(c),(new cljs.core.Keyword(null,
"v","v",21465059)).cljs$core$IFn$_invoke$arity$1(c)],null))},null,c)};datascript.query._get_some.cljs$lang$maxFixedArity=2;datascript.query._get_some.cljs$lang$applyTo=function(a){var b=cljs.core.first.call(null,a),c=cljs.core.next.call(null,a);a=cljs.core.first.call(null,c);c=cljs.core.next.call(null,c);return this.cljs$core$IFn$_invoke$arity$variadic(b,a,c)};datascript.query._missing_QMARK_=function(a,b,c){return null==cljs.core.get.call(null,datascript.impl.entity.entity.call(null,a,b),c)};
datascript.query.and_fn=function(a){for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=0<b.length?new cljs.core.IndexedSeq(b.slice(0),0,null):null;return datascript.query.and_fn.cljs$core$IFn$_invoke$arity$variadic(b)};datascript.query.and_fn.cljs$core$IFn$_invoke$arity$variadic=function(a){return cljs.core.reduce.call(null,function(a,c){return cljs.core.truth_(c)?c:cljs.core.reduced.call(null,c)},!0,a)};datascript.query.and_fn.cljs$lang$maxFixedArity=0;
datascript.query.and_fn.cljs$lang$applyTo=function(a){return this.cljs$core$IFn$_invoke$arity$variadic(cljs.core.seq.call(null,a))};datascript.query.or_fn=function(a){for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=0<b.length?new cljs.core.IndexedSeq(b.slice(0),0,null):null;return datascript.query.or_fn.cljs$core$IFn$_invoke$arity$variadic(b)};
datascript.query.or_fn.cljs$core$IFn$_invoke$arity$variadic=function(a){return cljs.core.reduce.call(null,function(a,c){return cljs.core.truth_(c)?cljs.core.reduced.call(null,c):c},null,a)};datascript.query.or_fn.cljs$lang$maxFixedArity=0;datascript.query.or_fn.cljs$lang$applyTo=function(a){return this.cljs$core$IFn$_invoke$arity$variadic(cljs.core.seq.call(null,a))};
datascript.query.built_ins=cljs.core.PersistentHashMap.fromArrays([new cljs.core.Symbol(null,"true?","true?",-1600332395,null),new cljs.core.Symbol(null,"and","and",668631710,null),new cljs.core.Symbol(null,"odd?","odd?",-1458588199,null),new cljs.core.Symbol(null,"get-else","get-else",1312024065,null),new cljs.core.Symbol(null,"\x3e\x3d","\x3e\x3d",1016916022,null),new cljs.core.Symbol(null,"print-str","print-str",-699700354,null),new cljs.core.Symbol(null,"\x3e","\x3e",1085014381,null),new cljs.core.Symbol(null,
"count","count",-514511684,null),new cljs.core.Symbol(null,"get-some","get-some",409442058,null),new cljs.core.Symbol(null,"nil?","nil?",1612038930,null),new cljs.core.Symbol(null,"untuple","untuple",-606149900,null),new cljs.core.Symbol(null,"inc","inc",324505433,null),new cljs.core.Symbol(null,"/","/",-1371932971,null),new cljs.core.Symbol(null,"quot","quot",-1125214196,null),new cljs.core.Symbol(null,"false?","false?",-1522377573,null),new cljs.core.Symbol(null,"not","not",1044554643,null),new cljs.core.Symbol(null,
"identity","identity",-1007039734,null),new cljs.core.Symbol(null,"-differ?","-differ?",1465687357,null),new cljs.core.Symbol(null,"tuple","tuple",1167864243,null),new cljs.core.Symbol(null,"re-seq","re-seq",-2105554076,null),new cljs.core.Symbol(null,"\x3c\x3d","\x3c\x3d",1244895369,null),new cljs.core.Symbol("clojure.string","starts-with?","clojure.string/starts-with?",656256322,null),new cljs.core.Symbol(null,"\x3d","\x3d",-1501502141,null),new cljs.core.Symbol(null,"min","min",2085523049,null),
new cljs.core.Symbol(null,"+","+",-740910886,null),new cljs.core.Symbol(null,"name","name",-810760592,null),new cljs.core.Symbol(null,"missing?","missing?",-1710383910,null),new cljs.core.Symbol(null,"ground","ground",-1460862835,null),new cljs.core.Symbol(null,"rand-int","rand-int",-495012157,null),new cljs.core.Symbol(null,"complement","complement",-913606051,null),new cljs.core.Symbol(null,"\x3d\x3d","\x3d\x3d",-234118149,null),new cljs.core.Symbol(null,"hash-map","hash-map",-439030950,null),new cljs.core.Symbol(null,
"compare","compare",1109853757,null),new cljs.core.Symbol(null,"range","range",-1014743483,null),new cljs.core.Symbol(null,"max","max",1701898075,null),new cljs.core.Symbol(null,"empty?","empty?",76408555,null),new cljs.core.Symbol(null,"*","*",345799209,null),new cljs.core.Symbol(null,"pr-str","pr-str",-2066912145,null),new cljs.core.Symbol(null,"println-str","println-str",-2049216703,null),new cljs.core.Symbol(null,"meta","meta",-1154898805,null),new cljs.core.Symbol(null,"zero?","zero?",325758897,
null),new cljs.core.Symbol(null,"!\x3d","!\x3d",-201205829,null),new cljs.core.Symbol(null,"prn-str","prn-str",-145225943,null),new cljs.core.Symbol(null,"dec","dec",-766002333,null),new cljs.core.Symbol(null,"re-pattern","re-pattern",1047705161,null),new cljs.core.Symbol(null,"vector","vector",-751469611,null),new cljs.core.Symbol(null,"not\x3d","not\x3d",1466536204,null),new cljs.core.Symbol(null,"str","str",-1564826950,null),new cljs.core.Symbol(null,"\x3c","\x3c",993667236,null),new cljs.core.Symbol(null,
"namespace","namespace",1263021155,null),new cljs.core.Symbol(null,"keyword","keyword",-1843046022,null),new cljs.core.Symbol(null,"-","-",-471816912,null),new cljs.core.Symbol(null,"some?","some?",234752293,null),new cljs.core.Symbol(null,"pos?","pos?",-244377722,null),new cljs.core.Symbol(null,"rand","rand",-1745930995,null),new cljs.core.Symbol(null,"re-matches","re-matches",-1865705768,null),new cljs.core.Symbol(null,"list","list",-1889078086,null),new cljs.core.Symbol(null,"contains?","contains?",
-1676812576,null),new cljs.core.Symbol("clojure.string","ends-with?","clojure.string/ends-with?",-745964149,null),new cljs.core.Symbol(null,"subs","subs",1453849536,null),new cljs.core.Symbol(null,"mod","mod",1510044207,null),new cljs.core.Symbol("clojure.string","includes?","clojure.string/includes?",-1842146260,null),new cljs.core.Symbol(null,"array-map","array-map",1555038968,null),new cljs.core.Symbol(null,"rem","rem",664046770,null),new cljs.core.Symbol(null,"even?","even?",-1827825394,null),
new cljs.core.Symbol(null,"type","type",-1480165421,null),new cljs.core.Symbol(null,"neg?","neg?",-1902175577,null),new cljs.core.Symbol("clojure.string","blank?","clojure.string/blank?",1772874244,null),new cljs.core.Symbol(null,"not-empty","not-empty",2029453590,null),new cljs.core.Symbol(null,"or","or",1876275696,null),new cljs.core.Symbol(null,"identical?","identical?",-745864205,null),new cljs.core.Symbol(null,"set","set",1945134081,null),new cljs.core.Symbol(null,"re-find","re-find",1143444147,
null)],[cljs.core.true_QMARK_,datascript.query.and_fn,cljs.core.odd_QMARK_,datascript.query._get_else,cljs.core._GT__EQ_,cljs.core.print_str,cljs.core._GT_,cljs.core.count,datascript.query._get_some,cljs.core.nil_QMARK_,cljs.core.identity,cljs.core.inc,cljs.core._SLASH_,cljs.core.quot,cljs.core.false_QMARK_,cljs.core.not,cljs.core.identity,datascript.query._differ_QMARK_,cljs.core.vector,cljs.core.re_seq,cljs.core._LT__EQ_,clojure.string.starts_with_QMARK_,cljs.core._EQ_,cljs.core.min,cljs.core._PLUS_,
cljs.core.name,datascript.query._missing_QMARK_,cljs.core.identity,cljs.core.rand_int,cljs.core.complement,cljs.core._EQ__EQ_,cljs.core.hash_map,cljs.core.compare,cljs.core.range,cljs.core.max,cljs.core.empty_QMARK_,cljs.core._STAR_,cljs.core.pr_str,cljs.core.println_str,cljs.core.meta,cljs.core.zero_QMARK_,cljs.core.not_EQ_,cljs.core.prn_str,cljs.core.dec,cljs.core.re_pattern,cljs.core.vector,cljs.core.not_EQ_,cljs.core.str,cljs.core._LT_,cljs.core.namespace,cljs.core.keyword,cljs.core._,cljs.core.some_QMARK_,
cljs.core.pos_QMARK_,cljs.core.rand,cljs.core.re_matches,cljs.core.list,cljs.core.contains_QMARK_,clojure.string.ends_with_QMARK_,cljs.core.subs,cljs.core.mod,clojure.string.includes_QMARK_,cljs.core.array_map,cljs.core.rem,cljs.core.even_QMARK_,cljs.core.type,cljs.core.neg_QMARK_,clojure.string.blank_QMARK_,cljs.core.not_empty,datascript.query.or_fn,cljs.core.identical_QMARK_,cljs.core.set,cljs.core.re_find]);
datascript.query.built_in_aggregates=function(){var a=function(a){return cljs.core.reduce.call(null,cljs.core._PLUS_,0,a)},b=function(b){return a.call(null,b)/cljs.core.count.call(null,b)},c=function(c){var d=b.call(null,c);return a.call(null,function(){return function(a){return function k(b){return new cljs.core.LazySeq(null,function(a){return function(){for(;;){var c=cljs.core.seq.call(null,b);if(c){if(cljs.core.chunked_seq_QMARK_.call(null,c)){var d=cljs.core.chunk_first.call(null,c),e=cljs.core.count.call(null,
d),f=cljs.core.chunk_buffer.call(null,e);a:for(var h=0;;)if(h<e){var l=cljs.core._nth.call(null,d,h)-a;cljs.core.chunk_append.call(null,f,l*l);h+=1}else{d=!0;break a}return d?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,f),k.call(null,cljs.core.chunk_rest.call(null,c))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,f),null)}f=cljs.core.first.call(null,c)-a;return cljs.core.cons.call(null,f*f,k.call(null,cljs.core.rest.call(null,c)))}return null}}}(a),null,null)}}(d).call(null,
c)}())/cljs.core.count.call(null,c)};return cljs.core.PersistentHashMap.fromArrays([new cljs.core.Symbol(null,"variance","variance",-1522424942,null),new cljs.core.Symbol(null,"count","count",-514511684,null),new cljs.core.Symbol(null,"median","median",-2084869638,null),new cljs.core.Symbol(null,"sum","sum",1777518341,null),new cljs.core.Symbol(null,"min","min",2085523049,null),new cljs.core.Symbol(null,"max","max",1701898075,null),new cljs.core.Symbol(null,"count-distinct","count-distinct",-1566572514,
null),new cljs.core.Symbol(null,"distinct","distinct",-148347594,null),new cljs.core.Symbol(null,"avg","avg",1837937727,null),new cljs.core.Symbol(null,"stddev","stddev",775056588,null),new cljs.core.Symbol(null,"rand","rand",-1745930995,null),new cljs.core.Symbol(null,"sample","sample",1719555128,null)],[c,cljs.core.count,function(a){var b=cljs.core.sort.call(null,a);a=cljs.core.count.call(null,a);var c=a>>1,d=cljs.core.nth.call(null,b,c);return cljs.core.even_QMARK_.call(null,a)?(d+cljs.core.nth.call(null,
b,c-1))/2:d},a,function(){var a=null,b=function(a){return cljs.core.reduce.call(null,function(a,b){return 0>cljs.core.compare.call(null,b,a)?b:a},cljs.core.first.call(null,a),cljs.core.next.call(null,a))},c=function(a,b){return cljs.core.vec.call(null,cljs.core.reduce.call(null,function(b,c){return cljs.core.count.call(null,b)<a?cljs.core.sort.call(null,cljs.core.compare,cljs.core.conj.call(null,b,c)):0>cljs.core.compare.call(null,c,cljs.core.last.call(null,b))?cljs.core.sort.call(null,cljs.core.compare,
cljs.core.conj.call(null,cljs.core.butlast.call(null,b),c)):b},cljs.core.PersistentVector.EMPTY,b))};a=function(a,d){switch(arguments.length){case 1:return b.call(this,a);case 2:return c.call(this,a,d)}throw Error("Invalid arity: "+arguments.length);};a.cljs$core$IFn$_invoke$arity$1=b;a.cljs$core$IFn$_invoke$arity$2=c;return a}(),function(){var a=null,b=function(a){return cljs.core.reduce.call(null,function(a,b){return 0<cljs.core.compare.call(null,b,a)?b:a},cljs.core.first.call(null,a),cljs.core.next.call(null,
a))},c=function(a,b){return cljs.core.vec.call(null,cljs.core.reduce.call(null,function(b,c){return cljs.core.count.call(null,b)<a?cljs.core.sort.call(null,cljs.core.compare,cljs.core.conj.call(null,b,c)):0<cljs.core.compare.call(null,c,cljs.core.first.call(null,b))?cljs.core.sort.call(null,cljs.core.compare,cljs.core.conj.call(null,cljs.core.next.call(null,b),c)):b},cljs.core.PersistentVector.EMPTY,b))};a=function(a,d){switch(arguments.length){case 1:return b.call(this,a);case 2:return c.call(this,
a,d)}throw Error("Invalid arity: "+arguments.length);};a.cljs$core$IFn$_invoke$arity$1=b;a.cljs$core$IFn$_invoke$arity$2=c;return a}(),function(a){return cljs.core.count.call(null,cljs.core.distinct.call(null,a))},cljs.core.set,b,function(a){return Math.sqrt(c.call(null,a))},function(){var a=null,b=function(a){return cljs.core.rand_nth.call(null,a)},c=function(a,b){return cljs.core.vec.call(null,cljs.core.repeatedly.call(null,a,function(){return cljs.core.rand_nth.call(null,b)}))};a=function(a,d){switch(arguments.length){case 1:return b.call(this,
a);case 2:return c.call(this,a,d)}throw Error("Invalid arity: "+arguments.length);};a.cljs$core$IFn$_invoke$arity$1=b;a.cljs$core$IFn$_invoke$arity$2=c;return a}(),function(a,b){return cljs.core.vec.call(null,cljs.core.take.call(null,a,cljs.core.shuffle.call(null,b)))}])}();datascript.query.parse_rules=function(a){a="string"===typeof a?cljs.reader.read_string.call(null,a):a;datascript.parser.parse_rules.call(null,a);return cljs.core.group_by.call(null,cljs.core.ffirst,a)};
datascript.query.empty_rel=function(a){a=cljs.core.map.call(null,new cljs.core.Keyword(null,"symbol","symbol",-1038572696),datascript.parser.collect_vars_distinct.call(null,a));return new datascript.query.Relation(cljs.core.zipmap.call(null,a,cljs.core.range.call(null)),cljs.core.PersistentVector.EMPTY,null,null,null)};datascript.query.IBinding=function(){};
datascript.query.in__GT_rel=function(a,b){if(null!=a&&null!=a.datascript$query$IBinding$in__GT_rel$arity$2)return a.datascript$query$IBinding$in__GT_rel$arity$2(a,b);var c=datascript.query.in__GT_rel[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=datascript.query.in__GT_rel._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"IBinding.in-\x3erel",a);};datascript.parser.BindIgnore.prototype.datascript$query$IBinding$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.BindIgnore.prototype.datascript$query$IBinding$in__GT_rel$arity$2=function(a,b){return datascript.query.prod_rel.call(null)};datascript.parser.BindScalar.prototype.datascript$query$IBinding$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.BindScalar.prototype.datascript$query$IBinding$in__GT_rel$arity$2=function(a,b){return new datascript.query.Relation(cljs.core.PersistentArrayMap.createAsIfByAssoc([cljs.core.get_in.call(null,this,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"variable","variable",-281346492),new cljs.core.Keyword(null,"symbol","symbol",-1038572696)],null)),0]),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,
[cljs.core.into_array.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null))],null),null,null,null)};datascript.parser.BindColl.prototype.datascript$query$IBinding$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.BindColl.prototype.datascript$query$IBinding$in__GT_rel$arity$2=function(a,b){if(datascript.db.seqable_QMARK_.call(null,b))return cljs.core.empty_QMARK_.call(null,b)?datascript.query.empty_rel.call(null,this):cljs.core.reduce.call(null,datascript.query.sum_rel,cljs.core.map.call(null,function(a){return function(b){return datascript.query.in__GT_rel.call(null,(new cljs.core.Keyword(null,"binding","binding",539932593)).cljs$core$IFn$_invoke$arity$1(a),b)}}(this),b));throw cljs.core.ex_info.call(null,
["Cannot bind value ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))," to collection ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,datascript.parser.source.call(null,this)))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","binding","query/binding",698240489),new cljs.core.Keyword(null,"value","value",305978217),b,new cljs.core.Keyword(null,"binding","binding",
539932593),datascript.parser.source.call(null,this)],null));};datascript.parser.BindTuple.prototype.datascript$query$IBinding$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.BindTuple.prototype.datascript$query$IBinding$in__GT_rel$arity$2=function(a,b){if(datascript.db.seqable_QMARK_.call(null,b)){if(cljs.core.count.call(null,b)<cljs.core.count.call(null,(new cljs.core.Keyword(null,"bindings","bindings",1271397192)).cljs$core$IFn$_invoke$arity$1(this)))throw cljs.core.ex_info.call(null,["Not enough elements in a collection ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))," to bind tuple ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
datascript.parser.source.call(null,this)))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","binding","query/binding",698240489),new cljs.core.Keyword(null,"value","value",305978217),b,new cljs.core.Keyword(null,"binding","binding",539932593),datascript.parser.source.call(null,this)],null));return cljs.core.reduce.call(null,datascript.query.prod_rel,cljs.core.map.call(null,function(a){return function(a,b){return datascript.query.in__GT_rel.call(null,
a,b)}}(this),(new cljs.core.Keyword(null,"bindings","bindings",1271397192)).cljs$core$IFn$_invoke$arity$1(this),b))}throw cljs.core.ex_info.call(null,["Cannot bind value ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))," to tuple ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,datascript.parser.source.call(null,this)))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query",
"binding","query/binding",698240489),new cljs.core.Keyword(null,"value","value",305978217),b,new cljs.core.Keyword(null,"binding","binding",539932593),datascript.parser.source.call(null,this)],null));};
datascript.query.resolve_in=function(a,b){var c=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);return c instanceof datascript.parser.BindScalar&&(new cljs.core.Keyword(null,"variable","variable",-281346492)).cljs$core$IFn$_invoke$arity$1(c)instanceof datascript.parser.SrcVar?cljs.core.update.call(null,a,new cljs.core.Keyword(null,"sources","sources",-321166424),cljs.core.assoc,cljs.core.get_in.call(null,c,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Keyword(null,"variable","variable",-281346492),new cljs.core.Keyword(null,"symbol","symbol",-1038572696)],null)),b):c instanceof datascript.parser.BindScalar&&(new cljs.core.Keyword(null,"variable","variable",-281346492)).cljs$core$IFn$_invoke$arity$1(c)instanceof datascript.parser.RulesVar?cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"rules","rules",1198912366),datascript.query.parse_rules.call(null,b)):cljs.core.update.call(null,a,new cljs.core.Keyword(null,"rels","rels",
1770187185),cljs.core.conj,datascript.query.in__GT_rel.call(null,c,b))};
datascript.query.resolve_ins=function(a,b,c){var d=cljs.core.count.call(null,b),e=cljs.core.count.call(null,c);if(d<e)throw cljs.core.ex_info.call(null,["Extra inputs passed, expected: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.mapv.call(null,function(a,b){return function(a){return(new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a))}}(d,e),b))),", got: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
e))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","inputs","query/inputs",1042810394),new cljs.core.Keyword(null,"expected","expected",1583670997),b,new cljs.core.Keyword(null,"got","got",-1674745710),c],null));if(d>e)throw cljs.core.ex_info.call(null,["Too few inputs passed, expected: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,cljs.core.mapv.call(null,function(a,b){return function(a){return(new cljs.core.Keyword(null,
"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a))}}(d,e),b))),", got: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","inputs","query/inputs",1042810394),new cljs.core.Keyword(null,"expected","expected",1583670997),b,new cljs.core.Keyword(null,"got","got",-1674745710),c],null));return cljs.core.reduce.call(null,
datascript.query.resolve_in,a,cljs.core.zipmap.call(null,b,c))};datascript.query._STAR_lookup_attrs_STAR_=null;datascript.query._STAR_implicit_source_STAR_=null;
datascript.query.getter_fn=function(a,b){a=a.call(null,b);return cljs.core.contains_QMARK_.call(null,datascript.query._STAR_lookup_attrs_STAR_,b)?function(a){return function(b){b=b[a];return"number"===typeof b?b:cljs.core.sequential_QMARK_.call(null,b)?datascript.db.entid.call(null,datascript.query._STAR_implicit_source_STAR_,b):me.tonsky.persistent_sorted_set.arrays.array_QMARK_.call(null,b)?datascript.db.entid.call(null,datascript.query._STAR_implicit_source_STAR_,b):b}}(a):function(a){return function(b){return b[a]}}(a)};
datascript.query.tuple_key_fn=function(a){return 1===cljs.core.count.call(null,a)?cljs.core.first.call(null,a):function(a){return function(b){return cljs.core.list_STAR_.call(null,a.map(function(a){return function(a){return a.call(null,b)}}(a)))}}(cljs.core.to_array.call(null,a))};
datascript.query.hash_attrs=function(a,b){for(var c=cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY);;){var d=cljs.core.first.call(null,b);if(null==d)return cljs.core.persistent_BANG_.call(null,c);var e=a.call(null,d);b=cljs.core.next.call(null,b);c=cljs.core.assoc_BANG_.call(null,c,e,cljs.core.conj.call(null,cljs.core.get.call(null,c,e,cljs.core.List.EMPTY),d))}};
datascript.query.hash_join=function(a,b){var c=(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(a),d=(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(b),e=(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),f=(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(b),g=cljs.core.vec.call(null,datascript.query.intersect_keys.call(null,(new cljs.core.Keyword(null,
"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(b))),h=cljs.core.map.call(null,function(a,b,c,d,e){return function(a){return datascript.query.getter_fn.call(null,c,a)}}(c,d,e,f,g),g),k=cljs.core.map.call(null,function(a,b,c,d,e,f){return function(a){return datascript.query.getter_fn.call(null,d,a)}}(c,d,e,f,g,h),g);a=cljs.core.keys.call(null,e);b=cljs.core.vec.call(null,clojure.set.difference.call(null,
cljs.core.set.call(null,cljs.core.keys.call(null,f)),cljs.core.set.call(null,cljs.core.keys.call(null,e))));var l=cljs.core.to_array.call(null,cljs.core.map.call(null,e,a)),m=cljs.core.to_array.call(null,cljs.core.map.call(null,f,b)),n=datascript.query.tuple_key_fn.call(null,h),p=datascript.query.hash_attrs.call(null,n,c),q=datascript.query.tuple_key_fn.call(null,k);c=cljs.core.persistent_BANG_.call(null,cljs.core.reduce.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q){return function(r,t){var u=q.call(null,
t),v=cljs.core.get.call(null,p,u);return null==v?r:cljs.core.reduce.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,u,v){return function(a,b){return cljs.core.conj_BANG_.call(null,a,datascript.query.join_tuples.call(null,b,p,t,q))}}(v,v,u,a,b,c,d,e,f,g,h,k,l,m,n,p,q),r,v)}}(c,d,e,f,g,h,k,a,b,l,m,n,p,q),cljs.core.transient$.call(null,cljs.core.PersistentVector.EMPTY),d));return new datascript.query.Relation(cljs.core.zipmap.call(null,cljs.core.concat.call(null,a,b),cljs.core.range.call(null)),c,null,
null,null)};
datascript.query.subtract_rel=function(a,b){var c=null!=a&&(a.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,a):a,d=cljs.core.get.call(null,c,new cljs.core.Keyword(null,"attrs","attrs",-2090668713)),e=cljs.core.get.call(null,c,new cljs.core.Keyword(null,"tuples","tuples",-676032639)),f=null!=b&&(b.cljs$lang$protocol_mask$partition0$&64||cljs.core.PROTOCOL_SENTINEL===b.cljs$core$ISeq$)?cljs.core.apply.call(null,cljs.core.hash_map,
b):b,g=cljs.core.get.call(null,f,new cljs.core.Keyword(null,"attrs","attrs",-2090668713)),h=cljs.core.get.call(null,f,new cljs.core.Keyword(null,"tuples","tuples",-676032639)),k=datascript.query.intersect_keys.call(null,d,g),l=cljs.core.map.call(null,function(a,b,c,d,e,f,g,h,k){return function(a){return datascript.query.getter_fn.call(null,g,a)}}(a,c,d,e,b,f,g,h,k),k),m=datascript.query.tuple_key_fn.call(null,l),n=datascript.query.hash_attrs.call(null,m,h),p=cljs.core.map.call(null,function(a,b,c,
d,e,f,g,h,k,l,m,n){return function(a){return datascript.query.getter_fn.call(null,c,a)}}(a,c,d,e,b,f,g,h,k,l,m,n),k),q=datascript.query.tuple_key_fn.call(null,p);return cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"tuples","tuples",-676032639),cljs.core.filterv.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q){return function(a){return null==n.call(null,q.call(null,a))}}(a,c,d,e,b,f,g,h,k,l,m,n,p,q),e))};
datascript.query.lookup_pattern_db=function(a,b){var c=cljs.core.mapv.call(null,function(a){return a instanceof cljs.core.Symbol?null:a},b);a=datascript.db._search.call(null,a,c);b=cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,cljs.core.filter.call(null,function(a,b){return function(a){var b=cljs.core.nth.call(null,a,0,null);cljs.core.nth.call(null,a,1,null);return datascript.query.free_var_QMARK_.call(null,b)}}(c,a),cljs.core.map.call(null,cljs.core.vector,b,new cljs.core.PersistentVector(null,
4,5,cljs.core.PersistentVector.EMPTY_NODE,["e","a","v","tx"],null))));return new datascript.query.Relation(b,a,null,null,null)};datascript.query.matches_pattern_QMARK_=function(a,b){for(var c=b,d=a;;)if(cljs.core.truth_(function(){var a=c;return cljs.core.truth_(a)?d:a}()))if(a=cljs.core.first.call(null,c),b=cljs.core.first.call(null,d),b instanceof cljs.core.Symbol||cljs.core._EQ_.call(null,a,b))a=cljs.core.next.call(null,c),b=cljs.core.next.call(null,d),c=a,d=b;else return!1;else return!0};
datascript.query.lookup_pattern_coll=function(a,b){a=cljs.core.filter.call(null,function(a){return datascript.query.matches_pattern_QMARK_.call(null,b,a)},a);var c=cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,cljs.core.filter.call(null,function(a){return function(a){var b=cljs.core.nth.call(null,a,0,null);cljs.core.nth.call(null,a,1,null);return datascript.query.free_var_QMARK_.call(null,b)}}(a),cljs.core.map.call(null,cljs.core.vector,b,cljs.core.range.call(null))));return new datascript.query.Relation(c,
cljs.core.mapv.call(null,cljs.core.to_array,a),null,null,null)};datascript.query.normalize_pattern_clause=function(a){return cljs.core.truth_(datascript.query.source_QMARK_.call(null,cljs.core.first.call(null,a)))?a:cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"$","$",-1580747756,null)],null),a)};
datascript.query.lookup_pattern=function(a,b){return(null!=a?cljs.core.PROTOCOL_SENTINEL===a.datascript$db$ISearch$||(a.cljs$lang$protocol_mask$partition$?0:cljs.core.native_satisfies_QMARK_.call(null,datascript.db.ISearch,a)):cljs.core.native_satisfies_QMARK_.call(null,datascript.db.ISearch,a))?datascript.query.lookup_pattern_db.call(null,a,b):datascript.query.lookup_pattern_coll.call(null,a,b)};
datascript.query.collapse_rels=function(a,b){for(var c=cljs.core.PersistentVector.EMPTY;;){var d=cljs.core.first.call(null,a);if(null==d)return cljs.core.conj.call(null,c,b);cljs.core.truth_(cljs.core.not_empty.call(null,datascript.query.intersect_keys.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(b),(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(d))))?(a=cljs.core.next.call(null,a),b=datascript.query.hash_join.call(null,
d,b)):(a=cljs.core.next.call(null,a),c=cljs.core.conj.call(null,c,d))}};datascript.query.rel_with_attr=function(a,b){return cljs.core.some.call(null,function(a){return cljs.core.contains_QMARK_.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),b)?a:null},(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a))};
datascript.query.context_resolve_val=function(a,b){a=datascript.query.rel_with_attr.call(null,a,b);if(null==a)return null;var c=cljs.core.first.call(null,(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(a));return null==c?null:c[(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a).call(null,b)]};
datascript.query.rel_contains_attrs_QMARK_=function(a,b){return cljs.core.some.call(null,function(b){return cljs.core.contains_QMARK_.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),b)},b)};
datascript.query.rel_prod_by_attrs=function(a,b){var c=cljs.core.filter.call(null,function(a){return datascript.query.rel_contains_attrs_QMARK_.call(null,a,b)},(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a)),d=cljs.core.reduce.call(null,datascript.query.prod_rel,c);return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.update.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),function(a,b){return function(b){return cljs.core.remove.call(null,
cljs.core.set.call(null,a),b)}}(c,d)),d],null)};
datascript.query._call_fn=function(a,b,c,d){a=(new cljs.core.Keyword(null,"sources","sources",-321166424)).cljs$core$IFn$_invoke$arity$1(a);b=(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(b);for(var e=cljs.core.count.call(null,d),f=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,e),g=me.tonsky.persistent_sorted_set.arrays.make_array.call(null,e),h=0;;)if(h<e){var k=cljs.core.nth.call(null,d,h);if(k instanceof cljs.core.Symbol){var l=cljs.core.get.call(null,
a,k);null==l?g[h]=cljs.core.get.call(null,b,k):f[h]=l}else f[h]=k;h+=1}else break;return c===cljs.core.vector?function(a,b,d,e,f){return function(a){for(var b=me.tonsky.persistent_sorted_set.arrays.aclone.call(null,e),g=0;;)if(g<d){var h=f[g];null!=h&&(b[g]=a[h]);g+=1}else break;return cljs.core.apply.call(null,c,b)}}(a,b,e,f,g):function(a,b,d,e,f){return function(a){for(var b=0;;)if(b<d){var g=f[b];null!=g&&(e[b]=a[g]);b+=1}else break;return cljs.core.apply.call(null,c,e)}}(a,b,e,f,g)};
datascript.query.resolve_sym=function(a){return null};
datascript.query.filter_by_pred=function(a,b){var c=cljs.core.nth.call(null,b,0,null),d=cljs.core.seq.call(null,c),e=cljs.core.first.call(null,d),f=cljs.core.next.call(null,d),g=function(){var c=cljs.core.get.call(null,datascript.query.built_ins,e);if(cljs.core.truth_(c))return c;c=datascript.query.context_resolve_val.call(null,a,e);if(cljs.core.truth_(c))return c;c=datascript.query.resolve_sym.call(null,e);if(cljs.core.truth_(c))return c;if(null==datascript.query.rel_with_attr.call(null,a,e))throw cljs.core.ex_info.call(null,
["Unknown predicate '",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))," in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),b,new cljs.core.Keyword(null,"var","var",-769682797),e],null));return null}(),h=datascript.query.rel_prod_by_attrs.call(null,
a,cljs.core.filter.call(null,cljs.core.symbol_QMARK_,f)),k=cljs.core.nth.call(null,h,0,null),l=cljs.core.nth.call(null,h,1,null),m=cljs.core.truth_(g)?function(){var a=datascript.query._call_fn.call(null,k,l,g,f);return cljs.core.update.call(null,l,new cljs.core.Keyword(null,"tuples","tuples",-676032639),function(a,b,c,d,e,f,g,h,k,l,m,n){return function(b){return cljs.core.filter.call(null,a,b)}}(a,b,c,d,e,f,e,f,g,h,k,l))}():cljs.core.assoc.call(null,l,new cljs.core.Keyword(null,"tuples","tuples",
-676032639),cljs.core.PersistentVector.EMPTY);return cljs.core.update.call(null,k,new cljs.core.Keyword(null,"rels","rels",1770187185),cljs.core.conj,m)};
datascript.query.bind_by_fn=function(a,b){var c=cljs.core.nth.call(null,b,0,null),d=cljs.core.seq.call(null,c),e=cljs.core.first.call(null,d),f=cljs.core.next.call(null,d),g=cljs.core.nth.call(null,b,1,null),h=datascript.parser.parse_binding.call(null,g),k=function(){var c=cljs.core.get.call(null,datascript.query.built_ins,e);if(cljs.core.truth_(c))return c;c=datascript.query.context_resolve_val.call(null,a,e);if(cljs.core.truth_(c))return c;c=datascript.query.resolve_sym.call(null,e);if(cljs.core.truth_(c))return c;
if(null==datascript.query.rel_with_attr.call(null,a,e))throw cljs.core.ex_info.call(null,["Unknown function '",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))," in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),b,new cljs.core.Keyword(null,
"var","var",-769682797),e],null));return null}(),l=datascript.query.rel_prod_by_attrs.call(null,a,cljs.core.filter.call(null,cljs.core.symbol_QMARK_,f)),m=cljs.core.nth.call(null,l,0,null),n=cljs.core.nth.call(null,l,1,null),p=cljs.core.truth_(k)?function(){var a=datascript.query._call_fn.call(null,m,n,k,f),p=function(){return function(a,b,c,d,e,f,g,h,k,l,m,n,p,q){return function H(r){return new cljs.core.LazySeq(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q){return function(){for(var b=r;;)if(b=cljs.core.seq.call(null,
b)){if(cljs.core.chunked_seq_QMARK_.call(null,b)){var c=cljs.core.chunk_first.call(null,b),d=cljs.core.count.call(null,c),e=cljs.core.chunk_buffer.call(null,d);a:for(var f=0;;)if(f<d){var g=cljs.core._nth.call(null,c,f),h=a.call(null,g);null!=h&&cljs.core.chunk_append.call(null,e,datascript.query.prod_rel.call(null,new datascript.query.Relation((new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(q),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,
[g],null),null,null,null),datascript.query.in__GT_rel.call(null,l,h)));f+=1}else{c=!0;break a}return c?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,e),H.call(null,cljs.core.chunk_rest.call(null,b))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,e),null)}e=cljs.core.first.call(null,b);c=a.call(null,e);if(null!=c)return cljs.core.cons.call(null,datascript.query.prod_rel.call(null,new datascript.query.Relation((new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(q),
new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[e],null),null,null,null),datascript.query.in__GT_rel.call(null,l,c)),H.call(null,cljs.core.rest.call(null,b)));b=cljs.core.rest.call(null,b)}else return null}}(a,b,c,d,e,f,g,h,k,l,m,n,p,q),null,null)}}(a,b,c,d,e,f,e,f,g,h,k,l,m,n).call(null,(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(n))}();return cljs.core.empty_QMARK_.call(null,p)?datascript.query.prod_rel.call(null,n,datascript.query.empty_rel.call(null,
h)):cljs.core.reduce.call(null,datascript.query.sum_rel,p)}():datascript.query.prod_rel.call(null,cljs.core.assoc.call(null,n,new cljs.core.Keyword(null,"tuples","tuples",-676032639),cljs.core.PersistentVector.EMPTY),datascript.query.empty_rel.call(null,h));return cljs.core.update.call(null,m,new cljs.core.Keyword(null,"rels","rels",1770187185),datascript.query.collapse_rels,p)};
datascript.query.rule_QMARK_=function(a,b){if(cljs.core.sequential_QMARK_.call(null,b)){var c=cljs.core.truth_(datascript.query.source_QMARK_.call(null,cljs.core.first.call(null,b)))?cljs.core.second.call(null,b):cljs.core.first.call(null,b);if(c instanceof cljs.core.Symbol){if(cljs.core.truth_(datascript.query.free_var_QMARK_.call(null,c))||cljs.core.contains_QMARK_.call(null,new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,6,[new cljs.core.Symbol(null,"and","and",668631710,
null),null,new cljs.core.Symbol(null,"not","not",1044554643,null),null,new cljs.core.Symbol(null,"not-join","not-join",-645515756,null),null,new cljs.core.Symbol(null,"or-join","or-join",591375469,null),null,new cljs.core.Symbol(null,"or","or",1876275696,null),null,new cljs.core.Symbol(null,"_","_",-1201019570,null),null],null),null),c))return!1;if(cljs.core.contains_QMARK_.call(null,(new cljs.core.Keyword(null,"rules","rules",1198912366)).cljs$core$IFn$_invoke$arity$1(a),c))return!0;throw cljs.core.ex_info.call(null,
["Unknown rule '",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,c))," in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),b],null));}}return!1};datascript.query.rule_seqid=cljs.core.atom.call(null,0);
datascript.query.expand_rule=function(a,b,c){c=cljs.core.seq.call(null,a);var d=cljs.core.first.call(null,c),e=cljs.core.next.call(null,c),f=cljs.core.swap_BANG_.call(null,datascript.query.rule_seqid,cljs.core.inc);b=cljs.core.get.call(null,(new cljs.core.Keyword(null,"rules","rules",1198912366)).cljs$core$IFn$_invoke$arity$1(b),d);return function(a,b,c,d,e,f,p,q){return function u(g){return new cljs.core.LazySeq(null,function(a,b,c,d,e,f,h,k){return function(){for(;;){var l=cljs.core.seq.call(null,
g);if(l){var m=l;if(cljs.core.chunked_seq_QMARK_.call(null,m)){var n=cljs.core.chunk_first.call(null,m),p=cljs.core.count.call(null,n),q=cljs.core.chunk_buffer.call(null,p);return function(){for(var g=0;;)if(g<p){var t=cljs.core._nth.call(null,n,g),u=t,v=cljs.core.seq.call(null,u),w=cljs.core.first.call(null,v),x=cljs.core.next.call(null,v),y=w,B=cljs.core.seq.call(null,y),A=cljs.core.first.call(null,B),z=cljs.core.next.call(null,B),C=A,I=z,E=x,D=cljs.core.zipmap.call(null,I,f);cljs.core.chunk_append.call(null,
q,clojure.walk.postwalk.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,t,u,v,w,x,y,B,A,z,C,I,E,D){return function(a){if(cljs.core.truth_(datascript.query.free_var_QMARK_.call(null,a))){var b=p.call(null,a);return null==b?cljs.core.symbol.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.name.call(null,a)),"__auto__",cljs.core.str.cljs$core$IFn$_invoke$arity$1(E)].join("")):b}return a}}(g,u,v,w,x,y,B,A,z,C,I,E,D,t,n,p,q,m,l,a,b,c,d,e,f,h,k),E));g+=1}else return!0}()?cljs.core.chunk_cons.call(null,
cljs.core.chunk.call(null,q),u.call(null,cljs.core.chunk_rest.call(null,m))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,q),null)}var t=cljs.core.first.call(null,m),v=t,w=cljs.core.seq.call(null,v),x=cljs.core.first.call(null,w),y=cljs.core.next.call(null,w),B=x,z=cljs.core.seq.call(null,B),I=cljs.core.first.call(null,z),T=cljs.core.next.call(null,z),Q=I,R=T,S=y,U=cljs.core.zipmap.call(null,R,f);return cljs.core.cons.call(null,clojure.walk.postwalk.call(null,function(a,b,c,d,e,f,g,h,
k,l,m,n,p,q,t,u,v,w,x,y,B,A,z){return function(a){if(cljs.core.truth_(datascript.query.free_var_QMARK_.call(null,a))){var b=n.call(null,a);return null==b?cljs.core.symbol.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.name.call(null,a)),"__auto__",cljs.core.str.cljs$core$IFn$_invoke$arity$1(A)].join("")):b}return a}}(v,w,x,y,B,z,I,T,Q,R,S,U,t,m,l,a,b,c,d,e,f,h,k),S),u.call(null,cljs.core.rest.call(null,m)))}return null}}}(a,b,c,d,e,f,p,q),null,null)}}(a,c,d,e,d,e,f,b).call(null,
b)};datascript.query.remove_pairs=function(a,b){a=cljs.core.remove.call(null,function(a){var b=cljs.core.nth.call(null,a,0,null);a=cljs.core.nth.call(null,a,1,null);return cljs.core._EQ_.call(null,b,a)},cljs.core.map.call(null,cljs.core.vector,a,b));return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.map.call(null,cljs.core.first,a),cljs.core.map.call(null,cljs.core.second,a)],null)};
datascript.query.rule_gen_guards=function(a,b){var c=cljs.core.seq.call(null,a),d=cljs.core.first.call(null,c),e=cljs.core.next.call(null,c);b=cljs.core.get.call(null,b,d);return function(a,b,c,d,e,m,n){return function r(f){return new cljs.core.LazySeq(null,function(a,b,c,d,e,g,h){return function(){for(;;){var a=cljs.core.seq.call(null,f);if(a){if(cljs.core.chunked_seq_QMARK_.call(null,a)){var b=cljs.core.chunk_first.call(null,a),c=cljs.core.count.call(null,b),d=cljs.core.chunk_buffer.call(null,c);
a:for(var e=0;;)if(e<c){var h=cljs.core._nth.call(null,b,e),k=datascript.query.remove_pairs.call(null,g,h);h=cljs.core.nth.call(null,k,0,null);k=cljs.core.nth.call(null,k,1,null);cljs.core.chunk_append.call(null,d,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"-differ?","-differ?",1465687357,null)],null),h,k)],null));e+=1}else{b=!0;break a}return b?
cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,d),r.call(null,cljs.core.chunk_rest.call(null,a))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,d),null)}d=cljs.core.first.call(null,a);b=datascript.query.remove_pairs.call(null,g,d);d=cljs.core.nth.call(null,b,0,null);b=cljs.core.nth.call(null,b,1,null);return cljs.core.cons.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.concat.call(null,new cljs.core.PersistentVector(null,1,5,
cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"-differ?","-differ?",1465687357,null)],null),d,b)],null),r.call(null,cljs.core.rest.call(null,a)))}return null}}}(a,b,c,d,e,m,n),null,null)}}(a,c,d,e,d,e,b).call(null,b)};
datascript.query.walk_collect=function(a,b){var c=cljs.core.atom.call(null,cljs.core.PersistentVector.EMPTY);clojure.walk.postwalk.call(null,function(a){return function(c){cljs.core.truth_(b.call(null,c))&&cljs.core.swap_BANG_.call(null,a,cljs.core.conj,c);return c}}(c),a);return cljs.core.deref.call(null,c)};datascript.query.collect_vars=function(a){return cljs.core.set.call(null,datascript.query.walk_collect.call(null,a,datascript.query.free_var_QMARK_))};
datascript.query.split_guards=function(a,b){a=function(a){return function(b){b=cljs.core.nth.call(null,b,0,null);b=cljs.core.seq.call(null,b);cljs.core.first.call(null,b);b=cljs.core.next.call(null,b);return cljs.core.every_QMARK_.call(null,a,b)}}(datascript.query.collect_vars.call(null,a));return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.filter.call(null,a,b),cljs.core.remove.call(null,a,b)],null)};
datascript.query.solve_rule=function(a,b){for(var c=cljs.core.filter.call(null,datascript.query.free_var_QMARK_,b),d=cljs.core.zipmap.call(null,c,cljs.core.range.call(null)),e=function(a,b){return function(a,b){return cljs.core.reduce.call(null,datascript.query._resolve_clause,a,b)}}(c,d),f=function(a,b,c){return function(d){return cljs.core.some.call(null,function(a,b,c){return function(a){return cljs.core.empty_QMARK_.call(null,(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(a))}}(a,
b,c),(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(d))}}(c,d,e),g=new cljs.core.List(null,new cljs.core.PersistentArrayMap(null,5,[new cljs.core.Keyword(null,"prefix-clauses","prefix-clauses",1294180028),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"prefix-context","prefix-context",-1269613591),a,new cljs.core.Keyword(null,"clauses","clauses",1454841241),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null),new cljs.core.Keyword(null,
"used-args","used-args",23596256),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword(null,"pending-guards","pending-guards",-1255527308),cljs.core.PersistentArrayMap.EMPTY],null),null,1,null),h=new datascript.query.Relation(d,cljs.core.PersistentVector.EMPTY,null,null,null);;){var k=cljs.core.first.call(null,g);if(null==k)return h;var l=k,m=cljs.core.split_with.call(null,function(b,c,d,e,f,g,h,k){return function(b){return cljs.core.not.call(null,datascript.query.rule_QMARK_.call(null,a,b))}}(g,
h,l,k,c,d,e,f),(new cljs.core.Keyword(null,"clauses","clauses",1454841241)).cljs$core$IFn$_invoke$arity$1(l)),n=cljs.core.nth.call(null,m,0,null),p=cljs.core.nth.call(null,m,1,null),q=cljs.core.seq.call(null,p),r=cljs.core.first.call(null,q),t=cljs.core.next.call(null,q),u=r,v=t;if(null==u){b=e.call(null,(new cljs.core.Keyword(null,"prefix-context","prefix-context",-1269613591)).cljs$core$IFn$_invoke$arity$1(l),n);b=datascript.query._collect.call(null,b,c);var w=new datascript.query.Relation(d,b,
null,null,null);b=cljs.core.next.call(null,g);w=datascript.query.sum_rel.call(null,h,w);g=b;h=w}else{var x=u,y=cljs.core.seq.call(null,x),B=cljs.core.first.call(null,y),I=cljs.core.next.call(null,y),T=B,z=I,A=datascript.query.rule_gen_guards.call(null,u,(new cljs.core.Keyword(null,"used-args","used-args",23596256)).cljs$core$IFn$_invoke$arity$1(l)),C=datascript.query.split_guards.call(null,cljs.core.concat.call(null,(new cljs.core.Keyword(null,"prefix-clauses","prefix-clauses",1294180028)).cljs$core$IFn$_invoke$arity$1(l),
n),cljs.core.concat.call(null,A,(new cljs.core.Keyword(null,"pending-guards","pending-guards",-1255527308)).cljs$core$IFn$_invoke$arity$1(l))),D=cljs.core.nth.call(null,C,0,null),E=cljs.core.nth.call(null,C,1,null);if(cljs.core.truth_(cljs.core.some.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v,w,x,y,B,A,z,C,I){return function(a){return cljs.core._EQ_.call(null,a,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.list(new cljs.core.Symbol(null,"-differ?",
"-differ?",1465687357,null))],null))}}(g,h,x,y,B,I,T,z,A,C,D,E,m,n,p,q,r,t,u,v,l,k,c,d,e,f),D)))b=cljs.core.next.call(null,g),w=h,g=b,h=w;else{var G=cljs.core.concat.call(null,n,D),F=e.call(null,(new cljs.core.Keyword(null,"prefix-context","prefix-context",-1269613591)).cljs$core$IFn$_invoke$arity$1(l),G);if(cljs.core.truth_(f.call(null,F)))b=cljs.core.next.call(null,g),w=h,g=b,h=w;else{var H=cljs.core.assoc.call(null,(new cljs.core.Keyword(null,"used-args","used-args",23596256)).cljs$core$IFn$_invoke$arity$1(l),
T,cljs.core.conj.call(null,cljs.core.get.call(null,(new cljs.core.Keyword(null,"used-args","used-args",23596256)).cljs$core$IFn$_invoke$arity$1(l),T,cljs.core.PersistentVector.EMPTY),z)),K=datascript.query.expand_rule.call(null,u,a,H);b=cljs.core.concat.call(null,function(){return function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v,w,x,y,B,A,z,C,I,E,D,G,F){return function Y(H){return new cljs.core.LazySeq(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v,w,x,y,B,A,z,C,I,E,D,G,F){return function(){for(;;){var a=
cljs.core.seq.call(null,H);if(a){if(cljs.core.chunked_seq_QMARK_.call(null,a)){var b=cljs.core.chunk_first.call(null,a),d=cljs.core.count.call(null,b),g=cljs.core.chunk_buffer.call(null,d);a:for(var h=0;;)if(h<d){var k=cljs.core._nth.call(null,b,h);cljs.core.chunk_append.call(null,g,new cljs.core.PersistentArrayMap(null,5,[new cljs.core.Keyword(null,"prefix-clauses","prefix-clauses",1294180028),e,new cljs.core.Keyword(null,"prefix-context","prefix-context",-1269613591),f,new cljs.core.Keyword(null,
"clauses","clauses",1454841241),datascript.query.concatv.call(null,k,z),new cljs.core.Keyword(null,"used-args","used-args",23596256),c,new cljs.core.Keyword(null,"pending-guards","pending-guards",-1255527308),t],null));h+=1}else{b=!0;break a}return b?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,g),Y.call(null,cljs.core.chunk_rest.call(null,a))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,g),null)}g=cljs.core.first.call(null,a);return cljs.core.cons.call(null,new cljs.core.PersistentArrayMap(null,
5,[new cljs.core.Keyword(null,"prefix-clauses","prefix-clauses",1294180028),e,new cljs.core.Keyword(null,"prefix-context","prefix-context",-1269613591),f,new cljs.core.Keyword(null,"clauses","clauses",1454841241),datascript.query.concatv.call(null,g,z),new cljs.core.Keyword(null,"used-args","used-args",23596256),c,new cljs.core.Keyword(null,"pending-guards","pending-guards",-1255527308),t],null),Y.call(null,cljs.core.rest.call(null,a)))}return null}}}(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v,w,x,y,B,A,
z,C,I,E,D,G,F),null,null)}}(g,h,H,K,G,F,x,y,B,I,T,z,A,C,D,E,m,n,p,q,r,t,u,v,l,k,c,d,e,f).call(null,K)}(),cljs.core.next.call(null,g));w=h;g=b;h=w}}}}};
datascript.query.resolve_pattern_lookup_refs=function(a,b){if(null!=a?cljs.core.PROTOCOL_SENTINEL===a.datascript$db$IDB$||(a.cljs$lang$protocol_mask$partition$?0:cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IDB,a)):cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IDB,a)){var c=cljs.core.nth.call(null,b,0,null),d=cljs.core.nth.call(null,b,1,null),e=cljs.core.nth.call(null,b,2,null),f=cljs.core.nth.call(null,b,3,null);return cljs.core.subvec.call(null,new cljs.core.PersistentVector(null,
4,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.truth_(function(){var a=datascript.query.lookup_ref_QMARK_.call(null,c);return cljs.core.truth_(a)?a:datascript.query.attr_QMARK_.call(null,c)}())?datascript.db.entid_strict.call(null,a,c):c,d,cljs.core.truth_(function(){if(cljs.core.truth_(e)){var b=datascript.query.attr_QMARK_.call(null,d);return cljs.core.truth_(b)&&(b=datascript.db.ref_QMARK_.call(null,a,d))?(b=datascript.query.lookup_ref_QMARK_.call(null,e),cljs.core.truth_(b)?b:datascript.query.attr_QMARK_.call(null,
e)):b}return e}())?datascript.db.entid_strict.call(null,a,e):e,cljs.core.truth_(datascript.query.lookup_ref_QMARK_.call(null,f))?datascript.db.entid_strict.call(null,a,f):f],null),0,cljs.core.count.call(null,b))}return b};
datascript.query.dynamic_lookup_attrs=function(a,b){var c=cljs.core.nth.call(null,b,0,null),d=cljs.core.nth.call(null,b,1,null),e=cljs.core.nth.call(null,b,2,null);b=cljs.core.nth.call(null,b,3,null);var f=cljs.core.PersistentHashSet.EMPTY;c=cljs.core.truth_(datascript.query.free_var_QMARK_.call(null,c))?cljs.core.conj.call(null,f,c):f;c=cljs.core.truth_(datascript.query.free_var_QMARK_.call(null,b))?cljs.core.conj.call(null,c,b):c;return cljs.core.truth_(function(){var b=datascript.query.free_var_QMARK_.call(null,
e);return cljs.core.truth_(b)?cljs.core.not.call(null,datascript.query.free_var_QMARK_.call(null,d))&&datascript.db.ref_QMARK_.call(null,a,d):b}())?cljs.core.conj.call(null,c,e):c};datascript.query.limit_rel=function(a,b){b=cljs.core.not_empty.call(null,cljs.core.select_keys.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a),b));return null==b?null:cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"attrs","attrs",-2090668713),b)};
datascript.query.limit_context=function(a,b){return cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),cljs.core.keep.call(null,function(a){return datascript.query.limit_rel.call(null,a,b)},(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a)))};
datascript.query.bound_vars=function(a){return cljs.core.into.call(null,cljs.core.PersistentHashSet.EMPTY,cljs.core.mapcat.call(null,function(a){return cljs.core.keys.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(a))},(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a)))};
datascript.query.check_bound=function(a,b,c){if(cljs.core.truth_(clojure.set.subset_QMARK_.call(null,b,a)))return null;a=clojure.set.difference.call(null,cljs.core.set.call(null,b),a);throw cljs.core.ex_info.call(null,["Insufficient bindings: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,a))," not bound in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,c))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",
-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),c,new cljs.core.Keyword(null,"vars","vars",-2046957217),a],null));};
datascript.query.check_free_same=function(a,b,c){b=cljs.core.mapv.call(null,function(b){return clojure.set.difference.call(null,datascript.query.collect_vars.call(null,b),a)},b);if(cljs.core.truth_(cljs.core.apply.call(null,cljs.core._EQ_,b)))return null;throw cljs.core.ex_info.call(null,["All clauses in 'or' must use same set of free vars, had ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,b))," in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
c))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),c,new cljs.core.Keyword(null,"vars","vars",-2046957217),b],null));};
datascript.query.check_free_subset=function(a,b,c){for(var d=cljs.core.set.call(null,cljs.core.remove.call(null,a,b)),e=cljs.core.seq.call(null,c),f=null,g=0,h=0;;)if(h<g){c=cljs.core._nth.call(null,f,h);var k=cljs.core.not_empty.call(null,clojure.set.difference.call(null,d,datascript.query.collect_vars.call(null,c)));if(null!=k)throw e=k,cljs.core.prn.call(null,c,a,b,d),cljs.core.ex_info.call(null,["All clauses in 'or' must use same set of free vars, had ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
e))," not bound in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,c))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),c,new cljs.core.Keyword(null,"vars","vars",-2046957217),e],null));h+=1}else if(c=cljs.core.seq.call(null,e)){e=c;if(cljs.core.chunked_seq_QMARK_.call(null,e))f=cljs.core.chunk_first.call(null,
e),e=cljs.core.chunk_rest.call(null,e),c=f,g=cljs.core.count.call(null,f),f=c;else{c=cljs.core.first.call(null,e);f=cljs.core.not_empty.call(null,clojure.set.difference.call(null,d,datascript.query.collect_vars.call(null,c)));if(null!=f)throw e=f,cljs.core.prn.call(null,c,a,b,d),cljs.core.ex_info.call(null,["All clauses in 'or' must use same set of free vars, had ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,e))," not bound in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,
c))].join(""),new cljs.core.PersistentArrayMap(null,3,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),c,new cljs.core.Keyword(null,"vars","vars",-2046957217),e],null));e=cljs.core.next.call(null,e);f=null;g=0}h=0}else return null};
datascript.query._resolve_clause=function(a){switch(arguments.length){case 2:return datascript.query._resolve_clause.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.query._resolve_clause.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.query._resolve_clause.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.query._resolve_clause.call(null,a,b,b)};
datascript.query._resolve_clause.cljs$core$IFn$_invoke$arity$3=function(a,b,c){for(;;){var d=datascript.query.looks_like_QMARK_,e=b;if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.symbol_QMARK_,new cljs.core.Symbol(null,"*","*",345799209,null)],null)],null),e)))return datascript.query.check_bound.call(null,datascript.query.bound_vars.call(null,a),
cljs.core.filter.call(null,datascript.query.free_var_QMARK_,cljs.core.nfirst.call(null,b)),b),datascript.query.filter_by_pred.call(null,a,b);if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.symbol_QMARK_,new cljs.core.Symbol(null,"*","*",345799209,null)],null),new cljs.core.Symbol(null,"_","_",-1201019570,null)],null),e)))return datascript.query.check_bound.call(null,
datascript.query.bound_vars.call(null,a),cljs.core.filter.call(null,datascript.query.free_var_QMARK_,cljs.core.nfirst.call(null,b)),b),datascript.query.bind_by_fn.call(null,a,b);if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[datascript.query.source_QMARK_,new cljs.core.Symbol(null,"*","*",345799209,null)],null),e))){var f=cljs.core.seq.call(null,b);c=cljs.core.first.call(null,f);f=cljs.core.next.call(null,f);var g=datascript.query._STAR_implicit_source_STAR_;
datascript.query._STAR_implicit_source_STAR_=cljs.core.get.call(null,(new cljs.core.Keyword(null,"sources","sources",-321166424)).cljs$core$IFn$_invoke$arity$1(a),c);try{return datascript.query._resolve_clause.call(null,a,f,b)}finally{datascript.query._STAR_implicit_source_STAR_=g}}else{if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"or","or",1876275696,null),new cljs.core.Symbol(null,"*","*",345799209,null)],
null),e))){var h=b,k=cljs.core.seq.call(null,h),l=cljs.core.first.call(null,k),m=cljs.core.next.call(null,k);f=l;g=m;var n=datascript.query.check_free_same.call(null,datascript.query.bound_vars.call(null,a),g,b),p=cljs.core.map.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n){return function(b){return datascript.query.resolve_clause.call(null,a,b)}}(a,b,c,h,k,l,m,f,g,n,d,e),g);b=cljs.core.map.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p){return function(a){return cljs.core.reduce.call(null,datascript.query.hash_join,
(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a))}}(a,b,c,h,k,l,m,f,g,n,p,d,e),p);return cljs.core.assoc.call(null,cljs.core.first.call(null,p),new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.reduce.call(null,datascript.query.sum_rel,b)],null))}if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,
"or-join","or-join",591375469,null),new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"*","*",345799209,null)],null),new cljs.core.Symbol(null,"*","*",345799209,null)],null),new cljs.core.Symbol(null,"*","*",345799209,null)],null),e))){g=cljs.core.seq.call(null,b);f=cljs.core.first.call(null,g);g=cljs.core.next.call(null,g);h=cljs.core.first.call(null,g);f=cljs.core.next.call(null,
g);h=cljs.core.seq.call(null,h);g=cljs.core.first.call(null,h);h=cljs.core.next.call(null,h);n=g;g=f;f=datascript.query.bound_vars.call(null,a);datascript.query.check_bound.call(null,f,n,c);datascript.query.check_free_subset.call(null,f,h,g);c=cljs.core.list_STAR_.call(null,new cljs.core.Symbol(null,"or-join","or-join",591375469,null),cljs.core.concat.call(null,n,h),g);f=b;b=c;c=f;continue}else{if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,
[new cljs.core.Symbol(null,"or-join","or-join",591375469,null),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"*","*",345799209,null)],null),new cljs.core.Symbol(null,"*","*",345799209,null)],null),e))){l=b;m=cljs.core.seq.call(null,l);var q=cljs.core.first.call(null,m),r=cljs.core.next.call(null,m);f=q;var t=cljs.core.first.call(null,r),u=cljs.core.next.call(null,r);h=t;g=u;var v=cljs.core.set.call(null,h);n=datascript.query.check_free_subset.call(null,
datascript.query.bound_vars.call(null,a),v,g);k=datascript.query.limit_context.call(null,a,v);p=cljs.core.map.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u){return function(a){return datascript.query.limit_context.call(null,datascript.query.resolve_clause.call(null,r,a),p)}}(a,b,c,l,m,q,r,f,t,u,h,g,v,n,k,d,e),g);b=cljs.core.map.call(null,function(a,b,c,d,e,f,g,h,k,l,m,n,p,q,r,t,u,v){return function(a){return cljs.core.reduce.call(null,datascript.query.hash_join,(new cljs.core.Keyword(null,
"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a))}}(a,b,c,l,m,q,r,f,t,u,h,g,v,n,k,p,d,e),p);b=cljs.core.reduce.call(null,datascript.query.sum_rel,b);return cljs.core.update.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),datascript.query.collapse_rels,b)}if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"and","and",668631710,null),new cljs.core.Symbol(null,"*","*",345799209,null)],null),
e)))return c=cljs.core.seq.call(null,b),b=cljs.core.first.call(null,c),c=cljs.core.next.call(null,c),f=b,b=c,cljs.core.reduce.call(null,datascript.query.resolve_clause,a,b);if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"not","not",1044554643,null),new cljs.core.Symbol(null,"*","*",345799209,null)],null),e))){f=cljs.core.seq.call(null,b);b=cljs.core.first.call(null,f);g=cljs.core.next.call(null,f);f=b;b=g;f=
datascript.query.bound_vars.call(null,a);g=datascript.query.collect_vars.call(null,b);if(cljs.core.empty_QMARK_.call(null,clojure.set.intersection.call(null,f,g)))throw cljs.core.ex_info.call(null,["Insufficient bindings: none of ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,g))," is bound in ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.pr_str.call(null,c))].join(""),new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Keyword(null,"error","error",-978969032),
new cljs.core.Keyword("query","where","query/where",-1935159429),new cljs.core.Keyword(null,"form","form",-1624062471),c],null));n=null;a=cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.reduce.call(null,datascript.query.hash_join,(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a))],null));b=cljs.core.reduce.call(null,datascript.query.resolve_clause,
a,b);b=datascript.query.subtract_rel.call(null,datascript.query.single.call(null,(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a)),cljs.core.reduce.call(null,datascript.query.hash_join,(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(b)));return cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null))}if(cljs.core.truth_(d.call(null,
new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"not-join","not-join",-645515756,null),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"*","*",345799209,null)],null),new cljs.core.Symbol(null,"*","*",345799209,null)],null),e)))return b=cljs.core.seq.call(null,b),f=cljs.core.first.call(null,b),b=cljs.core.next.call(null,b),f=cljs.core.first.call(null,b),b=cljs.core.next.call(null,b),h=
f,f=datascript.query.bound_vars.call(null,a),n=datascript.query.check_bound.call(null,f,h,c),a=cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.reduce.call(null,datascript.query.hash_join,(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a))],null)),k=datascript.query.limit_context.call(null,a,h),b=datascript.query.limit_context.call(null,cljs.core.reduce.call(null,
datascript.query.resolve_clause,k,b),h),b=datascript.query.subtract_rel.call(null,datascript.query.single.call(null,(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a)),cljs.core.reduce.call(null,datascript.query.hash_join,(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(b))),cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,
[b],null));if(cljs.core.truth_(d.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"*","*",345799209,null)],null),e))){c=datascript.query._STAR_implicit_source_STAR_;b=datascript.query.resolve_pattern_lookup_refs.call(null,c,b);f=datascript.query.lookup_pattern.call(null,c,b);g=datascript.query._STAR_lookup_attrs_STAR_;datascript.query._STAR_lookup_attrs_STAR_=(null!=c?cljs.core.PROTOCOL_SENTINEL===c.datascript$db$IDB$||(c.cljs$lang$protocol_mask$partition$?
0:cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IDB,c)):cljs.core.native_satisfies_QMARK_.call(null,datascript.db.IDB,c))?datascript.query.dynamic_lookup_attrs.call(null,c,b):datascript.query._STAR_lookup_attrs_STAR_;try{return cljs.core.update.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),datascript.query.collapse_rels,f)}finally{datascript.query._STAR_lookup_attrs_STAR_=g}}else throw Error(["No matching clause: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(e)].join(""));
}}break}};datascript.query._resolve_clause.cljs$lang$maxFixedArity=3;
datascript.query.resolve_clause=function(a,b){if(cljs.core.truth_(datascript.query.rule_QMARK_.call(null,a,b)))if(cljs.core.truth_(datascript.query.source_QMARK_.call(null,cljs.core.first.call(null,b)))){var c=datascript.query._STAR_implicit_source_STAR_;datascript.query._STAR_implicit_source_STAR_=cljs.core.get.call(null,(new cljs.core.Keyword(null,"sources","sources",-321166424)).cljs$core$IFn$_invoke$arity$1(a),cljs.core.first.call(null,b));try{return datascript.query.resolve_clause.call(null,
a,cljs.core.next.call(null,b))}finally{datascript.query._STAR_implicit_source_STAR_=c}}else return cljs.core.update.call(null,a,new cljs.core.Keyword(null,"rels","rels",1770187185),datascript.query.collapse_rels,datascript.query.solve_rule.call(null,a,b));else return datascript.query._resolve_clause.call(null,a,b)};
datascript.query._q=function(a,b){var c=datascript.query._STAR_implicit_source_STAR_;datascript.query._STAR_implicit_source_STAR_=cljs.core.get.call(null,(new cljs.core.Keyword(null,"sources","sources",-321166424)).cljs$core$IFn$_invoke$arity$1(a),new cljs.core.Symbol(null,"$","$",-1580747756,null));try{return cljs.core.reduce.call(null,datascript.query.resolve_clause,a,b)}finally{datascript.query._STAR_implicit_source_STAR_=c}};
datascript.query._collect=function(a){switch(arguments.length){case 2:return datascript.query._collect.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.query._collect.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.query._collect.cljs$core$IFn$_invoke$arity$2=function(a,b){a=(new cljs.core.Keyword(null,"rels","rels",1770187185)).cljs$core$IFn$_invoke$arity$1(a);return datascript.query._collect.call(null,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[me.tonsky.persistent_sorted_set.arrays.make_array.call(null,cljs.core.count.call(null,b))],null),a,b)};
datascript.query._collect.cljs$core$IFn$_invoke$arity$3=function(a,b,c){for(;;){var d=cljs.core.first.call(null,b);if(null==d)return a;var e=d,f=cljs.core.select_keys.call(null,(new cljs.core.Keyword(null,"attrs","attrs",-2090668713)).cljs$core$IFn$_invoke$arity$1(e),c);if(cljs.core.empty_QMARK_.call(null,f)){var g=a,h=cljs.core.next.call(null,b),k=c;a=g;b=h;c=k}else{var l=cljs.core.to_array.call(null,cljs.core.map.call(null,function(a,b,c,d,e,f){return function(a){return cljs.core.get.call(null,
d,a)}}(a,b,c,f,e,d),c)),m=cljs.core.count.call(null,c);g=function(){return function(a,b,c,d,e,f,g,h){return function B(k){return new cljs.core.LazySeq(null,function(a,b,c,d,e,f,g,h){return function(){for(var l=k;;){var m=cljs.core.seq.call(null,l);if(m){var n=m,p=cljs.core.first.call(null,n);m=function(a,b,c,d,e,f,g,h,k,l,m,n){return function X(p){return new cljs.core.LazySeq(null,function(a,b,c,d,e,f,g,h,k,l,m,n){return function(){for(;;){var a=cljs.core.seq.call(null,p);if(a){if(cljs.core.chunked_seq_QMARK_.call(null,
a)){var b=cljs.core.chunk_first.call(null,a),c=cljs.core.count.call(null,b),d=cljs.core.chunk_buffer.call(null,c);return function(){for(var a=0;;)if(a<c){var f=cljs.core._nth.call(null,b,a);cljs.core.chunk_append.call(null,d,function(){for(var a=cljs.core.aclone.call(null,e),b=0;;)if(b<k){var c=h[b];null!=c&&(a[b]=f[c]);b+=1}else break;return a}());a+=1}else return!0}()?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,d),X.call(null,cljs.core.chunk_rest.call(null,a))):cljs.core.chunk_cons.call(null,
cljs.core.chunk.call(null,d),null)}var f=cljs.core.first.call(null,a);return cljs.core.cons.call(null,function(){for(var a=cljs.core.aclone.call(null,e),b=0;;)if(b<k){var c=h[b];null!=c&&(a[b]=f[c]);b+=1}else break;return a}(),X.call(null,cljs.core.rest.call(null,a)))}return null}}}(a,b,c,d,e,f,g,h,k,l,m,n),null,null)}}(l,a,b,c,p,n,m,d,e,f,g,h);if(m=cljs.core.seq.call(null,m.call(null,(new cljs.core.Keyword(null,"tuples","tuples",-676032639)).cljs$core$IFn$_invoke$arity$1(g))))return cljs.core.concat.call(null,
m,B.call(null,cljs.core.rest.call(null,l)));l=cljs.core.rest.call(null,l)}else return null}}}(a,b,c,d,e,f,g,h),null,null)}}(a,b,c,l,m,f,e,d).call(null,a)}();h=cljs.core.next.call(null,b);k=c;a=g;b=h;c=k}}};datascript.query._collect.cljs$lang$maxFixedArity=3;datascript.query.collect=function(a,b){return cljs.core.set.call(null,cljs.core.map.call(null,cljs.core.vec,datascript.query._collect.call(null,a,b)))};datascript.query.IContextResolve=function(){};
datascript.query._context_resolve=function(a,b){if(null!=a&&null!=a.datascript$query$IContextResolve$_context_resolve$arity$2)return a.datascript$query$IContextResolve$_context_resolve$arity$2(a,b);var c=datascript.query._context_resolve[goog.typeOf(null==a?null:a)];if(null!=c)return c.call(null,a,b);c=datascript.query._context_resolve._;if(null!=c)return c.call(null,a,b);throw cljs.core.missing_protocol.call(null,"IContextResolve.-context-resolve",a);};
datascript.parser.Variable.prototype.datascript$query$IContextResolve$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Variable.prototype.datascript$query$IContextResolve$_context_resolve$arity$2=function(a,b){return datascript.query.context_resolve_val.call(null,b,this.symbol)};datascript.parser.SrcVar.prototype.datascript$query$IContextResolve$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.SrcVar.prototype.datascript$query$IContextResolve$_context_resolve$arity$2=function(a,b){return cljs.core.get_in.call(null,b,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Keyword(null,"sources","sources",-321166424),this.symbol],null))};datascript.parser.PlainSymbol.prototype.datascript$query$IContextResolve$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.PlainSymbol.prototype.datascript$query$IContextResolve$_context_resolve$arity$2=function(a,b){a=cljs.core.get.call(null,datascript.query.built_in_aggregates,this.symbol);return cljs.core.truth_(a)?a:datascript.query.resolve_sym.call(null,this.symbol)};datascript.parser.Constant.prototype.datascript$query$IContextResolve$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.Constant.prototype.datascript$query$IContextResolve$_context_resolve$arity$2=function(a,b){return this.value};
datascript.query._aggregate=function(a,b,c){return cljs.core.mapv.call(null,function(a,e,f){if(cljs.core.truth_(datascript.parser.aggregate_QMARK_.call(null,a))){e=datascript.query._context_resolve.call(null,(new cljs.core.Keyword(null,"fn","fn",-1175266204)).cljs$core$IFn$_invoke$arity$1(a),b);a=cljs.core.map.call(null,function(a){return function(a){return datascript.query._context_resolve.call(null,a,b)}}(e),cljs.core.butlast.call(null,(new cljs.core.Keyword(null,"args","args",1315556576)).cljs$core$IFn$_invoke$arity$1(a)));
var d=cljs.core.map.call(null,function(a,b){return function(a){return cljs.core.nth.call(null,a,f)}}(e,a),c);return cljs.core.apply.call(null,e,cljs.core.concat.call(null,a,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[d],null)))}return e},a,cljs.core.first.call(null,c),cljs.core.range.call(null))};
datascript.query.idxs_of=function(a,b){return cljs.core.remove.call(null,cljs.core.nil_QMARK_,cljs.core.map.call(null,function(b,d){return cljs.core.truth_(a.call(null,b))?d:null},b,cljs.core.range.call(null)))};
datascript.query.aggregate=function(a,b,c){var d=datascript.query.idxs_of.call(null,cljs.core.complement.call(null,datascript.parser.aggregate_QMARK_),a),e=function(a){return function(b){return cljs.core.map.call(null,function(a){return function(a){return cljs.core.nth.call(null,b,a)}}(a),a)}}(d);c=cljs.core.group_by.call(null,e,c);return function(c,d,e){return function m(f){return new cljs.core.LazySeq(null,function(c,d,e){return function(){for(;;){var c=cljs.core.seq.call(null,f);if(c){if(cljs.core.chunked_seq_QMARK_.call(null,
c)){var d=cljs.core.chunk_first.call(null,c),e=cljs.core.count.call(null,d),g=cljs.core.chunk_buffer.call(null,e);a:for(var h=0;;)if(h<e){var l=cljs.core._nth.call(null,d,h);cljs.core.nth.call(null,l,0,null);l=cljs.core.nth.call(null,l,1,null);cljs.core.chunk_append.call(null,g,datascript.query._aggregate.call(null,a,b,l));h+=1}else{d=!0;break a}return d?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,g),m.call(null,cljs.core.chunk_rest.call(null,c))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,
g),null)}g=cljs.core.first.call(null,c);cljs.core.nth.call(null,g,0,null);g=cljs.core.nth.call(null,g,1,null);return cljs.core.cons.call(null,datascript.query._aggregate.call(null,a,b,g),m.call(null,cljs.core.rest.call(null,c)))}return null}}}(c,d,e),null,null)}}(d,e,c).call(null,c)};datascript.query.map_STAR_=function(a,b){return cljs.core.reduce.call(null,function(b,d){return cljs.core.conj.call(null,b,a.call(null,d))},cljs.core.empty.call(null,b),b)};
datascript.query.tuples__GT_return_map=function(a,b){a=(new cljs.core.Keyword(null,"symbols","symbols",1211743)).cljs$core$IFn$_invoke$arity$1(a);var c=cljs.core.range.call(null,0,cljs.core.count.call(null,a));return datascript.query.map_STAR_.call(null,function(a,b){return function(c){return cljs.core.reduce.call(null,function(a,b){return function(b,d){return cljs.core.assoc.call(null,b,cljs.core.nth.call(null,a,d),cljs.core.nth.call(null,c,d))}}(a,b),cljs.core.PersistentArrayMap.EMPTY,b)}}(a,c),
b)};datascript.query.IPostProcess=function(){};datascript.query._post_process=function(a,b,c){if(null!=a&&null!=a.datascript$query$IPostProcess$_post_process$arity$3)return a.datascript$query$IPostProcess$_post_process$arity$3(a,b,c);var d=datascript.query._post_process[goog.typeOf(null==a?null:a)];if(null!=d)return d.call(null,a,b,c);d=datascript.query._post_process._;if(null!=d)return d.call(null,a,b,c);throw cljs.core.missing_protocol.call(null,"IPostProcess.-post-process",a);};
datascript.parser.FindRel.prototype.datascript$query$IPostProcess$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindRel.prototype.datascript$query$IPostProcess$_post_process$arity$3=function(a,b,c){return null==b?c:datascript.query.tuples__GT_return_map.call(null,b,c)};datascript.parser.FindColl.prototype.datascript$query$IPostProcess$=cljs.core.PROTOCOL_SENTINEL;
datascript.parser.FindColl.prototype.datascript$query$IPostProcess$_post_process$arity$3=function(a,b,c){return cljs.core.into.call(null,cljs.core.PersistentVector.EMPTY,cljs.core.map.call(null,cljs.core.first),c)};datascript.parser.FindScalar.prototype.datascript$query$IPostProcess$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindScalar.prototype.datascript$query$IPostProcess$_post_process$arity$3=function(a,b,c){return cljs.core.ffirst.call(null,c)};
datascript.parser.FindTuple.prototype.datascript$query$IPostProcess$=cljs.core.PROTOCOL_SENTINEL;datascript.parser.FindTuple.prototype.datascript$query$IPostProcess$_post_process$arity$3=function(a,b,c){return null!=b?cljs.core.first.call(null,datascript.query.tuples__GT_return_map.call(null,b,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.first.call(null,c)],null))):cljs.core.first.call(null,c)};
datascript.query.pull=function(a,b,c){return function(a){return function g(b){return new cljs.core.LazySeq(null,function(a){return function(){for(;;){var c=cljs.core.seq.call(null,b);if(c){var d=c;if(cljs.core.chunked_seq_QMARK_.call(null,d)){var f=cljs.core.chunk_first.call(null,d),h=cljs.core.count.call(null,f),p=cljs.core.chunk_buffer.call(null,h);return function(){for(var b=0;;)if(b<h){var g=cljs.core._nth.call(null,f,b);cljs.core.chunk_append.call(null,p,cljs.core.mapv.call(null,function(a,b,
c,d,f,g,h,k){return function(a,b){if(cljs.core.truth_(a)){var c=cljs.core.nth.call(null,a,0,null);a=cljs.core.nth.call(null,a,1,null);return datascript.pull_api.pull_spec.call(null,c,a,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null),!1)}return b}}(b,g,f,h,p,d,c,a),a,g));b+=1}else return!0}()?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,p),g.call(null,cljs.core.chunk_rest.call(null,d))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,p),
null)}var q=cljs.core.first.call(null,d);return cljs.core.cons.call(null,cljs.core.mapv.call(null,function(a,b,c,d){return function(a,b){if(cljs.core.truth_(a)){var c=cljs.core.nth.call(null,a,0,null);a=cljs.core.nth.call(null,a,1,null);return datascript.pull_api.pull_spec.call(null,c,a,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[b],null),!1)}return b}}(q,d,c,a),a,q),g.call(null,cljs.core.rest.call(null,d)))}return null}}}(a),null,null)}}(function(){return function f(a){return new cljs.core.LazySeq(null,
function(){for(;;){var c=cljs.core.seq.call(null,a);if(c){if(cljs.core.chunked_seq_QMARK_.call(null,c)){var e=cljs.core.chunk_first.call(null,c),k=cljs.core.count.call(null,e),l=cljs.core.chunk_buffer.call(null,k);a:for(var m=0;;)if(m<k){var n=cljs.core._nth.call(null,e,m);cljs.core.chunk_append.call(null,l,cljs.core.truth_(datascript.parser.pull_QMARK_.call(null,n))?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[datascript.query._context_resolve.call(null,(new cljs.core.Keyword(null,
"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(n),b),datascript.pull_parser.parse_pull.call(null,datascript.query._context_resolve.call(null,(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(n),b))],null):null);m+=1}else{e=!0;break a}return e?cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,l),f.call(null,cljs.core.chunk_rest.call(null,c))):cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,l),null)}l=cljs.core.first.call(null,c);
return cljs.core.cons.call(null,cljs.core.truth_(datascript.parser.pull_QMARK_.call(null,l))?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[datascript.query._context_resolve.call(null,(new cljs.core.Keyword(null,"source","source",-433931539)).cljs$core$IFn$_invoke$arity$1(l),b),datascript.pull_parser.parse_pull.call(null,datascript.query._context_resolve.call(null,(new cljs.core.Keyword(null,"pattern","pattern",242135423)).cljs$core$IFn$_invoke$arity$1(l),b))],null):
null,f.call(null,cljs.core.rest.call(null,c)))}return null}},null,null)}.call(null,a)}()).call(null,c)};datascript.query.query_cache=cljs.core.volatile_BANG_.call(null,datascript.lru.lru.call(null,100));
datascript.query.memoized_parse_query=function(a){var b=cljs.core.get.call(null,cljs.core.deref.call(null,datascript.query.query_cache),a,null);null==b&&(b=datascript.parser.parse_query.call(null,a),cljs.core._vreset_BANG_.call(null,datascript.query.query_cache,cljs.core.assoc.call(null,cljs.core._deref.call(null,datascript.query.query_cache),a,b)));return b};
datascript.query.q=function(a){for(var b=[],c=arguments.length,d=0;;)if(d<c)b.push(arguments[d]),d+=1;else break;b=1<b.length?new cljs.core.IndexedSeq(b.slice(1),0,null):null;return datascript.query.q.cljs$core$IFn$_invoke$arity$variadic(arguments[0],b)};
datascript.query.q.cljs$core$IFn$_invoke$arity$variadic=function(a,b){var c=datascript.query.memoized_parse_query.call(null,a),d=(new cljs.core.Keyword(null,"qfind","qfind",1529332972)).cljs$core$IFn$_invoke$arity$1(c),e=datascript.parser.find_elements.call(null,d),f=datascript.parser.find_vars.call(null,d),g=cljs.core.count.call(null,e),h=(new cljs.core.Keyword(null,"qwith","qwith",-45809392)).cljs$core$IFn$_invoke$arity$1(c),k=cljs.core.concat.call(null,f,cljs.core.map.call(null,new cljs.core.Keyword(null,
"symbol","symbol",-1038572696),h));a=cljs.core.sequential_QMARK_.call(null,a)?datascript.parser.query__GT_map.call(null,a):a;var l=(new cljs.core.Keyword(null,"where","where",-2044795965)).cljs$core$IFn$_invoke$arity$1(a);b=datascript.query.resolve_ins.call(null,new datascript.query.Context(cljs.core.PersistentVector.EMPTY,cljs.core.PersistentArrayMap.EMPTY,cljs.core.PersistentArrayMap.EMPTY,null,null,null),(new cljs.core.Keyword(null,"qin","qin",1372651151)).cljs$core$IFn$_invoke$arity$1(c),b);var m=
datascript.query.collect.call(null,datascript.query._q.call(null,b,l),k);f=cljs.core.truth_((new cljs.core.Keyword(null,"with","with",-1536296876)).cljs$core$IFn$_invoke$arity$1(a))?cljs.core.mapv.call(null,function(a,b,c,d,e,f,g,h,k,l,m,I){return function(a){return cljs.core.vec.call(null,cljs.core.subvec.call(null,a,0,f))}}(m,c,d,e,f,g,h,k,a,l,b,m),m):m;f=cljs.core.truth_(cljs.core.some.call(null,datascript.parser.aggregate_QMARK_,e))?datascript.query.aggregate.call(null,e,b,f):f;e=cljs.core.truth_(cljs.core.some.call(null,
datascript.parser.pull_QMARK_,e))?datascript.query.pull.call(null,e,b,f):f;return datascript.query._post_process.call(null,d,(new cljs.core.Keyword(null,"qreturn-map","qreturn-map",1841215994)).cljs$core$IFn$_invoke$arity$1(c),e)};datascript.query.q.cljs$lang$maxFixedArity=1;datascript.query.q.cljs$lang$applyTo=function(a){var b=cljs.core.first.call(null,a);a=cljs.core.next.call(null,a);return this.cljs$core$IFn$_invoke$arity$variadic(b,a)};datascript.core={};datascript.core.tx0=536870912;datascript.core.entity=datascript.impl.entity.entity;datascript.core.entid=datascript.db.entid;datascript.core.entity_db=function(a){if(!cljs.core.truth_(datascript.impl.entity.entity_QMARK_.call(null,a)))throw Error("Assert failed: (de/entity? entity)");return a.db};datascript.core.touch=datascript.impl.entity.touch;datascript.core.pull=datascript.pull_api.pull;datascript.core.pull_many=datascript.pull_api.pull_many;datascript.core.q=datascript.query.q;
datascript.core.empty_db=datascript.db.empty_db;datascript.core.db_QMARK_=datascript.db.db_QMARK_;datascript.core.datom=datascript.db.datom;datascript.core.datom_QMARK_=datascript.db.datom_QMARK_;datascript.core.init_db=datascript.db.init_db;datascript.core.is_filtered=function(a){return a instanceof datascript.db.FilteredDB};
datascript.core.filter=function(a,b){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");if(cljs.core.truth_(datascript.core.is_filtered.call(null,a))){var c=a.unfiltered_db;return new datascript.db.FilteredDB(c,function(a,c,f){return function(a){var d=c.call(null,a);return cljs.core.truth_(d)?b.call(null,f,a):d}}(a,a.pred,c),cljs.core.atom.call(null,0),null,null,null)}return new datascript.db.FilteredDB(a,function(c){return b.call(null,a,c)},cljs.core.atom.call(null,
0),null,null,null)};datascript.core.with$=function(a){switch(arguments.length){case 2:return datascript.core.with$.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.with$.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.with$.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.with$.call(null,a,b,null)};
datascript.core.with$.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");if(cljs.core.truth_(datascript.core.is_filtered.call(null,a)))throw cljs.core.ex_info.call(null,"Filtered DB cannot be modified",new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"error","error",-978969032),new cljs.core.Keyword("transaction","filtered","transaction/filtered",1699706605)],null));return datascript.db.transact_tx_data.call(null,
datascript.db.map__GT_TxReport.call(null,new cljs.core.PersistentArrayMap(null,5,[new cljs.core.Keyword(null,"db-before","db-before",-553691536),a,new cljs.core.Keyword(null,"db-after","db-after",-571884666),a,new cljs.core.Keyword(null,"tx-data","tx-data",934159761),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"tempids","tempids",1767509089),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194),c],null)),b)};
datascript.core.with$.cljs$lang$maxFixedArity=3;datascript.core.db_with=function(a,b){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(datascript.core.with$.call(null,a,b))};
datascript.core.datoms=function(a){switch(arguments.length){case 2:return datascript.core.datoms.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.datoms.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return datascript.core.datoms.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return datascript.core.datoms.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);
case 6:return datascript.core.datoms.cljs$core$IFn$_invoke$arity$6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};datascript.core.datoms.cljs$core$IFn$_invoke$arity$2=function(a,b){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._datoms.call(null,a,b,cljs.core.PersistentVector.EMPTY)};
datascript.core.datoms.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._datoms.call(null,a,b,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null))};
datascript.core.datoms.cljs$core$IFn$_invoke$arity$4=function(a,b,c,d){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._datoms.call(null,a,b,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d],null))};
datascript.core.datoms.cljs$core$IFn$_invoke$arity$5=function(a,b,c,d,e){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._datoms.call(null,a,b,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e],null))};
datascript.core.datoms.cljs$core$IFn$_invoke$arity$6=function(a,b,c,d,e,f){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._datoms.call(null,a,b,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e,f],null))};datascript.core.datoms.cljs$lang$maxFixedArity=6;
datascript.core.seek_datoms=function(a){switch(arguments.length){case 2:return datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],
arguments[3],arguments[4]);case 6:return datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$2=function(a,b){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._seek_datoms.call(null,a,b,cljs.core.PersistentVector.EMPTY)};
datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._seek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null))};
datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$4=function(a,b,c,d){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._seek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d],null))};
datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$5=function(a,b,c,d,e){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._seek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e],null))};
datascript.core.seek_datoms.cljs$core$IFn$_invoke$arity$6=function(a,b,c,d,e,f){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._seek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e,f],null))};datascript.core.seek_datoms.cljs$lang$maxFixedArity=6;
datascript.core.rseek_datoms=function(a){switch(arguments.length){case 2:return datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],
arguments[2],arguments[3],arguments[4]);case 6:return datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$2=function(a,b){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._rseek_datoms.call(null,a,b,cljs.core.PersistentVector.EMPTY)};
datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._rseek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[c],null))};
datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$4=function(a,b,c,d){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._rseek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d],null))};
datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$5=function(a,b,c,d,e){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._rseek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e],null))};
datascript.core.rseek_datoms.cljs$core$IFn$_invoke$arity$6=function(a,b,c,d,e,f){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._rseek_datoms.call(null,a,b,new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[c,d,e,f],null))};datascript.core.rseek_datoms.cljs$lang$maxFixedArity=6;
datascript.core.index_range=function(a,b,c,d){if(!cljs.core.truth_(datascript.db.db_QMARK_.call(null,a)))throw Error("Assert failed: (db/db? db)");return datascript.db._index_range.call(null,a,b,c,d)};
datascript.core.conn_QMARK_=function(a){var b=null!=a?a.cljs$lang$protocol_mask$partition0$&32768||cljs.core.PROTOCOL_SENTINEL===a.cljs$core$IDeref$?!0:a.cljs$lang$protocol_mask$partition0$?!1:cljs.core.native_satisfies_QMARK_.call(null,cljs.core.IDeref,a):cljs.core.native_satisfies_QMARK_.call(null,cljs.core.IDeref,a);return b?datascript.db.db_QMARK_.call(null,cljs.core.deref.call(null,a)):b};
datascript.core.conn_from_db=function(a){return cljs.core.atom.call(null,a,new cljs.core.Keyword(null,"meta","meta",1499536964),new cljs.core.PersistentArrayMap(null,1,[new cljs.core.Keyword(null,"listeners","listeners",394544445),cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY)],null))};
datascript.core.conn_from_datoms=function(a){switch(arguments.length){case 1:return datascript.core.conn_from_datoms.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 2:return datascript.core.conn_from_datoms.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.conn_from_datoms.cljs$core$IFn$_invoke$arity$1=function(a){return datascript.core.conn_from_db.call(null,datascript.core.init_db.call(null,a))};datascript.core.conn_from_datoms.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.conn_from_db.call(null,datascript.core.init_db.call(null,a,b))};datascript.core.conn_from_datoms.cljs$lang$maxFixedArity=2;
datascript.core.create_conn=function(a){switch(arguments.length){case 0:return datascript.core.create_conn.cljs$core$IFn$_invoke$arity$0();case 1:return datascript.core.create_conn.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};datascript.core.create_conn.cljs$core$IFn$_invoke$arity$0=function(){return datascript.core.conn_from_db.call(null,datascript.core.empty_db.call(null))};
datascript.core.create_conn.cljs$core$IFn$_invoke$arity$1=function(a){return datascript.core.conn_from_db.call(null,datascript.core.empty_db.call(null,a))};datascript.core.create_conn.cljs$lang$maxFixedArity=1;
datascript.core._transact_BANG_=function(a,b,c){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");var d=cljs.core.atom.call(null,null);cljs.core.swap_BANG_.call(null,a,function(a){return function(d){d=datascript.core.with$.call(null,d,b,c);cljs.core.reset_BANG_.call(null,a,d);return(new cljs.core.Keyword(null,"db-after","db-after",-571884666)).cljs$core$IFn$_invoke$arity$1(d)}}(d));return cljs.core.deref.call(null,d)};
datascript.core.transact_BANG_=function(a){switch(arguments.length){case 2:return datascript.core.transact_BANG_.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.transact_BANG_.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.transact_BANG_.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.transact_BANG_.call(null,a,b,null)};
datascript.core.transact_BANG_.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");b=datascript.core._transact_BANG_.call(null,a,b,c);c=cljs.core.seq.call(null,function(){var b=(new cljs.core.Keyword(null,"listeners","listeners",394544445)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a));return null==b?null:cljs.core.deref.call(null,b)}());for(var d=null,e=0,f=0;;)if(f<e){var g=cljs.core._nth.call(null,
d,f);cljs.core.nth.call(null,g,0,null);cljs.core.nth.call(null,g,1,null).call(null,b);f+=1}else if(c=cljs.core.seq.call(null,c))d=c,cljs.core.chunked_seq_QMARK_.call(null,d)?(c=cljs.core.chunk_first.call(null,d),f=cljs.core.chunk_rest.call(null,d),d=c,e=cljs.core.count.call(null,c),c=f):(c=cljs.core.first.call(null,d),cljs.core.nth.call(null,c,0,null),cljs.core.nth.call(null,c,1,null).call(null,b),c=cljs.core.next.call(null,d),d=null,e=0),f=0;else break;return b};
datascript.core.transact_BANG_.cljs$lang$maxFixedArity=3;datascript.core.reset_conn_BANG_=function(a){switch(arguments.length){case 2:return datascript.core.reset_conn_BANG_.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.reset_conn_BANG_.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.reset_conn_BANG_.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.reset_conn_BANG_.call(null,a,b,null)};
datascript.core.reset_conn_BANG_.cljs$core$IFn$_invoke$arity$3=function(a,b,c){c=datascript.db.map__GT_TxReport.call(null,new cljs.core.PersistentArrayMap(null,4,[new cljs.core.Keyword(null,"db-before","db-before",-553691536),cljs.core.deref.call(null,a),new cljs.core.Keyword(null,"db-after","db-after",-571884666),b,new cljs.core.Keyword(null,"tx-data","tx-data",934159761),cljs.core.concat.call(null,cljs.core.map.call(null,function(a){return cljs.core.assoc.call(null,a,new cljs.core.Keyword(null,
"added","added",2057651688),!1)},datascript.core.datoms.call(null,cljs.core.deref.call(null,a),new cljs.core.Keyword(null,"eavt","eavt",-666437073))),datascript.core.datoms.call(null,b,new cljs.core.Keyword(null,"eavt","eavt",-666437073))),new cljs.core.Keyword(null,"tx-meta","tx-meta",1159283194),c],null));cljs.core.reset_BANG_.call(null,a,b);for(var d=cljs.core.seq.call(null,function(){var b=(new cljs.core.Keyword(null,"listeners","listeners",394544445)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,
a));return null==b?null:cljs.core.deref.call(null,b)}()),e=null,f=0,g=0;;)if(g<f){var h=cljs.core._nth.call(null,e,g);cljs.core.nth.call(null,h,0,null);cljs.core.nth.call(null,h,1,null).call(null,c);g+=1}else if(d=cljs.core.seq.call(null,d))e=d,cljs.core.chunked_seq_QMARK_.call(null,e)?(d=cljs.core.chunk_first.call(null,e),g=cljs.core.chunk_rest.call(null,e),e=d,f=cljs.core.count.call(null,d),d=g):(d=cljs.core.first.call(null,e),cljs.core.nth.call(null,d,0,null),cljs.core.nth.call(null,d,1,null).call(null,
c),d=cljs.core.next.call(null,e),e=null,f=0),g=0;else break;return b};datascript.core.reset_conn_BANG_.cljs$lang$maxFixedArity=3;datascript.core.atom_QMARK_=function(a){return a instanceof cljs.core.Atom};
datascript.core.listen_BANG_=function(a){switch(arguments.length){case 2:return datascript.core.listen_BANG_.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.listen_BANG_.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.listen_BANG_.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.listen_BANG_.call(null,a,cljs.core.rand.call(null),b)};
datascript.core.listen_BANG_.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");if(!cljs.core.truth_(datascript.core.atom_QMARK_.call(null,(new cljs.core.Keyword(null,"listeners","listeners",394544445)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a)))))throw Error("Assert failed: (atom? (:listeners (meta conn)))");cljs.core.swap_BANG_.call(null,(new cljs.core.Keyword(null,"listeners","listeners",
394544445)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a)),cljs.core.assoc,b,c);return b};datascript.core.listen_BANG_.cljs$lang$maxFixedArity=3;
datascript.core.unlisten_BANG_=function(a,b){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");if(!cljs.core.truth_(datascript.core.atom_QMARK_.call(null,(new cljs.core.Keyword(null,"listeners","listeners",394544445)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,a)))))throw Error("Assert failed: (atom? (:listeners (meta conn)))");return cljs.core.swap_BANG_.call(null,(new cljs.core.Keyword(null,"listeners","listeners",394544445)).cljs$core$IFn$_invoke$arity$1(cljs.core.meta.call(null,
a)),cljs.core.dissoc,b)};datascript.core.data_readers=new cljs.core.PersistentArrayMap(null,2,[new cljs.core.Symbol("datascript","Datom","datascript/Datom",-901340080,null),datascript.db.datom_from_reader,new cljs.core.Symbol("datascript","DB","datascript/DB",-487332776,null),datascript.db.db_from_reader],null);
for(var seq__4559_4569=cljs.core.seq.call(null,datascript.core.data_readers),chunk__4560_4570=null,count__4561_4571=0,i__4562_4572=0;;)if(i__4562_4572<count__4561_4571){var vec__4563_4573=cljs.core._nth.call(null,chunk__4560_4570,i__4562_4572),tag_4574=cljs.core.nth.call(null,vec__4563_4573,0,null),cb_4575=cljs.core.nth.call(null,vec__4563_4573,1,null);cljs.reader.register_tag_parser_BANG_.call(null,tag_4574,cb_4575);var G__4576=seq__4559_4569,G__4577=chunk__4560_4570,G__4578=count__4561_4571,G__4579=
i__4562_4572+1;seq__4559_4569=G__4576;chunk__4560_4570=G__4577;count__4561_4571=G__4578;i__4562_4572=G__4579}else{var temp__5720__auto___4580=cljs.core.seq.call(null,seq__4559_4569);if(temp__5720__auto___4580){var seq__4559_4581__$1=temp__5720__auto___4580;if(cljs.core.chunked_seq_QMARK_.call(null,seq__4559_4581__$1)){var c__4351__auto___4582=cljs.core.chunk_first.call(null,seq__4559_4581__$1),G__4583=cljs.core.chunk_rest.call(null,seq__4559_4581__$1),G__4584=c__4351__auto___4582,G__4585=cljs.core.count.call(null,
c__4351__auto___4582),G__4586=0;seq__4559_4569=G__4583;chunk__4560_4570=G__4584;count__4561_4571=G__4585;i__4562_4572=G__4586}else{var vec__4566_4587=cljs.core.first.call(null,seq__4559_4581__$1),tag_4588=cljs.core.nth.call(null,vec__4566_4587,0,null),cb_4589=cljs.core.nth.call(null,vec__4566_4587,1,null);cljs.reader.register_tag_parser_BANG_.call(null,tag_4588,cb_4589);var G__4590=cljs.core.next.call(null,seq__4559_4581__$1),G__4591=null,G__4592=0,G__4593=0;seq__4559_4569=G__4590;chunk__4560_4570=
G__4591;count__4561_4571=G__4592;i__4562_4572=G__4593}}else break}datascript.core.last_tempid=cljs.core.atom.call(null,-1E6);datascript.core.tempid=function(a){switch(arguments.length){case 1:return datascript.core.tempid.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 2:return datascript.core.tempid.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.tempid.cljs$core$IFn$_invoke$arity$1=function(a){return cljs.core._EQ_.call(null,a,new cljs.core.Keyword("db.part","tx","db.part/tx",-1480923213))?new cljs.core.Keyword("db","current-tx","db/current-tx",1600722132):cljs.core.swap_BANG_.call(null,datascript.core.last_tempid,cljs.core.dec)};
datascript.core.tempid.cljs$core$IFn$_invoke$arity$2=function(a,b){return cljs.core._EQ_.call(null,a,new cljs.core.Keyword("db.part","tx","db.part/tx",-1480923213))?new cljs.core.Keyword("db","current-tx","db/current-tx",1600722132):b};datascript.core.tempid.cljs$lang$maxFixedArity=2;datascript.core.resolve_tempid=function(a,b,c){return cljs.core.get.call(null,b,c)};
datascript.core.db=function(a){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");return cljs.core.deref.call(null,a)};
datascript.core.transact=function(a){switch(arguments.length){case 2:return datascript.core.transact.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.transact.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};datascript.core.transact.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.transact.call(null,a,b,null)};
datascript.core.transact.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");var d=datascript.core.transact_BANG_.call(null,a,b,c);if("undefined"===typeof datascript||"undefined"===typeof datascript.core||"undefined"===typeof datascript.core.t_datascript$core4599)datascript.core.t_datascript$core4599=function(a,b,c,d,k){this.conn=a;this.tx_data=b;this.tx_meta=c;this.res=d;this.meta4600=k;this.cljs$lang$protocol_mask$partition0$=
491520;this.cljs$lang$protocol_mask$partition1$=1},datascript.core.t_datascript$core4599.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a){return function(a,b){return new datascript.core.t_datascript$core4599(this.conn,this.tx_data,this.tx_meta,this.res,b)}}(d),datascript.core.t_datascript$core4599.prototype.cljs$core$IMeta$_meta$arity$1=function(a){return function(a){return this.meta4600}}(d),datascript.core.t_datascript$core4599.prototype.cljs$core$IDeref$_deref$arity$1=function(a){return function(a){return this.res}}(d),
datascript.core.t_datascript$core4599.prototype.cljs$core$IDerefWithTimeout$_deref_with_timeout$arity$3=function(a){return function(a,b,c){return this.res}}(d),datascript.core.t_datascript$core4599.prototype.cljs$core$IPending$_realized_QMARK_$arity$1=function(a){return function(a){return!0}}(d),datascript.core.t_datascript$core4599.getBasis=function(a){return function(){return new cljs.core.PersistentVector(null,5,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"conn","conn",1918841190,
null),new cljs.core.Symbol(null,"tx-data","tx-data",-1720276008,null),new cljs.core.Symbol(null,"tx-meta","tx-meta",-1495152575,null),new cljs.core.Symbol(null,"res","res",245523648,null),new cljs.core.Symbol(null,"meta4600","meta4600",-1631234558,null)],null)}}(d),datascript.core.t_datascript$core4599.cljs$lang$type=!0,datascript.core.t_datascript$core4599.cljs$lang$ctorStr="datascript.core/t_datascript$core4599",datascript.core.t_datascript$core4599.cljs$lang$ctorPrWriter=function(a){return function(a,
b,c){return cljs.core._write.call(null,b,"datascript.core/t_datascript$core4599")}}(d),datascript.core.__GT_t_datascript$core4599=function(a){return function(a,b,c,d,e){return new datascript.core.t_datascript$core4599(a,b,c,d,e)}}(d);return new datascript.core.t_datascript$core4599(a,b,c,d,cljs.core.PersistentArrayMap.EMPTY)};datascript.core.transact.cljs$lang$maxFixedArity=3;
datascript.core.future_call=function(a){var b=cljs.core.atom.call(null,null),c=cljs.core.atom.call(null,!1);setTimeout(function(b,c){return function(){cljs.core.reset_BANG_.call(null,b,a.call(null));return cljs.core.reset_BANG_.call(null,c,!0)}}(b,c),0);if("undefined"===typeof datascript||"undefined"===typeof datascript.core||"undefined"===typeof datascript.core.t_datascript$core4603)datascript.core.t_datascript$core4603=function(a,b,c,g){this.f=a;this.res=b;this.realized=c;this.meta4604=g;this.cljs$lang$protocol_mask$partition0$=
491520;this.cljs$lang$protocol_mask$partition1$=1},datascript.core.t_datascript$core4603.prototype.cljs$core$IWithMeta$_with_meta$arity$2=function(a,b){return function(a,b){return new datascript.core.t_datascript$core4603(this.f,this.res,this.realized,b)}}(b,c),datascript.core.t_datascript$core4603.prototype.cljs$core$IMeta$_meta$arity$1=function(a,b){return function(a){return this.meta4604}}(b,c),datascript.core.t_datascript$core4603.prototype.cljs$core$IDeref$_deref$arity$1=function(a,b){return function(a){return cljs.core.deref.call(null,
this.res)}}(b,c),datascript.core.t_datascript$core4603.prototype.cljs$core$IDerefWithTimeout$_deref_with_timeout$arity$3=function(a,b){return function(a,b,c){return cljs.core.truth_(cljs.core.deref.call(null,this.realized))?cljs.core.deref.call(null,this.res):c}}(b,c),datascript.core.t_datascript$core4603.prototype.cljs$core$IPending$_realized_QMARK_$arity$1=function(a,b){return function(a){return cljs.core.deref.call(null,this.realized)}}(b,c),datascript.core.t_datascript$core4603.getBasis=function(a,
b){return function(){return new cljs.core.PersistentVector(null,4,5,cljs.core.PersistentVector.EMPTY_NODE,[new cljs.core.Symbol(null,"f","f",43394975,null),new cljs.core.Symbol(null,"res","res",245523648,null),new cljs.core.Symbol(null,"realized","realized",1487343404,null),new cljs.core.Symbol(null,"meta4604","meta4604",1013902380,null)],null)}}(b,c),datascript.core.t_datascript$core4603.cljs$lang$type=!0,datascript.core.t_datascript$core4603.cljs$lang$ctorStr="datascript.core/t_datascript$core4603",
datascript.core.t_datascript$core4603.cljs$lang$ctorPrWriter=function(a,b){return function(a,b,c){return cljs.core._write.call(null,b,"datascript.core/t_datascript$core4603")}}(b,c),datascript.core.__GT_t_datascript$core4603=function(a,b){return function(a,b,c,d){return new datascript.core.t_datascript$core4603(a,b,c,d)}}(b,c);return new datascript.core.t_datascript$core4603(a,b,c,cljs.core.PersistentArrayMap.EMPTY)};
datascript.core.transact_async=function(a){switch(arguments.length){case 2:return datascript.core.transact_async.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);case 3:return datascript.core.transact_async.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};
datascript.core.transact_async.cljs$core$IFn$_invoke$arity$2=function(a,b){return datascript.core.transact_async.call(null,a,b,null)};datascript.core.transact_async.cljs$core$IFn$_invoke$arity$3=function(a,b,c){if(!cljs.core.truth_(datascript.core.conn_QMARK_.call(null,a)))throw Error("Assert failed: (conn? conn)");return datascript.core.future_call.call(null,function(){return datascript.core.transact_BANG_.call(null,a,b,c)})};datascript.core.transact_async.cljs$lang$maxFixedArity=3;
datascript.core.rand_bits=function(a){return cljs.core.rand_int.call(null,1<<a)};datascript.core.to_hex_string=function(a,b){a=a.toString(16);var c=cljs.core.count.call(null,a);return c>b?cljs.core.subs.call(null,a,0,b):c<b?[cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.apply.call(null,cljs.core.str,cljs.core.repeat.call(null,b-c,"0"))),cljs.core.str.cljs$core$IFn$_invoke$arity$1(a)].join(""):a};
datascript.core.squuid=function(a){switch(arguments.length){case 0:return datascript.core.squuid.cljs$core$IFn$_invoke$arity$0();case 1:return datascript.core.squuid.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:throw Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join(""));}};datascript.core.squuid.cljs$core$IFn$_invoke$arity$0=function(){return datascript.core.squuid.call(null,(new Date).getTime())};
datascript.core.squuid.cljs$core$IFn$_invoke$arity$1=function(a){return cljs.core.uuid.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,a/1E3|0,8)),"-",cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,datascript.core.rand_bits.call(null,16),4)),"-",cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,datascript.core.rand_bits.call(null,16)&4095|16384,4)),"-",cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,
datascript.core.rand_bits.call(null,16)&16383|32768,4)),"-",cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,datascript.core.rand_bits.call(null,16),4)),cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,datascript.core.rand_bits.call(null,16),4)),cljs.core.str.cljs$core$IFn$_invoke$arity$1(datascript.core.to_hex_string.call(null,datascript.core.rand_bits.call(null,16),4))].join(""))};
datascript.core.squuid.cljs$lang$maxFixedArity=1;datascript.core.squuid_time_millis=function(a){return 1E3*parseInt(cljs.core.subs.call(null,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(a)].join(""),0,8),16)};